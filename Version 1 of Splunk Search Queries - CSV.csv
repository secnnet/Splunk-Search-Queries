_private_splunk_getCloudIndexesInfo,Get indexes information from all available indexers.,always,24h,"| rest [rest splunk_server=local /services/server/info 

                 | eval splunk_server = if(server_roles == ""cluster_search_head"" AND instance_type 
== ""cloud"", ""idx*"", ""local"") 

                 | return splunk_server] 

           /services/data/indexes datatype=all 

| stats sum(currentDBSizeMB) as value_currentDBSizeMB 

        max(maxTime) as value_maxTime 

        min(minTime) as value_minTime 

        first(*) as * 

        by title 

| rename value_currentDBSizeMB AS currentDBSizeMB 

         value_maxTime AS maxTime 

         value_minTime AS minTime  

| join type=outer title [eventcount [rest splunk_server=local /services/server/info 

                                     | eval splunk_server = if(server_roles == ""cluster_search_head"" 
AND instance_type == ""cloud"", ""idx*"", ""local"") 

                                     | return splunk_server] 

                         summarize=f index=* | 

                         stats sum(count) AS totalEventCount by index | 

                         rename index AS title] 

| eval totalEventCount = if(isnotnull(totalEventCount), totalEventCount, 0)"
AWS Dashboard Report Acceleration,,always,24h,"index=* sourcetype=""aws:cloudwatchlogs"" OR sourcetype=""aws:cloudtrail"" OR sourcetype=""aws:metadata"" 
OR sourcetype=""aws:cloudwatch:guardduty""

OR sourcetype=""aws:securityhub:finding"" OR sourcetype=""aws:iam:credentialreport"" OR 
sourcetype=""aws:accessanalyzer:finding""

| rex field=source 
""(?<source_dm_id>[0-9a-f]{8}\b-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-\b[0-9a-f]{12})""

| eval id = if(isnotnull(data_manager_input_id), data_manager_input_id, source_dm_id)

| rex field=source ""^[^:]+:(\/)?(?<cwl_type>[^\/]+)(\/)(?<cwl_service>[^\/]+).+$""

| rex field=source ""^[^:]+:(?<md_category>(iam_|ec2_)\w+)$""

| eval cwl_ds = sourcetype + "":"" + if(cwl_type==""aws"", cwl_service, ""api-gateway"")

| eval metadata_ds = sourcetype + "":"" + md_category

| eval datasource = case(sourcetype == ""aws:cloudwatchlogs"", cwl_ds, sourcetype == ""aws:metadata"", 
metadata_ds, true(), sourcetype)

| eval account_id = coalesce(recipientAccountId, AccountId, AwsAccountId, accountId, account)

| eval region = if(datasource == ""aws:iam:credentialreport"" OR datasource == 
""aws:metadata:iam_users"", ""us-east-1"", coalesce(awsRegion, Region, region))

| stats latest(_time) as last_seen_event, count as num_events_7d, sparkline(count) as 
last_7d_sparkline by id, datasource, region, account_id"
Bucket Merge Retrieve Conf Settings,,always,24h,"| rest services/data/indexes datatype=all 

| search disabled!=1 AND bucketMerging=1 

| dedup title 

| fields title bucketMerging bucketMerge.minMergeSizeMB bucketMerge.maxMergeSizeMB 
bucketMerge.maxMergeTimeSpanSecs bucketMerge.minMergeCount bucketMerge.maxMergeCount"
Cluster CPU Usage,,always,24h,"| mstats avg(_value) prestats=true WHERE `k8s-metrics-index` AND 
metric_name=""kube.cluster.cpu.usage_rate"" span=5m | timechart avg(_value) as ""Avg"" span=5m | eval  
""CPU (Cores)"" = Avg/1000 | fields - Avg"
Cluster Memory Usage,,always,24h,"| mstats avg(_value) prestats=true WHERE `k8s-metrics-index` AND 
metric_name=""kube.cluster.memory.usage"" span=5m | timechart avg(_value) as ""Avg"" span=5m | eval  
""Memory (GB)"" = Avg/1000000000 | fields - Avg"
Disk I/O READ,,always,24h,"| mstats avg(_value) prestats=true WHERE `k8s-metrics-index` AND 
metric_name=""kube.node.disk.io_read_bytes_rate"" span=10s BY ""node"" | timechart avg(_value) as ""Avg"" 
span=10s BY ""node"""
Disk I/O Write,,always,24h,"| mstats avg(_value) prestats=true WHERE `k8s-metrics-index` AND 
metric_name=""kube.node.disk.io_write_bytes_rate"" span=10s BY ""node"" | timechart avg(_value) as ""Avg"" 
span=10s BY ""node"""
Errors in the last 24 hours,,always,24h,error OR failed OR severe OR ( sourcetype=access_* ( 404 OR 500 OR 503 ) )
Errors in the last hour,,always,24h,error OR failed OR severe OR ( sourcetype=access_* ( 404 OR 500 OR 503 ) )
Generate Data Availability ML Model for Latency,,always,24h,"| tstats count values(source) as source avg(_indextime) as indextime where 

    [| inputlookup data_inventory_products_lookup 

    | eval category=case(isnotnull(daily_event_volume) AND daily_event_volume > 50000, 
""highvolumelowlatency"", stage!=""step-sourcetype"", ""normal"", 1=1,""unused"") 

    | lookup SSE-data-availability-products-categorization productId OUTPUT category as 
category_override 

    | eval category=coalesce(category_override, category) 

    | search category=""highvolumelowlatency"" OR category=""normal"" 

    | eval termsearch = if(len(termsearch)>0,""("" . termsearch . "")"",null()) 

    | stats values(termsearch) as search 

    | eval search=""("" . mvjoin(search, "" OR "") . "")"" ] earliest=-30d by index sourcetype _time 
span=5m 

| eval reduce_factor_to_limit_memory_explosion = 10

| where random()%reduce_factor_to_limit_memory_explosion = 1 

| eval lag = indextime - _time - 180 

| stats values(lag) as lag values(source) as source by index sourcetype _time 

| where lag > 0 

| eval productId=null, 

    [| inputlookup data_inventory_products_lookup 

    | eval category=case(isnotnull(daily_event_volume) AND daily_event_volume > 50000, 
""highvolumelowlatency"", stage!=""step-sourcetype"", ""normal"", 1=1,""unused"") 

    | lookup SSE-data-availability-products-categorization productId OUTPUT category as 
category_override 

    | eval category=coalesce(category_override, category) 

    | search category=""highvolumelowlatency"" OR category=""normal"" 

    | eval termsearch = if(len(termsearch)>0,""("" . termsearch . "")"",null()) 

    | rex field=termsearch mode=sed ""s/\""/\\\""/g"" 

    | eval search = ""productId=if(searchmatch(\"""" . termsearch . ""\""), mvappend(productId, \"""" . 
productId . ""\""), productId)"" 

    | stats values(search) as search 

    | eval search=mvjoin(search, "", "")]

| mvexpand productId

| fit DensityFunction lag  by productId upper_threshold=0.01 dist=norm into app:sse_event_lag_model

| stats count as baseline_num_data_samples avg(lag) as baseline_avg_lag min(_time) as 
baseline_earliest max(_time) as baseline_latest by productId | eval baseline_update_last_run = 
now(), baseline_lag_at_last_update = now() - baseline_latest  | outputlookup 
SSE-data_availability_latency_status.csv"
Generate MITRE matrix list,This search formats the MITRE Attack framework table into a list format.,always,24h,"| mitremap

| transpose 100 column_name=""Tactic""

| rename ""row *"" AS technique_*

| untable Tactic Technique_Order Technique

| eval Technique_Order=substr(Technique_Order,11,2)

| sort Technique_Order

| streamstats count AS Tactic_Order

| eval Tactic_Order=if(Technique_Order=""1"",Tactic_Order,null)

| sort Tactic Tactic_Order

| filldown Tactic_Order

| sort Tactic_Order Technique_Order

| eval Matrix=""Enterprise ATT&CK""

| table Matrix Tactic Tactic_Order Technique Technique_Order

| outputlookup mitre_matrix_list.csv"
getIndexesList,"Get indexes information from the indexers, this search is needed to populate the cloud indexes manager page.",always,24h,"| rest splunk_server=idx* /services/data/indexes datatype=all search=""isInternal=0"" f=eai:acl* 
f=datatype f=storage_tier f=disabled f=frozenTimePeriodInSecs f=isVirtual f=max*SizeMB f=archiver* 
f=title f=metric.timestampResolution 

| stats values(eai:acl.app) as eai:acl.app 

        values(datatype) as datatype 

        values(storage_tier) as storage_tier 

        values(disabled) as disabled 

        values(frozenTimePeriodInSecs) as frozenTimePeriodInSecs 

        values(isVirtual) as isVirtual 

        values(maxTotalDataSizeMB) as maxTotalDataSizeMB 

        values(maxGlobalDataSizeMB) as maxGlobalDataSizeMB 

        values(maxGlobalRawDataSizeMB) as maxGlobalRawDataSizeMB 

        values(archiver.selfStorageProvider) as archiver.selfStorageProvider 

        values(archiver.selfStorageBucket) as archiver.selfStorageBucket 

        values(archiver.selfStorageBucketFolder) as archiver.selfStorageBucketFolder 

        values(archiver.coldStorageProvider) as archiver.coldStorageProvider 

        values(archiver.coldStorageRetentionPeriod) as archiver.coldStorageRetentionPeriod 

        values(archiver.enableDataArchive) as archiver.enableDataArchive 

        values(archiver.maxDataArchiveRetentionPeriod) as archiver.maxDataArchiveRetentionPeriod 

        values(metric.timestampResolution) as metric.timestampResolution 

        by title 

| join type=outer title [rest splunk_server=local count=0 /services/data/distributed-indexes 

                         | fields title rawSizeBytes eventCount startEpoch endEpoch 

                         | rename eventCount AS totalEventCount startEpoch AS minTime endEpoch AS 
maxTime] 

| eval totalRawSizeMB = if(isnotnull(rawSizeBytes), round(rawSizeBytes / 1024 / 1024, 2), 0) 

| eval totalEventCount = if(isnotnull(totalEventCount), totalEventCount, 0)"
getMetricTransformsList,Get the list of metric schema transforms for all the indexers,always,24h,|rest splunk_server=idx*  /services/data/transforms/metric-schema
HEC Plugin Queue Length,,always,24h,"`k8s-event-index` sourcetype=""fluentd:monitor-agent"" output_plugin=true type=splunk_hec | timechart 
max(buffer_queue_length) as ""Queue Length"""
HEC Plugin Queue Size,,always,24h,"`k8s-event-index` sourcetype=""fluentd:monitor-agent"" output_plugin=true type=splunk_hec | timechart 
avg(buffer_total_queued_size) as ""Queue Size"""
HEC Plugin Retry Count,,always,24h,"`k8s-event-index` sourcetype=""fluentd:monitor-agent"" output_plugin=true type=splunk_hec | timechart  
sum(retry_count) as ""Retry Count"""
instrumentation.anonymized.eventsByTime,,always,24h,"(index=_introspection OR index=_telemetry) sourcetype=splunk_telemetry source=""http-stream"" 
visibility=*anonymous* | append [| savedsearch instrumentation.licenseUsage]"
instrumentation.anonymous.firstEvent,,always,24h,"(index=_introspection OR index=_telemetry) sourcetype=splunk_telemetry source=""http-stream"" 
visibility=*anonymous* | append [savedsearch instrumentation.licenseUsage] | where date >= 
""$beginDate$"" AND date <= ""$endDate$"" | head 1"
instrumentation.authentication.jwt,,always,24h,"| rest splunk_server=local /services/properties/authorize/tokens_auth/disabled | table value | 
rename value as disabled | appendcols [| search index=_audit action=create_token | stats count | 
rename count as created] | appendcols [| rest splunk_server=local 
/services/configs/conf-authentication |  eval test=if(isnull(scriptPath), 0, 1) | table test | stats 
sum | rename sum(test) as scriptedExtensionsEnabled] | appendcols [| search index = _internal 
source=*/splunkd.log jsonwebtoken validation failed | stats count | rename count as failures] | 
makejson output=data"
instrumentation.deployment.app,,always,24h,"| rest /services/apps/local | eval _time=now() | fields splunk_server title updated version disabled 
| eval 
data=""{\""host\"":\""""+splunk_server+""\"",\""name\"":\""""+title+""\"",\""version\"":\""""+coalesce(version, 
"""")+""\"",\""enabled\"":""+if(disabled=0, ""true"", ""false"")+""}"" | eval date=strftime(_time, ""%Y-%m-%d"") | 
fields data _time date"
instrumentation.deployment.clustering.indexer,,always,24h,"| makeresults annotate=true | append [localop | rest /services/cluster/config] | sort -mode | head 1 
| eval 
data=if(mode==""master"",""{\""host\"":\""""+splunk_server+""\"",\""timezone\"":\""""+strftime(now(),""%z"")+""\"",\""
multiSite\"":""+multisite+"",\""summaryReplication\"":""+if(summary_replication=1,""true"",""false"")+"",\""enab
led\"":true,\""replicationFactor\"":""+tostring(replication_factor)+"",\""siteReplicationFactor\"":""+coales
ce(replace(replace(site_replication_factor, ""origin"", ""\""origin\""""), ""total"", ""\""total\""""), 
""null"")+"",\""siteSearchFactor\"":""+coalesce(replace(replace(site_search_factor, ""origin"", 
""\""origin\""""), ""total"", 
""\""total\""""),""null"")+"",\""searchFactor\"":""+tostring(search_factor)+""}"",""{\""host\"":\""""+splunk_server+""
\"",\""timezone\"":\""""+strftime(now(),""%z"")+""\"",\""enabled\"":false}"") | eval _time=now() | eval 
date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.deployment.featureFlags,,always,24h,"| rest /services/properties splunk_server=local | rename title as conf |  map maxsearches=200 
search=""| rest /services/properties/$conf$ fillContents=1 | rename title as featureFlag  | search 
featureFlag=_feature-flag*"" | fields featureFlag, name, creationDate, disabled, description |  
makejson featureFlag, name, description, disabled, creationDate output=data | outputtelemetry 
input=data anonymous=true support=true component=""deployment.featureFlags"" optinrequired=3 
type=event"
instrumentation.deployment.forwarders,,always,24h,"index=_internal source=*metrics.log* TERM(group=tcpin_connections) (TERM(connectionType=cooked) OR 
TERM(connectionType=cookedSSL)) fwdType=* guid=* | rename sourceIp as forwarderHost | eval 
connectionType=case(fwdType==""uf"" or fwdType==""lwf"" or fwdType==""full"", fwdType, 1==1,""Splunk 
fwder"") | eval version=if(isnull(version),""pre 4.2"",version) | bin _time span=1d | stats sum(kb) as 
kb, latest(connectionType) as connectionType, latest(arch) as arch, latest(os) as os, 
latest(version) as version latest(forwarderHost) as forwarderHost by guid _time | stats 
estdc(forwarderHost) as numHosts estdc(guid) as numInstances 
`instrumentation_distribution_values(kb)` by connectionType arch os version _time | eval 
data=""{\""hosts\"":""+tostring(numHosts)+"",\""instances\"":""+tostring(numInstances)+"",\""architecture\"":\""
""+arch+""\"",\""os\"":\""""+os+""\"",\""splunkVersion\"":\""""+version+""\"",\""type\"":\""""+connectionType+""\"",\""byt
es\"":{"" + `instrumentation_distribution_strings(""kb"",1024,0)` + ""}}"" | eval date=strftime(_time, 
""%Y-%m-%d"") | fields _time date data"
instrumentation.deployment.index,,always,24h,"| rest /services/data/indexes | join type=outer splunk_server title [| rest 
/services/data/indexes-extended] 

| append [| rest /services/data/indexes datatype=metric | join type=outer splunk_server title [| 
rest /services/data/indexes-extended datatype=metric]] 

| eval warm_bucket_size = if(isnotnull('bucket_dirs.home.warm_bucket_size'), 
'bucket_dirs.home.warm_bucket_size', 'bucket_dirs.home.size') 

| eval cold_bucket_size_gb = tostring(round(coalesce('bucket_dirs.cold.bucket_size', 
'bucket_dirs.cold.size', 0) / 1024, 2)) 

| eval warm_bucket_size_gb = tostring(round(coalesce(warm_bucket_size,0) / 1024, 2)) 

| eval hot_bucket_size = tostring(round(coalesce(total_size / 1024 - cold_bucket_size_gb - 
warm_bucket_size_gb, 0),2)) 

| eval hot_bucket_size_gb = tostring(round(coalesce(hot_bucket_size,0) / 1024, 2)) 

| eval thawed_bucket_size_gb = tostring(round(coalesce('bucket_dirs.thawed.bucket_size', 
'bucket_dirs.thawed.size',0) / 1024, 2)) 

| eval warm_bucket_count = tostring(coalesce('bucket_dirs.home.warm_bucket_count', 0)) 

| eval hot_bucket_count = tostring(coalesce('bucket_dirs.home.hot_bucket_count',0)) 

| eval cold_bucket_count = tostring(coalesce('bucket_dirs.cold.bucket_count',0)) 

| eval thawed_bucket_count = tostring(coalesce('bucket_dirs.thawed.bucket_count',0)) 

| eval home_event_count = tostring(coalesce('bucket_dirs.home.event_count',0)) 

| eval cold_event_count = tostring(coalesce('bucket_dirs.cold.event_count',0)) 

| eval thawed_event_count = tostring(coalesce('bucket_dirs.thawed.event_count',0)) 

| eval home_bucket_capacity_gb = coalesce(if('homePath.maxDataSizeMB' == 0, ""\""unlimited\"""", 
round('homePath.maxDataSizeMB' / 1024, 2)), ""\""unlimited\"""") 

| eval cold_bucket_capacity_gb = coalesce(if('coldPath.maxDataSizeMB' == 0, ""\""unlimited\"""", 
round('coldPath.maxDataSizeMB' / 1024, 2)), ""\""unlimited\"""") 

| eval currentDBSizeGB = tostring(round(coalesce(currentDBSizeMB,0) / 1024, 2)) 

| eval maxTotalDataSizeGB = tostring(if(maxTotalDataSizeMB = 0, ""unlimited"", 
coalesce(round(maxTotalDataSizeMB / 1024, 2), ""null""))) 

| eval minTime = tostring(coalesce(strptime(minTime,""%Y-%m-%dT%H:%M:%S%z""),""null"")) 

| eval maxTime = tostring(coalesce(strptime(maxTime,""%Y-%m-%dT%H:%M:%S%z""),""null"")) 

| eval total_bucket_count = tostring(if(isnotnull(total_bucket_count), total_bucket_count, 0)) 

| eval totalEventCount = tostring(coalesce(totalEventCount, 0)) 

| eval total_raw_size_gb = tostring(coalesce(round(total_raw_size / 1024, 2), ""null"")) 

| eval timeResolution = IF('metric.timestampResolution'==""ms"",""millisec"",""sec"") 

| eval index_type = coalesce(datatype ,""event"") 

| rename eai:acl.app as App 

| eval _time=now() 

| fields splunk_server, title,index_type, timeResolution,

currentDBSizeGB, totalEventCount, total_bucket_count, 

total_raw_size_gb, minTime, maxTime, home_bucket_capacity_gb, cold_bucket_capacity_gb, 

hot_bucket_size_gb, warm_bucket_size_gb, cold_bucket_size_gb, thawed_bucket_size_gb, 

hot_bucket_count, warm_bucket_count, cold_bucket_count, thawed_bucket_count, 

home_event_count, cold_event_count, thawed_event_count, 

maxTotalDataSizeGB, maxHotBuckets, maxWarmDBCount App _time 

| eval 
data=""{\""host\"":\""""+splunk_server+""\"",\""name\"":\""""+title+""\"",\""type\"":\""""+index_type+""\"",\""timeResol
ution\"":\""""+timeResolution+""\"",\""app\"":\""""+App+""\"",\""total\"":{\""currentDBSizeGB\"":""+currentDBSizeGB+
"",\""maxDataSizeGB\"":""+maxTotalDataSizeGB+"",\""events\"":""+totalEventCount+"",\""buckets\"":""+total_bucket
_count+"",\""rawSizeGB\"":""+total_raw_size_gb+"",\""minTime\"":""+minTime+"",\""maxTime\"":""+maxTime+""},\""buck
ets\"":{\""homeCapacityGB\"":""+home_bucket_capacity_gb+"",\""homeEventCount\"":""+home_event_count+"",\""cold
CapacityGB\"":""+cold_bucket_capacity_gb+"",\""hot\"":{\""sizeGB\"":""+hot_bucket_size_gb+"",\""count\"":""+hot_
bucket_count+"",\""max\"":""+maxHotBuckets+""},\""warm\"":{\""sizeGB\"":""+warm_bucket_size_gb+"",\""count\"":""+w
arm_bucket_count+""},\""cold\"":{\""sizeGB\"":""+cold_bucket_size_gb+"",\""count\"":""+cold_bucket_count+"",\""e
vents\"":""+cold_event_count+""},\""thawed\"":{\""sizeGB\"":""+thawed_bucket_size_gb+"",\""count\"":""+thawed_bu
cket_count+"",\""events\"":""+thawed_event_count+""}}}"" 

| eval date=strftime(_time, ""%Y-%m-%d"") | fields data _time date"
instrumentation.deployment.node,,always,24h,"index=_introspection sourcetype=splunk_disk_objects component::Partitions | bin _time span=1d | 
stats latest(data.free) as partitionFree, latest(data.capacity) as partitionCapacity by host 
data.fs_type data.mount_point _time | eval 
partitionUtilized=round(1-partitionFree/partitionCapacity,2) | eval 
partitions=""{\""utilization\"":""+`instrumentation_number_format(partitionUtilized,1,2)`+"",\""capacity\""
:""+`instrumentation_number_format(partitionCapacity,1048576,0)`+"",\""fileSystem\"":\""""+'data.fs_type' 
+ ""\""}"" | stats delim="","" values(partitions) as partitions by host _time | rename _time as date | 
mvcombine partitions | rename date as _time | join type=left host _time [search index=_introspection 
sourcetype=splunk_resource_usage component::Hostwide | eval cpuUsage = 'data.cpu_system_pct' + 
'data.cpu_user_pct' | rename data.mem_used as memUsage | bin _time span=1d | stats 
latest(data.cpu_count) as coreCount, latest(data.virtual_cpu_count) as virtualCoreCount, 
latest(data.mem) as memAvailable, latest(data.splunk_version) as splunkVersion, 
latest(data.cpu_arch) as cpuArch, latest(data.os_name) as osName, latest(data.os_name_ext) as 
osNameExt, latest(data.os_version) as osVersion, `instrumentation_distribution_values(cpuUsage)`, 
`instrumentation_distribution_values(memUsage)`, latest(data.instance_guid) as guid by host _time] | 
fillnull value=""null"" coreCount virtualCoreCount memAvailable | eval 
splunkVersion=coalesce(""\""""+splunkVersion+""\"""", ""null""), cpuArch=coalesce(""\""""+cpuArch+""\"""", 
""null""), osName=coalesce(""\""""+osName + ""\"""", ""null""), osNameExt=coalesce(""\""""+osNameExt+""\"""", 
""null""), osVersion=coalesce(""\""""+osVersion+""\"""", ""null""), guid=coalesce(""\""""+guid+""\"""", ""null"") | 
eval data = ""{\""guid\"":""+guid+"",\""host\"":\""""+replace(host,""\"""", ""\\\"""")+""\"",\""partitions\"": "" + 
coalesce(""["" + partitions + ""]"", ""null"") + "",\""cpu\"":{\""architecture\"":""+cpuArch+"",\""coreCount\"":"" + 
tostring(coreCount)+ "",\""virtualCoreCount\"":""+tostring(virtualCoreCount)+"",\""utilization\"":{"" + 
`instrumentation_distribution_strings(""cpuUsage"",.01,2)` + ""}},\""memory\"":""+""{\""capacity\"":""+ 
`instrumentation_number_format(memAvailable,1048576,0)`+"",\""utilization\"":{"" + 
`instrumentation_distribution_strings(""memUsage"",1/memAvailable,2)` + 
""}},\""os\"":""+osName+"",\""osExt\"":""+osNameExt + 
"",\""osVersion\"":""+osVersion+"",\""splunkVersion\"":""+splunkVersion+""}"" | eval date=strftime(_time, 
""%Y-%m-%d"") | fields _time date data"
instrumentation.lastSent,,always,24h,"index=_telemetry source=telemetry sourcetype=splunk_telemetry_log status=success | fillnull 
value=anonymous visibility | eval anonymous_send_time = if(visibility LIKE ""%anonymous%"", _time, 
null) | eval license_send_time = if(visibility LIKE ""%license%"", _time, null) | eval 
support_send_time = if(visibility LIKE ""%support%"", _time, null) | stats latest(anonymous_send_time) 
as latest_anonymous_send_time latest(license_send_time) as latest_license_send_time 
latest(support_send_time) as latest_support_send_time"
instrumentation.license.firstEvent,,always,24h,"| savedsearch instrumentation.licenseUsage | where date >= ""$beginDate$"" AND date <= ""$endDate$"" | 
head 1"
instrumentation.licenseUsage,,always,24h,"NOT() | append [search index=_telemetry type=RolloverSummary | eval date=strftime(_time-43200, 
""%Y-%m-%d"") | eval 
licenseIDs=coalesce(replace(replace(replace(replace(licenseGuids,""\["",""[\""""),""\]"",""\""]""),"","",""\"",\""""
),"" "", """"),""null""), subgroup_id=coalesce(subgroupId, ""Production""), 
group_id=coalesce(""\""""+licenseGroup+""\"""", ""null""), lmGuid=coalesce(""\""""+guid+""\"""", ""null""), 
productType=coalesce(""\""""+productType+""\"""", ""null""), 
type_id=if(substr(stack,1,16)=""fixed-sourcetype"", ""fixed-sourcetype"",stack) | stats max(_time) as 
lastTime latest(stacksz) as stack_quota, latest(poolsz) as pool_quota, sum(b) as consumption by pool 
stack host lmGuid licenseIDs type_id group_id subgroup_id productType date | rename stack as 
stack_id | eval pool=""{\""quota\"":"" + pool_quota+"",\""consumption\"":""+consumption+""}"" | stats 
delim="","" values(pool) as pools, max(lastTime) as lastTime max(stack_quota) as stack_quota 
sum(consumption) as stack_consumption by stack_id group_id subgroup_id type_id lmGuid host 
licenseIDs productType date | mvcombine pools | eval 
_raw=""{\""component\"":\""licensing.stack\"",\""data\"":{\""host\"":\""""+host+""\"",\""guid\"":""+lmGuid+"",\""name\
"":\""""+replace(stack_id,""\"""", ""\\\"""")+""\"",\""type\"":\"""" + type_id + ""\"",\""subgroup\"":\"""" + subgroup_id 
+ ""\"",\""product\"":""+productType+"",\""quota\"":"" + 
stack_quota+"",\""consumption\"":""+stack_consumption+"",\""pools\"":[""+pools+""],\""licenseIDs\"":""+licenseID
s+""}, \""date\"":\""""+date+""\"",\""visibility\"":\""anonymous,license\""}"", _time=lastTime]"
instrumentation.licensing.stack,,always,24h,"index=_telemetry source=*license_usage_summary.log* sourcetype=splunkd TERM(type=RolloverSummary) | 
eval date=strftime(_time, ""%m-%d-%Y""), 
licenseIDs=coalesce(replace(replace(replace(replace(licenseGuids,""\["",""[\""""),""\]"",""\""]""),"","",""\"",\""""
),"" "", """"),""null""), subgroup_id=coalesce(subgroupId, ""Production""), 
group_id=coalesce(""\""""+licenseGroup+""\"""", ""null""), lmGuid=coalesce(""\""""+guid+""\"""", ""null""), 
productType=coalesce(""\""""+productType+""\"""", ""null""), 
type_id=if(substr(stack,1,16)=""fixed-sourcetype"", ""fixed-sourcetype"",stack) | stats latest(stacksz) 
as stack_quota, latest(poolsz) as pool_quota, sum(b) as consumption by pool stack host lmGuid 
licenseIDs type_id group_id subgroup_id productType date | rename stack as stack_id | eval 
pool=""{\""quota\"":"" + pool_quota+"",\""consumption\"":""+consumption+""}"" | stats delim="","" values(pool) 
as pools, max(stack_quota) as stack_quota sum(consumption) as stack_consumption by stack_id group_id 
subgroup_id type_id lmGuid host licenseIDs productType date | mvcombine pools | eval 
data=""{\""host\"":\""""+host+""\"",\""guid\"":""+lmGuid+"",\""name\"":\""""+replace(stack_id,""\"""", 
""\\\"""")+""\"",\""type\"":\"""" + type_id + ""\"",\""subgroup\"":\"""" + subgroup_id + 
""\"",\""product\"":""+productType+"",\""quota\"":"" + 
stack_quota+"",\""consumption\"":""+stack_consumption+"",\""pools\"":[""+pools+""],\""licenseIDs\"":""+licenseID
s+""}"" | eval _time=strptime(date, ""%m-%d-%Y"")-43200 | fields data _time"
instrumentation.performance.bundleReplication,,always,24h,"index=_internal source=*/metrics.log TERM(group=bundles_uploads) | bin _time span=1d | stats count 
as bundles_uploads_count avg(peer_count) as avg_peer_count avg(average_baseline_bundle_bytes) as 
avg_baseline_bundle_bytes max(average_baseline_bundle_bytes) as max_baseline_bundle_bytes 
avg(average_delta_bundle_bytes) as avg_delta_bundle_bytes max(average_delta_bundle_bytes) as 
max_delta_bundle_bytes sum(total_count) as total_count sum(delta_count) as total_delta_count 
sum(success_count) as total_success_count sum(baseline_count) as total_baseline_count 
sum(already_present_count) as total_already_present_count sum(total_msec_spent) as total_msec_spent 
sum(delta_msec_spent) as total_delta_msec_spent sum(total_bytes) as total_bytes sum(delta_bytes) as 
total_delta_bytes by host _time | makejson output=data | eval date=strftime(_time, ""%Y-%m-%d"") | 
fields _time date data"
instrumentation.performance.bundleReplicationCycle,,always,24h,"index=_internal source=*/metrics.log splunk_server=local TERM(group=bundle_replication) 
TERM(name=cycle_dispatch) 

| stats count(cycle_id) as cycleCount avg(peer_count) as avgPeerCount avg(peer_success_count) as 
avgPeerSuccessCount avg(replication_time_msec) as avgReplicationTimeMsec avg(bundle_bytes) as 
avgBundleBytes avg(delta_bundle_bytes) as avgDeltaBundleBytes 

| appendcols [| rest /services/search/distributed/bundle/replication/config splunk_server=local | 
fields replicationPolicy] 

| eval avgPeerCount=round(avgPeerCount,2) | eval avgPeerSuccessCount=round(avgPeerSuccessCount,2) 

| eval avgReplicationTimeMsec=round(avgReplicationTimeMsec,2) | eval 
avgBundleBytes=round(avgBundleBytes,2) | eval avgDeltaBundleBytes=round(avgDeltaBundleBytes,2) 

| makejson output=data | eval _time=now(), date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.performance.indexing,,always,24h,"index=_internal TERM(group=thruput) TERM(name=index_thruput) source=*metrics.log* | bin _time 
span=30s | stats sum(kb) as kb sum(instantaneous_kbps) as instantaneous_kbps by host _time | bin 
_time span=1d | stats sum(kb) as totalKB `instrumentation_distribution_values(instantaneous_kbps)` 
by host _time | eval data=""{\""host\"":\""""+host+""\"",\""thruput\"":{\""total\"":"" + 
tostring(round(totalKB*1024)) + "","" + 
`instrumentation_distribution_strings(""instantaneous_kbps"",1024,0)`+""}}"" | eval date=strftime(_time, 
""%Y-%m-%d"") | fields _time date data"
instrumentation.performance.search,,always,24h,"index=_audit sourcetype=audittrail TERM(action=search) TERM(info=completed) total_run_time=* | eval 
search_et=if(search_et=""N/A"", 0, search_et) | eval search_lt=if(search_lt=""N/A"", exec_time, 
min(exec_time,search_lt)) | eval timerange=search_lt-search_et | bin _time span=1d | stats 
latest(searched_buckets) as searched_buckets latest(total_slices) as total_slices latest(scan_count) 
as scan_count latest(timerange) as timerange latest(total_run_time) as runtime by search_id _time | 
stats `instrumentation_distribution_values(runtime)`, 
`instrumentation_distribution_values(searched_buckets)`, 
`instrumentation_distribution_values(total_slices)`, 
`instrumentation_distribution_values(scan_count)`, `instrumentation_distribution_values(timerange)` 
count as numSearches by _time | eval 
data=""{\""searches\"":""+tostring(numSearches)+"",\""latency\"":{""+`instrumentation_distribution_strings(""
runtime"",1,2)`+""},\""buckets\"":{""+`instrumentation_distribution_strings(""searched_buckets"",1,2)`+""},\
""slices\"":{""+`instrumentation_distribution_strings(""total_slices"",1,2)`+""},\""scanCount\"":{""+`instrum
entation_distribution_strings(""scan_count"",1,2)`+""},\""dayRange\"":{""+`instrumentation_distribution_st
rings(""timerange"",1/86400,2)`+""}}"" | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.reporting,,always,24h,"index=_telemetry source=telemetry sourcetype=splunk_telemetry_log | fields _raw | spath | eval 
time_formatted = strftime(_time, ""%Y-%m-%d %H:%M:%S"") | search (status=success OR status=failed)"
instrumentation.reporting.errors,,always,24h,"index=_telemetry source=telemetry sourcetype=splunk_telemetry_log status=failed 
visibility=*$visibility$*"
instrumentation.reportingErrorCount,,always,24h,"index=_telemetry source=telemetry sourcetype=splunk_telemetry_log status=failed | fillnull 
value=anonymous visibility | stats count(eval(visibility LIKE ""%anonymous%"")) as anonymous_errors 
count(eval(visibility LIKE ""%license%"")) as license_errors count(eval(visibility LIKE ""%support%"")) 
as support_errors"
instrumentation.support.eventsByTime,,always,24h,"(index=_introspection OR index=_telemetry) sourcetype=splunk_telemetry source=""http-stream"" 
visibility=*support* | append [| savedsearch instrumentation.licenseUsage]"
instrumentation.support.firstEvent,,always,24h,"(index=_introspection OR index=_telemetry) sourcetype=splunk_telemetry source=""http-stream"" 
visibility=*support* | append [savedsearch instrumentation.licenseUsage] | where date >= 
""$beginDate$"" AND date <= ""$endDate$"" | head 1"
instrumentation.topology.deployment.clustering.member,,always,24h,"| localop | rest /services/cluster/master/peers | eval 
data=""{\""master\"":\""""+splunk_server+""\"",\""member\"":{\""host\"":\""""+label+""\"",\""guid\"":\""""+title+""\"",\""
status\"":\""""+status+""\""},\""site\"":\""""+site+""\""}"" | where isnotnull(data) | eval _time=now() | eval 
date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.topology.deployment.clustering.searchhead,,always,24h,"| localop | rest /services/cluster/master/searchheads | where splunk_server!=label | eval 
data=""{\""master\"":\""""+splunk_server+""\"",\""searchhead\"":{\""host\"":\""""+label+""\"",\""guid\"":\""""+title+""\
"",\""status\"":\""""+status+""\""},\""site\"":\""""+site+""\""}"" | where isnotnull(data) | eval _time=now() | 
eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.topology.deployment.distsearch.peer,,always,24h,"| localop | rest /services/search/distributed/peers | eval 
data=""{\""host\"":\""""+splunk_server+""\"",\""peer\"":{\""host\"":\""""+peerName+""\"",\""guid\"":\""""+guid+""\"",\""st
atus\"":\""""+status+""\""}}"" | where isnotnull(data) | eval _time=now() | eval date=strftime(_time, 
""%Y-%m-%d"") | fields _time date data"
instrumentation.topology.deployment.licensing.slave,,always,24h,"| localop | rest /services/licenser/slaves | eval 
data=""{\""master\"":\""""+splunk_server+""\"",\""slave\"":{\""host\"":\""""+label+""\"",\""guid\"":\""""+title+""\"",\""p
ool\"":\""""+active_pool_ids+""\""}}"" | where isnotnull(data) | eval _time=now() | eval 
date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.topology.deployment.shclustering.member,,always,24h,"| localop | rest /services/shcluster/captain/members | eval 
data=""{\""site\"":\""""+site+""\"",\""captain\"":\""""+splunk_server+""\"",\""member\"":{\""host\"":\""""+label+""\"",\""
guid\"":\""""+title+""\"",\""status\"":\""""+status+""\""}}"" | where isnotnull(data) | eval _time=now() | eval 
date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.admissionRules.enabled,,always,24h,"NOT() | append [rest splunk_server=local /services/workloads/status/admission-control-status | 
fields enabled]"
instrumentation.usage.admissionRules.rules,,always,24h,"NOT() | append [rest splunk_server=local 
""/services/workloads/rules?workload_rule_type=search_filter"" | 
`hash_admission_rule_predicate(index)` | `hash_admission_rule_predicate(app)` | 
`hash_admission_rule_predicate(user)` | `hash_admission_rule_predicate(role)` | eval 
data=""\""""+sha1(title)+""\"":{\""predicate\"":\""""+predicate+""\""}"" | stats list(data) AS ruleList, count 
AS ruleTotal | eval ruleCombined=mvjoin(ruleList, "", "") | fields ruleTotal, ruleCombined]"
instrumentation.usage.admissionRules.rulesTriggered,,always,24h,"index=_internal sourcetype=wlm_monitor prefilter_action=filter | stats count by prefilter_rule | 
fields prefilter_rule, count | eval data=""{\""searchFilterRule\"":\""""+sha1(prefilter_rule)+""\"", 
\""filteredSearchesCount\"":\""""+count+""\""}"" | stats list(data) AS rulesTriggered, count AS 
rulesTriggeredTotal | eval rulesTriggeredCombined=mvjoin(rulesTriggered, "", "") | fields 
rulesTriggeredTotal, rulesTriggeredCombined"
instrumentation.usage.app.page,,always,24h,"index=_internal sourcetype=splunk_web_access uri_path=""/*/app/*/*"" NOT uri_path=""/*/static/*"" | eval 
uri_parts=split(uri_path, ""/""),locale=mvindex(uri_parts,1), app=mvindex(uri_parts,3), 
page=mvindex(uri_parts,4) | bin _time span=1d | eventstats estdc(user) as appUsers count as 
appOccurrences by app _time | bin _time span=1d | stats latest(locale) as locale count as 
occurrences estdc(user) as users by app page appUsers appOccurrences _time | sort app -occurrences | 
streamstats count as pageRank by app _time | where pageRank<=10 | eval 
data=""{\""app\"":\""""+app+""\"",\""page\"":\""""+page+""\"",\""locale\"":\""""+locale+""\"",\""occurrences\"":"" + 
tostring(occurrences) + "",\""users\"":"" + tostring(users) + ""}"" | eval 
data=if(pageRank==1,data+"";{\""app\"":\""""+app+""\"",\""locale\"":\""""+locale+""\"",\""occurrences\"":"" + 
tostring(appOccurrences) + "",\""users\"":"" + tostring(appUsers) + ""}"", data) | stats values(data) as 
data by app appOccurrences appUsers _time | sort _time -appOccurrences | streamstats count as 
appRank by _time | where appRank<=25 | mvexpand data | makemv delim="";"" data | mvexpand data | eval 
date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.bucketmerge.clustered,,always,24h,"index=_internal source=*mergebuckets.log* (""all peers"" action=merge OR action=dryrun) OR action=list 
| eval command=action | eval newBucketsCount=mergedBuckets | eval 
oldBucketsCount=totalBucketsToMerge | eval indexersCount=if(isnotnull(peers),peers,0) | eval 
bucketsFailedToMergeCount=if(isnotnull(bucketsUnableToMerge),bucketsUnableToMerge,0) |table command, 
newBucketsCount, oldBucketsCount, bucketsFailedToMergeCount, indexersCount | makejson command 
newBucketsCount oldBucketsCount bucketsFailedToMergeCount indexersCount output=""data"" | eval 
_time=now(), date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.bucketmerge.standalone,,always,24h,"index=_internal source=*splunkd-utility.log* component=BucketMergerCmd command=merge OR 
command=dryrun OR command=list | table command, newBucketsCount, oldBucketsCount, durationSec | 
makejson command newBucketsCount oldBucketsCount durationSec output=""data"" | eval _time=now(), 
date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.configaudit.info,,always,24h,"| rest splunk_server=local /services/config_audit/config | eval disabled='info.disabled', 
mode='info.mode', denylist='info.denylist', exclude_fields='info.exclude_fields', 
uses_inotify='info.uses_inotify' | makejson disabled, mode, denylist, exclude_fields, uses_inotify 
output=data | eval _time=now(), date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.configaudit.introspection,,always,24h,"index=_audit action=search info=granted (search=""*index=_c*"" OR search=""*index=*_configaudit*"") NOT 
(search=*""index=*_audit""*) | stats dc(user) AS ""user_count"" count AS ""total_search_count"" | eval 
_time=now() | eval date=strftime(_time, ""%Y-%m-%d"") | makejson user_count total_search_count 
output=data | fields data _time"
instrumentation.usage.configaudit.searches,,always,24h,"index=""_configaudit"" | top limit=500 data.action data.path data.changes{}.stanza 
data.changes{}.properties{}.name | rex field=data.path "".*\/etc\/*(?<path>.*)"" | eval path = 
""$SPLUNK_HOME/etc/"" + 'path' | eval stanza = 'data.changes{}.stanza' | eval prop = 
'data.changes{}.properties{}.name' | eval _time=now() | eval date=strftime(_time, ""%Y-%m-%d"") | 
makejson path stanza prop count output=data | fields data _time"
instrumentation.usage.durableSearch,,always,24h,"| rest servicesNS/-/-/admin/savedsearch | search NOT title=instrumentation.* AND NOT 
durable.track_time_type="""" | eval name=sha1(title), durableTrackTimeType='durable.track_time_type', 
durableLagTime='durable.lag_time', durableBackfillType='durable.backfill_type', 
durableMaxBackfillIntervals='durable.max_backfill_intervals', 
enableSummaryIndex=if('action.summary_index'==1, ""Yes"", ""No"")  | fields name, durableTrackTimeType, 
durableLagTime, durableBackfillType, durableMaxBackfillIntervals, enableSummaryIndex | makejson name 
durableTrackTimeType durableLagTime durableBackfillType durableMaxBackfillIntervals 
enableSummaryIndex output=""data"" | eval _time=now(), date=strftime(_time, ""%Y-%m-%d"") | fields _time 
date data"
instrumentation.usage.healthMonitor.currentState,,always,24h,"| rest /services/apps/local splunk_server=local | search title=search | rename version as 
splunk_version | fields splunk_version 

 | appendcols [| rest services/server/health-config/distributed_health_reporter splunk_server=local 
| eval dist_hr_enabled=if(isnull(disabled) or disabled=='' or disabled==0, 1, 0) | fields 
dist_hr_enabled] 

 | appendcols [| search index=_internal earliest=-1d source=*splunkd_ui_access.log 
(""server/health/splunkd/details"" OR ""server/health/deployment/details"") | stats count as 
click_count] 

 | appendcols [ 

    | rest services/server/health/splunkd/details splunk_server=local 

    | fields + features.* health | rename health as features.health 

    | fields - *.reasons.* *.messages.* 

    | foreach features.* [ eval newname=""splunkd.""+replace(lower(""<<MATCHSTR>>""), "" "", ""_"") | rex 
field=newname mode=sed ""s/features\.|\.health//g"" | eval {newname}='<<FIELD>>'] 

    | fields - features.*, newname 

    | transpose column_name=""features"" | rename ""row 1"" as current_color 

    | join type=outer features [ 

        | search index=_internal earliest=-1d source=*health.log component=PeriodicHealthReporter 

            | stats count as num,  values(color) as colors by node_path 

            | rename node_path as features 

            | eval colors = mvjoin(colors, "","") 

            | eval worst_color = if(match(colors, ""red""), ""red"", (if(match(colors, ""yellow""), 
""yellow"", ""green""))) 

            | fields features, num, colors, worst_color 

    ] 

    | sort by features 

    | eval nodes="""", combin_column=1 

    | foreach features* [eval nodes = ""{\""nodePath\"": \"""" + '<<FIELD>>' + ""\"", \""color\"": \"""" + 
current_color + ""\"", \""worstColorInLast24Hours\"": \"""" + worst_color + ""\""}""] 

    | stats count list(nodes) as node_list by combin_column 

    | eval node_status = mvjoin(node_list, "", "") 

 ] 

 | eval data = ""{\""splunkVersion\"": \"""" + splunk_version + ""\"", \""distribuedHealthReporter\"": 
{\""enabled\"": "" + dist_hr_enabled + ""}, \""healthReportClicks\"": "" + click_count + "", \""nodeStatus\"": 
["" + node_status + ""]}"", _time=now(), date=strftime(_time, ""%Y-%m-%d"") 

 | fields data _time date"
instrumentation.usage.indexing.sourcetype,,always,24h,"index=_internal source=*metrics.log* TERM(group=per_sourcetype_thruput) | bin _time span=1d | stats 
sum(ev) as events, sum(kb) as size, estdc(host) as hosts by series _time | eval 
data=""{\""name\"":\""""+replace(series,""\"""", ""\\\"""") + 
""\"",\""events\"":""+tostring(events)+"",\""bytes\"":""+tostring(round(size*1024))+"",\""hosts\"":""+tostring(ho
sts)+""}"" | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.kvstore,,always,24h,"|rest splunk_server=local /services/kvstore/info | eval data = ""{"" | foreach usage.* [eval data = 
data + ""\""<<FIELD>>\"":\"""" + '<<FIELD>>' + ""\"", "" ] | eval data = rtrim(data, "", "") + ""}"", _time = 
now(), date=strftime(_time, ""%Y-%m-%d"") | fields data _time date"
instrumentation.usage.kvstorebackuprestore,,always,24h,"index=_internal sourcetype=splunkd source=*splunkd.log* component=KVStoreBackupRestore (started AND 
archiveName AND method) | eval usageMethod = if(method==2, ""pointInTime"", ""nonPointInTime"") | stats 
count by usageMethod, action | makejson usageMethod, action, count output=data | eval _time=now(), 
date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.lookups.lookupDefinitions,,always,24h,"|rest splunk_server=local /services/admin/transforms-lookup getsize=true | eval name = 'eai:acl.app' 
+ ""."" + title | rename ""eai:acl.sharing"" AS sharing | eval is_temporal = if(isnull(time_field),0,1) 
| table name type is_temporal size sharing | join type=left name [rest splunk_server=local 
/services/admin/kvstore-collectionstats | table data | mvexpand data | spath input=data | table ns 
size | rename ns as name] | eval name=sha1(name) | makejson output=lookups | stats list(lookups) as 
lookups | eval data = ""{ \""lookups\"" : ["" . mvjoin(lookups,"","") . ""]}"", _time = now(), 
date=strftime(_time, ""%Y-%m-%d"") | fields data _time date"
instrumentation.usage.metrics,,always,24h,"| mcatalog values(_dims) values(sourcetype) values(metric_type) where index=* earliest=-15m by 
metric_name, index | stats count(values(_dims)) AS dimension_count list(values(sourcetype)) AS 
sourcetype list(values(metric_type)) AS metrictype by metric_name, index | eval metrictype = 
if(isnull(metrictype), ""N/A"", metrictype) | fields metric_name, index,  dimension_count, sourcetype, 
metrictype | eval data=""{ \""metricName\"" : \""""+metric_name+""\"", \""indexName\"" : \""""+index+""\"", 
\""dimensionCount\"" : \""""+dimension_count+""\"", \""sourcetype\"" : \""""+sourcetype+""\"", \""metricType\"" : 
\""""+metrictype+""\""}"", _time = now(), date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.rest,,always,24h,"index=_internal useragent=splunk-sdk* | eval endpointuri = case(like(uri_path, 
""%/authorization/capabilities%""), ""authorization/capabilities"", like(uri_path, 
""%/authorization/roles%""), ""authorization/roles"", like(uri_path, ""%/configs/conf-%s%""), 
""configs/conf-%s"", like(uri_path, ""%/properties/%""), ""properties"", like(uri_path, 
""%/saved/eventtypes%""), ""saved/eventtypes"", like(uri_path, ""%/deployment/client%""), 
""deployment/client"", like(uri_path, ""%/deployment/tenants%""), ""deployment/tenants"", like(uri_path, 
""%/deployment/server%""), ""deployment/server"", like(uri_path, ""%/deployment/serverclass%""), 
""deployment/serverclass"", like(uri_path, ""%/storage/passwords%""), ""storage/passwords"", 
like(uri_path, ""%/services/receivers/stream%""), ""/services/receivers/stream"", like(uri_path, 
""%/services/receivers/simple%""), ""/services/receivers/simple"", like(uri_path, 
""%/authentication/users%""), ""authentication/users"", like(uri_path, ""%/saved/searches%""), 
""saved/searches"", like(uri_path, ""%/data/modular_inputs%""), ""data/modular_inputs"", like(uri_path, 
""%/data/input%""), ""data/input"", like(uri_path, ""%/data/indexes%""), ""data/indexes"", like(uri_path, 
""%/alerts/fired_alerts%""), ""/alerts/fired_alerts"", like(uri_path, ""%messages%""), ""messages"", 
like(uri_path, ""%/search/jobs%""), ""search/jobs"" ) | stats count by endpointuri, status, method, 
useragent | eval _time=now(), date=strftime(_time, ""%Y-%m-%d"") | eval data=""{ \""endpointUri\"" : 
\""""+endpointuri+""\"", \""status\"" : \""""+status+""\"", \""method\"" : \""""+method+""\"", \""useragent\"" : 
\""""+useragent+""\"", \""count\"" : \""""+count+""\"" }"" | fields _time date data"
instrumentation.usage.rollup,,always,24h,"| rest servicesNS/-/-/catalog/metricstore/rollup | eval summaryCount=0, target_index_list="""", 
metricOverrideCount=0, name=title, hasDimensionList=if(isnull(dimensionList), ""false"", ""true"") | 
foreach summaries*rollupIndex [| eval summaryCount=if(isnull('<<FIELD>>'), summaryCount, 
summaryCount+1)] | foreach aggregation* [| eval metricOverrideCount=if(isnull('<<FIELD>>'), 
metricOverrideCount, metricOverrideCount+1)] | foreach summaries*rollupIndex [eval 
target_index_list=if(isnotnull('<<FIELD>>'), target_index_list."","".'<<FIELD>>', target_index_list)] 
| eval targetIndex=split('target_index_list',"","")| mvexpand  targetIndex | search NOT targetIndex="""" 
| join type=left targetIndex [| rest /services/data/indexes datatype=metric | eval 
targetIndexDBSizeGB_temp=tostring(round(coalesce(currentDBSizeMB,0) / 1024, 2)) | stats 
sum(targetIndexDBSizeGB_temp) as targetIndexDBSizeGB by title | rename title as targetIndex | fields 
targetIndex, targetIndexDBSizeGB] | fields name, defaultAggregation, summaryCount, hasDimensionList, 
metricOverrideCount, targetIndex, targetIndexDBSizeGB | eval 
targetIndexDBSizeGB=if(targetIndexDBSizeGB==0, ""0 (Check Index to Verify)"", targetIndexDBSizeGB) | 
makejson name defaultAggregation targetIndex targetIndexDBSizeGB hasDimensionList summaryCount(int) 
metricOverrideCount(int) output=""data"" | eval _time=now(), date=strftime(_time, ""%Y-%m-%d"") | fields 
_time date data"
instrumentation.usage.savedSearches.alerts,,always,24h,"| rest servicesNS/-/-/admin/savedsearch | search NOT title=instrumentation.* | eval 
name=sha1(title), alertConditionType=alert_type, actionList=actions, 
triggerMode=if('alert.digest_mode'==1, ""Once"", ""For each result""), alertSeverity='alert.severity', 
alertSuppress=if('alert.suppress'==1, ""Yes"", ""No""), 
alertSuppressGroup=if('alert.suppress.group_name'=="""", ""N/A"", sha1('alert.suppress.group_name')), 
alertTrackable=if('alert.track'==1, ""Yes"", ""No""), cronSchedule=cron_schedule, 
dispatchAllowPartialResults=if('dispatch.allow_partial_results'==1, ""Yes"", ""No"") | fields name, 
alertConditionType, actionList, triggerMode, alertSeverity, alertTrackable, alertSuppress, 
alertSuppressGroup, cronSchedule, dispatchAllowPartialResults | makejson name alertConditionType 
actionList triggerMode alertSeverity alertTrackable alertSuppress cronSchedule alertSuppressGroup 
dispatchAllowPartialResults output=""data"" | eval _time=now(), date=strftime(_time, ""%Y-%m-%d"") | 
fields _time date data"
instrumentation.usage.search.concurrent,,always,24h,"index=_introspection sourcetype=splunk_resource_usage component::PerProcess data.search_props.sid::* 
| bin _time span=10s | stats estdc(data.search_props.sid) AS concurrent_searches by _time host | bin 
_time span=1d | stats `instrumentation_distribution_values(concurrent_searches)` by host _time | 
eval data=""{\""host\"":\""""+host+""\"",\""searches\"":{"" + 
`instrumentation_distribution_strings(""concurrent_searches"",1,0)` +""}}"" | eval date=strftime(_time, 
""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.search.report_acceleration,,always,24h,"| localop | rest /servicesNS/-/-/admin/summarization | stats count as existing_report_accelerations, 
sum(summary.access_count) as access_count_of_existing_report_accelerations | makejson 
access_count_of_existing_report_accelerations(int) existing_report_accelerations(int) output=""data"" 
| eval _time=now(), date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.search.searchTelemetry,,always,24h,"index=_introspection sourcetype=search_telemetry | rename search_commands{}.name as name, 
search_commands{}.duration as duration | stats perc50(duration), perc90(duration), perc95(duration), 
perc99(duration), sum(duration) as totalDuration, sum(bytes_read) as sumBytesRead, count(bytes_read) 
as countBytesRead max(bytes_read) as maxBytesRead by name, type | makejson 
output=searchTypeInformation | fields searchTypeInformation | mvcombine delim="","" 
searchTypeInformation | nomv searchTypeInformation | eval _time=now(), date=strftime(_time, 
""%Y-%m-%d"") | eval data=""{ \""searchTypeInformation\"" : ["".searchTypeInformation.""]}"" | fields _time 
date data"
instrumentation.usage.search.searchtelemetry.sourcetypeUsage,,always,24h,"index=_audit | stats count(sourcetype_count__*) as * | makejson output=sourcetypeUsage | fields 
sourcetypeUsage | mvcombine delim="","" sourcetypeUsage | nomv sourcetypeUsage | eval _time=now(), 
date=strftime(_time, ""%Y-%m-%d"") | eval data=""{ \""sourcetypeUsage\"" : ["".sourcetypeUsage.""]}"" | 
fields _time date data"
instrumentation.usage.search.type,,always,24h,"index=_introspection sourcetype=splunk_resource_usage component::PerProcess data.search_props.sid::* 
| rename data.search_props.type as searchType | bin _time span=1d | stats 
estdc(data.search_props.sid) AS search_count by searchType _time | eval 
data=""\""""+searchType+""\"":""+tostring(search_count) | stats delim="","" values(data) as data by _time | 
rename _time as date | mvcombine data | eval data=""{""+data+""}"" | rename date as _time | eval 
date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.smartStore.accountTypes,,always,24h,"|rest splunk_server=local /services/configs/conf-indexes | eval scheme=if(storageType == ""remote"", 
mvindex(split(path,"":""), 0), ""local"") | eval 
scheme=case(scheme==""gs"",""gcp"",scheme==""s3"",""aws"",scheme!=""local"",scheme) | stats list(scheme) as 
accountTypes delim="","" by splunk_server | nomv accountTypes | fillnull value="""" accountTypes | eval 
accountTypes=""\""accountTypes\"":\"""" + accountTypes + ""\"""" | fields accountTypes, splunk_server"
instrumentation.usage.smartStore.capacity,,always,24h,"|rest splunk_server=local /services/server/status/partitions-space | makejson available, capacity, 
free, fs_type, output=""cap"" | eval cap=""\""""+title+""\"": ""+cap+"""" | stats list(cap) AS capList BY 
splunk_server | eval capCombined=""\""total storage capacity\"":{"" + mvjoin(capList, "", "") + ""}"" | 
fields capCombined, splunk_server"
instrumentation.usage.smartStore.global,,always,24h,"|rest splunk_server=local /services/configs/conf-server | where title in 
(""cachemanager"",""diskUsage"", ""clustering"") | eval 
data=""\""""+title+""\"":"",hotlist_recency_secs=if(isnull(hotlist_recency_secs), ""none"", 
hotlist_recency_secs), 
hotlist_bloom_filter_recency_hours=if(isnull(hotlist_bloom_filter_recency_hours), ""none"", 
hotlist_bloom_filter_recency_hours) | eval data=if(title=""diskUsage"", 
data+""{\""minFreeSpace\"":\""""+minFreeSpace+""\""}"", data), data=if(title=""cachemanager"", 
data+""{\""eviction_padding\"":\""""+eviction_padding+""\"",\""max_cache_size\"":\""""+max_cache_size+""\"", 
\""hotlist_recency_secs\"":\""""+hotlist_recency_secs+""\"", 
\""hotlist_bloom_filter_recency_hours\"":\""""+hotlist_bloom_filter_recency_hours+""\""}"", data), 
data=if(title=""clustering"", data+""{\""mode\"":\""""+mode+""\""""+if(mode=""master"", 
"",\""search_factor\"":\""""+search_factor+""\"",\""multisite\"":\""""+multisite+""\"",\""site_replication_factor\
"":\""""+site_replication_factor+""\"",\""site_search_factor\"":\""""+site_search_factor+""\""}"", ""}""), data) | 
stats list(data) AS dataList BY splunk_server | eval globalConfig=""\""global config\"":{"" + 
mvjoin(dataList, "","") + ""}"" | fields globalConfig, splunk_server"
instrumentation.usage.smartStore.perIndex,,always,24h,"|rest splunk_server=local /services/configs/conf-indexes | appendcols [|rest splunk_server=local 
/servicesNS/nobody/splunk_instrumentation/telemetry | fields telemetrySalt]| eval 
title_dist=if(match(title, ""^([^_].*?)\s*""),""external"",""internal""), 
s2Enabled=if(isnotnull(remotePath),""SmartStore enabled"", ""non-SmartStore 
enabled""),hotlist_recency_secs=if(isnull(hotlist_recency_secs), ""none"", hotlist_recency_secs), 
hotlist_bloom_filter_recency_hours=if(isnull(hotlist_bloom_filter_recency_hours), ""none"", 
hotlist_bloom_filter_recency_hours) | makejson frozenTimePeriodInSecs, hotlist_recency_secs, 
hotlist_bloom_filter_recency_hours, maxHotSpanSecs, maxGlobalDataSizeMB, output=""indexConfig"" | eval 
telemetrySalt=if(isnull(telemetrySalt), """", telemetrySalt), hashTitle=sha1(telemetrySalt+title), 
title_combine=title_dist+""_""+hashTitle, indexConfig=""\""""+title_combine+""\"":"" + indexConfig | stats 
list(hashTitle) AS titleList,list(indexConfig) AS indexList BY s2Enabled, splunk_server | eval 
indexConfig=mvjoin(indexList, "",""), titleCombined=""\""""+s2Enabled+""\"":\"""" + mvjoin(titleList, "","") 
+""\"""" | stats list(titleCombined) AS s2List, list(indexConfig) AS indexList BY splunk_server| eval 
s2Enabled=""\""list of indexes\"":{"" + mvjoin(s2List, "","") + ""}"", indexConfig=""\""per index config\"":{"" 
+ mvjoin(indexList, "","") + ""}""  | fields s2Enabled, indexConfig, splunk_server"
instrumentation.usage.streamingMetricAlerts,,always,24h,"| rest servicesNS/-/-/alerts/metric_alerts | eval name=sha1(title), hasFilter=if(filter=="""", ""No"", 
""Yes""), hasGroupby=if(groupby=="""", ""No"", ""Yes""), 
triggerActionPerGroup=if('trigger.action_per_group'==1, ""Yes"", ""No""), 
triggerEvaluationPerGroup=if('trigger.evaluation_per_group'==1, ""Yes"", ""No""), 
triggerSuppress=if('trigger.suppress'==1, ""Yes"", ""No""), 
triggerPrepare=if(isnotnull('trigger.prepare'), ""Yes"", ""No""), 
alertTrackable=if('splunk_ui.track'==1, ""Yes"", ""No""), 
triggerThreshold=if(isnotnull('trigger.threshold'), 'trigger.threshold', ""N/A""), actionList="""", 
hasDescription=if(description=="""", ""No"", ""Yes""), alertSeverity=if(isnull('splunk_ui.severity'), 
""N/A"", 'splunk_ui.severity'), triggerExpires='trigger.expires', 
triggerMaxTracked='trigger.max_tracked' | eval actionList=if('action.email'==1, 
actionList."","".""email"", actionList), actionList=if('action.logevent'==1, actionList."","".""logevent"", 
actionList), actionList=if('action.rss'==1, actionList."","".""rss"", actionList), 
actionList=if('action.script'==1, actionList."","".""script"", actionList), 
actionList=if('action.webhook'==1, actionList."","".""webhook"", actionList) | eval 
actionList=if(actionList=="""", actionList, substr(actionList,2)) | eval hasLabels=""No"", 
hasComplexCondition=""No"" | foreach label* [| eval hasLabels=if(isnull('<<FIELD>>'), hasLabels, 
""Yes"")] | eval hasMultipleMetricIndexes=if(match(metric_indexes, "",""), ""Yes"", ""No""), 
hasComplexCondition=if(match(condition, ""OR"") OR match(condition, ""AND""), ""Yes"", 
hasComplexCondition) | fields name, hasFilter, hasGroupby, triggerActionPerGroup, 
triggerEvaluationPerGroup, triggerThreshold, triggerSuppress, triggerPrepare, alertTrackable, 
actionList, hasDescription, alertSeverity, triggerExpires, triggerMaxTracked, hasLabels, 
hasMultipleMetricIndexes, hasComplexCondition | makejson name hasFilter hasGroupby 
triggerActionPerGroup triggerEvaluationPerGroup triggerThreshold triggerSuppress triggerPrepare 
alertTrackable actionList hasDescription alertSeverity triggerExpires triggerMaxTracked hasLabels 
hasMultipleMetricIndexes hasComplexCondition output=""data"" | eval _time=now(), date=strftime(_time, 
""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.users.active,,always,24h,"index=_audit sourcetype=audittrail TERM(action=search) user!=""splunk-system-user"" user!=""n/a"" | bin 
_time span=1d | stats estdc(user) as active by _time | eval data=""{\""active\"":""+tostring(active)+""}"" 
| eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.workloadManagement.category,,always,24h,"NOT() | append [rest splunk_server=local /services/workloads/categories | eval 
data=""\""""+title+""\"":{\""allocated cpu percent\"":\""""+cpu_allocated_percent+""\"", \""allocated mem 
limit\"":\""""+mem_allocated_percent+""\""}"" | stats list(data) AS categoryList | eval 
categoryCombined=mvjoin(categoryList, "", "") | fields categoryCombined]"
instrumentation.usage.workloadManagement.enabled,,always,24h,"NOT() | append [rest splunk_server=local /services/workloads/status | eval 
support='general.isSupported', enabled='general.enabled', os_name='general.os_name', 
os_version='general.os_version'| fields support, enabled, os_name, os_version]"
instrumentation.usage.workloadManagement.pools,,always,24h,"NOT() | append [rest splunk_server=local /services/workloads/pools | eval 
isDeafultPool=if(default_category_pool=1, ""True"", ""False""), poolList=""\""""+title+""\"":{\""allocated cpu 
percent\"":\""""+cpu_allocated_percent+""\"", \""allocated mem limit\"":\""""+mem_allocated_percent+""\"", 
\""default category pool\"":\""""+isDeafultPool+""\""}"" | stats list(poolList) AS poolList, count BY 
category | eval poolList=""\""""+category+""\"":{\""count\"":""+count+"",""+mvjoin(poolList, "", "")+""}"" | stats 
sum(count) AS poolTotal list(poolList) AS poolList| eval poolCombined=mvjoin(poolList, "", "") | 
fields poolCombined, poolTotal]"
instrumentation.usage.workloadManagement.rules,,always,24h,"NOT() | append [rest splunk_server=local /services/workloads/rules | eval 
data=""\""""+title+""\"":{\""order\"":\""""+order+""\"", \""predicate\"":\""""+predicate+""\"", \""workload 
pool\"":\""""+workload_pool+""\""}"" | stats list(data) AS ruleList, count AS ruleTotal by splunk_server | 
eval ruleCombined=mvjoin(ruleList, "", "") | fields ruleTotal, ruleCombined]"
Kubernetes Collector Container Logs,,always,24h,"`k8s-event-index` sourcetype=""splunk-fluentd-*"""
Kubernetes Events,,always,24h,"`k8s-event-index` sourcetype=""kube:objects:events:watch"" | rename object.involvedObject.kind as 
Kind,object.involvedObject.name as Name,object.reason as Reason,object.message as Message , 
object.lastTimestamp as LastTime, object.source.component as Component| table Name, Kind, 
Component,Reason, Message, LastTime"
Kubernetes Heapster Logs,,always,24h,"`k8s-event-index` sourcetype=""heapster"""
License Usage Data Cube,,always,24h,"index=_internal source=*license_usage.log* type=""Usage"" | eval h=if(len(h)=0 OR 
isnull(h),""(SQUASHED)"",h) | eval s=if(len(s)=0 OR isnull(s),""(SQUASHED)"",s) | eval idx=if(len(idx)=0 
OR isnull(idx),""(UNKNOWN)"",idx) | bin _time span=1d | stats sum(b) as b by _time, pool, s, st, h, 
idx"
Messages by minute last 3 hours,,always,24h,"index=_internal source=""*metrics.log"" eps ""group=per_source_thruput"" NOT filetracker | eval 
events=eps*kb/kbps | timechart fixedrange=t span=1m limit=5 sum(events) by series"
Namespaces Count,,always,24h,"`k8s-event-index` sourcetype=""kube:objects:namespaces"" [search `k8s-event-index` 
sourcetype=""kube:objects:namespaces"" | dedup ""metadata.requestResourceVersion"" | head 1 | table 
""metadata.requestResourceVersion"" ] | stats count"
Namespaces Details,,always,24h,"`k8s-event-index` sourcetype=""kube:objects:namespaces"" [search `k8s-event-index` 
sourcetype=""kube:objects:namespaces"" | dedup ""metadata.requestResourceVersion"" | head 1 | table 
""metadata.requestResourceVersion"" ] | rename metadata.name as Name, status.phase as 
Status,metadata.creationTimestamp as CreationTime | table Name,Status,CreationTime"
Node Filesystme Usage,,always,24h,"| mstats avg(_value) prestats=true WHERE `k8s-metrics-index` AND 
metric_name=""kube.container.filesystem.usage"" span=5m BY ""node"" | timechart avg(_value) as ""Avg"" 
agg=max limit=5 useother=false span=5m BY ""node"""
Node Netowrk Data Recieved,,always,24h,"| mstats avg(_value) prestats=true WHERE `k8s-metrics-index` AND 
metric_name=""kube.container.network.rx"" span=10s BY ""node"" | timechart avg(_value) as ""Avg"" agg=max 
limit=5 useother=false span=10s BY ""node"""
Node Netowrk Data Transmitted,,always,24h,"| mstats avg(_value) prestats=true WHERE `k8s-metrics-index` AND 
metric_name=""kube.container.network.tx"" span=10s BY ""node"" | timechart avg(_value) as ""Avg"" agg=max 
limit=5 useother=false span=10s BY ""node"""
Nodes Count,,always,24h,"`k8s-event-index` sourcetype=""kube:objects:nodes"" [search `k8s-event-index` 
sourcetype=""kube:objects:nodes"" | dedup ""metadata.requestResourceVersion"" | head 1 | table 
""metadata.requestResourceVersion"" ] | stats count"
Nodes Details,,always,24h,"`k8s-event-index` sourcetype=""kube:objects:nodes"" [search `k8s-event-index` 
sourcetype=""kube:objects:nodes"" | dedup ""metadata.requestResourceVersion"" | head 1 | table 
""metadata.requestResourceVersion"" ]| rename metadata.name as Name,metadata.labels.kubernetes.io/role 
as Role, metadata.labels.failure-domain.beta.kubernetes.io/region as Region, 
metadata.labels.beta.kubernetes.io/instance-type as ""Instance Type"", 
metadata.labels.beta.kubernetes.io/os as OS, metadata.creationTimestamp as CreationTime | table 
Name, Role, Region,""Instance Type"", OS, CreationTime"
Orphaned scheduled searches,,always,24h,"| rest timeout=600 splunk_server=local /servicesNS/-/-/saved/searches add_orphan_field=yes count=0 

| search orphan=1 disabled=0 is_scheduled=1 

| eval status = if(disabled = 0, ""enabled"", ""disabled"") 

| fields title eai:acl.owner eai:acl.app eai:acl.sharing orphan status is_scheduled cron_schedule 
next_scheduled_time next_scheduled_time actions 

| rename title AS ""search name"" eai:acl.owner AS owner eai:acl.app AS app eai:acl.sharing AS sharing"
Pod CPU/Memeory Usage Trend,,always,24h,"| mstats avg(_value) as cpu  WHERE `k8s-metrics-index` AND metric_name=""kube.pod.cpu.usage"" span=10s 
 BY ""pod"" | join type=left _time [ | mstats avg(_value) as memory WHERE `k8s-metrics-index` AND 
metric_name=""kube.pod.memory.usage"" BY span=10s ""pod""] | stats sparkline(avg(cpu)) as ""CPU Usage"", 
sparkline(avg(memory)) as ""Memory Usage"" BY ""pod"""
Pods Count,,always,24h,"`k8s-event-index` sourcetype=""kube:objects:pods"" [search `k8s-event-index` 
sourcetype=""kube:objects:pods"" | dedup ""metadata.requestResourceVersion"" | head 1 | table 
""metadata.requestResourceVersion"" ]| stats count"
Pods Details,,always,24h,"`k8s-event-index` sourcetype=""kube:objects:pods"" [search `k8s-event-index` 
sourcetype=""kube:objects:pods"" | dedup ""metadata.requestResourceVersion"" | head 1 | table 
""metadata.requestResourceVersion"" ] | rename metadata.name as Name,status.phase as 
Status,metadata.namespace as Namespace,spec.nodeName as Node, 
status.containerStatuses{}.restartCount as Restart, status.containerStatuses{}.image as Image, 
metadata.creationTimestamp as CreationTime | table Name, Status, Namespace, Node, Restart, Image, 
CreationTime"
Products and the Content Mapped to Them,"This expects that you have completed the Data Inventory configuration, and mapped your active content on the Manage Bookmarks page. You will then get a complete view from product to the content that it enables.",always,24h,"| inputlookup data_inventory_products_lookup 

| search stage!=step-sourcetype stage!=step-cim 

| rex field=basesearch ""^\s*(?<basesearch>.*?)\s*$""

| eval basesearch=if(like(basesearch, ""(%"") AND like(basesearch, ""%)""), basesearch, ""("" . basesearch 
. "")"") 

| makemv delim=""|"" eventtypeId 

| mvexpand eventtypeId 

| rename eventtypeId as data_source_categories 

| join data_source_categories 

    [| sseanalytics 

    | search search_title!="""" 

    | stats count count(eval(bookmark_status=""successfullyImplemented"")) as 
count_successfullyImplemented values(search_title) as search_title by data_source_categories 

    | eval search_title=mvjoin(search_title, ""|"")] 

| eval Product = vendorName . "" "" . productName

| makemv delim=""|"" data_source_categories | mvexpand data_source_categories

| rex field=data_source_categories ""^(?<ds>[^-]*)"" | sseidenrichment type=datasourceid field=ds | 
sseidenrichment type=dscid field=data_source_categories | eval data_source_categories = data_source 
. "" > "" . data_source_category| stats values(*) as * by Product | search Product!="" "" 

| table Product basesearch data_source_categories metadata_json search_title count 

| spath input=metadata_json | fields - metadata_json

| table Product basesearch data_source_categories search_title * count 

| rename count as ""Total Mapped Content for This Product"" basesearch as ""Dataset That Provides 
Visibility"" search_title as ""Saved Search Name"" data_source_categories as ""Data Source Category"" 
description as Description"
RapidDiag Telemetry: CLI access statistics,,always,24h,"index=_internal sourcetype=""splunk_rapid_diag"" splunk_server=""local"" component=cli_internal 
token_auth=False mode=* action=* result=* 

| table mode, action , result 

| stats count AS data.count by mode, action, result 

| rename mode as data.mode, action as data.action , result AS data.result 

| makejson data.* output=event"
RapidDiag Telemetry: Execution statistics,,always,24h,"index=_internal sourcetype=""splunk_rapid_diag"" splunk_server=""local"" (component=task OR 
(component=collector internal=False)) name=* status=* 

| table component, name, status 

| eval name=substr(sha256(name),0,12) 

| stats count AS data.count by component, name, status 

| rename status as data.status, name as data.metricName, component AS data.type 

| makejson data.* output=event"
RapidDiag Telemetry: UI access statistics,,always,24h,"index=_internal sourcetype=""splunkd_ui_access"" app/splunk_rapid_diag/task_manager OR 
app/splunk_rapid_diag/task_template_wizard OR app/splunk_rapid_diag/data_collection OR 
app/splunk_rapid_diag/reference_guide method=GET splunk_server=""local"" 

| table user, uri_path, status 

| stats count AS data.count by user, uri_path, status 

| eval [| rest splunk_server=local /servicesNS/nobody/splunk_instrumentation/telemetry 

| table telemetrySalt 

| format 

| rex field=search mode=sed ""s/[()]//g""] 

| eval data.user=substr(sha256(telemetrySalt + user),0,12) 

| rename uri_path as data.uri_path, status as data.status 

| makejson data.* output=event"
s2modecheck,"check _internal index path to see if remotePath is configured. If yes, S2 is enabled, if not, it is Non-S2 stack.",always,24h,"| rest splunk_server=idx* /services/data/indexes/_internal datatype=all f=title f=remotePath 
f=disabled"
Saved Searches and the Data that Enables Them,"This expects that you have completed the Data Inventory configuration, and mapped your active content on the Manage Bookmarks page. You will then be get a list oriented to the saved searches, showing each saved search and the data set and products that enable it",always,24h,"| inputlookup data_inventory_products_lookup 

| search stage!=step-sourcetype stage!=step-cim 

| rex field=basesearch ""^\s*(?<basesearch>.*?)\s*$"" 

| eval basesearch=if(like(basesearch, ""(%"") AND like(basesearch, ""%)""), basesearch, ""("" . basesearch 
. "")"") 

| makemv delim=""|"" eventtypeId 

| mvexpand eventtypeId 

| rename eventtypeId as data_source_categories 

| join data_source_categories 

    [| sseanalytics 

    | search search_title!="""" 

    | stats count count(eval(bookmark_status=""successfullyImplemented"")) as 
count_successfullyImplemented values(search_title) as search_title by bookmark_status 
data_source_categories 

    | eval search_title=mvjoin(search_title, ""|"")] 

| eval Product = vendorName . "" "" . productName 

| makemv search_title delim=""|"" 

| mvexpand search_title

| stats values(basesearch) as basesearch values(Product) as Product by search_title

| eval basesearch = ""("" . mvjoin(basesearch, "" OR "") . "")"", ""Products That Provide 
Visibility""=mvjoin(mvfilter(Product!="" ""), "", "")

| rename basesearch as ""Dataset That Provides Visibility"" search_title as ""Saved Search Name""

| table ""Saved Search Name"" ""Dataset That Provides Visibility"" ""Products That Provide Visibility"""
SIM - Total Searchable Index Data,,always,24h,"`sim_searchable_index_storage` 

| logresults tag=TotalSearchableStorage"
SIM Splunkd - Data Parsing Issues,,always,24h,`data_parsing_issues`
SIM Splunkd - Distinct Apps,,always,24h,`distinct_apps`
SIM Splunkd - Distinct Users,,always,24h,`distinct_users`
SIM Splunkd - Long Running Searches,,always,24h,`long_running_searches`
SIM Splunkd - Scheduled Search Skip Ratio,,always,24h,`scheduled_search_skip_ratio`
SIM Splunkd - Total Page Views,,always,24h,`total_page_views`
SIM SS - Forwarder Build Asset Table,,always,24h,"`sim_build_forwarder_assets(1m)` 

| inputlookup append=true sim_forwarder_assets 

| stats values(forwarder_type) as forwarder_type, max(version) as version, values(arch) as arch, 
values(os) as os, max(last_connected) as last_connected, values(new_sum_kb) as sum_kb, 
values(new_avg_tcp_kbps_sparkline) as avg_tcp_kbps_sparkline, values(new_avg_tcp_kbps) as 
avg_tcp_kbps, values(new_avg_tcp_eps) as avg_tcp_eps by guid, hostname 

| addinfo 

| eval status = if(isnull(sum_kb) or (sum_kb <= 0) or (last_connected < (info_max_time - 900)), 
""missing"", ""active"") 

| eval sum_kb = round(sum_kb, 2) 

| eval avg_tcp_kbps = round(avg_tcp_kbps, 2) 

| eval avg_tcp_eps = round(avg_tcp_eps, 2) 

| fields guid, hostname, forwarder_type, version, arch, os, status, last_connected, sum_kb, 
avg_tcp_kbps_sparkline, avg_tcp_kbps, avg_tcp_eps 

| outputlookup sim_forwarder_assets"
SIM SS - License Usage Data Cube,,always,24h,"`sim_set_index_internal` `sim_set_license_master` source=*license_usage.log* type=""Usage"" | eval 
h=if(len(h)=0 OR isnull(h),""(SQUASHED)"",h) | eval s=if(len(s)=0 OR isnull(s),""(SQUASHED)"",s) | bin 
_time span=1d | stats sum(b) as b by _time, s, st, h, idx"
SIM SS - SAML Algorithm Compatibility,,always,24h,"| rest /services/properties/authentication/authentication/authType | fields value

| eval saml_enabled=case(value=""SAML"",1)

| stats count by host,saml_enabled

| stats values(saml_enabled) AS saml_enabled values(name) AS name by host

| fillnull saml_enabled value=0

| eventstats sum(saml_enabled) AS sum_saml

| where sum_saml>0

| fields - sum_saml

| join host type=outer [search (index=splunkd OR index=auth) 
source=/opt/splunk/var/log/splunk/splunkd.log `sim_set_search_head` component=UiSAML log_level=DEBUG 
""IDP response"" ""SignatureMethod Algorithm"" earliest=-60m

  | rex ""<(ds:|)SignatureMethod Algorithm=.+?\#(?<saml_algorithm>.+?)\""( \/|\/)\>""

  | fillnull saml_algorithm value=""unknown""

  | stats count by host,saml_algorithm

  | fields - count]

| eval order=1

| appendpipe [| inputlookup splunk_72_upgrade_saml.csv | eval order=2]

| sort host order saml_algorithm

| stats first(saml_algorithm) AS saml_algorithm first(saml_enabled) AS saml_enabled by host name

| outputlookup splunk_72_upgrade_saml.csv"
SIM SS - SAML Authentication Check,,always,24h,"index=btool file=authentication.conf `sim_set_search_head` stanza=""saml"" OR stanza=""duo-mfa""

| stats latest(signatureAlgorithm) AS signatureAlgorithm by host,stanza

| eval saml=case(stanza=""saml"",""yes"")

| eval duo=case(stanza=""duo-mfa"",""yes"")

| eval sha_status=case(stanza=""saml"" AND signatureAlgorithm=""RSA-SHA1"",1,stanza=""saml"" AND 
signatureAlgorithm=""RSA-SHA256"",0)

| eventstats sum(sha_status) AS sha_status1

| eval sha_status=case(sha_status1=0,""pass"",sha_status1>0,""fail"",isnull(sha_status1) AND 
stanza=""saml"",""unknown"")

| stats values(saml) AS saml values(duo) AS duo values(sha_status) AS sha_status

| outputlookup saml.csv"
SIM SVC - Log Data,,always,24h,"index=""summary"" source=""splunk-virtual-core-usage"" 

| bin _time span=1h 

| rename _time as svc_time 

| convert ctime(svc_time) 

| stats 

  max(License) as License, 

  max(utilization) as Utilization, 

  max(total_util) as total_util, 

  max(Provisioned) as Provisioned, 

  max(total_prov) as total_prov 

  by svc_time, role 

| logresults tag=SVC"
Splunk errors last 24 hours,,always,24h,"index=_internal "" error "" NOT debug source=*splunkd.log*"
Telemetry - AWS Security and CWL Input Snapshot,,always,24h,|dmtelemetryinputslookup |makejson output=data
Telemetry - Data Manager Global Configuration Information,,always,24h,|dmtelemetryglobalconfiglookup |makejson output=data
Top Container CPU Usage,,always,24h,"| mstats avg(_value) prestats=true WHERE `k8s-metrics-index` AND 
metric_name=""kube.container.cpu.usage"" span=5m BY ""container"" | timechart avg(_value) as ""Avg"" 
agg=max limit=5 useother=false span=5m BY ""container"""
Top Container Memory Usage,,always,24h,"| mstats avg(_value) prestats=true WHERE `k8s-metrics-index` AND 
metric_name=""kube.container.memory.usage"" span=5m BY ""container"" | timechart avg(_value) as ""Avg"" 
agg=max limit=5 useother=false span=5m BY ""container"""
_private_splunk_getCloudIndexesInfo,Get indexes information from all available indexers.,always,24h,"| rest [rest splunk_server=local /services/server/info 

                 | eval splunk_server = if(server_roles == ""cluster_search_head"" AND instance_type 
== ""cloud"", ""idx*"", ""local"") 

                 | return splunk_server] 

           /services/data/indexes datatype=all 

| stats sum(currentDBSizeMB) as value_currentDBSizeMB 

        max(maxTime) as value_maxTime 

        min(minTime) as value_minTime 

        first(*) as * 

        by title 

| rename value_currentDBSizeMB AS currentDBSizeMB 

         value_maxTime AS maxTime 

         value_minTime AS minTime  

| join type=outer title [eventcount [rest splunk_server=local /services/server/info 

                                     | eval splunk_server = if(server_roles == ""cluster_search_head"" 
AND instance_type == ""cloud"", ""idx*"", ""local"") 

                                     | return splunk_server] 

                         summarize=f index=* | 

                         stats sum(count) AS totalEventCount by index | 

                         rename index AS title] 

| eval totalEventCount = if(isnotnull(totalEventCount), totalEventCount, 0)"
ActiveDirectory: Create Computer Lookup,,always,24h,`msad-index` `admon-computer-lookup-update`
ActiveDirectory: Create GPO Lookup,,always,24h,`msad-index` `admon-gpo-lookup-update`
ActiveDirectory: Create Group Lookup,,always,24h,`msad-index` `admon-group-lookup-update`
ActiveDirectory: Create User Lookup,,always,24h,`msad-index` `admon-user-lookup-update`
ActiveDirectory: Update Computer Lookup,,always,24h,`msad-index` `admon-computer-lookup-update`
ActiveDirectory: Update GPO Lookup,,always,24h,`msad-index` `admon-gpo-lookup-update`
ActiveDirectory: Update Group Lookup,,always,24h,`msad-index` `admon-group-lookup-update`
ActiveDirectory: Update User Lookup,,always,24h,`msad-index` `admon-user-lookup-update`
AD Objects - App Health - Macro Data Details,,always,24h,"| `ms_ad_obj_cfg_idx_base` 

| mvexpand index 

| join type=left index 

    [| `ms_ad_obj_cfg_idx_avail` ] 

| join type=left index 

    [| `ms_ad_obj_cfg_idx_data` ] 

| sort flag,-Total_Events

| eval Total_Sourcetypes=if(isnull(cmb),0,mvcount(cmb)) 

| fillnull 0 Total_Events,currentDBSizeMB 

| eval flag=if(isnull(index_flag),2,if(currentDBSizeMB<2,1,0)) 

| eval flag_msg=case(flag=2,""index Not Created: "".index,flag=1,""Missing Index Data: 
"".index,flag=0,""OK: "".index)

| rename index as macro_index, cmb as sourcetypes 

| fillnull value=0 Total_Events,currentDBSizeMB 

| makemv delim=""|"" sourcetypes 

| eval Total_Sourcetypes=if(isnull(sourcetypes),0,mvcount(sourcetypes))

| eval sourcetypes=if(isnull(sourcetypes),flag_msg,sourcetypes)

| sort -flag macro_name 

| table 
macro_name,macro_definition,macro_index,flag,flag_msg,Total_Events,Total_Sourcetypes,currentDBSizeMB
,sourcetypes"
AD Objects - App Health - Macro Data Summary,,always,24h,"| `ms_ad_obj_cfg_idx_base`

| mvexpand index

| join type=left index [| `ms_ad_obj_cfg_idx_avail` ]

| join type=left index [| `ms_ad_obj_cfg_idx_data` ]

| sort flag,-Total_Events

| eval Total_Sourcetypes=if(isnull(cmb),0,mvcount(cmb))

| fillnull 0 Total_Events,currentDBSizeMB

| eval flag=if(isnull(index_flag),2,if(isnull(data_flag),1,0))

| eval flag_msg=case(flag=2,""index Not Created: "".index,flag=1,""Missing Index Data: 
"".index,flag=0,""OK: "".index)

| rename index as macro_index, cmb as sourcetypes

| fillnull value=0 Total_Events,currentDBSizeMB

| eval sourcetypes=if(isnull(sourcetypes),flag_msg,sourcetypes)

| makemv delim=""|"" sourcetypes

| sort -flag macro_name

| table 
macro_name,macro_definition,macro_index,flag,flag_msg,Total_Events,currentDBSizeMB,sourcetypes"
AD Objects - App Health - Sourcetype Counts Windows,,always,24h,"| metadata type=sourcetypes index=[| `ms_ad_obj_cfg_idx_base`

| mvexpand index

| table index]

| stats max(lastTime) AS lastTime, , max(firstTime) AS firstTime, sum(totalCount) AS totalCount by 
sourcetype

| sort -totalCount

| eval totalCount=tostring(totalCount,""commas"")

| eval lastTime=strftime(lastTime,""%m/%d/%y %I:%M %P"")

| eval firstTime=strftime(firstTime,""%m/%d/%y %I:%M %P"")"
AD Objects - App Health - Sourcetypes by Indexes,,always,24h,"| `ms_ad_obj_cfg_idx_data`

| makemv delim=""|"" cmb

| mvexpand cmb

| rex field=cmb ""(?<sourcetype>[^\(]+)\((?<Total_Events>[^\)]+)""

| table index,sourcetype,Total_Events"
AD Objects - App Health - Windows Index Details,,always,24h,"| rest /servicesNS/-/-/data/indexes count=0 splunk_server=local

| table title, *

| rename title AS index

| join index [| `ms_ad_obj_cfg_idx_base`

| mvexpand index

| table index]"
AD Objects - Audit - Changes - Computers,,always,24h,"`ms_obj_changes_base_cat(""Computer"")`

| `ms_obj_computer_change_out`

| rename adminuser as ""Admin User"",user as ""Target Computer"",msad_action as 
""Action"",dest_user_subject as ""Target Computer ID"",MSADChanges as ""Changes"""
AD Objects - Audit - Changes - GPO - By Admin Day Summary,,always,24h,"`ms_obj_changes_base_cat(""Group Policy"")`

| fields _time, session_id, src_nt_domain, 
src_user,Object_Name_Guid,displayName,dir_svcs_action,AttributeLDAPDisplayName,AttributeValue,MSADCh
angedAttributes,Correlation_ID,signature,msad_action,Old_DN,New_DN

| fillnull value="""" Correlation_ID,msad_action

| eval Object_Lookup_Name=""{"".upper(Object_Name_Guid).""}"" 

| lookup AD_Obj_GPO cn AS Object_Lookup_Name OUTPUT displayName 

| join type=left Object_Lookup_Name [| inputlookup AD_Obj_GPO | fields cn,displayName | rename cn AS 
Object_Lookup_Name | table Object_Lookup_Name,displayName]

| eval displayName=if(isnull(displayName),Object_Lookup_Name."" GPO CN not found"",displayName) 

| join type=left src_user [| inputlookup AD_Obj_User | fields cn,sAMAccountName | rename 
sAMAccountName as src_user,cn AS Admin | table Admin,src_user]

| eval Admin=if(isnull(Admin),src_user,Admin."" ("".src_user."")"")

| eval Day=strftime(_time,""%m/%d/%y"")

| stats count by displayName, Admin,Day

| eval comb=""|"".displayName."" ("".count."")""

| sort -count

| stats list(comb) AS Daily_Change_Summary, sum(count) AS Total_Events by Admin,Day

| makemv delim=""|"" Daily_Change_Summary

| sort -Day 

| xyseries  Day Admin Daily_Change_Summary"
AD Objects - Audit - Changes - Group,,always,24h,"`ms_obj_changes_base_cat(""Group"")` 

| `ms_obj_group_change_out`

| fields - member_obj_lkp

| rename adminuser as ""Administrator"",msad_action as ""Action"",group_obj_nm as ""Group 
Name"",MSADGroupType as ""Group Type"",MSADGroupClass AS ""Group Class"",signature as ""Changes"""
AD Objects - Audit - Changes - Group All,,always,24h,"`ms_obj_changes_base_cat(""Group*"")`

| fields 
_time,_raw,member_obj_dn,member_obj_id,member_obj_domain,member_obj_class,src_user,src_nt_domain,gro
up_obj_id,Group_Name,group_obj_nm,user_group,msad_action,MSADGroupClassID,MSADGroupType,MSADGroupCla
ss,signature,Correlation_ID,MSADChangedAttributes,AttributeLDAPDisplayName,AttributeValue,DN,dir_svc
s_action,Old_DN,New_DN

| `ms_obj_group_change_out`

| rename adminuser as ""Administrator"",msad_action as ""Action"",group_obj_nm as 
""Target_Group"",MSADGroupType as ""Target Group Type"",MSADGroupClass AS ""Target Group Class"",member AS 
""Target Member"",MSADChanges as ""Changes"""
AD Objects - Audit - Changes - Group Membership,,always,24h,"`ms_obj_changes_base_cat(""Group Membership"")`

| `ms_obj_groupmembership_change_out`

| rename  group_obj_nm as ""Target_Group"",MSADGroupClass as ""Class"",msad_action AS ""Action"",member AS 
""Target Member"",member_obj_lkp AS ""Target Member Lookup"",MSADGroupType as ""Type"",adminuser as ""Admin 
User"",MSADChanges as ""Changes"""
AD Objects - Audit - Changes - Group Membership Add,,always,24h,"`ms_obj_changes_base_cat_act(""Group Membership"",""added"")`

| fields 
_time,_raw,member_obj_dn,member_obj_id,member_obj_domain,member_obj_class,src_user,src_nt_domain,gro
up_obj_id,Group_Name,group_obj_nm,user_group,msad_action,MSADGroupClassID,MSADGroupType,MSADGroupCla
ss,signature,Correlation_ID,MSADChangedAttributes,AttributeLDAPDisplayName,AttributeValue,DN,dir_svc
s_action,Old_DN,New_DN

| `ms_obj_group_change_out`

| rename adminuser as ""Administrator"",msad_action as ""Action"",group_obj_nm as 
""Target_Group"",MSADGroupType as ""Target Group Type"",MSADGroupClass AS ""Target Group Class"",member AS 
""Target Member"",MSADChanges as ""Changes"""
AD Objects - Audit - Changes - Group Membership Remove,,always,24h,"`ms_obj_changes_base_cat_act(""Group Membership"",""removed"")`

| fields 
_time,_raw,member_obj_dn,member_obj_id,member_obj_domain,member_obj_class,src_user,src_nt_domain,gro
up_obj_id,Group_Name,group_obj_nm,user_group,msad_action,MSADGroupClassID,MSADGroupType,MSADGroupCla
ss,signature,Correlation_ID,MSADChangedAttributes,AttributeLDAPDisplayName,AttributeValue,DN,dir_svc
s_action,Old_DN,New_DN

| `ms_obj_group_change_out`

| rename adminuser as ""Administrator"",msad_action as ""Action"",group_obj_nm as 
""Target_Group"",MSADGroupType as ""Target Group Type"",MSADGroupClass AS ""Target Group Class"",member AS 
""Target Member"",MSADChanges as ""Changes"""
AD Objects - Audit - Changes - Group Policies,,always,24h,"`ms_obj_changes_base_cat(""Group Policy"")`

| fields _time, session_id, src_nt_domain, 
src_user,Object_Name_Guid,displayName,dir_svcs_action,AttributeLDAPDisplayName,AttributeValue,MSADCh
angedAttributes,Correlation_ID,signature,msad_action,Old_DN,New_DN

| fillnull value="""" Correlation_ID,msad_action

| eval adminuser=if(isnull(src_nt_domain),src_user,src_nt_domain.""\\"".src_user) 

| eval Object_Lookup_Name=""{"".lower(Object_Name_Guid).""}"" 

| join type=left Object_Lookup_Name [| inputlookup AD_Obj_GPO | fields cn, displayName | rename cn 
AS Object_Lookup_Name | table Object_Lookup_Name, displayName]

| eval displayName=if(isnull(displayName),""Warning: "".Object_Lookup_Name."" GPO CN not found in the 
AD_Obj_GPO Lookup. If GPO is new wait 15 minutes and run report again, or check that 
ms_ad_obj_sched_sync_gpo scheduled search is running as scheduled."",displayName) 

| `ms_obj_msad-changed-attributes`

| stats max(_time) AS last_time, min(_time) AS start_time,list(MSADChanges) AS 
MSADChanges,values(Correlation_ID) AS Correlation_IDs by 
session_id,Object_Lookup_Name,displayName,adminuser,signature,msad_action

| eval MSADChanges=mvjoin(MSADChanges, ""########"")

| eval MSADChanges=case(isnull(signature) AND isnull(MSADChanges),""Unknown 
Changes"",isnull(signature),MSADChanges,isnotnull(MSADChanges),""Signature: 
"".signature.""########"".MSADChanges)

| eval Session_Time=""Session ID ("".session_id."")|Start: "".strftime(start_time,""%m/%d/%y %I:%M:%S 
%P"").""|End: "".strftime(last_time,""%m/%d/%y %I:%M:%S %P"")

| table displayName,adminuser,Session_Time,msad_action,Correlation_IDs,MSADChanges

| makemv delim=""########"" MSADChanges

| makemv delim=""|"" Session_Time

| rename adminuser as ""Administrator"",msad_action as ""Action"",displayName as ""GPO Name"",MSADChanges 
as ""Changes"""
AD Objects - Audit - Changes - OU,,always,24h,"`ms_obj_changes_base_cat(""OU"")` (src_nt_domain=""*"" OR dest_nt_domain=""*"")

| fields 
_raw,_time,chg_gp_guid,dir_svcs_action,signature,LDAP_Display_Name,gpo_name,ou_obj_dn,DN,Old_DN,New_
DN,Correlation_ID,Value,LDAP_Display_Name,chg_gp_guid,src_user,src_nt_domain,EventCode,msad_action

| eval 
dest_ou_dn=if(isnull(New_DN),DN,New_DN),adminuser=if(isnull(src_nt_domain),lower(src_user),src_nt_do
main.""\\"".lower(src_user))

| rex field=dest_ou_dn ""(?i)ou\=(?<ou_name>[^\,]+)""

| rex field=Value max_match=0 ""\{(?<chg_gp_guid>[^\}]+)""

| fillnull value=""NA"" 
chg_gp_guid,dir_svcs_action,signature,LDAP_Display_Name,gpo_name,DN,Old_DN,New_DN,Correlation_ID

| mvexpand chg_gp_guid

| eval gpo_link=if(LDAP_Display_Name==""gPLink"",lower(chg_gp_guid),"""")

| eval Value=if(isnull(Value),lower(AttributeValue),lower(Value))

| lookup AD_Obj_GPO gpo_link OUTPUT displayName AS gpo_name

| eval mod_summary=if(LDAP_Display_Name==""gPLink"" AND isnotnull(gpo_name),""| - Action: 
"".dir_svcs_action.""| - Target Attribute: "".LDAP_Display_Name.""| - Target Linked GPO: "".gpo_name.""| - 
Target Linked GPO ID: "".chg_gp_guid,""| - Action: "".dir_svcs_action.""| - Target Attribute: 
"".LDAP_Display_Name.""| - Target Attribute Value: "".Value)

| eval chg_summary=case(EventCode=5137,""OU Created:| - Event Correlation ID: "".Correlation_ID.""| - 
DN: "".DN,EventCode=5138,""OU Undeleted:| - Event Correlation ID: "".Correlation_ID."" - 
"",EventCode=5139,""OU Moved:| - Event Correlation ID: "".Correlation_ID.""| - From: "".Old_DN.""| - To: 
"".New_DN,EventCode=5141,""OU Deleted:| - Event Correlation ID: "".Correlation_ID,EventCode=5136 OR 
EventCode=4662,""OU Modified: | - Event Correlation ID: "".Correlation_ID.""|"".mod_summary)

| table _time,adminuser,msad_action,ou_name,dest_ou_dn,EventCode,signature,chg_summary

| makemv delim=""|"" chg_summary

| rename msad_action AS ""Action"",adminuser AS ""Admin User"",ou_name AS OU,dest_ou_dn AS ""OU 
DN"",chg_summary AS ""Changes"""
AD Objects - Audit - Changes - User - By Admin Change Summary,,always,24h,"`ms_obj_changes_base_cat(""User"")`

| fields 
_time,user,src_user,src_nt_domain,dest_nt_domain,user_obj_guid,user_type,msad_action,signature,Corre
lation_ID,MSADChangedAttributes,AttributeLDAPDisplayName,AttributeValue,DN,dir_svcs_action,user_obj_
dn,Old_DN,New_DN

| join type=left src_user [| inputlookup AD_Obj_User | fields cn,sAMAccountName | rename 
sAMAccountName as src_user,cn AS Admin | table Admin,src_user]

| eval Admin=if(isnull(Admin),src_user,Admin."" ("".src_user."")"")

| eval Day=strftime(_time,""%m/%d/%y"")

| stats count by msad_action, Admin,Day

| eval comb=""|"".Day."" ("".count."")""

| sort -count

| stats list(comb) AS Daily_Change_Summary, sum(count) AS Total_Events by Admin,msad_action

| makemv delim=""|"" Daily_Change_Summary

| sort -Day 

| xyseries  msad_action Admin Daily_Change_Summary"
AD Objects - Audit - Changes - User - By Admin Day Summary,,always,24h,"`ms_obj_changes_base_cat(""User"")`

| fields 
_time,user,src_user,src_nt_domain,dest_nt_domain,user_obj_guid,user_type,msad_action,signature,Corre
lation_ID,MSADChangedAttributes,AttributeLDAPDisplayName,AttributeValue,DN,dir_svcs_action,user_obj_
dn,Old_DN,New_DN

| join type=left src_user [| inputlookup AD_Obj_User | fields cn,sAMAccountName | rename 
sAMAccountName as src_user,cn AS Admin | table Admin,src_user]

| eval Admin=if(isnull(Admin),src_user,Admin."" ("".src_user."")"")

| eval Day=strftime(_time,""%m/%d/%y"")

| stats count by msad_action, Admin,Day

| eval comb=""|"".msad_action."" ("".count."")""

| sort -count

| stats list(comb) AS Daily_Change_Summary, sum(count) AS Total_Events by Admin,Day

| makemv delim=""|"" Daily_Change_Summary

| sort -Day 

| xyseries  Day Admin Daily_Change_Summary"
AD Objects - Audit - Changes - Users,,always,24h,"`ms_obj_changes_base_cat(""User"")`

| `ms_obj_user_change_out`

| rename adminuser as ""Administrator"",msad_action as ""Action"",dest_user_subject as ""Target User 
ID"",MSADChanges as ""Changes"""
AD Objects - Audit - Created - Computers,,always,24h,"`ms_obj_changes_base_cat_act(""Computer"",""created"")`

| fields _time, src_user, user, comp_obj_dn, comp_obj_sam,msad_action, MSADChanges, dest_nt_domain, 
signature, MSADChangedAttributes,AttributeLDAPDisplayName,AttributeValue,DN,dir_svcs_action

| eval adminuser=if(isnull(src_nt_domain),src_user,upper(src_nt_domain).""\\"".src_user)

| `ms_obj_computer_change_out`

| rename adminuser as ""Admin User"",user as ""Target Computer"",msad_action as 
""Action"",dest_user_subject as ""Target Computer ID"",MSADChanges as ""Changes"""
AD Objects - Audit - Created - Group,,always,24h,"`ms_obj_changes_base_cat_act(""Group"",""created"")` 

| `ms_obj_group_change_out`

| fields - member

| rename adminuser as ""Administrator"",msad_action as ""Action"",group_obj_nm as ""Group 
Name"",MSADGroupType as ""Group Type"",MSADGroupClass AS ""Group Class"",signature as ""Changes"""
AD Objects - Audit - Created - Group Policies,,always,24h,"`ms_obj_changes_base_cat_act(""Group Policy"",""created"")`

| fields _time, session_id, src_nt_domain, 
src_user,Object_Name_Guid,displayName,dir_svcs_action,AttributeLDAPDisplayName,AttributeValue,MSADCh
angedAttributes,Correlation_ID,signature,msad_action,Old_DN,New_DN

| fillnull value="""" Correlation_ID,msad_action

| eval adminuser=if(isnull(src_nt_domain),src_user,src_nt_domain.""\\"".src_user) 

| eval Object_Lookup_Name=""{"".upper(Object_Name_Guid).""}"" 

| join type=left Object_Lookup_Name [| inputlookup AD_Obj_GPO | fields cn_link, displayName | rename 
cn_link AS Object_Lookup_Name | table Object_Lookup_Name, displayName]

| eval displayName=if(isnull(displayName),""Warning: "".Object_Lookup_Name."" GPO CN not found in the 
AD_Obj_GPO Lookup. If GPO is new wait 15 minutes and run report again, or check that 
ms_ad_obj_sched_sync_gpo scheduled search is running as scheduled."",displayName) 

| `ms_obj_msad-changed-attributes`

| stats max(_time) AS last_time, min(_time) AS start_time,list(MSADChanges) AS 
MSADChanges,values(Correlation_ID) AS Correlation_IDs by 
session_id,Object_Lookup_Name,displayName,adminuser,signature,msad_action

| eval MSADChanges=mvjoin(MSADChanges, ""########"")

| eval MSADChanges=case(isnull(signature) AND isnull(MSADChanges),""Unknown 
Changes"",isnull(signature),MSADChanges,isnotnull(MSADChanges),""Signature: 
"".signature.""########"".MSADChanges)

| eval Session_Time=""Session ID ("".session_id."")|Start: "".strftime(start_time,""%m/%d/%y %I:%M:%S 
%P"").""|End: "".strftime(last_time,""%m/%d/%y %I:%M:%S %P"")

| table displayName,adminuser,Session_Time,msad_action,Correlation_IDs,MSADChanges

| makemv delim=""########"" MSADChanges

| makemv delim=""|"" Session_Time

| rename adminuser as ""Administrator"",msad_action as ""Action"",displayName as ""GPO Name"",MSADChanges 
as ""Changes"""
AD Objects - Audit - Created - OU,,always,24h,"`ms_obj_changes_base_cat_act(""OU"",""created"")`

| rex field=DN ""(?i)ou\=(?<ou_name>[^\,]+)""

| fillnull value=""NA"" 
chg_gp_guid,dir_svcs_action,signature,LDAP_Display_Name,gpo_name,DN,Old_DN,New_DN

| table 
_time,ou_name,DN,src_nt_domain,src_user,Correlation_ID,EventCode,signature,DN,Old_DN,New_DN,Value,ms
ad_action

| eval chg_summary = ""OU Created:| - DN: "".DN.""| - Event Correlation ID: "".Correlation_ID

| table _time,msad_action,ou_name,DN,EventCode,signature,src_nt_domain,src_user,chg_summary

| makemv delim=""|"" chg_summary

| rename msad_action AS ""OU Action"",src_nt_domain AS ""Admin Domain"",src_user AS ""Admin User"",ou_name 
AS OU,DN AS ""OU DN"",chg_summary AS ""Change Details"""
AD Objects - Audit - Created - Users,,always,24h,"`ms_obj_changes_base_cat_act(""User"",""created"")`

| `ms_obj_user_change_out`

| table _time,adminuser,msad_action,user,dest_user_subject,Correlation_IDs,MSADChanges

| rename adminuser as ""Administrator"",msad_action as ""Action"",dest_user_subject as ""Target User 
ID"",MSADChanges as ""Changes"""
AD Objects - Audit - Critical Groups - Events,,always,24h,"`ms_obj_win_events_security`

[| inputlookup AD_Audit_Default_Critical_Objects

| fields cn

| join type=left cn [| inputlookup AD_Obj_Group | fields cn, dn | rename dn AS lkp_dn | table 
cn,lkp_dn]

| search lkp_dn=*

| stats values(lkp_dn) AS search

| format]

| `ms_obj_group_change_out`

| rename adminuser as ""Administrator"",msad_action as ""Action"",group_obj_nm as 
""Target_Group"",MSADGroupType as ""Target Group Type"",MSADGroupClass AS ""Target Group Class"",member AS 
""Target Member"",MSADChanges as ""Changes"""
AD Objects - Audit - Critical Objects - Lookup,,always,24h,"| inputlookup AD_Audit_Default_Critical_Objects

| eval inherited_user_rights=""- "".(replace(inherited_user_rights,"";"","";- ""))

| eval direct_user_rights=""- "".(replace(direct_user_rights,"";"","";- ""))

| makemv delim="";"" inherited_user_rights

| makemv delim="";"" direct_user_rights

| table 
cn,default_container,description,direct_user_rights,group_scope,inherited_user_rights,obj_type,speci
al_note,type_flag"
AD Objects - Audit - Critical Users - Events,,always,24h,"`ms_obj_win_events_security` [| inputlookup AD_Audit_Default_Critical_Objects

| fields cn

| join type=left cn [| inputlookup AD_Obj_User | fields cn, dn | table cn,dn]

| eval user=if(cn=""Administrator"" OR cn=""Guest"",""user=\"""".cn,NULL),src_user=if(cn=""Administrator"" OR 
cn=""Guest"",""src_user=\"""".cn,NULL)

| eval search=if(cn=""Administrator"" OR cn=""Guest"",dn,cn.""|"".dn)

| makemv delim=""|"" search

| eval search=mvappend(search,user,src_user)

| stats values(search) AS search

| search search=*

| eval search=replace(replace(""\"""".mvjoin(search,""\"" OR 
\"""").""\"""",""\""user\="",""user=""),""\""src_user\="",""src_user="")

| table search]"
AD Objects - Audit - Deleted - Computers,,always,24h,"`ms_obj_changes_base_cat_act(""Computer"",""deleted"")`

| `ms_obj_computer_change_out`

| rename adminuser as ""Admin User"",user as ""Target Computer"",msad_action as 
""Action"",dest_user_subject as ""Target Computer ID"",MSADChanges as ""Changes"""
AD Objects - Audit - Deleted - Group,,always,24h,"`ms_obj_changes_base_cat_act(""Group"",""deleted"")`

| `ms_obj_group_change_out`

| fields - member

| rename adminuser as ""Administrator"",msad_action as ""Action"",group_obj_nm as ""Group 
Name"",MSADGroupType as ""Group Type"",MSADGroupClass AS ""Group Class"",signature as ""Changes"""
AD Objects - Audit - Deleted - Group Policies,,always,24h,"`ms_obj_changes_base_cat_act(""Group Policy"",""deleted"")`

| fields _time, session_id, src_nt_domain, 
src_user,Object_Name_Guid,displayName,dir_svcs_action,AttributeLDAPDisplayName,AttributeValue,MSADCh
angedAttributes,Correlation_ID,signature,msad_action,Old_DN,New_DN

| fillnull value="""" Correlation_ID,msad_action

| eval adminuser=if(isnull(src_nt_domain),src_user,src_nt_domain.""\\"".src_user) 

| eval Object_Lookup_Name=""{"".upper(Object_Name_Guid).""}"" 

| join type=left Object_Lookup_Name [| inputlookup AD_Obj_GPO | fields cn_link, displayName | rename 
cn_link AS Object_Lookup_Name | table Object_Lookup_Name, displayName]

| eval displayName=if(isnull(displayName),""Warning: "".Object_Lookup_Name."" GPO CN not found in the 
AD_Obj_GPO Lookup. If GPO is new wait 15 minutes and run report again, or check that 
ms_ad_obj_sched_sync_gpo scheduled search is running as scheduled."",displayName) 

| `ms_obj_msad-changed-attributes`

| stats max(_time) AS last_time, min(_time) AS start_time,list(MSADChanges) AS 
MSADChanges,values(Correlation_ID) AS Correlation_IDs by 
session_id,Object_Lookup_Name,displayName,adminuser,signature,msad_action

| eval MSADChanges=mvjoin(MSADChanges, ""########"")

| eval MSADChanges=case(isnull(signature) AND isnull(MSADChanges),""Unknown 
Changes"",isnull(signature),MSADChanges,isnotnull(MSADChanges),""Signature: 
"".signature.""########"".MSADChanges)

| eval Session_Time=""Session ID ("".session_id."")|Start: "".strftime(start_time,""%m/%d/%y %I:%M:%S 
%P"").""|End: "".strftime(last_time,""%m/%d/%y %I:%M:%S %P"")

| table displayName,adminuser,Session_Time,msad_action,Correlation_IDs,MSADChanges

| makemv delim=""########"" MSADChanges

| makemv delim=""|"" Session_Time

| rename adminuser as ""Administrator"",msad_action as ""Action"",displayName as ""GPO Name"",MSADChanges 
as ""Changes"""
AD Objects - Audit - Deleted - Users,,always,24h,"`ms_obj_changes_base_cat_act(""User"",""deleted"")` 

| `ms_obj_user_change_out`

| table _time,adminuser,msad_action,user,dest_user_subject,Correlation_IDs,MSADChanges

| rename adminuser as ""Administrator"",msad_action as ""Action"",dest_user_subject as ""Target User 
ID"",MSADChanges as ""Changes"""
AD Objects - Audit - Login - Computer,,always,24h,"`ms_obj_failed_success_logons(""computer"")`

| fields user, status, _time, host,src_ip,src_nt_host,signature,Failure_Reason,Logon_Type,Sub_Status

| lookup AD_Audit_Logon_Types Logon_Type OUTPUT Logon_TypeName

| eval Logon_User=lower(user)

| eval src_ip=replace(src_ip,""::ffff:|::1"","""")

| eval src_nt_host=if(isnull(src_nt_host),if(isnull(src_ip) OR src_ip==""127.0.0.1"" OR src_ip=="""" OR 
src_ip==""-"",upper(host),src_ip),src_nt_host)

| eval src_ip=if(isnull(src_ip) OR src_ip==""127.0.0.1"" OR src_ip=="""" OR src_ip==""-"",host,src_ip)

| fillnull value=""Not In Event"" src_nt_host, src_ip,Failure_Reason,signature

| eval Session_Status=""Audit "".status

| eval Failure_Reason=if(Sub_Status==""0xC0000064"",""Non-Domain Account - 
"".Failure_Reason,Failure_Reason)

| fields _time, host,src_ip,src_nt_host,Logon_User, status, 
Session_Status,signature,Failure_Reason,Logon_TypeName

| stats count,values(Logon_TypeName) AS Logon_Type by _time, host,src_ip,src_nt_host,Logon_User, 
status, Session_Status,signature,Failure_Reason

| eval Success_count=if(status==""success"",1,0)

| eval Failure_count=if(status==""failure"",1,0)

| join type=left Logon_User [| inputlookup AD_Obj_User | fields uac_details,sAMAccountName | rename 
sAMAccountName as Logon_User | table uac_details,Logon_User]

| eval Failure_Reason=if(isnull(Failure_Reason) OR Failure_Reason==""Not In Event"",status."": 
"".signature,status."": "".Failure_Reason)

| fillnull value=""Not Available"" uac_details

| eventstats count AS Failure_Reason_cnt by Failure_Reason,Logon_User

| eventstats count AS src_ip_cnt by src_ip,Logon_User

| eventstats count AS src_nt_host_cnt by src_nt_host,Logon_User

| eval Failure_Reason=""("".Failure_Reason_cnt."") - "".Failure_Reason

| eval src_ip=""("".src_ip_cnt."") - "".src_ip

| eval src_nt_host=""("".src_nt_host_cnt."") - "".src_nt_host

| sort - src_ip_cnt, - src_nt_host_cnt

| stats count AS Total_Attempts, sum(Success_count) AS Success_Count, sum(Failure_count) AS 
Failure_Count, values(Logon_Type) AS Logon_Types, values(Failure_Reason) AS 
Failure_Reason,values(src_ip) AS src_ip,values(src_nt_host) AS src_nt_host by Logon_User,uac_details

| sort -Total_Attempts

| makemv delim="":"" uac_details

| eval src_nt_host=mvsort(src_nt_host)"
AD Objects - Audit - Login - Details,,always,24h,"`ms_obj_failed_success_logons(""user"")`

| fields user, status, _time, host,src_ip,src_nt_host,signature,Failure_Reason,Logon_Type,Sub_Status

| lookup AD_Audit_Logon_Types Logon_Type OUTPUT Logon_TypeName

| eval Logon_User=lower(user)

| eval src_ip=replace(src_ip,""::ffff:|::1"","""")

| eval src_nt_host=if(isnull(src_nt_host),if(isnull(src_ip) OR src_ip==""127.0.0.1"" OR src_ip=="""" OR 
src_ip==""-"",upper(host),src_ip),src_nt_host)

| eval src_ip=if(isnull(src_ip) OR src_ip==""127.0.0.1"" OR src_ip=="""" OR src_ip==""-"",host,src_ip)

| fillnull value=""Not In Event"" src_nt_host, src_ip,Failure_Reason,signature

| eval Session_Status=""Audit "".status

| eval Failure_Reason=if(Sub_Status==""0xC0000064"",""Non-Domain Account - 
"".Failure_Reason,Failure_Reason)

| fields _time, host,src_ip,src_nt_host,Logon_User, status, 
Session_Status,signature,Failure_Reason,Logon_TypeName

| stats count,values(Logon_TypeName) AS Logon_Type by _time, host,src_ip,src_nt_host,Logon_User, 
status, Session_Status,signature,Failure_Reason

| eval Success_count=if(status==""success"",1,0)

| eval Failure_count=if(status==""failure"",1,0)

| join type=left Logon_User [| inputlookup AD_Obj_User | fields userAccountControl,sAMAccountName | 
lookup AD_Obj_UAC userAccountControl OUTPUT uac_details| rename sAMAccountName as Logon_User | table 
uac_details,Logon_User]

| eval Failure_Reason=if(isnull(Failure_Reason) OR Failure_Reason==""Not In Event"",status."": 
"".signature,status."": "".Failure_Reason)

| fillnull value=""Not Available"" uac_details

| eventstats count AS Failure_Reason_cnt by Failure_Reason,Logon_User

| eventstats count AS src_ip_cnt by src_ip,Logon_User

| eventstats count AS src_nt_host_cnt by src_nt_host,Logon_User

| eval Failure_Reason=""("".Failure_Reason_cnt."") - "".Failure_Reason

| eval src_ip=""("".src_ip_cnt."") - "".src_ip

| eval src_nt_host=""("".src_nt_host_cnt."") - "".src_nt_host

| sort - src_ip_cnt, - src_nt_host_cnt

| stats count AS Total_Attempts, sum(Success_count) AS Success_Count, sum(Failure_count) AS 
Failure_Count, values(Logon_Type) AS Logon_Types, values(Failure_Reason) AS 
Failure_Reason,values(src_ip) AS src_ip,values(src_nt_host) AS src_nt_host by Logon_User,uac_details

| sort -Total_Attempts

| makemv delim="":"" uac_details

| eval src_nt_host=mvsort(src_nt_host)"
AD Objects - Audit - Login - Expired Disabled,,always,24h,"`ms_obj_failed_success_logons(""user"")` [| inputlookup AD_Obj_User| fields accountExpires, 
uac_details, whenChanged,sAMAccountName| makemv delim="":"" uac_details | eval 
uac_filter=if(match(uac_details, ""Disabled""),""True"",""False"") | eval 
accountExpipres_utc=round(strptime(accountExpires,""%I:%M.%S %P, %a %m/%d/%Y""),0)| WHERE 
uac_filter==""True"" OR accountExpires_utc<now()| rename sAMAccountName AS search | stats count by 
search | fields search| format]

| fields user, status, _time, host,src_ip,Failure_Reason,signature,src_nt_host

| eval src_ip=replace(src_ip,""::ffff:|::1"","""")

| eval src_nt_host=if(isnull(src_nt_host),if(isnull(src_ip) OR src_ip==""127.0.0.1"" OR src_ip=="""" OR 
src_ip==""-"",upper(host),src_ip),src_nt_host)

| eval src_ip=if(isnull(src_ip) OR src_ip==""127.0.0.1"" OR src_ip=="""" OR src_ip==""-"",host,src_ip)

| fillnull value=""Not In Event"" src_nt_host, src_ip

| eval Failure_Reason=if(isnull(Failure_Reason),signature,Failure_Reason)

| stats count by src_ip,src_nt_host, user,Failure_Reason

| join user [| inputlookup AD_Obj_User | fields cn,accountExpires, uac_details, 
whenChanged,sAMAccountName | eval uac_filter=if(match(uac_details, ""Disabled""),""True"",""False"") | 
eval accountExpipres_utc=round(strptime(accountExpires,""%I:%M.%S %P, %a %m/%d/%Y""),0)| WHERE 
uac_filter==""True"" OR accountExpires_utc<now()| rename sAMAccountName AS user | table 
cn,accountExpires, uac_details, whenChanged,user]

| sort -count

| eval cn=if(isnull(cn),user,cn)

| eventstats sum(count) AS f_cnt by user,Failure_Reason

| eventstats sum(count) AS s_ip_cnt by src_ip,user

| eventstats sum(count) AS shst_ip_cnt by src_nt_host,user

| eval Source_IPs=""("".tostring(s_ip_cnt,""commas"")."") - "".src_ip

| eval Source_Systems=""("".tostring(shst_ip_cnt,""commas"")."") - "".src_nt_host

| eval Top_Reasons=""("".tostring(f_cnt,""commas"")."") - "".Failure_Reason

| stats list(Source_IPs) AS Source_IPs, list(Source_Systems) AS Source_Systems, list(Top_Reasons) AS 
Top_Reasons, sum(count) AS Total_Failed_Attempts by user,cn, uac_details, accountExpires, 
whenChanged

| sort -Total_Failed_Attempts

| makemv delim="":"" uac_details

| eval Source_IPs=mvdedup(Source_IPs),Source_Systems=mvdedup(Source_Systems)

| eval uac_filter=mvfilter(match(uac_details, ""Disabled""))

| eval accountExpipres_utc=round(strptime(accountExpires,""%I:%M.%S %P, %a %m/%d/%Y""),0)

| eval user_state=if(accountExpires_utc<now(),""Expired At 
("".accountExpires."")"",if(uac_filter==""Disabled"", ""Disabled At ("".whenChanged."")"",""NA""))

| eval Top_Reasons=mvindex(mvdedup(Top_Reasons),0,9)

| table user,cn,user_state, uac_details, 
accountExpires,whenChanged,Total_Failed_Attempts,Source_IPs, Source_Systems,Top_Reasons

| rename user AS Logon_User"
AD Objects - Audit - Login - Failed - Non-Domain Users,,always,24h,"`ms_obj_failed_logons(""user"")` Sub_Status=0xC0000064

| eval Date=strftime(_time, ""%m/%d/%Y"") 

| eval Workstation_Name=if(isnull(Workstation_Name),host,lower(Workstation_Name))

| stats count by Date, user, host, Workstation_Name 

| rename count as ""Attempts"" 

| sort -Date -Attempts 

| rename user as ""Target Account"" host as ""Host"""
AD Objects - Audit - Login - Failed Logons - Basic,,always,24h,"`ms_obj_failed_logons(""user"")`

| fields user, status, _time, host,src_ip,src_nt_host,signature,Failure_Reason,Logon_Type,Sub_Status

| lookup AD_Audit_Logon_Types Logon_Type OUTPUT Logon_TypeName

| eval Logon_User=lower(user)

| eval src_ip=replace(src_ip,""::ffff:|::1"","""")

| eval src_nt_host=if(isnull(src_nt_host),if(isnull(src_ip) OR src_ip==""127.0.0.1"" OR src_ip=="""" OR 
src_ip==""-"",upper(host),src_ip),src_nt_host)

| eval src_ip=if(isnull(src_ip) OR src_ip==""127.0.0.1"" OR src_ip=="""" OR src_ip==""-"",host,src_ip)

| fillnull value=""Not In Event"" src_nt_host, src_ip,Failure_Reason,signature

| eval Session_Status=""Audit "".status

| eval Failure_Reason=if(Sub_Status==""0xC0000064"",""Non-Domain Account - 
"".Failure_Reason,Failure_Reason)

| fields _time, host,src_ip,src_nt_host,Logon_User, status, 
Session_Status,signature,Failure_Reason,Logon_TypeName

| stats count,values(Logon_TypeName) AS Logon_Type by _time, host,src_ip,src_nt_host,Logon_User, 
status, Session_Status,signature,Failure_Reason"
AD Objects - Audit - Login - Success Ratio,,always,24h,"`ms_obj_failed_success_logons(""user"")` 

| fields user, status, _time, host,src_ip

| eval src_ip=replace(src_ip,""::ffff:|::1"","""")

| eval src_nt_host=if(isnull(src_nt_host),if(isnull(src_ip) OR src_ip==""127.0.0.1"" OR src_ip=="""" OR 
src_ip==""-"",upper(host),src_ip),src_nt_host)

| eval Session_Status=""Audit "".status 

| stats max(_time) AS latest, min(_time) AS earliest, count AS sesscount, dc(src_nt_host) AS 
Session_Host_Count, values(Logon_Type) AS Session_Types, count(eval(status=""success"")) AS 
success_count, count(eval(status=""failure"")) AS fail_count by user 

| eval First_Attempt=strftime(earliest, ""%m/%d/%Y %H:%M:%S"") 

| eval Last_Attempt=strftime(latest, ""%m/%d/%Y %H:%M:%S"") 

| eval Fail_Percent=round((fail_count/sesscount)*100,2)

| eval Total_Attempts=fail_count+success_count 

| sort -Fail_Percent, - Total_Attempts 

| eval Fail_Percent=Fail_Percent.""%""

| eval Success_Percent=round((success_count/sesscount)*100,2).""%"" 

| table user, Session_Host_Count, Total_Attempts, Fail_Percent, Success_Percent, First_Attempt, 
Last_Attempt

| rename user AS Logon_User"
AD Objects - Audit - Login - User Locked Events,,always,24h,"`ms_obj_win_events_security` EventCode=4740

| fields _time, user,Caller_Computer_Name

| eval Locked_Account=mvindex(Account_Name,1)

| transaction user maxpause=5s 

| eval Locked_Time=strftime(_time, ""%m/%d/%Y %H:%M:%S"") 

| join type=left user [| inputlookup AD_Obj_User | fields displayName, 
distinguishedName,sAMAccountName | rename sAMAccountName as user | table displayName, 
distinguishedName,user]

| fillnull value=""Account Not Found"" displayName

| rex field=Caller_Computer_Name ""\\\\\\\(?<Caller_Computer_Name>[^$]+)"" 

| eventstats count AS Total_Lockouts by user

| table Locked_Time, user, displayName, Caller_Computer_Name,distinguishedName,Total_Lockouts 

| rename user as ""User Name"", displayName as ""Display Name"", Caller_Computer_Name as ""Source 
Computer Name"""
AD Objects - Audit - Modified - Computers,,always,24h,"`ms_obj_changes_base_cat_act(""Computer"",""modified"")`

| fields _time, src_user, user, comp_obj_dn, comp_obj_sam,msad_action, MSADChanges, dest_nt_domain, 
signature, MSADChangedAttributes,AttributeLDAPDisplayName,AttributeValue,DN,dir_svcs_action

| eval adminuser=if(isnull(src_nt_domain),src_user,upper(src_nt_domain).""\\"".src_user)

| `ms_obj_computer_change_out`

| rename adminuser as ""Admin User"",user as ""Target Computer"",msad_action as 
""Action"",dest_user_subject as ""Target Computer ID"",MSADChanges as ""Changes"""
AD Objects - Audit - Modified - OU,,always,24h,"`ms_obj_changes_base_cat_act(""OU"",""modified"")`

| eval dest_ou_dn=if(isnull(New_DN),DN,New_DN)

| rex field=dest_ou_dn ""(?i)ou\=(?<ou_name>[^\,]+)""

| rex field=Value max_match=0 ""\{(?<chg_gp_guid>[^\}]+)""

| fillnull value=""NA"" 
chg_gp_guid,dir_svcs_action,signature,LDAP_Display_Name,gpo_name,DN,Old_DN,New_DN,Correlation_ID

| eval Value=if(isnull(Value),lower(AttributeValue),lower(Value)),chg_gp_guid=lower(chg_gp_guid)

| mvexpand chg_gp_guid

| eval chg_gplink=if(LDAP_Display_Name==""gPLink"",""{"".chg_gp_guid.""}"","""")

| join type=left chg_gplink [| inputlookup AD_Obj_GPO | fields cn,displayName | rex field=cn 
""^(?<chg_gplink>[^(\s|$)]+)"" | dedup chg_gplink | table chg_gplink, displayName | rename displayName 
AS gpo_name]

| table _time,ou_name,dest_ou_dn,src_nt_domain,src_user,LDAP_Display_Name,dir_svcs_action, 
Correlation_ID,chg_gp_guid,gpo_name,EventCode,signature,DN,Old_DN,New_DN,Value,msad_action

| eval chg_summary=if(LDAP_Display_Name==""gPLink"" AND isnotnull(gpo_name),""OU Modified:| - Event 
Correlation ID: "".Correlation_ID.""| - Action: "".dir_svcs_action.""| - Target Attribute: 
"".LDAP_Display_Name.""| - Target Linked GPO: "".gpo_name.""| - Target Linked GPO ID: "".chg_gp_guid,""OU 
Modified:|| - Event Correlation ID: "".Correlation_ID."" - Action: "".dir_svcs_action.""| - Target 
Attribute: "".LDAP_Display_Name.""| - Target Attribute Value: "".Value.""| - Event Correlation ID: 
"".Correlation_ID)

| table _time,ou_name,dest_ou_dn,msad_action,EventCode,signature,src_nt_domain,src_user,chg_summary

| makemv delim=""|"" chg_summary

| rename msad_action AS ""OU Action"",src_nt_domain AS ""Admin Domain"",src_user AS ""Admin User"",ou_name 
AS OU,dest_ou_dn AS ""OU DN"",chg_summary AS ""Change Details"""
AD Objects - Audit - Modified - Users,,always,24h,"`ms_obj_changes_base_cat_act(""User"",""modified"")`

| fields 
_time,user,src_user,src_nt_domain,dest_nt_domain,user_obj_guid,user_type,msad_action,signature,Corre
lation_ID,MSADChangedAttributes,AttributeLDAPDisplayName,AttributeValue,DN,dir_svcs_action,user_obj_
dn,Old_DN,New_DN

| `ms_obj_user_change_out`

| table _time,adminuser,msad_action,user,dest_user_subject,Correlation_IDs,MSADChanges

| makemv delim=""########"" MSADChanges

| rename adminuser as ""Administrator"",msad_action as ""Action"",dest_user_subject as ""Target User 
ID"",MSADChanges as ""Changes"""
AD Objects - Audit - Moved - Computers,,always,24h,"`ms_obj_changes_base_cat_act(""Computer"",""moved"")`

| `ms_obj_computer_change_out`

| rename adminuser as ""Admin User"",user as ""Target Computer"",msad_action as 
""Action"",dest_user_subject as ""Target Computer ID"",MSADChanges as ""Changes"""
AD Objects - Audit - Moved - Group,,always,24h,"`ms_obj_changes_base_cat_act(""Group"",""moved"")`  

| `ms_obj_group_change_out`

| fields - member

| rename adminuser as ""Administrator"",msad_action as ""Action"",group_obj_nm as ""Group 
Name"",MSADGroupType as ""Group Type"",MSADGroupClass AS ""Group Class"",signature as ""Changes"""
AD Objects - Audit - Moved - OU,,always,24h,"`ms_obj_changes_base_cat_act(""OU"",""moved"")`

| eval dest_ou_dn=if(isnull(New_DN),DN,New_DN)

| rex field=dest_ou_dn ""(?i)ou\=(?<ou_name>[^\,]+)""

| fillnull value=""NA"" signature,DN,Old_DN,New_DN,Correlation_ID

| eval chg_summary=""OU Moved:| - Event Correlation ID: "".Correlation_ID.""| - From: "".Old_DN.""| - To: 
"".New_DN

| table _time,ou_name,dest_ou_dn,msad_action,EventCode,signature,src_nt_domain,src_user,chg_summary

| makemv delim=""|"" chg_summary

| rename msad_action AS ""OU Action"",src_nt_domain AS ""Admin Domain"",src_user AS ""Admin User"",ou_name 
AS OU,dest_ou_dn AS ""OU DN"",chg_summary AS ""Change Details"""
AD Objects - Audit - Moved - Users,,always,24h,"`ms_obj_changes_base_cat_act(""User"",""moved"")`

| `ms_obj_user_change_out`

| table _time,adminuser,msad_action,user,dest_user_subject,Correlation_IDs,MSADChanges

| rename adminuser as ""Administrator"",msad_action as ""Action"",dest_user_subject as ""Target User 
ID"",MSADChanges as ""Changes"""
AD Objects - Audit - Undeleted - Computers,,always,24h,"`ms_obj_changes_base_cat_act(""Computer"",""undeleted"")`

| `ms_obj_computer_change_out`

| rename adminuser as ""Admin User"",user as ""Target Computer"",msad_action as 
""Action"",dest_user_subject as ""Target Computer ID"",MSADChanges as ""Changes"""
AD Objects - Audit - Undeleted - Group,,always,24h,"`ms_obj_changes_base_cat_act(""Group"",""undeleted"")`

| `ms_obj_group_change_out`

| fields - member

| rename adminuser as ""Administrator"",msad_action as ""Action"",group_obj_nm as ""Group 
Name"",MSADGroupType as ""Group Type"",MSADGroupClass AS ""Group Class"",signature as ""Changes"""
AD Objects - Audit - Undeleted - Users,,always,24h,"`ms_obj_changes_base_cat_act(""User"",""undeleted"")`

| `ms_obj_user_change_out`

| table _time,adminuser,msad_action,user,dest_user_subject,Correlation_IDs,MSADChanges

| rename adminuser as ""Administrator"",msad_action as ""Action"",dest_user_subject as ""Target User 
ID"",MSADChanges as ""Changes"""
AD Objects - Computer Lookup - Group List,,always,24h,"| inputlookup AD_Obj_Computer

| fields cn,dn,primaryGroupID

| lookup AD_Obj_Group member AS dn output cn AS Group,distinguishedName AS Group_DN

| lookup AD_Obj_Group primaryGroupToken AS primaryGroupID OUTPUT cn AS p_Group,distinguishedName AS 
p_Group_DN

| eval p_Group=""(Primary) "".p_Group,p_Group_DN=""(Primary) "".p_Group_DN

| eval Group=mvappend(Group,p_Group),Group_DN=mvappend(Group_DN,p_Group_DN)

| rename cn AS Computer

| eval Group_Count=mvcount(Group)

| sort -Group_Count

| table Computer, domain, dn,Group_Count,Group,Group_DN"
AD Objects - Config - KVstore - Configuration,,always,24h,"| rest /servicesNS/-/ms_windows_ad_objects/storage/collections/config

| search eai:acl.app=""ms_windows_ad_objects"""
AD Objects - Directory Services - Field Extractions,,always,24h,"`ms_obj_win_events_security` (EventCode=5136 OR EventCode=5137 OR EventCode=5138 OR EventCode=5139 
OR EventCode=5141)

| rex field=_raw ""(?msi)Message\=A\sdirectory\sservice\sobject\swas\s(?<msad_action>[^\.]+)""

| rex field=_raw 
""(?msi)Object:(\s+|\n|\r).*DN\:\s+(?<distinguishedName>[^(\r|\n)]+)(\s+|\n|\r).*Class\:\s+(?<Object_
Type>[^(\r|\n)]+)""

| rex field=_raw ""(?msi)(Object 
Type\:|Object\:)(\s+|\n|\r).*(Object\sName|GUID)\:\s+CN(=\""|=\{)(?<Object_Name_Guid>[^(\""|\})]+)""

| fillnull value=""Empty"" Object_Type, distinguishedName, Object_Name_Guid, msad_action

| stats values(Class) AS Classes, values(distinguishedName) AS distinguishedName, 
values(Object_Type) AS Object_Type,values(Object_Name_Guid) AS Object_Name_Guid by msad_action"
AD Objects - File ACL - Base List,,always,24h,"`ms__obj_win_api_index` sourcetype=""WinDirAcl""

| rex max_match=0 ""(?:\[)(?<object_acls>[^\]]+)""

| rex max_match=0 
""(?:\""IdentityReference\""\:\"")(?<IdentityReference>[^\""]+)\""\,\""FileSystemRights\""\:\""(?<FileSystemR
ights>[^\""]+)\""\,\""AccessControlType\""\:\""(?<AccessControlType>[^\""]+)\""\,\""IsInherited\""\:\""(?<IsIn
herited>[^\""]+)\""\,\""InheritanceFlags\""\:\""(?<InheritanceFlags>[^\""]+)\""\,\""PropagationFlags\""\:\""(?
<PropagationFlags>[^\""]+)\""""

| stats count,values(IdentityReference) AS IdentityReference,values(object_acls) AS object_acls by 
object_path,object_last_mod_time,object_size,object_dir_cnt,object_file_cnt"
AD Objects - File ACL - Full List,,always,24h,"`ms__obj_win_api_index` sourcetype=""WinDirAcl""

| rex max_match=0 ""(?:\[)(?<object_acls>[^\]]+)""

| mvexpand object_acls

| rex 
""IdentityReference\""\:\""(?<IdentityReference>[^\""]+)\""\,\""FileSystemRights\""\:\""(?<FileSystemRights>
[^\""]+)\""\,\""AccessControlType\""\:\""(?<AccessControlType>[^\""]+)\""\,\""IsInherited\""\:\""(?<IsInherite
d>[^\""]+)\""\,\""InheritanceFlags\""\:\""(?<InheritanceFlags>[^\""]+)\""\,\""PropagationFlags\""\:\""(?<Propa
gationFlags>[^\""]+)""

| table 
object_path,object_last_mod_time,object_size,object_dir_cnt,object_file_cnt,object_acls,IdentityRefe
rence,FileSystemRights,AccessControlType,IsInherited,InheritanceFlags,PropagationFlags"
AD Objects - File ACL - Summary,,always,24h,"`ms__obj_win_api_index` sourcetype=""WinDirAcl""

| rex max_match=0 ""(?:\[)(?<object_acls>[^\]]+)""

| mvexpand object_acls

| rex 
""IdentityReference\""\:\""(?<IdentityReference>[^\""]+)\""\,\""FileSystemRights\""\:\""(?<FileSystemRights>
[^\""]+)\""\,\""AccessControlType\""\:\""(?<AccessControlType>[^\""]+)\""\,\""IsInherited\""\:\""(?<IsInherite
d>[^\""]+)\""\,\""InheritanceFlags\""\:\""(?<InheritanceFlags>[^\""]+)\""\,\""PropagationFlags\""\:\""(?<Propa
gationFlags>[^\""]+)""

| table 
object_path,object_last_mod_time,object_size,object_dir_cnt,object_file_cnt,object_acls,IdentityRefe
rence,FileSystemRights,AccessControlType,IsInherited,InheritanceFlags,PropagationFlags

| eval ACL_Type=""( "".AccessControlType."" ) "".FileSystemRights, Object_Paths=object_path."" (SubDir: 
"".object_dir_cnt."", Files: "".object_file_cnt."" )""

| fillnull value=""NA"" 
object_path,object_last_mod_time,object_size,object_dir_cnt,object_file_cnt,object_acls,IdentityRefe
rence,FileSystemRights,AccessControlType,IsInherited,InheritanceFlags,PropagationFlags,ACL_Type

| stats values(Object_Paths) AS Object_Paths,sum(object_size) AS Total_Size,sum(object_dir_cnt) As 
Total_Directories,sum(object_file_cnt) AS Total_Files by IdentityReference,ACL_Type

| eval Total_Size=tostring(Total_Size/1024,""commas"")."" MB"""
AD Objects - File Audit - Detailed View,,always,24h,"`ms_obj_win_events_security` Object_Server=""Security"" TaskCategory=""File System"" Accesses!=""Read*"" 
Accesses!=""Execute/Traverse"" Accesses!=""SYNCHRONIZE"" user_type=""user""

| fields _time,EventCode,Object_Name,Accesses,Account_Name,RecordNumber,user,src_user,signature

| eval Object_Path=Object_Name, temp=_time, signature=if(isnull(signature),""NA"",signature)

| eval user=if(isnull(user),lower(src_user),lower(user))

| convert timeformat=""%m-%d-%Y %H:%M:%S"" ctime(temp) AS eventtimes 

| eval history=eventtimes.""(User: "".Account_Name."" 
Type:"".Accesses."")"",signature=if(isnull(signature),Message,signature)

| stats values(history) as Change_History, values(EventCode) as Win_Event_IDs, values(RecordNumber) 
as Win_Event_Record, min(eventtimes) as First_Change_Time by user,Object_Path,signature 

| lookup AD_Obj_User lookup_usr AS user OUTPUT cn

| eval user=if(isnull(cn),user,cn."" ("".user."")"")

| eval Win_Event_Records=mvjoin(Win_Event_Record,"", "")  

| eval Win_Event_IDs=mvjoin(Win_Event_IDs,"", "") 

| eval Change_Type=mvjoin(Change_Type,"", "") 

| table First_Change_Time, Object_Path, signature,user, Win_Event_IDs, Win_Event_Records, 
Change_History, 

| sort First_Change_Time"
AD Objects - File Audit - Top 10 Obj Path,,always,24h,"`ms_obj_win_events_security` Object_Server=""Security"" TaskCategory=""File System"" Accesses!=""Read*"" 
Accesses!=""Execute/Traverse"" Accesses!=""SYNCHRONIZE"" user_type=""user""

| fields _time,EventCode,Object_Name,Accesses,Account_Name,user,src_user

| eval Object_Path=Object_Name, temp=_time, signature=if(isnull(signature),""NA"",signature)

| eval user=if(isnull(user),lower(src_user),lower(user))

| stats count by Accesses,Object_Path,user

| sort -count

| eval cmb=count."" - "".Object_Path."" ("".Accesses."")""

| stats sum(count) AS Total_Events,list(cmb) AS Top_10_Object_Details by user

| lookup AD_Obj_User lookup_usr AS user OUTPUT cn

| eval user=if(isnull(cn),user,cn."" 
("".user."")""),Top_10_Object_Details=mvindex(Top_10_Object_Details,0,9)

| table user, Top_10_Object_Details, Total_Events"
AD Objects - File Audit - Top 10 Path and Type,,always,24h,"`ms_obj_win_events_security` Object_Server=""Security"" TaskCategory=""File System"" Accesses!=""Read*"" 
Accesses!=""Execute/Traverse"" Accesses!=""SYNCHRONIZE"" user_type=""user""

| fields Object_Name,Accesses,Account_Name,user,src_user

| eval Object_Path=Object_Name, temp=_time, signature=if(isnull(signature),""NA"",signature)

| eval user=if(isnull(user),lower(src_user),lower(user))

| stats count by Accesses,Object_Path,user

| sort -count

| lookup AD_Obj_User lookup_usr AS user OUTPUT cn

| eval user=if(isnull(cn),user,cn."" ("".user."")"")

| eval cmb=count."" - "".Object_Path

| stats sum(count) AS Total_Events,list(cmb) AS cmb by Accesses,user

| eval Top_10_Type_Details=mvindex(cmb,0,9)

| table user,Accesses, Top_10_Type_Details, Total_Events

| sort -Total_Events"
AD Objects - File Audit - Top 10 User  and Obj Path,,always,24h,"`ms_obj_win_events_security` Object_Server=""Security"" TaskCategory=""File System"" Accesses!=""Read*"" 
Accesses!=""Execute/Traverse"" Accesses!=""SYNCHRONIZE"" user_type=""user""

| fields Object_Name,Accesses,Account_Name,user,src_user

| eval Object_Path=Object_Name, temp=_time, signature=if(isnull(signature),""NA"",signature)

| eval user=if(isnull(user),lower(src_user),lower(user))

| stats count by Accesses,Object_Path,user

| sort -count

| lookup AD_Obj_User lookup_usr AS user OUTPUT cn

| eval user=if(isnull(cn),user,cn."" ("".user."")"")

| eval cmb=count."" - "".user."" ("".Accesses."")""

| stats sum(count) AS Total_Events,list(cmb) AS cmb by Object_Path

| eval Top_10_User_Details=mvindex(cmb,0,9)

| table Object_Path, Top_10_User_Details, Total_Events

| sort -Total_Events"
AD Objects - Group Lookup - Critical Members,,always,24h,"| inputlookup AD_Audit_Default_Critical_Objects WHERE obj_type=""group""

| fields cn

| lookup AD_Obj_Group cn OUTPUT member

| search member!=""""

| table cn,member"
AD Objects - Group Lookup - Embedded In Group List,,always,24h,"| inputlookup AD_Obj_Group

| fields cn,dn,domain

| lookup AD_Obj_Group member AS dn output cn AS Embedded_In_Group,distinguishedName AS 
Embedded_In_Group_DN

| rename cn AS Group

| eval Embedded_Group_Count=mvcount(Embedded_In_Group)

| sort -Embedded_Group_Count

| table Group, domain, dn,Embedded_Group_Count,Embedded_In_Group,Embedded_In_Group_DN"
AD Objects - Group Lookup - Members and ComputerList,,always,24h,"| inputlookup AD_Obj_Group WHERE membercount!=""0""

| fields cn,member,domain,dn,description,membercount

| rename cn AS GroupName, domain AS GroupDomain,dn AS GroupDN

| mvexpand member

| lookup AD_Obj_Computer dn AS member OUTPUT distinguishedName AS member,dn AS 
ComputerDN,sAMAccountName AS Computer,domain AS ComputerDomain

| eval 
User=if(isnull(User),NULL,UserDomain.""\\"".User),Computer=if(isnull(Computer),NULL,ComputerDomain.""\\
"".Computer),EmbGroup=if(isnull(EmbGroup),NULL,EmbGroupDomain.""\\"".EmbGroup)

| fillnull value="""" description, GroupDomain, GroupName, GroupDN,Computer,ComputerDN,ComputerDomain

| stats max(membercount) AS membercount,list(member) AS member,list(Computer) AS 
Computer,list(ComputerDN) AS ComputerDN by GroupDN,GroupName, GroupDomain, description

| eval Computer=mvfilter(Computer!=""""),ComputerDN=mvfilter(ComputerDN!="""")

| eval ComputerCount=if(mvcount(Computer)>0,mvcount(Computer),0)

| search ComputerCount>0"
AD Objects - Group Lookup - Members and EmbGroupList,,always,24h,"| inputlookup AD_Obj_Group WHERE membercount!=""0""

| fields cn,member,domain,dn,description,membercount

| rename cn AS GroupName, domain AS GroupDomain,dn AS GroupDN

| mvexpand member

| lookup AD_Obj_Group dn AS member OUTPUT distinguishedName AS member,dn AS 
EmbGroupDN,sAMAccountName AS EmbGroup,domain AS EmbGroupDomain

| eval EmbGroup=if(isnull(EmbGroup),NULL,EmbGroupDomain.""\\"".EmbGroup)

| fillnull value="""" description, GroupDomain, GroupName, GroupDN,EmbGroup,EmbGroupDN,EmbGroupDomain

| stats max(membercount) AS membercount,list(member) AS member,list(EmbGroup) AS 
EmbGroup,list(EmbGroupDN) AS EmbGroupDN by GroupDN,GroupName, GroupDomain, description

| eval EmbGroup=mvfilter(EmbGroup!=""""),EmbGroupDN=mvfilter(EmbGroupDN!="""")

| eval EmbGroupCount=if(mvcount(EmbGroup)>0,mvcount(EmbGroup),0)

| search EmbGroupCount>0"
AD Objects - Group Lookup - Members and UsersList,,always,24h,"| inputlookup AD_Obj_Group WHERE membercount!=""0""

| fields cn,member,domain,dn,description,membercount

| rename cn AS GroupName, domain AS GroupDomain,dn AS GroupDN

| mvexpand member

| lookup AD_Obj_User dn AS member OUTPUT distinguishedName AS member,dn AS UserDN,sAMAccountName AS 
User,domain AS UserDomain

| eval User=if(isnull(User),NULL,UserDomain.""\\"".User)

| fillnull value="""" description, GroupDomain, GroupName, GroupDN,User,UserDN,UserDomain

| stats max(membercount) AS membercount,list(member) AS member, list(User) AS User,list(UserDN) AS 
UserDN by GroupDN,GroupName, GroupDomain, description

| eval User=mvfilter(User!=""""),UserDN=mvfilter(UserDN!="""")

| eval UserCount=if(mvcount(User)>0,mvcount(User),0)

| search UserCount>0"
AD Objects - Group Lookup - Members List,,always,24h,"| inputlookup AD_Obj_Group WHERE membercount!=""0""

| rename cn AS GroupName

| table GroupName, domain, groupType_Name,description, member"
AD Objects - Group Lookup - Windows Security Membership Changes,,always,24h,"`ms_obj_changes_base_cat(""Group Membership"")` 

| fields 
src_user,src_nt_domain,member_obj_domain,member_obj_id,member_obj_dn,member,MSADGroupClassID,MSADGro
upClass,group_obj_dn,member_id,objectGUID,user_group,group_obj_nm,msad_action,MSADGroupType

| eval adminuser=if(isnull(src_nt_domain),src_user,upper(src_nt_domain).""\\"".src_user) 

| eval 
member=if(isnull(member_obj_domain),replace(member_obj_id,""\x5C{1}"",""""),member_obj_domain.""\\"".repla
ce(member_obj_id,""\x5C{1}"","""")) 

| eval member=if(isnull(member),if(isnull(member_obj_dn),""NA"",member_obj_dn),member) 

| lookup AD_Audit_Group_Type MSADGroupClassID OUTPUT MSADGroupClass 

| join type=left group_obj_dn 

    [| inputlookup AD_Obj_Group 

    | fields cn, MSADGroupClass,MSADGroupType, distinguishedName 

    | rename distniguishedName AS group_obj_dn,cn AS group_obj_nm 

    | table group_obj_dn,group_obj_nm,MSADGroupClass,MSADGroupType] 

| rex mode=sed field=member_id ""s/\s/###/g"" 

| makemv delim=""###"" member_id 

| eval member=if(isnull(member_id),member,member_id) 

| eval objectGUID=if(isnull(objectGUID),lower(ObjectGUID),lower(objectGUID)) 

| join type=left user_group 

    [| inputlookup AD_Obj_Group 

    | fields objectGUID, cn, MSADGroupClass,MSADGroupType, distinguishedName 

    | rename distniguishedName AS group_obj_dn,cn AS user_group 

    | table objectGUID,group_obj_dn,user_group,MSADGroupClass,MSADGroupType] 

| table _time,adminuser,MSADGroupClass,MSADGroupType,src_nt_domain,group_obj_nm,msad_action,member 

| rename adminuser as ""Administrator"",MSADGroupClass as ""Type"",MSADGroupType as 
""Scope"",src_nt_domain as ""Domain"",group_obj_nm as ""Group"",msad_action as ""Action"",member as ""Member"" 


| sort -Group"
AD Objects - Membership - All,,always,24h,"| inputlookup AD_Group WHERE member!=""""

| fields cn,displayName,distinguishedName,member,objectGUID

| eval group_displayName=if(displayName="""",cn,displayName)

| makemv delim=""####"" member

| rename cn AS group_cn,distinguishedName AS group_dn,objectGUID AS group_obj

| stats values(cn) AS group_cn,values(group_displayName) AS group_displayName by 
member,group_dn,group_obj

| join type=left member [ |inputlookup AD_User | fields 
distinguishedName,objectGUID,sAMAccountName,cn,objectClass,userPrincipalName| rename 
userPrincipalName AS member_email,objectClass AS member_class,distinguishedName AS member,objectGUID 
as member_obj,sAMAccountName AS member_user,cn AS member_cn | table 
member,member_obj,member_user,member_cn,member_class,member_email]

| join type=left member [ |inputlookup AD_Obj_Computer | fields 
distinguishedName,objectGUID,sAMAccountName,cn,objectClass,userPrincipalName| rename 
userPrincipalName AS member_email,objectClass AS member_class,distinguishedName AS member,objectGUID 
as member_obj,sAMAccountName AS member_user,cn AS member_cn | table 
member,member_obj,member_user,member_cn,member_class,member_email]

| join type=left member [ |inputlookup AD_Group | fields 
distinguishedName,objectGUID,sAMAccountName,cn,objectClass,userPrincipalName| rename 
userPrincipalName AS member_email,objectClass AS member_class,distinguishedName AS member,objectGUID 
as member_obj,sAMAccountName AS member_user,cn AS member_cn | table 
member,member_obj,member_user,member_cn,member_class,member_email]"
AD Objects - Membership - Computer,,always,24h,"| inputlookup AD_Obj_Computer

| lookup AD_Obj_Group member AS distinguishedName OUTPUT cn AS Group,distinguishedName AS Group_dn

| lookup AD_Obj_Group primaryGroupToken AS primaryGroupID OUTPUT cn AS 
PrimaryGroup,distinguishedName AS PrimaryGroup_dn

| eval Group=mvappend(Group,PrimaryGroup),Group_dn=mvappend(Group_dn,PrimaryGroup_dn)

| table cn,sAMAccountName,userPrincipalName,distinguishedName,Group,Group_dn"
AD Objects - Membership - Group,,always,24h,"| inputlookup AD_Group

| lookup AD_Obj_Group member AS distinguishedName OUTPUT cn AS Group,distinguishedName AS Group_dn

| lookup AD_Obj_Group primaryGroupToken AS primaryGroupID OUTPUT cn AS 
PrimaryGroup,distinguishedName AS PrimaryGroup_dn

| eval Group=mvappend(Group,PrimaryGroup),Group_dn=mvappend(Group_dn,PrimaryGroup_dn)

| table cn,sAMAccountName,userPrincipalName,distinguishedName,Group,Group_dn

| search Group!="""""
AD Objects - Membership - Individual Group,,always,24h,"| inputlookup AD_Group WHERE distinguishedName=""CN=Administrators,CN=Builtin,DC=sedemo,DC=local""

| lookup AD_Obj_User distinguishedName AS member OUTPUT userPrincipalName AS 
Member_User_email,sAMAccountName AS Member_User_ID,cn AS Member_User_cn,distinguishedName AS 
Member_User_dn,objectClass AS Member_User_class

| lookup AD_Obj_User primaryGroupID AS primaryGroupToken OUTPUT userPrincipalName AS 
Member_User_email_pg,sAMAccountName AS Member_User_ID_pg,cn AS Member_User_cn,distinguishedName AS 
Member_User_dn_pg,objectClass AS Member_User_class_pg

| lookup AD_Obj_Group distinguishedName AS member OUTPUT sAMAccountName AS Member_Group_ID,cn AS 
Member_Group_cn,distinguishedName AS Member_Group_dn,objectClass AS Member_Group_class

| lookup AD_Obj_Computer distinguishedName AS member OUTPUT sAMAccountName AS Member_Computer_ID,cn 
AS Member_Computer_cn,distinguishedName AS Member_Computer_dn,objectClass AS Member_Computer_class

| lookup AD_Obj_Computer primaryGroupID AS primaryGroupToken OUTPUT sAMAccountName AS 
Member_Computer_ID_pg,cn AS Member_Computer_cn_pg,distinguishedName AS 
Member_Computer_dn_pg,objectClass AS Member_Computer_class_pg

| eval Group=if(displayName="""",cn,displayName)

| eval 
Member_User_emai=if(Member_User_email_pg="""",Member_User_email,mvappend(Member_User_email,Member_User
_email_pg)),Member_User_ID=if(Member_User_ID_pg="""",Member_User_ID,mvappend(Member_User_ID,Member_Use
r_ID_pg)),Member_User_cn=if(Member_User_cn_pg="""",Member_User_cn,mvappend(Member_User_cn,Member_User_
cn_pg)),Member_User_dn=if(Member_User_dn_pg="""",Member_User_dn,mvappend(Member_User_dn,Member_User_dn
_pg)),Member_User_class=if(Member_User_class_pg="""",Member_User_class,mvappend(Member_User_class,Memb
er_User_class_pg))

| eval 
Member_Computer_ID=if(Member_Computer_ID_pg="""",Member_Computer_ID,mvappend(Member_Computer_ID,Member
_Computer_ID_pg)),Member_Computer_cn=if(Member_Computer_cn_pg="""",Member_User_cn,mvappend(Member_Comp
uter_cn,Member_Computer_cn_pg)),Member_Computer_dn=if(Member_Computer_dn_pg="""",Member_Computer_dn,mv
append(Member_Computer_dn,Member_User_dn_pg)),Member_Computer_class=if(Member_Computer_class_pg="""",M
ember_Computer_class,mvappend(Member_Computer_class,Member_Computer_class_pg))

| table 
Group,sAMAccountName,distinguishedName,member,Group,Member_User_cn,Member_User_ID,Member_User_dn,Mem
ber_User_class,Member_Computer_cn,Member_Computer_ID,Member_Computer_dn,Member_Computer_class,Member
_Group_cn,Member_Group_ID,Member_Group_class

| rename sAMAccountName AS Group_ID, distinguishedName AS Group_dn,member AS Current_Members"
AD Objects - Membership - User,,always,24h,"| inputlookup AD_Obj_User

| lookup AD_Obj_Group member AS distinguishedName OUTPUT cn AS Group,distinguishedName AS Group_dn

| lookup AD_Obj_Group primaryGroupToken AS primaryGroupID OUTPUT cn AS 
PrimaryGroup,distinguishedName AS PrimaryGroup_dn

| eval Group=mvappend(Group,PrimaryGroup),Group_dn=mvappend(Group_dn,PrimaryGroup_dn)

| table cn,sAMAccountName,userPrincipalName,distinguishedName,Group,Group_dn"
AD Objects - OU - GPO Linked,,always,24h,"| inputlookup AD_Obj_OU WHERE gpo_link!=""""

| table 
OU,displayName,name,objectClass,distinguishedName,Linked_GPO,gpo_link,objectCategory,whenChanged,whe
nCreated

| mvexpand gpo_link

| join type=left gpo_link [|inputlookup AD_Obj_GPO | rename displayName AS Linked_GPO | table 
gpo_link,Linked_GPO]

| stats values(Linked_GPO) AS Linked_GPO, values(gpo_link) AS gpo_link by 
OU,displayName,name,objectClass,distinguishedName,objectCategory,whenChanged,whenCreated

| table 
OU,displayName,name,objectClass,distinguishedName,Linked_GPO,gpo_link,objectCategory,whenChanged,whe
nCreated"
AD Objects - Scheduled Search - Runtime Statistics,,always,24h,"index=_internal sourcetype=scheduler savedsearch_name=""ms_ad_obj_sched*"" (status=""completed"" OR 
status=""skipped"" OR

status=""deferred"")

| eval window_time = if(isnotnull(window_time), window_time, 0)

| eval execution_latency = max(dispatch_time - (scheduled_time + window_time), 0)

| stats avg(run_time) as runtime, avg(execution_latency) AS avg_exec_latency, 
count(eval(status==""completed"" OR status==""skipped"")) AS total_exec, count(eval(status==""skipped"")) 
AS skipped_exec count(eval(status==""deferred"")) AS deferred_exec by app, savedsearch_name, user, 
savedsearch_id

| join savedsearch_id type=outer [

| rest ""/servicesNS/-/-/saved/searches/"" earliest_time=`ms_obj_time_modifier(-0s@s)` 
latest_time=`ms_obj_time_modifier(+8d@d)` search=""is_scheduled=1"" search=""disabled=0""

| search NOT (dispatch.earliest_time=rt* OR dispatch.latest_time=rt*)

| mvexpand scheduled_times

| stats count(title) as count max(scheduled_times) as max_t min(scheduled_times) as min_t by title, 
eai:acl.app, eai:acl.owner cron_schedule

| eval schedule_interval=round((max_t-min_t)/(count-1), 0)

| eval savedsearch_id = 'eai:acl.owner'."";"".'eai:acl.app'."";"".title

| fields savedsearch_id, cron_schedule, schedule_interval ]

| eval runtime = round(runtime, 0)

| eval avg_exec_latency = round(avg_exec_latency, 0)

| eval search_workload = round(runtime / schedule_interval * 100, 2)."" %""

| eval skip_ratio = round(skipped_exec / total_exec * 100, 2)."" %""

| fields savedsearch_name, app, user, cron_schedule, schedule_interval, runtime, search_workload, 
total_exec, skipped_exec, skip_ratio, deferred_exec, avg_exec_latency

| sort - search_workload

| rename savedsearch_name as ""Report Name"", app as App, user as User, cron_schedule as ""Cron 
Schedule"", runtime as ""Average Runtime (sec)"", total_exec as ""Total Executions"", skip_ratio as ""Skip 
Ratio"", skipped_exec as ""Skipped Executions"", deferred_exec AS ""Deferred Executions"", 
schedule_interval as ""Schedule Interval (sec)"", search_workload as ""Interval Load Factor"", 
avg_exec_latency AS ""Average Execution Latency (sec)"""
AD Objects - Scheduled Search - Skipped Reasons,,always,24h,"index=_internal sourcetype=scheduler status=""skipped"" savedsearch_name=""ms_ad_obj_sched_*""

| eval alert_actions = if(isnull(alert_actions) OR alert_actions == """", ""none"", alert_actions)

| eval reason = if(isnull(reason) OR reason == """", ""none"", reason)

| stats count AS count values(alert_actions) AS alert_actions, max(_time) AS l_time by 
savedsearch_name, reason

| eval reason_and_count = reason."" ("".count."")""

| eval l_time=strftime(l_time,""%m/%d/%y %I:%M:%S %P"")

| stats values(l_time) AS ""Last Time Skipped"",values(reason_and_count) AS reasons 
first(alert_actions) AS alert_actions by savedsearch_name

| rename reasons AS ""Skip Reason (Skip Count)"" alert_actions AS ""Alert Actions"" savedsearch_name AS 
""Report Name"""
AD Objects - Tools - Lookup Field List,,always,24h,"| inputlookup lookup_field_lists.csv 

| table AD_Obj_GroupPolicies_LDAP* 

| stats values(AD_Obj_GPO-base_in) AS raw_in_fields, values(AD_Obj_GPO-base_out) AS base_out_fields 

| eval raw_in_fields=mvjoin(raw_in_fields,"","") 

| eval base_out_fields=mvjoin(base_out_fields,"","")"
AD Objects - User Lookup - Group List,,always,24h,"| inputlookup AD_Obj_User

| lookup AD_Obj_Group member AS dn output cn AS Group,distinguishedName AS Group_DN

| lookup AD_Obj_Group primaryGroupToken AS primaryGroupID OUTPUT cn AS p_Group,distinguishedName AS 
p_Group_DN

| eval p_Group=""(Primary) "".p_Group,p_Group_DN=""(Primary) "".p_Group_DN

| eval Group=mvappend(Group,p_Group),Group_DN=mvappend(Group_DN,p_Group_DN)

| rename cn AS User

| eval Group_Count=mvcount(Group)

| sort -Group_Count

| table User, domain, distinguishedName,Group_Count,Group,Group_DN"
AD Objects - User Lookup - SubSearch - Critical Obj Events,,always,24h,"`ms_obj_win_events_security` (`ms_obj_critical_filter_raw(User,src_user)`)

| fields EventCode,src_user,signature

| stats values(EventCode) AS EventCode, count by src_user,signature"
AD Objects - User Lookup - SubSearch txt - Critical Obj Events,,always,24h,"`ms_obj_win_events_security` (`ms_obj_critical_filter_raw(User)`)

| fields EventCode,src_user,signature

| stats values(EventCode) AS EventCode, count by src_user,signature

| `ms_obj_critical_filter_field(User,src_user)`"
AD Objects - User Lookup - UAC to Binary Example,,always,24h,"| inputlookup AD_Obj_User append=true  

| fields userAccountControl 

| dedup userAccountControl 

| eval octet = userAccountControl 

| eval rank = split(""1"", "","") 

| eval octet_rank = mvzip(rank, octet) 

| fields - octet, rank 

| mvexpand octet_rank 

| eval octet_rank_split = split(octet_rank, "","") 

| eval rank = mvindex(octet_rank_split, 0) 

| eval octet = mvindex(octet_rank_split, 1) 

| fields - octet_rank, octet_rank_split 

| eval power = mvrange(0,32) 

| mvexpand power 

| eval base2 = pow(2, power) 

| eval mydiv = floor(octet / base2) 

| eval octet_bin = mydiv % 2 

| fields - mydiv, base2 

| sort limit=0 IP, rank, octet, - power 

| stats list(octet_bin) as octet_bin by userAccountControl 

| eval uac_bin_map = mvjoin(octet_bin, """") 

| rex field=uac_bin_map 
""00000(?<uac_dc_account>\d{1})(?<uac_kerb_no_pac>\d{1})(?<uac_trust_auth_for_delegation>\d{1})(?<uac
_pwd_expired>\d{1})(?<uac_pwd_kerb_pre_auth>\d{1})(?<uac_pwd_kerb_des>\d{1})(?<uac_sensitive>\d{1})(
?<uac_trust_for_delegation>\d{1})(?<uac_smartcard_req>\d{1})(?<uac_mns_account>\d{1})(?<uac_pwd_not_
expire>\d{1})(?<na_uac_5>\d{1})(?<na_uac_4>\d{1})(?<uac_srvr_trust_account>\d{1})(?<uac_wkstn_trust_
account>\d{1})(?<uac_trust_account>\d{1})(?<na_uac_3>\d{1})(?<uac_normal_account>\d{1})(?<uac_temp_d
up_account>\d{1})(?<uac_pwd_store_rev>\d{1})(?<uac_pwd_cant_change>\d{1})(?<uac_pwd_not_req>\d{1})(?
<uac_lockout>\d{1})(?<uac_home_dir_req>\d{1})(?<na_uac_1>\d{1})(?<uac_account_state>\d{1})(?<uac_scr
ipt_account>\d{1})"" 

| eval uac_details="""" 

| eval uac_details=if(uac_account_state=1,uac_details.""Disabled"",uac_details.""Enabled"") 

| eval uac_details=if(uac_script_account=1,uac_details."":Logon script is executed"",uac_details) 

| eval uac_details=if(uac_temp_dup_account=1,uac_details."":Temp Duplicate Account"",uac_details) 

| eval uac_details=if(uac_home_dir_req=1,uac_details."":Home Directory Required"",uac_details) 

| eval uac_details=if(uac_pwd_not_req=1,uac_details."":Password Not Required"",uac_details) 

| eval uac_details=if(uac_pwd_cant_change=1,uac_details."":Cant Change Password"",uac_details) 

| eval uac_details=if(uac_pwd_store_rev=1,uac_details."":Store Password using reversible 
encryption"",uac_details) 

| eval uac_details=if(uac_normal_account=1,uac_details."":Normal User Account"",uac_details) 

| eval uac_details=if(uac_trust_account=1,uac_details."":InterDomain Trust Account"",uac_details) 

| eval uac_details=if(uac_wkstn_trust_account=1,uac_details."":Workstation Trust 
Account"",uac_details) 

| eval uac_details=if(uac_srvr_trust_account=1,uac_details."":Server Trust Account"",uac_details) 

| eval uac_details=if(uac_pwd_not_expire=1,uac_details."":Password Does Not Expire"",uac_details) 

| eval uac_details=if(uac_mns_account=1,uac_details."":Majority Node Set (MNS) account"",uac_details) 

| eval uac_details=if(uac_smartcard_req=1,uac_details."":Smart Card Required"",uac_details) 

| eval uac_details=if(uac_trust_for_delegation=1,uac_details."":Trusted for Delegation"",uac_details) 

| eval uac_details=if(uac_sensitive=1,uac_details."":Sensitive - Not Delegated"",uac_details) 

| eval uac_details=if(uac_pwd_kerb_des=1,uac_details."":Kerberos authentication DES 
only"",uac_details) 

| eval uac_details=if(uac_pwd_kerb_pre_auth=1,uac_details."":Kerberos Does Not Require 
Pre-Auth"",uac_details) 

| eval uac_details=if(uac_pwd_expired=1,uac_details."":Password has Expired"",uac_details) 

| eval uac_details=if(uac_trust_auth_for_delegation=1,uac_details."":Can request a Kerberos ticket on 
behalf of another user"",uac_details) 

| eval uac_details=if(uac_kerb_no_pac=1,uac_details."":Request Kerberos Ticket without PAC 
data"",uac_details) 

| eval uac_details=if(uac_dc_account=1,uac_details."":Read Only Domain Controller 
Account"",uac_details) 

| makemv delim="":"" uac_details

| table userAccountControl,uac_bin_map,uac_details"
AD Objects - User Lookup - User Settings Basic,,always,24h,"| inputlookup AD_Obj_User append=true  

| `ms_obj_uac_details` 

| makemv delim="":"" uac_details

| table domain, sAMAccountName, userAccountControl, uac_details,domain, 
distinguishedName,whenChanged,whenCreated  

| sort sAMAccountName 

| rename sAMAccountName AS ""user"", uac_details AS userAccountControl_Details"
AD Objects - User Lookup - User Settings Full,,always,24h,"| inputlookup AD_Obj_User append=true

| `ms_obj_uac_details`

| table sAMAccountName,userAccountControl, uac*"
AD Objects - Verify Baseline Data - Completed,,always,24h,"`ms_obj_admon_flt_obj_type(ms_obj_admon_base_a_obj,ms_obj_admon_base_sync_type)`

| timechart span=30s count"
AD Objects - Verify Baseline Data - Overall,,always,24h,"`ms_obj_admon_flt_obj_type(ms_obj_admon_base_a_obj,ms_obj_admon_base_sync_type)` [search 
`ms_obj_admon_last_sync(ms_obj_admon_base_a_obj,ms_obj_admon_base_sync_type)`]

| fields _time,objectClass, objectGUID

| stats dc(objectGUID) AS count, max(_time) AS l_evt_time by objectClass

| eval 
ObjectType=case(objectClass=""top|person|organizationalPerson|user"",""User"",objectClass=""top|group"",""G
roup"",objectClass=""top|person|organizationalPerson|user|computer"",""Computer"",objectClass=""top|organi
zationalUnit"",""Organization 
Units"",objectClass=""top|container"",""Containers"",objectClass=""top|container|groupPolicyContainer"",""Gr
oup Policies"")

| where isnotnull(ObjectType)

| append [search `ms__obj_win_ad_index` eventtype=""msad-dc-health"" earliest=@d

| fields _time,host

| stats max(_time) AS l_evt_time,dc(host) AS count

| eval ObjectType=""Domain Details""

| table l_evt_time,count,ObjectType]

| eval min_l_evt = (now()-l_evt_time)/60

| eval check_completion=if(ObjectType=""Domain Details"",if(count>0,""Domain ms-dc-health data 
Collected"",""Warning - Missing eventtype=\""msad-dc-health\"" Data, Please review the Getting Data In 
for ensure the AD Domain Data is either collected or manually added""),if(count>0 AND 
min_l_evt>5,""Baseline Collection Completed ("".round(min_l_evt,0)."" Minutes Ago""."")"",""Wait for 
Baseline Collection to Complete before building Lookups""))

| eval l_evt_time=strftime(l_evt_time,""%m/%d/%y %H:%M:%S"")

| sort -count

| eval min_l_evt = round(min_l_evt,0)."" Minutes Ago""

| table ObjectType, count, l_evt_time,check_completion"
AD Objects - Verify Computer AD Objects Lookup,,always,24h,| inputlookup AD_Obj_Computer
AD Objects - Verify Computer Delete,,always,24h,"`ms_obj_admon_flt_obj_type(ms_obj_admon_computer,ms_obj_admon_base_del_type)`"
AD Objects - Verify Computer Sync Or Update,,always,24h,"`ms_obj_admon_computer`  (""admonEventType=Sync"" OR ""admonEventType=Update"")"
AD Objects - Verify DL Group AD Objects Lookup,,always,24h,"| inputlookup AD_Obj_Group WHERE isDistributionList=""TRUE"""
AD Objects - Verify DL Group Delete,,always,24h,"`ms_obj_admon_flt_obj_type(ms_obj_admon_group,ms_obj_admon_base_del_type)`  
sAMAccountType=""268435457"""
AD Objects - Verify DL Group Sync Or Update,,always,24h,"`ms_obj_admon_group`  (""admonEventType=Sync"" OR ""admonEventType=Update"")  sAMAccountType=""268435457"""
AD Objects - Verify GPO AD Objects Lookup,,always,24h,| inputlookup AD_Obj_GPO
AD Objects - Verify GPO Delete,,always,24h,"`ms_obj_admon_flt_obj_type(ms_obj_admon_gpo,ms_obj_admon_base_del_type)`"
AD Objects - Verify GPO Sync Or Update,,always,24h,"`ms_obj_admon_gpo`  (""admonEventType=Sync"" OR ""admonEventType=Update"")"
AD Objects - Verify Group AD Objects Lookup,,always,24h,| inputlookup AD_Obj_Group
AD Objects - Verify Group Delete,,always,24h,"`ms_obj_admon_flt_obj_type(ms_obj_admon_group,ms_obj_admon_base_del_type)`"
AD Objects - Verify Group Sync Or Update,,always,24h,"`ms_obj_admon_group`  (""admonEventType=Sync"" OR ""admonEventType=Update"")"
AD Objects - Verify OU AD Objects Lookup,,always,24h,| inputlookup AD_Obj_OU
AD Objects - Verify OU Delete,,always,24h,"`ms_obj_admon_flt_obj_type(ms_obj_admon_ou,ms_obj_admon_base_del_type)`"
AD Objects - Verify OU Sync Or Update,,always,24h,"`ms_obj_admon_ou`  (""admonEventType=Sync"" OR ""admonEventType=Update"")"
AD Objects - Verify User Delete,,always,24h,"`ms_obj_admon_flt_obj_type(ms_obj_admon_user,ms_obj_admon_base_del_type)`"
AD Objects - Verify User Sync Or Update,,always,24h,"`ms_obj_admon_user`  (""admonEventType=Sync"" OR ""admonEventType=Update"")"
AD Objects - View User AD Objects Lookup,,always,24h,| inputlookup AD_Obj_User
AD Objects - Windows Performance - Procces Threads,,always,24h,"`ms__obj_win_perfmon_index` (host=""*"") instance!=""idle"" ((counter=""% Processor Time"" 
instance!=""_Total"") OR counter=""Thread Count"")

| fields _time,host,counter,instance,Value

| eval threads=if(counter=""Thread Count"", Value,NULL),proc_time=if(counter=""% Processor 
Time"",Value,NULL)

| table _time,host,counter,instance,threads,proc_time

| timechart dc(instance) AS Process_Count,avg(proc_time) AS Avg_CPU_Time,max(threads) AS Avg_Threads 
by host"
AD Objects - Windows Performance - Process CPU,,always,24h,"`ms__obj_win_perfmon_index` object=""Process"" counter=""% Processor Time"" instance!=""_Total""  
instance!=""Idle""

| fields _time,host,object,counter,instance,Value

| eventstats sum(Value) AS Total_Host_Value by host,_time

| eventstats avg(Value) AS Avg_Process_Value,sum(Value) AS Process_Value by _time,host,instance

| eval True_Process_Percent=(Process_Value/Total_Host_Value)*100

| eventstats sum(True_Process_Percent) AS Total_Host_Percent by _time

| eval 
True_Process_Percent=round(True_Process_Percent,2),True_Percent_Total=round(True_Percent_Total,2),Av
g_Process_Value=round(Avg_Process_Value,2),Total_Host_Value=round(Total_Host_Value,2),Process_Value=
round(Process_Value,2),Total_Host_Percent=round(Total_Host_Percent,2)

| rename instance AS Process

| table 
_time,host,counter,Process,Total_Host_Percent,Total_Host_Value,True_Process_Percent,Process_Value,,A
vg_Process_Value

| chart span=1m avg(True_Process_Percent) AS Process_Percent over _time by Process

| sort -_time"
AD_Obj_Admin_Audit_Build,Search for Rebuilding the AD_Obj_Admin_Audit Lookup in the KV Store.  This will replace the data currently in the lookup with all new values from the Windows Security Event Logs.,always,24h,`ms_obj_winevt_init_admin_audit`
AD_Obj_Admin_Audit_Migrate,Search for Rebuilding the AD_Obj_GPO Lookup in the KV Store.  This will replace the data currently in the lookup with all new values from the Windows Security Event Logs.,always,24h,`ms_obj_winevt_migrate_admin_audit`
AD_Obj_Admin_Audit_Update,"Scheduled Search for picking up Change Management, administrator Details AD_Obj_Admin_Audit Lookup Table",always,24h,`ms_obj_winevt_upd_admin_audit`
AD_Obj_Computer_Migrate,Search for Migrating from AD_Computer_LDAP_list.csv to the AD_Obj_Computer Lookup in the KV Store.,always,24h,"`ms_obj_admon_migrate_out(computer,Computer)`"
AD_Obj_Computer_ReBuild,Search for Rebuilding the AD_Obj_Computer Lookup in the KV Store.  This will replace the data currently in the lookup with all new values from the last time the admon baseline was collected.,always,24h,"`ms_obj_admon_bld_init_out(computer,Computer)`"
AD_Obj_Computer_Update,"Scheduled Search for picking up Computer AD Object Updates,New,Deleted,Moved then syncing AD_Obj_Computer Lookup Table",always,24h,"`ms_obj_admon_bld_upd_out(computer,Computer)`"
AD_Obj_Domain_Update,"Scheduled Search for picking up User AD Object Updates, then syncing for User Lookup Table",always,24h,`ms_obj_admon_upd_domain`
AD_Obj_GPO_Migrate,Search for Migrating from AD_GroupPolicies_LDAP_list.csv to the AD_Obj_GPO Lookup in the KV Store.,always,24h,"`ms_obj_admon_migrate_out(gpo,GPO)`"
AD_Obj_GPO_OU_Update,"Scheduled Search for picking up GPO AD Object Updates, then syncing for GPO Lookup Table",always,24h,| `ms_ad_admon_upd_gpo_wou`
AD_Obj_GPO_ReBuild,Search for Rebuilding the AD_Obj_GPO Lookup in the KV Store.  This will replace the data currently in the lookup with all new values from the last time the admon baseline was collected.,always,24h,"`ms_obj_admon_bld_init_out(gpo,GPO)`"
AD_Obj_GPO_Update,"Scheduled Search for picking up GPO AD Object Updates,New,Deleted,Moved then syncing AD_Obj_GPO Lookup Table",always,24h,"`ms_obj_admon_bld_upd_out(gpo,GPO)`"
AD_Obj_Group_Migrate,Search for Migrating from AD_Groups_LDAP_list.csv to the AD_Obj_Group Lookup in the KV Store.,always,24h,"`ms_obj_admon_migrate_out(group,Group)`"
AD_Obj_Group_ReBuild,Search for Rebuilding the AD_Obj_Group Lookup in the KV Store.  This will replace the data currently in the lookup with all new values from the last time the admon baseline was collected.,always,24h,"`ms_obj_admon_bld_init_out(group,Group)`"
AD_Obj_Group_Update,"Scheduled Search for picking up Group AD Object Updates,New,Deleted,Moved then syncing AD_Obj_Group Lookup Table",always,24h,"`ms_obj_admon_bld_upd_out(group,Group)`"
AD_Obj_OU_GPO_Update,"Scheduled Search for picking up OU AD Object Updates, then syncing linked GPO's with the AD Obj GPO table.",always,24h,| `ms_ad_admon_upd_ou_wgpo`
AD_Obj_OU_Migrate,Search for Migrating from AD_OU_LDAP_list.csv to the AD_Obj_OU Lookup in the KV Store.,always,24h,"`ms_obj_admon_migrate_out(ou,OU)`"
AD_Obj_OU_ReBuild,Search for Rebuilding the AD_Obj_OU Lookup in the KV Store.  This will replace the data currently in the lookup with all new values from the last time the admon baseline was collected.,always,24h,"`ms_obj_admon_bld_init_out(ou,OU)`"
AD_Obj_OU_Update,"Scheduled Search for picking up OU AD Object Updates,New,Deleted,Moved then syncing AD_Obj_OU Lookup Table",always,24h,"`ms_obj_admon_bld_upd_out(ou,OU)`"
AD_Obj_User_Migrate,Search for Migrating from AD_User_LDAP_list.csv to the AD_Obj_User Lookup in the KV Store.,always,24h,"`ms_obj_admon_migrate_out(user,User)`"
AD_Obj_User_ReBuild,Search for Rebuilding the AD_Obj_User Lookup in the KV Store.  This will replace the data currently in the lookup with all new values from the last time the admon baseline was collected.,always,24h,"`ms_obj_admon_bld_init_out(user,User)`"
AD_Obj_User_Update,"Scheduled Search for picking up Group AD Object Updates,New,Deleted,Moved then syncing AD_Obj_User Lookup Table",always,24h,"`ms_obj_admon_bld_upd_out(user,User)`"
Addon Metadata - Migrate AWS Accounts,,always,24h,| listawsaccounts | collect `aws-account-index`
Addon Metadata - Summarize AWS Inputs,,always,24h,| listawsinputs | collect `aws-input-index`
Addon Synchronization,,always,24h,| syncaddon
Admin_Extra_Field_Sizing_Analysis,,always,24h,"eventtype=ms_ad_obj_wineventlog_index earliest=-15m latest=now

| fieldsummary 

| rex field=values max_match=0 ""value\"":\""(?<values>[^\""]*)\"",""

| mvexpand values 

| eval bytes=len(values)

| rex field=field 
""^(?!date|punct|host|hostip|index|linecount|source|sourcetype|timeendpos|timestartpos|splunk_server)
(?<FieldName>.*)""

| stats count sum(bytes) as SumOfBytesInField values(values) as Values max(bytes) as 
MaxFieldLengthInBytes by FieldName

| rename count as NumberOfValuesPerField

| eventstats sum(NumberOfValuesPerField) as TotalEvents sum(SumOfBytesInField) as TotalBytes

| eval PercentageOfTotalEvents=round(NumberOfValuesPerField/TotalEvents*100,2)

| eval PercentageOfTotalBytes=round(SumOfBytesInField/TotalBytes*100,2)

| eval ConsumedMB=SumOfBytesInField/1024/1024

| eval TotalMB=TotalBytes/1024/1024

| table FieldName NumberOfValuesPerField SumOfBytesInField ConsumedMB PercentageOfTotalBytes 
PercentageOfTotalEvents

| addcoltotals labelfield=FieldName label=Totals

| sort - PercentageOfTotalEvents"
Amazon Inspector: Topology Amazon Inspector Recommendation Generator,Generate Amazon Inspector data,always,24h,"`aws-inspector-findings` assetAttributes.agentId=* assetType=ec2-instance | rename 
assetAttributes.agentId as agent_id, serviceAttributes.rulesPackageArn as rule_arn | stats 
latest(severity) as severity, latest(title) as finding by rule_arn, agent_id | table agent_id, 
severity, finding | outputlookup topology_inspector_recommendations"
Anomaly Detection: Jobs Service,,always,24h,| anomalyjob
Anomaly Detection: Schedule Time Checker,,always,24h,"index=_audit action=""search"" search=* | regex search=""job_id=\""\w{8}-\w{4}-\w{4}-\w{4}-\w{12}\""""  | 
eval is_alert=if(savedsearch_name="""", 0, 1) , earliest_time = strptime(apiStartTime,""'%a %b %d %T 
%Y'""), latest_time=strptime(apiEndTime,""'%a %b %d %T %Y'""), day=strftime(_time, ""%Y-%m-%d"")  | table 
_time, job_id, is_alert, earliest_time,latest_time, day | append [ | inputlookup 
anomaly_schedule_checker ] | where isnotnull(earliest_time) AND isnotnull(latest_time) | dedup 
job_id, is_alert | outputlookup anomaly_schedule_checker"
App Upgrader,Upgrade everything of the App to the latest version,always,24h,| upgrade
Application crash count in the last 24 hours,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" EventCode=""1001"" Event_Name=""*"" 

| eval application=P1."" (version: "".P2."")"" 

| timechart count by application"
Application crash count in the last 30 days,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" EventCode=""1001"" Event_Name=""*"" 

| eval application=P1."" (version: "".P2."")"" 

| timechart count by application"
Application crash count in the last 7 days,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" EventCode=""1001"" Event_Name=""*"" 

| eval application=P1."" (version: "".P2."")"" 

| timechart count by application"
Application Installed,,always,24h,"| rest /services/apps/local | search disabled=0 details=""http*""

| table label description details version"
Apps with an updgrade,,always,24h,"| rest /services/apps/local | search disabled=0 details=""http*"" (version!=update.version AND 
update.version != """")

| table label description details version update.version"
"Average CPU utilization per process, host in the last 24 hours",,always,24h,"`perfmon-index` eventtype=perfmon_windows object=Process counter=""% Processor Time"" 

| stats avg(Value) as ""Avg. CPU utilization"" by instance, Host"
"Average Memory utilization per process, host in the last 24 hours",,always,24h,"`perfmon-index` eventtype=perfmon_windows object=Process  counter=""Private Bytes"" 

| eval MB=Value/(1024*1024) 

| stats avg(MB) as ""Avg. Memory Utilization in MB"" by instance, host"
AWS Accounts with zero events in the last 24 hours,,always,24h,"index=prod_aws 

``` The event filed name needs to match the lookup table column name ```

| rename aws_account_id as AccountID

| stats count by AccountID

| inputlookup append=true C3-CM-AWSAccountAlias

| fillnull count 

| stats sum(count) as count by AccountID

| sort -count

| lookup C3-CM-AWSAccountAlias AccountID as AccountID OUTPUT Description

| search count = 0

| table AccountID, Description, count"
AWS Bill - Current Month Cost until Now,,always,24h,"| savedsearch ""AWS Bill - Monthly Latest Snapshot"" | search RecordType=StatementTotal | eval 
date_month=strftime(_time, ""%Y-%m"") | eval current_month=strftime(now(), ""%Y-%m"") | where 
date_month=current_month | stats sum(TotalCost) as TotalCost, first(CurrencyCode) as CurrencyCode"
AWS Bill - Current Month Cost until Now by Linked Account,,always,24h,"| savedsearch ""AWS Bill - Monthly Latest Snapshot"" | search RecordType=AccountTotal | eval 
date_month=strftime(_time, ""%Y-%m"") | eval current_month=strftime(now(), ""%Y-%m"") | where 
date_month=current_month | stats sum(TotalCost) as TotalCost, first(CurrencyCode) as CurrencyCode by 
LinkedAccount"
AWS Bill - Current Month Cost until Now by Service,,always,24h,"| savedsearch ""AWS Bill - Monthly Latest Snapshot"" | search RecordType=LinkedLineItem | eval 
date_month=strftime(_time, ""%Y-%m"") | eval current_month=strftime(now(), ""%Y-%m"") | where 
date_month=current_month | stats sum(TotalCost) as TotalCost, first(CurrencyCode) as CurrencyCode by 
ProductName"
AWS Bill - Daily Cost through Last Month - Blended,,always,24h,"| savedsearch ""AWS Bill - Detailed Cost Latest Snapshot"" | search RecordType=LineItem |   timechart 
span=1day sum(BlendedCost) as TotalCost"
AWS Bill - Daily Cost through Last Month - Unblended,,always,24h,"| savedsearch ""AWS Bill - Detailed Cost Latest Snapshot"" | search RecordType=LineItem |   timechart 
span=1day sum(UnBlendedCost) as TotalCost"
AWS Bill - Daily Cost through Last Month by Linked Account - Blended,,always,24h,"| savedsearch ""AWS Bill - Detailed Cost Latest Snapshot"" | search RecordType=LineItem |   timechart 
span=1day sum(BlendedCost) as TotalCost by LinkedAccount limit=20"
AWS Bill - Daily Cost through Last Month by Linked Account - Unblended,,always,24h,"| savedsearch ""AWS Bill - Detailed Cost Latest Snapshot"" | search RecordType=LineItem |   timechart 
span=1day sum(UnBlendedCost) as TotalCost by LinkedAccount limit=20"
AWS Bill - Daily Cost through Last Month by Region - Blended,,always,24h,"| savedsearch ""AWS Bill - Detailed Cost Latest Snapshot"" | search RecordType=LineItem |  timechart 
span=1day sum(BlendedCost) as TotalCost by AvailabilityZone limit=20"
AWS Bill - Daily Cost through Last Month by Region - Unblended,,always,24h,"| savedsearch ""AWS Bill - Detailed Cost Latest Snapshot"" | search RecordType=LineItem |  timechart 
span=1day sum(UnBlendedCost) as TotalCost by AvailabilityZone limit=20"
AWS Bill - Daily Cost through Last Month by Service - Blended,,always,24h,"| savedsearch ""AWS Bill - Detailed Cost Latest Snapshot"" | search RecordType=LineItem |   timechart 
span=1day sum(BlendedCost) as TotalCost by ProductName limit=20"
AWS Bill - Daily Cost through Last Month by Service - Unblended,,always,24h,"| savedsearch ""AWS Bill - Detailed Cost Latest Snapshot"" | search RecordType=LineItem |   timechart 
span=1day sum(UnBlendedCost) as TotalCost by ProductName limit=20"
AWS Bill - Detailed Cost Latest Snapshot,"To change index, revise the search string: index=""index"" eventtype=aws_billing_detail_report [seardch index=""your index"" ...(same as the left part)...",always,24h,"eventtype=aws_billing_detail_report  [search eventtype=aws_billing_detail_report 
RecordType=StatementTotal | dedup report_month sortby -_time | return 1000 S3KeyLastModified]"
AWS Bill - Monthly Cost,,always,24h,"| savedsearch ""AWS Bill - Monthly Latest Snapshot"" | search RecordType=StatementTotal | timechart 
span=1mon sum(TotalCost) as TotalCost"
AWS Bill - Monthly Cost by Linked Account,,always,24h,"| savedsearch ""AWS Bill - Monthly Latest Snapshot"" | search RecordType=AccountTotal | timechart 
span=1mon sum(TotalCost) by LinkedAccount limit=20"
AWS Bill - Monthly Cost by Service,,always,24h,"| savedsearch ""AWS Bill - Monthly Latest Snapshot"" | search RecordType=LinkedLineItem  | timechart 
span=1mon sum(TotalCost) as TotalCost by ProductName limit=20"
AWS Bill - Monthly Cost through Last Month by Region - Blended,,always,24h,"| savedsearch ""AWS Bill - Detailed Cost Latest Snapshot"" | search RecordType=LineItem |  timechart 
span=1mon sum(BlendedCost) as TotalCost by AvailabilityZone limit=20"
AWS Bill - Monthly Cost through Last Month by Region - Unblended,,always,24h,"| savedsearch ""AWS Bill - Detailed Cost Latest Snapshot"" | search RecordType=LineItem |  timechart 
span=1mon sum(UnBlendedCost) as TotalCost by AvailabilityZone limit=20"
AWS Bill - Monthly Latest Snapshot,"To change index, revise the search string: index=""index"" eventtype=aws_billing_monthly_report [search index=""index"" ...(same as the left part)...",always,24h,"eventtype=aws_billing_monthly_report [search eventtype=aws_billing_monthly_report | dedup 
report_month sortby -_time | return 1000 S3KeyLastModified]"
AWS Bill - Total Cost through Last Month by Region - Blended,,always,24h,"| savedsearch ""AWS Bill - Detailed Cost Latest Snapshot"" | search RecordType=LineItem |  stats 
sum(BlendedCost) as TotalCost by AvailabilityZone"
AWS Bill - Total Cost through Last Month by Region - Unblended,,always,24h,"| savedsearch ""AWS Bill - Detailed Cost Latest Snapshot"" | search RecordType=LineItem |  stats 
sum(UnBlendedCost) as TotalCost by AvailabilityZone"
AWS Bill - Total Cost until Now,,always,24h,"| savedsearch ""AWS Bill - Monthly Latest Snapshot"" | search RecordType=StatementTotal | stats 
sum(TotalCost) as TotalCost, first(CurrencyCode) as CurrencyCode"
AWS Bill - Total Cost until Now by Linked Account,,always,24h,"| savedsearch ""AWS Bill - Monthly Latest Snapshot"" | search RecordType=AccountTotal  | stats 
sum(TotalCost) as TotalCost, first(CurrencyCode) as CurrencyCode by LinkedAccount"
AWS Bill - Total Cost until Now by Service,,always,24h,"| savedsearch ""AWS Bill - Monthly Latest Snapshot"" | search RecordType=LinkedLineItem | stats 
sum(TotalCost) as TotalCost, first(CurrencyCode) as CurrencyCode by ProductName"
AWS Bill - Total Daytime Cost through Last Month - Blended,,always,24h,"| savedsearch ""AWS Bill - Detailed Cost Latest Snapshot"" | search RecordType=LineItem |  eval 
date_hour=strftime(_time, ""%H"") | search (date_hour>=7 AND date_hour<=17) | stats sum(BlendedCost) 
as TotalCost"
AWS Bill - Total Daytime Cost through Last Month - Unblended,,always,24h,"| savedsearch ""AWS Bill - Detailed Cost Latest Snapshot"" | search RecordType=LineItem |  eval 
date_hour=strftime(_time, ""%H"") | search (date_hour>=7 AND date_hour<=17) | stats sum(UnBlendedCost) 
as TotalCost"
AWS Bill - Total Nighttime Cost through Last Month - Blended,,always,24h,"| savedsearch ""AWS Bill - Detailed Cost Latest Snapshot"" | search RecordType=LineItem |  eval 
date_hour=strftime(_time, ""%H"") | search (date_hour < 7 OR date_hour > 17) | stats sum(BlendedCost) 
as TotalCost"
AWS Bill - Total Nighttime Cost through Last Month - Unblended,,always,24h,"| savedsearch ""AWS Bill - Detailed Cost Latest Snapshot"" | search RecordType=LineItem |  eval 
date_hour=strftime(_time, ""%H"") | search (date_hour < 7 OR date_hour > 17) | stats 
sum(UnBlendedCost) as TotalCost"
AWS Billing - Account Name,Extract account id - account name lookup from monthly billing report,always,24h,"`aws-billing-sourcetype` eventtype=aws_billing_monthly_report (RecordType=InvoiceTotal OR 
RecordType=AccountTotal) | eval 
LinkedAccountId=if(isnull(LinkedAccountId),PayerAccountId,LinkedAccountId) | eval 
LinkedAccountName=if(isnull(LinkedAccountName),PayerAccountName,LinkedAccountName) | stats count by 
LinkedAccountId LinkedAccountName | dedup LinkedAccountId sortby -_time | append [makeresults | eval 
LinkedAccountId=""placeholder"" | eval LinkedAccountName=""placeholder""] | table LinkedAccountId 
LinkedAccountName | outputlookup account_name"
AWS Config - Tags,Extract tags lookup from AWS Config,always,24h,"`aws-config-sourcetype` | spath output=tags path=tags | stats count by tags resourceType 
aws_account_id | fields - count | rex max_match=20 field=tags ""\""(?<key>[^,]+)\"": 
\""(?<value>[^,]+)\"""" | eval keyvalue=mvzip('key', 'value',""="") | mvexpand keyvalue | fields keyvalue 
resourceType aws_account_id | rex field=keyvalue ""(?<key>[^,]+)=(?<value>[^,]+)"" |  stats count by 
key value resourceType aws_account_id | fields key value resourceType aws_account_id | rename 
resourceType as type | outputlookup tags_config"
AWS Dashboard Report Acceleration,,always,24h,"index=* sourcetype=""aws:cloudwatchlogs"" OR sourcetype=""aws:cloudtrail"" OR sourcetype=""aws:metadata"" 
OR sourcetype=""aws:cloudwatch:guardduty""

OR sourcetype=""aws:securityhub:finding"" OR sourcetype=""aws:iam:credentialreport"" OR 
sourcetype=""aws:accessanalyzer:finding""

| rex field=source 
""(?<source_dm_id>[0-9a-f]{8}\b-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-\b[0-9a-f]{12})""

| eval id = if(isnotnull(data_manager_input_id), data_manager_input_id, source_dm_id)

| rex field=source ""^[^:]+:(\/)?(?<cwl_type>[^\/]+)(\/)(?<cwl_service>[^\/]+).+$""

| rex field=source ""^[^:]+:(?<md_category>(iam_|ec2_)\w+)$""

| eval cwl_ds = sourcetype + "":"" + if(cwl_type==""aws"", cwl_service, ""api-gateway"")

| eval metadata_ds = sourcetype + "":"" + md_category

| eval datasource = case(sourcetype == ""aws:cloudwatchlogs"", cwl_ds, sourcetype == ""aws:metadata"", 
metadata_ds, true(), sourcetype)

| eval account_id = coalesce(recipientAccountId, AccountId, AwsAccountId, accountId, account)

| eval region = if(datasource == ""aws:iam:credentialreport"" OR datasource == 
""aws:metadata:iam_users"", ""us-east-1"", coalesce(awsRegion, Region, region))

| stats latest(_time) as last_seen_event, count as num_events_7d, sparkline(count) as 
last_7d_sparkline by id, datasource, region, account_id"
AWS Description - CloudFront Edges,,always,24h,"`aws-description-resource("""", """", ""cloudfront_distributions"")` | dedup id | table id, domain_name, 
account_id | outputlookup cloudfront_edges"
AWS Description - S3 Buckets,,always,24h,"`aws-description(""*"", ""*"", ""s3_buckets"", ""Name"")`  | rename Name as bucket_name, LocationConstraint 
as region | table bucket_name, account_id, region | outputlookup s3_buckets"
AWS Description - Tags,,always,24h,"`aws-description-sourcetype` | spath output=tags path=tags | stats count by tags source 
aws_account_id | fields - count | rex max_match=20 field=tags ""\""(?<key>[^,]+)\"": 
\""(?<value>[^,]+)\"""" | eval keyvalue=mvzip('key', 'value',""="") | mvexpand keyvalue | fields keyvalue 
source aws_account_id | rex field=keyvalue ""(?<key>[^,]+)=(?<value>[^,]+)"" | rex field=source 
"".*?:(?<type>.*)"" |  stats count by key value type aws_account_id | fields key value type 
aws_account_id | outputlookup tags_description"
AWS: calculate data volume indexed,Calculate the amount of data indexed in Splunk,always,24h,"| search index=_internal sourcetype=splunkd source=*metrics.log splunk_server=""*"" 
group=""per_sourcetype_thruput"" 

         | stats sum(kb) as sum_kb by series | eval sum_mb=sum_kb/1024 

         | filterawssourcetype"
Azure Billing Period Lookup,,always,24h,"`azure-index` sourcetype=azure:billing:period | stats count by _time subscriptionId id name 
properties.billingPeriodStartDate properties.billingPeriodEndDate  | rename 
properties.billingPeriodStartDate AS billingPeriodStartDate properties.billingPeriodEndDate AS 
billingPeriodEndDate  | inputlookup azure_billing_periods append=t  | stats count by _time 
subscriptionId id name billingPeriodStartDate billingPeriodEndDate  | fields - count | outputlookup 
azure_billing_periods"
Azure No. Action by App and User,,always,24h,"| pivot Azure_Successful_Action RootObject count(RootObject) AS Hits SPLITROW appDisplayName AS 
Application SPLITROW userDisplayName AS Employee SORT 100 appDisplayName ROWSUMMARY 0 COLSUMMARY 0 
SHOWOTHER 1"
Azure Subscriptions Lookup,,always,24h,"`azure-index` sourcetype=""azure:subscriptions"" | stats count by subscriptionId, displayName | 
inputlookup lookup_subscriptions append=true | stats count by subscriptionId, displayName | fields - 
count | outputlookup lookup_subscriptions"
Billing CUR: Billing Reports AssemblyId Generator,Generate the lookup that stores the AssemblyId for the latest CUR report for each month.,always,24h,"`aws-billing-sourcetype-cur-digest` 

| stats latest(assemblyId) as assemblyId, latest(lastModified) as lastModifiedDate by source 

| rex field=source "".*/(?<timestr>\\d{8}-)\\d{8}.*"" 

| outputlookup billing_report_assemblyid_cur"
Billing CUR: Topology Billing Metric Generator,Generate Billing overlay for Topology,always,24h,"`aws-billing-details-cur(*)` InvoiceId=* ResourceId=""i-*"" OR ResourceId=""vol-*"" 

| rex field=source 
""(?<assemblyId>(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{
12}(\}){0,1})"" 

| search 

    [| inputlookup billing_report_assemblyid_cur | eval timestr1 = 
strftime(relative_time(now(),""-mon""), ""%Y%m"") + ""01-"" | where timestr = timestr1 |  table  
assemblyId | format] 

| stats sum(BlendedCost) as billing by ResourceId 

| rename ResourceId as name 

| table billing, name 

| outputlookup topology_billing_metrics_cur"
Billing: Billing Reports S3Key Generator,Generate the lookup that stores the S3KeyLastModified for the latest report each month.,always,24h,"`aws-billing-sourcetype` (RecordType=AccountTotal OR RecordType=StatementTotal) | stats count by 
aws_account_id S3KeyLastModified source eventtype | eventstats max(S3KeyLastModified) as max_s3 by 
source | where S3KeyLastModified=max_s3 and (eventtype=""aws_billing_monthly_report"" or 
eventtype=""aws_billing_detail_report"") | table S3KeyLastModified source eventtype | outputlookup 
billing_report_s3key"
Billing: Topology Billing Metric Generator,Generate Billing overlay for Topology,always,24h,"`aws-billing-details(*)` ResourceId=""i-*"" OR ResourceId=""vol-*"" | stats sum(BlendedCost) as billing 
by ResourceId | rename ResourceId as name | table billing, name | outputlookup 
topology_billing_metrics"
Bucket Merge Retrieve Conf Settings,,always,24h,"| rest services/data/indexes datatype=all 

| search disabled!=1 AND bucketMerging=1 

| dedup title 

| fields title bucketMerging bucketMerge.minMergeSizeMB bucketMerge.maxMergeSizeMB 
bucketMerge.maxMergeTimeSpanSecs bucketMerge.minMergeCount bucketMerge.maxMergeCount"
C3 - License Usage (Last Month),,always,24h,"`sim_licensing_summary_base`

          | `sim_licensing_summary_no_split("""")`

          | join [ search index=summary source=""splunk-ingestion""

            | stats latest(ingest_license) as license]

          | eval ingestion=GB, ""license limit""=license

          | fields - GB volume license"
C3 AWS Accounts with zero events in the last 24 hours,,always,24h,"index=prod_aws 

``` The event filed name needs to match the lookup table column name ```

| rename aws_account_id as AccountID

| stats count by AccountID

| inputlookup append=true C3-CM-AWSAccountAlias

| fillnull count 

| stats sum(count) as count by AccountID

| sort -count

| lookup C3-CM-AWSAccountAlias AccountID as AccountID OUTPUT Description

| search count = 0

| table AccountID, Description, count"
C3 Checkpoint Address Spoofing,,always,24h,"index=prod_checkpoint action=Detect 

| stats count by origin, src_ip, message_info, dest_ip , dest_port 

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location 

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location

| sort -count 

| search count > 500

| table origin, src_ip, src_location, message_info, dest_ip, dest_port, dest_location, count"
C3 Checkpoint Firewall Blocks,,always,24h,"index=prod_checkpoint action=Drop dest_ip!=62.216.233.164

| stats count by index, origin, src_ip, dest_ip, dest_port, action, rule_name

| sort -count

| head 20

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location 

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location

| lookup C3_WellKnownPorts port as dest_port OUTPUT description as Port

| rename origin as ""Firewall""

| table count, Firewall, src_ip, src_location, dest_ip, dest_port,Port,  dest_location, rule_name"
C3 Checkpoint Not Accepts,,always,24h,"index=prod_checkpoint action!=Accept

|  stats count by origin, src_ip, action, dest_ip , dest_port

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location

| sort -count

| table origin, src_ip, src_location, action, dest_ip, dest_port , dest_location , count"
C3 Checkpoint Scanner Blocks,,always,24h,"index=prod_checkpoint action=Drop src_ip IN (

``` Rapid 7 Scan Engines ```

""10.70.90.20"",

""10.70.90.21"",

""10.70.90.22"",

""10.80.90.20"",

""10.80.90.21"",

""10.80.90.22"",



``` MID Servers for Service Now ```

""10.70.181.10"",

""10.70.181.11"",

""10.70.181.12"",

""10.80.181.10"",

""10.80.181.11"",

""10.80.181.12""



)

| stats count by index, origin, src_ip, dest_ip, dest_port, action, rule_name

| sort -count

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location 

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location

| rename origin as ""Firewall""

| table count, Firewall, src_ip, src_location, dest_ip, dest_port, dest_location, rule_name"
C3 Checkpoint Top Talkers V3,,always,24h,"| tstats summariesonly=t sum(All_Traffic.bytes) AS Bytes sum(All_Traffic.bytes_in) as Bytes_In  
sum(All_Traffic.bytes_out) as Bytes_Out FROM datamodel=Network_Traffic WHERE 

    sourcetype=""cp_Firewall"" 

    ``` All_traffic.dest_ip = ""45.32.228.159"" ```

    NOT All_Traffic.action IN ( ""Drop"" )

    BY 

    All_Traffic.src_ip, All_Traffic.action, All_Traffic.dest_ip

| rename All_Traffic.* AS * 

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location 

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location 

| rename src_ip AS ""Source IP""

| eval GBytes = round(Bytes / 1024 /1024 /1024, 2) 

| eval GBytes_Out = round(Bytes_Out / 1024 /1024 /1024, 2) 

| eval GBytes_In = round(Bytes_In / 1024 /1024 /1024, 2) 

| sort - Bytes

| head 20

| fields ""Source IP"", src_location, action, GBytes, GBytes_In, GBytes_Out , dest_ip, dest_location"
C3 Cisco Scanner Blocks,,always,24h,"index=prod_cisco_asa Cisco_ASA_action=den* src_ip IN (

""10.70.90.20"",

""10.70.90.21"",

""10.70.90.22"",

""10.80.90.20"",

""10.80.90.21"",

""10.80.90.22"",

""10.70.181.10"",

""10.70.181.11"",

""10.70.181.12"",

""10.80.181.10"",

""10.80.181.11"",

""10.80.181.12""

)

| stats count by index, host, src_ip, dest_ip, dest_port, Cisco_ASA_action, rule_id

| sort -count

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location 

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location

| rename host as ""Firewall""

| table count, Firewall, src_ip, src_location, dest_ip, dest_port, dest_location, rule_id"
C3 DNS Analysis,Analysis of DNS Traffic,always,24h,"| tstats summariesonly=t count FROM datamodel=Network_Traffic WHERE ``` sourcetype=""cp_Firewall"" ``` 
All_Traffic.dest_port=""53"" All_Traffic.src_ip=* All_Traffic.dest_ip=""*"" BY All_Traffic.src_ip, 
All_Traffic.action, All_Traffic.dest_ip, All_Traffic.dest_port

| rename All_Traffic.* AS * 

| lookup C3Subnets subnet as src_ip OUTPUT location as ""Source Location"" 

| lookup C3Subnets subnet as dest_ip OUTPUT location as ""Destination Location""  

| rename src_ip AS ""Source IP"", dest_ip AS ""Destination IP"", dest_port AS ""Destination Port""

| fields ""Source Location"", ""Source IP"", ""Destination Location"", ""Destination IP"", ""Destination 
Port"" , action, count

| sort -count"
C3 DNS Analysis,Analysis of DNS Traffic,always,24h,"| tstats summariesonly=t count FROM datamodel=Network_Traffic WHERE 

    sourcetype=""cp_Firewall"" 

    All_Traffic.dest_port=""53"" 

    NOT All_Traffic.dest_ip IN (

    ""0.0.0.0"",

    ""10.10.150.2"",

    ""10.60.1.10"",

    ""10.60.8.10"",

    ""10.60.8.11"",

    ""10.60.80.10"",

    ""10.70.20.10"",

    ""10.70.20.11"",

    ""10.80.20.10"",

    ""10.80.20.11"",

    ""10.80.40.101"",

    ""10.10.150.1"",

    ""10.200.44.5"",

    ""172.18.128.99"",

    ""255.255.255.255"")

    NOT All_Traffic.src_ip IN (

    ""0.0.0.0"", 

    ""10.10.150.2"",

    ""10.60.1.10"",

    ""10.60.8.10"",

    ""10.60.8.11"",

    ""10.60.80.10"",

    ""10.70.55.10"",

    ""10.70.20.10"",

    ""10.70.20.11"",

    ""10.80.20.10"",

    ""10.80.20.11"",

    ""10.80.20.83"",

    ""10.80.40.101"",

    ""10.200.44.5"",

    ""172.18.128.98"",

    ""172.18.128.99"",

    ""10.70.20.83"",

    ""255.255.255.255"")

    ``` NOT All_Traffic.dvc IN (""10.60.10.252"". ""10.60.10.253"", ""10.60.73.252"" , ""10.60.73.253"", 
""172.18.248.123"", ""172.18.248.125"" )  ```

    ``` NOT All_Traffic.action IN (""Detect"", ""Prevent"", ""Drop"" ) ```

    BY 

    All_Traffic.src_ip, All_Traffic.action, All_Traffic.dest_ip

| rename All_Traffic.* AS * 

| sort - count

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location 

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location 

| rename src_ip AS ""Source IP""

| fields ""Source IP"", src_location, action, count , dest_ip, dest_location"
C3 Dynatrace Blocks,,always,24h,"index=prod_checkpoint action=Drop dest_ip IN (

""52.211.92.185"",

""63.33.149.166"",

""63.34.224.115"",

""34.246.164.174"",

""108.128.127.88"",

""54.73.50.132"",

""54.194.226.107"",

""34.249.56.77"",

""54.73.199.74"",

""34.249.78.239"",

""34.241.194.10"",

""54.220.249.199"",

""54.76.0.28"",

""54.247.149.59"",

""63.34.231.89"",

""54.72.59.249"",



""10.70.10.77"", 

""10.60.1.77"", 

""10.70.20.207"", 

""10.70.20.208""

)

| stats count by index, origin, src_ip, dest_ip, dest_port, action, rule_name

| sort -count

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location 

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location

| rename origin as ""Firewall""

| table count, Firewall, src_ip, src_location, dest_ip, dest_port, dest_location, rule_name"
C3 Dynatrace Cisco Blocks,,always,24h,"index=prod_cisco_asa Cisco_ASA_action=den* dest_ip IN (

""52.211.92.185"",

""63.33.149.166"",

""63.34.224.115"",

""34.246.164.174"",

""108.128.127.88"",

""54.73.50.132"",

""54.194.226.107"",

""34.249.56.77"",

""54.73.199.74"",

""34.249.78.239"",

""34.241.194.10"",

""54.220.249.199"",

""54.76.0.28"",

""54.247.149.59"",

""63.34.231.89"",

""54.72.59.249"",



""10.70.10.77"", 

""10.60.1.77"", 

""10.70.20.207"", 

""10.70.20.208""

)

| stats count by index, host, src_ip, dest_ip, dest_port, Cisco_ASA_action, rule_id

| sort -count

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location 

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location

| rename host as ""Firewall""

| table count, Firewall, src_ip, src_location, dest_ip, dest_port, dest_location, rule_id"
C3 Events by timeacross all prod indexs,,always,24h,"|  tstats prestats=t count WHERE index=prod_* AND sourcetype IN (""*"") BY sourcetype _time indextime 
span=1m

| timechart count span=1h by sourcetype"
C3 Events going into all known AWS Accounts,Lists all the accounts in  C3-CM-AWSAccountAlias with a count of each,always,24h,"index=prod_aws 

``` The event filed name needs to match the lookup table column name ```

| rename aws_account_id as AccountID

| stats count by AccountID

| inputlookup append=true C3-CM-AWSAccountAlias

| fillnull count 

| stats sum(count) as count by AccountID

| sort -count

| lookup C3-CM-AWSAccountAlias AccountID as AccountID OUTPUT AccountName, Description

| table AccountID, AccountName, Description, count"
C3 Firewall Block Analysis,,always,24h,"| tstats summariesonly=t count FROM datamodel=Network_Traffic WHERE 

    

```    All_Traffic.dest_ip IN (

    )

```

    All_Traffic.src_ip IN (

    ""0.0.0.0"", 

    ""10.*"",

    ""192.168.*"",

    ""172.16.*"",

    ""172.17.*"",

    ""172.18.*"",

    ""172.19.*"",

    ""172.20.*"",

    ""172.21.*"",

    ""172.22.*"",

    ""172.23.*"",

    ""172.24.*"",

    ""172.25.*"",

    ""172.26.*"",

    ""172.27.*"",

    ""172.28.*"",

    ""172.29.*"",

    ""172.30.*"",

    ""172.31.*"",

    ""255.255.255.255"")

    NOT All_Traffic.dvc IN (""10.60.10.252"". ""10.60.10.253"", ""10.60.73.252"" , ""10.60.73.253"", 
""172.18.248.123"", ""172.18.248.125"" ) 

     NOT All_Traffic.action IN (""permitted"", ""built"",""Accept"", ""Detect"" )

    BY 

    All_Traffic.dvc, All_Traffic.src_ip, All_Traffic.action, All_Traffic.dest_ip, 
All_Traffic.dest_port, All_Traffic.protocol

| rename All_Traffic.* AS * 

| sort - count

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location 

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location 

| lookup C3_WellKnownPorts port as dest_port OUTPUT description as Port_Description

| rename src_ip AS ""Source IP""

| fields dvc, ""Source IP"", src_location, action, count , dest_ip, protocol, dest_port, 
Port_Description , dest_location"
C3 Firewall Ingestion Usage,,always,24h,"`sim_licensing_usage_base`

| search idx IN (prod_checkpoint,prod_cisco_asa)

| `sim_licensing_usage_all(""idx"")`

| eval ingestion=GB | fields - GB volume"
C3 Heavy Forwarder Blocking,Heavy Forwarder Analysis,always,24h,"| tstats summariesonly=t count FROM datamodel=Network_Traffic WHERE 

    sourcetype=""cp_Firewall"" 

    All_Traffic.dest_ip IN (

    ""172.22.96.10"", 

    ""172.22.96.11"", 

    ""172.22.96.30"",

    ""172.22.96.41"", // Deployment Server

    ""172.25.96.10"", 

    ""172.25.96.11"",

    ""172.25.96.30""

    )

    NOT All_Traffic.src_ip IN (

    ""0.0.0.0"", 

    ""10.70.181.11"",

    ""10.80.181.10"",

    ""255.255.255.255"")

    ``` NOT All_Traffic.dvc IN (""10.60.10.252"". ""10.60.10.253"", ""10.60.73.252"" , ""10.60.73.253"", 
""172.18.248.123"", ""172.18.248.125"" )  ```

    All_Traffic.action IN (""Prevent"", ""Drop"" )

    BY 

    All_Traffic.src_ip, All_Traffic.action, All_Traffic.dest_ip, All_Traffic.dest_port

| rename All_Traffic.* AS * 

| sort - count

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location 

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location 

| lookup C3_WellKnownPorts port as dest_port OUTPUT description as Port_Description

| rename src_ip AS ""Source IP""

| fields ""Source IP"", src_location, action, count , dest_ip, dest_port, Port_Description , 
dest_location"
C3 Heavy Forwarder Blocks,,always,24h,"index=prod_checkpoint action=Drop dest_ip IN (

""172.22.96.10"",

""172.22.96.11"",

""172.25.96.10"",

""172.25.96.11""

)

| stats count by index, origin, src_ip, dest_ip, dest_port, action, rule_name

| sort -count

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location 

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location

| rename origin as ""Firewall""

| table count, Firewall, src_ip, src_location, dest_ip, dest_port, dest_location, rule_name"
C3 NTP Analysis,Analysis of NTP Traffic,always,24h,"| tstats summariesonly=t count FROM datamodel=Network_Traffic WHERE 

    sourcetype=""cp_Firewall"" 

    All_Traffic.dest_port=""123"" 

    NOT All_Traffic.dest_ip IN (

    ""0.0.0.0"",

    ""192.168.9.3"", // NTP Reading

    ""192.168.9.2"", // NTP Reading

    ""255.255.255.255"")

    NOT All_Traffic.src_ip IN (

    ""0.0.0.0"", 

    ""10.70.190.100"", // DC1 NTP

    ""10.80.190.100"", // DC2 NTP

    ""255.255.255.255"")

    ``` NOT All_Traffic.dvc IN (""10.60.10.252"". ""10.60.10.253"", ""10.60.73.252"" , ""10.60.73.253"", 
""172.18.248.123"", ""172.18.248.125"" )  ```

    ``` NOT All_Traffic.action IN (""Detect"", ""Prevent"", ""Drop"" ) ```

    BY 

    All_Traffic.src_ip, All_Traffic.action, All_Traffic.dest_ip

| rename All_Traffic.* AS * 

| sort - count

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location 

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location 

| rename src_ip AS ""Source IP""

| fields ""Source IP"", src_location, action, count , dest_ip, dest_location"
C3 Production Rules,,always,24h,"| rest /servicesNS/-/-/saved/searches

| search splunk_server=*sh* is_scheduled=1 disabled=0

| rename eai:acl.app as app

| stats count(cron_schedule) by cron_schedule, title, app, actions

| search (app=SA_Adarma_Secmon_Prod OR app=TA_Adarma-MSSP-CMMP)  (actions=*jira* OR 
actions=*runphantomplaybook*)"
C3 Readin Traffic,Analysis of Traffic going through the Reading Firewall,always,24h,"| tstats summariesonly=t count FROM datamodel=Network_Traffic WHERE 

    sourcetype=""cp_Firewall"" 

    All_Traffic.dest_port=""*"" 

    NOT All_Traffic.dest_ip IN (

    ""0.0.0.0"",

    ""255.255.255.255"")

    NOT All_Traffic.src_ip IN (

    ""0.0.0.0"", 

    ""10.10.0.*"",

    ""10.10.1.*"",

    ""10.10.2.*"",

    ""10.10.3.*"",

    ""10.10.4.*""

    ""10.10.8.*"",

    ""10.10.7.*"",

    ""10.10.10.*"",

    ""10.10.15.*"",

    ""10.10.110.*"",

    ""10.10.150.18"", //Bacs Server

    ""10.10.150.37"", //Fruadstar Server

    ""10.10.150.100"", // ESX Server

    ""10.10.150.89"", // VEAM Proxy

    ""10.10.150.99"", // Trend

    ""10.10.150.10"", // Trend

    ""10.10.200.50"", // Franking Machine

    ""10.10.200.51"", // Franking Machine

    ""10.10.150.60"", // SCCM Servers

    ""10.10.150.5"", // DCC

    ""10.10.150.4"", // DCC 2k19

    ""10.10.150.11"", // File Server 02

    ""192.168.40.*"",

    ""192.168.9.*"", // NTP Subnet

    ""192.168.7.*"", // NTP Subnet

    ""10.10.190.*"", // VXRail

    ""255.255.255.255"")

    NOT All_Traffic.dvc IN (""10.60.10.252"". ""10.60.10.253"", ""10.60.73.252"" , ""10.60.73.253"", 
""172.18.248.123"", ""172.18.248.125"" ) 

    NOT All_Traffic.Action IN (""Detect"", ""Prevent"", ""Drop"" )

    BY 

    All_Traffic.src_ip, All_Traffic.dest_port, All_Traffic.direction, All_Traffic.dest_ip, 
All_Traffic.action, All_Traffic.dest_translated_ip

| rename All_Traffic.* AS * 

| sort - count

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location 

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location

| lookup C3Subnets subnet as dest_translated_ip OUTPUT location as final_location

| rename src_ip AS ""Source IP"", dest_ip AS ""Destination IP"", dest_port AS Port, direction AS ""FW 
Determined Direction""

| fields ""Source IP"", src_location, ""Destination IP"", dest_location, Port, dest_translated_ip, 
final_location, Action, count"
C3 Reading Traffic Clone,Analysis of Traffic going through the Reading Firewall,always,24h,"| tstats summariesonly=t count FROM datamodel=Network_Traffic WHERE 

    sourcetype=""cp_Firewall"" 

    All_Traffic.dest_port=""*"" 

    NOT All_Traffic.dest_ip IN (

    ""0.0.0.0"",

    ""255.255.255.255"")

    NOT All_Traffic.src_ip IN (

    ""0.0.0.0"", 

    ""10.10.0.*"",

    ""10.10.1.*"",

    ""10.10.2.*"",

    ""10.10.3.*"",

    ""10.10.4.*""

    ""10.10.8.*"",

    ""10.10.7.*"",

    ""10.10.10.*"",

    ""10.10.15.*"",

    ""10.10.110.*"",

    ""10.10.150.18"", //Bacs Server

    ""10.10.150.37"", //Fruadstar Server

    ""10.10.150.100"", // ESX Server

    ""10.10.150.89"", // VEAM Proxy

    ""10.10.150.99"", // Trend

    ""10.10.150.10"", // Trend

    ""10.10.200.50"", // Franking Machine

    ""10.10.200.51"", // Franking Machine

    ""10.10.150.60"", // SCCM Servers

    ""10.10.150.5"", // DCC

    ""10.10.150.4"", // DCC 2k19

    ""10.10.150.11"", // File Server 02

    ""192.168.40.*"",

    ""192.168.9.*"", // NTP Subnet

    ""192.168.7.*"", // NTP Subnet

    ""10.10.190.*"", // VXRail

    ""255.255.255.255"")

    NOT All_Traffic.dvc IN (""10.60.10.252"". ""10.60.10.253"", ""10.60.73.252"" , ""10.60.73.253"", 
""172.18.248.123"", ""172.18.248.125"" ) 

    NOT All_Traffic.Action IN (""Detect"", ""Prevent"", ""Drop"" )

    BY 

    All_Traffic.src_ip, All_Traffic.dest_port, All_Traffic.direction, All_Traffic.dest_ip, 
All_Traffic.action, All_Traffic.dest_translated_ip

| rename All_Traffic.* AS * 

| sort - count

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location 

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location

| lookup C3Subnets subnet as dest_translated_ip OUTPUT location as final_location

| rename src_ip AS ""Source IP"", dest_ip AS ""Destination IP"", dest_port AS Port, direction AS ""FW 
Determined Direction""

| fields ""Source IP"", src_location, ""Destination IP"", dest_location, Port, dest_translated_ip, 
final_location, Action, count"
C3_TH-10 Search for malicious 'logon with explicit credentials' events:,,always,24h,"(index=prod_windows OR index=prod_windows_ad OR index=prod_aws) EventCode=4648 src_user!=SYSTEM 
src_user!=""*$*""

| where src_user!=Account_Name

| convert ctime(_time) as Time timeformat=""%d/%m/%y %H:%M:%S""

| stats values(Time) values(src_user) values(EventCode) values(action) values(user) 
values(Process_Name)  values(Additional_Information) values(Account_Name) values(Security_ID) by 
ComputerName"
C3_TH-10 Search for net use 'logon with explicit credentials' events:,,always,24h,"(index=prod_windows OR index=prod_windows_ad OR index=prod_aws) EventCode=4648 Process_ID=0x4 
src_user!=SYSTEM

| where src_user!=Account_Name

| convert ctime(_time) as Time timeformat=""%d/%m/%y %H:%M:%S""

| stats values(Time) values(src_user) values(EventCode) values(action) values(user) 
values(Process_Name)  values(Additional_Information) values(Account_Name) values(Security_ID) by 
ComputerName"
C3_TH-10 Search for remote service Interaction (utilising 'sc.exe' with explicit credentials):,,always,24h,"(index=prod_windows OR index=prod_windows_ad OR index=prod_aws) EventCode=4648 
Process_Name=""*sc.exe""

| convert ctime(_time) as Time timeformat=""%d/%m/%y %H:%M:%S""

| stats values(Time) values(src_user) values(EventCode) values(action) values(user) 
values(Process_Name)  values(Additional_Information) values(Account_Name) values(Security_ID) by 
ComputerName"
C3_TH-11 Search to view connections to/fgrom seen IPs.,,always,24h,"index=prod_cisco_asa 150.129.8.4 OR

150.129.8.5 OR

150.129.8.6 OR

150.129.8.8 OR

150.129.8.9 OR

150.129.8.10 OR

150.129.8.11 OR

150.129.8.12 OR

150.129.8.13 OR

150.129.8.14 OR

150.129.8.15 OR

150.129.8.16 OR

150.129.8.17 OR

150.129.8.19 OR

150.129.8.23 OR

150.129.8.24 OR

150.129.8.25 OR

150.129.8.26 OR

150.129.8.27 OR

150.129.8.28 OR

150.129.8.30 OR

150.129.8.31 OR

150.129.8.32 OR

150.129.8.33 OR

150.129.8.34

| stats earliest(_time) as Earliest latest(_time) as Latest values(dvc) as Device values(src_port) 
as Src_port values(dest_port) as Dest_port values(transport) as Transport values(description) as 
Description values(bytes) as Bytes values(Cisco_ASA_action) as Action values(severity_level) as 
Severity by src dest

| convert ctime(Earliest) ctime(Latest)"
C3_TH-11 Search to view hashe,,always,24h,"index=* abfa2a78b07ab43f637f2f6fd35e2e40983bb1033ba2beac9602745d5a54d257 OR

5924160dbc013d83a07ef1a9df8503de9bc1e577 OR

156685d32876f14d8e52bc6070004100 OR

8dbef5f7ffa96759bd395938ed385c8cfe991f96402f900f0a571c844c7fb78d OR

f9914b360284b987ab21f56aea9f6153fac23b84 OR

25a50b573de8f82bf8d5b29386fb94d7 OR

ac41e98905b8d5ca7ab3a06b3aa32fdabcbd31344f8b846d5062d3c3f9cf2942 OR

f43349174986cc31754b6c48627dd67af05352ab OR

5b8f8c6d171cb1b2e10d4264f5c3d9e6 OR

9b7ce9e9799f2c0c6357179d6ebd8c70380b783daf120302c3c21b41a9a6d5c5 OR

f07ddc53210435ca7fc1ef77577b058addcd63ce OR

131ab3e4ec47ff73ad99d9b3ab9bc00b OR

7190e8b5494bdbded7b48026eb7a0a51e103f7ef937f98c9cf91c344579e95f9 OR

57e9c9f4b40ccd0a26dba3cdea0dd91f118fc1c9 OR

7d758edc08b4fa1fd16a1c251306187c OR

acce6fbf738203f7a7a33b2ffb0d1fc48f718792d783dac0aec2112ab0f1a13e OR

0acbf782d01cf6ab3a797fd929e60da4b34e6876 OR

4ca19cafb8b2f762637ffd255070b84e"
C3_TH-11 Search to view processes,,always,24h,"index IN (prod_servicenow

prod_windows) 999.exe OR 888.exe OR 777.exe OR netscan6405.exe"
C3_TH-12 Search for process doppelgÃ¤nging:,,always,24h,"(index=prod_windows OR index=prod_windows_ad OR index=prod_aws) EventCode=4985 Logon_ID!=0x3E7 
Process_Name NOT (c:\windows\system32\svchost.exe, c:\windows\servicing\TrustedInstaller.exe, 
c:\windows\system32\lsass.exe, c:\windows\winSxS\*\TiWorker.exe, c:\windows\system32\poqexec.exe)

| convert ctime(_time) as Time timeformat=""%d/%m/%y %H:%M:%S""

| stats values(ComputerName) values(Process_Name) values(Logon_ID) values(action) values(user) 
values(Process_ID)  values(name) values(category) values(Account_Domain) values(Security_ID) by Time"
C3_TH-13 Search for password related subject:,,always,24h,"index=prod_mimecast subject=""Your message couldn't be delivered"" 
Sender=""brett.evans@coveainsurance.co.uk"" Rcpt=""brett.evans@and.digital"" 

| stats values(Sender) values(Rcpt) count by subject Delivered"
C3_TH-13 While investigating threat hunt some further activity was identified.,,always,24h,"index=prod_mimecast subject=""Your message couldn't be delivered"" 
Sender=""brett.evans@coveainsurance.co.uk"" Rcpt=""brett.evans@and.digital"" 

| stats values(Sender) values(Rcpt) count by subject Delivered"
C3_TH-14 Search for files:,,always,24h,"index=* (""%APPDATA%\pid.txt"" OR ""%APPDATA%\pidloc.txt"" OR ""%TEMP%\holdermail.txt"" OR 
""%TEMP%\holderwb.txt"" OR ""\Sys.exe"" OR ""\autorun.inf"" OR ""E:\autorun.inf"" OR ""%TEMP%\SysInfo.txt"" OR 
""%APPDATA%\Windows Update.exe"" OR ""E:\Sys.exe"" OR ""%TEMP%\subfolder"" OR 
""%TEMP%\subfolder\filename.exe"" OR ""%TEMP%\subfolder\filename.vbs"" OR 
""%LOCALAPPDATA%\Microsoft\Windows\WebCache\WebCacheV01.tmp"" OR ""%APPDATA%\WindowsUpdate.exe"")"
C3_TH-14 Search for hashes:,,always,24h,"index=* (0d4e850f6a4dfa6dc74f8770d6293c37a2a1df3bcf8bbac8ed5eebd7041cdf2e OR 
4496ce4c4eb7baa7ba7cac5a30d632db25143d89462ee4a885fbaf3752caec8d OR 
5983ce394d98d07d267d563496f4d444eaeb17e5fd9d2dd517b92145598d27ec OR 
5c2d0070ab7f93ddee20bbb6f38e60d994bcc3e256658c31a6ce8a033767a81e OR 
7d8dafc1e315b3adf788763ad0792e1c6e3cc0925f80b5bde41509858470b432 OR 
88f75d07e5f0b4f18651380e891d02b4980de66351c97a7bd766a9e6065452d8 OR 
93b1a9aa9be7e72eaed6ba8de581f9e73020fe70f021912e2e3ec956bd5171d9 OR 
94a3fbed738a7683435d72e0082c6c56a8472fb289ecda7e93055d69fb7f0117 OR 
dcab4d6f0691ce5b507470e879ffb9abfbe4039a52ebe0f4d5293e901c53e458 OR 
f264c1d4f641bb0063a6760ac36dcf6df08f01398bdf013e70ce14bfeea0322e)"
C3_TH-15 Search to identify web shell URIs through uncommon HTTP referrers:,,always,24h,"(index=prod_windows OR index=prod_windows_ad OR index=prod_aws)

| fillnull value=- `comment(""Fill all empty fields with - (needed to make blank referer fields 
searchable)"")`

| search status>=""200"" status<""300"" 'comment(""Only successful codes 200-299"")'

| stats dc(uri) as dc_URIs values(uri) as All_URIs count by referer 'comment(""Counts number of times 
each URI request is associated with a unique referer"")'

| table referer, All_URIs, dc_URIs

| sort + dc_URIs 'comment(""Sort count in ascending order"")'

| head 10 `comment(""Limit results to top 10. This can be changed to add more or fewer results"")`"
C3_TH-15 Search to identify web shell URIs through uncommon user agents:,,always,24h,"index=* | fillnull value=- 'comment(""Fill all empty fields with -"")'

| search status>=""200"" status <""300"" `comment(""Only looking for successful status codes 200-299"")` 

| stats count by useragent `comment(""Group User Agent strings to determine frequency"")`

| sort + count `comment(""Sort count in ascending order"")`

| head 10 `comment(""Limit results to top 10. This can be changed to add more or fewer results"")`"
C3_TH-15 Search to identify web shell URIs via anomalous IP address access:,,always,24h,"index=* | fillnull value=- 'comment(""Fill all empty fields with -"")'

| search status>=""200"" status<=""300"" uri!=- clientip!=- 'comment(""Only successful codes 200-299, 
eliminate blank URIs and client IPs"")'

| stats dc(useragent) as dc_user_agent values(useragent) as values_user_agent dc(clientip) as dc_src 
values(clientip) as values_src count by uri 'comment(""Find first and last time the grouping was 
found, number of distinct user agent strings and IP addresses used to access that URI"")'

| search dc_src<=5 OR dc_user_agent<=5 'comment(""Only URIs with <=5 unique user agents or IP 
addresses"")'

| table uri dc_user_agent values_user_agent dc_src values_src"
C3_TH-16 Search to Identify Domains/Hostnames/URLs (30 days):,,always,24h,"index=* (80674fb8973e2a7ee31596d9105d1d897a92f7bbcbf6f07b3bf7a9444f71ca9c OR 
93374f99070affdf3c298c152fc33694 OR 0793ce8600d84be1e9330ce243da55756a6e24e5 OR 
bf8d0fc2065cdf22ebaba1265ecbe4c4b44c0108)"
C3_TH-16 Search to identify Hashes (30 days):,,always,24h,"index=* (80674fb8973e2a7ee31596d9105d1d897a92f7bbcbf6f07b3bf7a9444f71ca9c OR 
93374f99070affdf3c298c152fc33694 OR 0793ce8600d84be1e9330ce243da55756a6e24e5 OR 
bf8d0fc2065cdf22ebaba1265ecbe4c4b44c0108)"
C3_TH-16 Search to Identify IPs (30 days):,,always,24h,"| tstats summariesonly=t count min(_time) as firstTime max(_time) as lastTime from 
datamodel=Network_Traffic where (All_Traffic.dest_ip IN (

5.196.108.185

200.116.145.225

96.126.101.6

)) by All_Traffic.src_ip All_Traffic.dest_ip"
C3_TH-17 Search to identify any file hash hits (30 days):,,always,24h,"index=* 

(207793677b889bf22c8f28120df0ab1cca69e23eb5213bfda5b474a0472f3fff OR

2263c1eb4d302492f261a35f02ac9257baaa1a1d8f0c0025459aef18dfde14e9 OR

34d6f25484edc517676af1b474d0dcc9fdf8277585206f3dfe1b9dc41a8e1d30 OR

52818de60a1238d208ec65ca00ae14d152ce2707104b02b9bb662533c33f9b80 OR

5d7810ab55189a068ae5ceef92f5d95ea105716f7abb7fdaa8db368bcc997c04 OR

8f5c02d7501229d5a06f864a936a76552fa03688860533ac46de9b1a881599db OR

9fdd46b8fac611813d0610ddc9a74be2534552f84037a021f2111f8cfcd02669 OR

c702947e68cebfde3eafa8b78711ba0c536e44912d7b4984a9055aa22d7ccedf OR

ca72d0ae5eb6e9e50fad7cea56c5048dc738024ed13750da83040fe0a5984101 OR

cb01f4749caef72ea8aaf8c166aa5b572f8bd5295779500cb0e5e8f1a2c38dc9 OR

cd669d8bc591e23169c703f49a20d7446a8a6db51c959334e9a5a6650882703e OR

d8b62bc60696d110df3d97c4ebcb5d2bd0a0c0445ce4a86a5a86c7e494f4c8d0 OR

e0d5bc01f2e3465b7dce3eb791b7e455a7bbd2c109a604312384d99e93f9b6b4 OR

ef804ddc84810a362e4c70f3bc1eb1650254acaabe33ffe9e1ed65a6ddd82067 OR

f023618b0b87c2b9c5115bfd3342c694564219757c1b5125c042f5a0f17ae682 OR

f8c1f6de0ec2d17ad26aae9fa2c5a33a9105cda60251cc388bd4c2c624d738e4)"
C3_TH-17 Search to Identify IP traffic (30 days):,,always,24h,"(index=prod_cisco_asa OR index=prod_checkpoint) 

(209.68.32.176 OR

114.140.13.110 OR

64.184.203.87 OR 

66.74.65.21 OR

75.69.92.137 OR

173.161.53.61 OR

67.82.249.90 OR

71.87.111.92 OR

75.64.22.81 OR

181.47.5.125 OR

95.111.225.124 OR

181.165.92.121 OR

118.168.183.114 OR

125.58.66.125 OR

61.227.47.110 OR

24.166.59.97 OR

71.97.99.170 OR

1.160.225.1 OR

68.230.236.85 OR

97.104.42.173 OR

111.248.215.43 OR

178.158.65.14 OR

114.162.146.65 OR

190.181.207.76 OR

24.181.13.254)"
C3_TH-18 Search for connections to associated URLs with the campaign:,,always,24h,"| tstats min(_time) as Time values(Web.user) AS user, values(Web.dest) AS dest, 
values(Web.http_method) AS method, values(Web.url) AS url, values(Web.http_referrer) AS referrer, 
values(Web.http_user_agent) AS userAgent, values(Web.category) AS category, values(Web.action) AS 
action FROM datamodel=Web WHERE Web.dest IN (*) Web.url IN 
(""*mhdosoksaccf9sni9icp.appsync-api.eu-west-1.avsvmcloud.com*""

""*k5kcubuassl3alrf7gm3.appsync-api.eu-west-1.avsvmcloud.com*""

""*ihvpgv9psvq02ffo77et.appsync-api.us-east-2.avsvmcloud.com*""

""*gq1h856599gqh538acqn.appsync-api.us-west-2.avsvmcloud.com*""

""*7sbvaemscs0mc925tb99.appsync-api.us-west-2.avsvmcloud.com*""

""*6a57jk2ba1d9keg15cbg.appsync-api.eu-west-1.avsvmcloud.com*""

""*appsync-api.us-west-2.avsvmcloud.com*""

""*appsync-api.us-east-2.avsvmcloud.com*""

""*appsync-api.us-east-1.avsvmcloud.com*""

""*appsync-api.eu-west-1.avsvmcloud.com*""

""*5qbtj04rcbp3tiq8bo6t.appsync-api.us-east-1.avsvmcloud.com*""

""*5qbtj04rcbp3tiq8bo6t.appsync-api.us-east-1.avsvmcloud.com*""

""*6a57jk2ba1d9keg15cbg.appsync-api.eu-west-1.avsvmcloud.com*""

""*7sbvaemscs0mc925tb99.appsync-api.us-west-2.avsvmcloud.com*""

""*gq1h856599gqh538acqn.appsync-api.us-west-2.avsvmcloud.com*""

""*ihvpgv9psvq02ffo77et.appsync-api.us-east-2.avsvmcloud.com*"" 

""*k5kcubuassl3alrf7gm3.appsync-api.eu-west-1.avsvmcloud.com*"" 

""*mhdosoksaccf9sni9icp.appsync-api.eu-west-1.avsvmcloud.com*"" 

""*deftsecurity.com*"" 

""*freescanonline.com*"" 

""*thedoccloud.com*"" 

""*websitetheme.com*"" 

""*highdatabase.com*"" 

""*incomeupdate.com*""

""*databasegalore.com*""

""*panhardware.com*""

""*zupertech.com*""

""*websitetheme.com*""

""*thedoccloud.com*""

""*highdatabase.com*""

""*freescanonline.com*""

""*digitalcollege.org*"" 

""*avsvmcloud.com*""

""*owa.organization.here*""

""*webcodez.com*"" 

""*virtualwebdata.com*"" 

""*solartrackingsystem.net*"" 

""*seobundlekit.com*"" 

""*lcomputers.com*"" 

""*kubecloud.com*"" 

""*globalnetworkissues.com*"" 

""*freescanonline.com*"" 

""*avsvmcloud.com*"" 

""*zupertech.com*""

""*digitalcollege.org*""

""*freescanonline.com*""

""*deftsecurity.com*""

""*thedoccloud.com*""

""*websitetheme.com*""

""*highdatabase.com*""

""*incomeupdate.com*""

""*databasegalore.com*""

""*panhardware.com*""

""*zupertech.com*""

""*seobundlekit.com*""

""*lcomputers.com*""

""*virtualdataserver.com*""

""*webcodez.com*""

""*infinitysoftwares.com*""

""*ervsystem.com*"") Web.http_referrer IN (*) BY Web.url

| fields Time, user, dest, url, method, referrer, userAgent, category, action

| convert ctime(Time)"
C3_TH-18 Search for inbound traffic from malicious IPs:,,always,24h,"| tstats values(All_Traffic.user) AS user, values(All_Traffic.src_ip) AS sourceIP, 
values(All_Traffic.src_port) AS sourcePort, values(All_Traffic.dest_ip) AS destinationIP, 
values(All_Traffic.dest_port) AS destinationPort, values(All_Traffic.direction) AS direction, 
values(All_Traffic.action) AS action FROM datamodel=Network_Traffic WHERE All_Traffic.src_ip IN (*) 
All_Traffic.dest_ip IN (51.89.125.18

5.252.177.25

5.252.177.21

204.188.205.176

139.99.115.204

167.114.213.199

13.59.205.66 

54.193.127.66 

54.215.192.52 

34.203.203.23 

139.99.115.204 

8.18.145.0

196.203.11.89 

20.141.48.154 

51.89.125.18 

8.18.145.131 

8.18.145.21 

8.18.145.3 

8.18.145.33 

18.217.225.111 

184.72.145.34 

184.72.209.33 

184.72.21.54 

184.72.1.3 

184.72.101.22 

184.72.113.55 

184.72.212.52 

184.72.224.3 

184.72.240.3 

184.72.229.1 

184.72.245.1 

184.72.48.22 

3.16.81.254 

3.87.182.149 

34.219.234.134 

8.18.145.134 

8.18.144.9

8.18.145.139 

8.18.145.150 

8.18.145.157 

8.18.145.36 ) All_Traffic.dest_port IN (*) BY All_Traffic.dest_ip, All_Traffic.action

| fields user, sourceIP, sourcePort, destinationIP, destinationPort, direction, action"
C3_TH-18 Search for outbound traffic to malicious IPs:,,always,24h,"| tstats values(All_Traffic.user) AS user, values(All_Traffic.src_ip) AS sourceIP, 
values(All_Traffic.src_port) AS sourcePort, values(All_Traffic.dest_ip) AS destinationIP, 
values(All_Traffic.dest_port) AS destinationPort, values(All_Traffic.direction) AS direction, 
values(All_Traffic.action) AS action FROM datamodel=Network_Traffic WHERE All_Traffic.src_ip IN (*) 
All_Traffic.dest_ip IN (51.89.125.18

5.252.177.25

5.252.177.21

204.188.205.176

139.99.115.204

167.114.213.199

13.59.205.66 

54.193.127.66 

54.215.192.52 

34.203.203.23 

139.99.115.204 

8.18.145.0

196.203.11.89 

20.141.48.154 

51.89.125.18 

8.18.145.131 

8.18.145.21 

8.18.145.3 

8.18.145.33 

18.217.225.111 

184.72.145.34 

184.72.209.33 

184.72.21.54 

184.72.1.3 

184.72.101.22 

184.72.113.55 

184.72.212.52 

184.72.224.3 

184.72.240.3 

184.72.229.1 

184.72.245.1 

184.72.48.22 

3.16.81.254 

3.87.182.149 

34.219.234.134 

8.18.145.134 

8.18.144.9

8.18.145.139 

8.18.145.150 

8.18.145.157 

8.18.145.36 ) All_Traffic.dest_port IN (*) BY All_Traffic.dest_ip, All_Traffic.action

| fields user, sourceIP, sourcePort, destinationIP, destinationPort, direction, action"
C3_TH-19 Search to Identify Domains/Hostnames/URLs:,,always,24h,"| tstats summariesonly=t count min(_time) as firstTime max(_time) as lastTime from datamodel=Web 
where (Web.url IN (""*13hjkz7513v64541852v65431b5411dxv24.su*""

""*13uhbt1z3tz78a56sdvghf1563451.ru*"" 

""*1376bad654134c667213.online*"" 

""*1378137613gbadz13567ds13.su*"" 

""*137zt67g1635r5bd671563gbzasduzh512.online*""

""*713zgjj2iigbh1766av441bsd67613.ru*"" 

""*7163zbh16356ztug13765gv541.su*"" 

""*asdjihnu1z763hubad6tn13.su*"" 

""*hjadzgt613bhu8967rv61563fv.su*"" 

""*ngnanoservebkup.duckdns.org*"" 

""*yandex.ru*"" 

""*hdfc.pp.ru*"" 

""*www5.tamareirashotelmg.com.br*"" 

""*www5.cdljussarago.com.br*""

""*guardiasolutionsnet*"" 

""*specializedhelp.com*"" 

""*dolamosssepo.com*"" 

""*dolamosssepo.xyz*"" 

""*rossmailers.club*"" 

""*rossmailers.com*"" 

""*rossmailers.me*"" 

""*rossmailers.net*"" 

""*rossmailers.org*"" 

""*rossmailers.pw*"" 

""*rossmailers.space*"")) by Web.src Web.url"
C3_TH-19 Search to identify hashes across all indexes:,,always,24h,"index IN (prod_windows prod_sophos_onprem ) sourcetype=WinEventLog

(""0c451e42735fa72cb36d1cc6911cd78ff5a6605bbf104c5f43b90342b1cc38db""

""11959868974ed014b69f572db4c68a1e7547121a759241e32856f208b64c88a8""

""1498e1536f2beb0d4e2ff9e1ace10e5c37fde536b3ed8d3ac2f6614ef37c9216""

""18712de3ff1e2af3255f76ccb40bf79e6f58599e15b7c148c87e8720438f56b6""

""1dc196190e82a017a81937d0b42f96ecd86673b7cc4d4a5fcebe0b4c63495879""

""1df87baeeac67f7eadf3875c0a12a610ec21b285e6b6be97bc0c6969b33277e7""

""1e7e024929426dc634eb67cdf25e1ea621bcaa437707f1956a96c62d66307c30""

""1ebcb62975ca935c0c538d1a421fe94c35c42ca42ebae3fdddce3b23240899b0""

""2047537c162e02f2135b3386f5cfec72c94a7dbe030c7ec12083a93e0a308d3b""

""4d11b045a577258f2ed62c1a56584c6ad8b0128398d19e2ad114c53dc091a734""

""62438d9ec56061fb81f514d6c8eff718f765d3101c16f70051c605deb3e4d788""

""74e23bf9c148dda32dd64e972a6eca790fef3e53008b80242b0732eefb283d51""

""78568ae742d82478786a06e8639fac6a2da6fa032a576ba89bc85261771abb18""

""7f6ebd301c47243a0c909c8f59f1600eacfe56dba2ccfb2639b24d9b16c9ec92""

""8176f5b87011d4d4db43e23663350820ef7a8f31ab452cf5ceae53b49d51b41e""

""823d10a3218a7fb185e70351870c21dcdbd175755a6da60c2cf5a5126904765d""

""83f1e0aceccf0ee054b7f0a933f3ccea3b2306d5b3bea741ea9206c08428a58f""

""91b5b42102b2a55ccf2cf8644e6c310c85b4061ec9ecdc228929769d51cf9ee3""

""a8546a9766dec41398b77083033656665b0b2b456bafeef6787284e224edde7d""

""a94f325d59619e015c362c480b953dedee41f90d10643c6ecc2b7405ce4d4d61""

""aec1921b68b08b6524304f0857bf328c7a404f25fdac2cd9ee88aaa822be6567""

""be801f78febf260293a7977dfd7f539f97faf3badbb8d21fe95ca894dd373e0e""

""c2bea2314e29228dc45397436380ce833cd456e95a36b04396da5bc512589a5b""

""c8d5bef4f8a9c5ca0ae5fbeed8494952a2eb2068e716b075682d056b496493c6""

""d43fc5bd5ab07811b01def3be2a57a4bf0126fd6ced7b73e55f1bf2fe80b95b1"")"
C3_TH-19 Search to identify IP addresses across all indexes:,,always,24h,"index=*

(""40.70.224.146"" OR

""91.92.109.119"" OR

""52.185.71.28"" OR

""212.7.208.130"" OR

""172.217.9.238"" OR

""40.76.4.15"" OR

""184.168.131.241"" OR

""5.255.255.80"" OR

""85.143.215.139"")"
C3_TH-2 Search to find hashes:,,always,24h,"| tstats count summariesonly=t from datamodel=Malware WHERE

[| inputlookup ViciousPandaHashes.csv

| rename Hashes as Malware_Attacks.file_hash

| fields Malware_Attacks.file_hash]

BY Malware_Attacks.src Malware_Attacks.file_hash"
C3_TH-2 Search to identify malicious domains:,,always,24h,"| tstats summariesonly=t earliest(_time) as Earliest latest(_time) as Latest values(Web.user) as 
User values(Web.dest) as Destination values(Web.site) as Site values(Web.action) as Action 
values(Web.category) as Category values(Web.url) as URL values(Web.http_content_type) as ""HTTP 
Content Type"" values(Web.http_method) as ""HTTP Method"" values(Web.http_referrer) as ""HTTP Referrer"" 
values(Web.http_user_agent) as ""User Agent"" from datamodel=Web WHERE

(Web.url=""dw.adyboh.com"" OR

Web.url=""wy.adyboh.com"" OR

Web.url=""feb.kkooppt.com"" OR

Web.url=""compdate.my03.com"" OR

Web.url=""jocoly.esvnpe.com"" OR

Web.url=""bmy.hqoohoa.com"" OR

Web.url=""bur.vueleslie.com"" OR

Web.url=""wind.windmilldrops.com"") by Web.src

| `drop_dm_object_name(Web)` 

| convert ctime(Earliest) ctime(Latest) timeformat=""%d/%m/%Y %H:%M:%S""

| sort -Earliest"
C3_TH-2 Search to identify malicious IPs:,,always,24h,"| tstats summariesonly=t earliest(_time) as Earliest latest(_time) as Latest values(Web.user) as 
User values(Web.dest) as Destination values(Web.site) as Site values(Web.action) as Action 
values(Web.category) as Category values(Web.url) as URL values(Web.http_content_type) as ""HTTP 
Content Type"" values(Web.http_method) as ""HTTP Method"" values(Web.http_referrer) as ""HTTP Referrer"" 
values(Web.http_user_agent) as ""User Agent"" from datamodel=Web WHERE

(Web.dest=""95.179.242.6"" OR

Web.dest=""95.179.242.27"" OR

Web.dest=""199.247.25.102"" OR

Web.dest=""95.179.210.61"" OR

Web.dest=""95.179.156.97"") by Web.src

| `drop_dm_object_name(Web)` 

| convert ctime(Earliest) ctime(Latest) timeformat=""%d/%m/%Y %H:%M:%S""

| sort -Earliest"
C3_TH-20 Search for suspicious Domains (30 Days):,,always,24h,"| tstats min(_time) as Time values(Web.user) AS user, values(Web.dest) AS dest, 
values(Web.http_method) AS method, values(Web.url) AS url, values(Web.http_referrer) AS referrer, 
values(Web.http_user_agent) AS userAgent, values(Web.category) AS category, values(Web.action) AS 
action FROM datamodel=Web WHERE Web.dest IN (*) Web.url IN (""*sctask.smartconnexxionz.com*""

""*medicalconsultants.ie*""

""*mmogollon.com.mx*""

""*laboratoriostabbler.com*""

""*urban-mosaic.com*""

""*kezto.co.uk*""

""*atwebpages.com*""

""*maapaaevents.com*""

""*truxiellogroup.com*""

""*wexfashion.com*""

""*caledoniehousesitting.com*""

""*tcet-talk.info*""

""*opinionglobal.com.do*""

""*payments.amadike.com*""

""*nec-i.com*""

""*du-wizards.com*""

""*ppdb-legacy.man1lamongan.com*""

""*motobuin.eltipodelasfotos.cl*""

""*riveroakshyundaikia.com*""

""*crudtest.srintegrated.com*""

""*busandvanrentalmalaysia.com*""

""*allstagingwork.com*""

""*tootaldeals.com*""

""*indabol.com.bo*""

""*olebaby.in*""

""*tootaldeals.com*""

""*binhanbal.com*""

""*bookallon.com*""

""*artismc.in*""

""*t-o-u-c-h-s-m-a-r-t.com*""

""*osmosisecuador.com*""

""*bulksms.interweblimited.com*""

""*sistacweb.com*"") Web.http_referrer IN (*) BY Web.url

| fields Time, user, dest, url, method, referrer, userAgent, category, action

| convert ctime(Time)"
C3_TH-20 Search for suspicious Files (30 Days):,,always,24h,"index IN (prod_checkpoint prod_cisco* prod_o365 prod_windows prod_sophos*) 
(""INV0737559499-20210111480893.xlsm"" OR ""INV1906204175-20210111877440.xlsm"" OR 
""INV1998174535-20210111804169.xlsm"" OR ""INV4808261243-20210111191030.xlsm"" OR 
""INV8164713354-20210111643874.xlsm"" OR ""INV9617285161-20210111842813.xlsm"" OR 
""INV1788514716-20210111553807.xlsm"")"
C3_TH-20 Search for suspicious Hashes (30 Days):,,always,24h,"index IN (prod_checkpoint prod_cisco* prod_o365 prod_windows prod_sophos*) 
(""fa5350d4304c4c2ceafa435244b5a5fc"" OR ""9b7c2b0abf5478ef9a23d9a9e87c7835"")"
C3_TH-21 Search for IPs:,,always,24h,"index IN (prod_checkpoint prod_cisco_asa prod_censornet) (""*184.105.192.2*"" OR ""*40.70.224.146*"" OR 
""*204.79.197.200*"")

| table category sourcetype index url user cs_host c_ip time date action dest dvc site"
C3_TH-21 Search for URLs:,,always,24h,"index IN (prod_checkpoint prod_cisco_asa prod_censornet) (""*bighecks.net*"" OR ""*imageshells.com*"" OR 
""*sonic4us.ru*"" OR ""*www.yahgodz.com*"" OR ""*www.update.microsoft.com.nsatc.net*"")"
C3_TH-22 Finding Malicious Tools (90d):,,always,24h,"EventCode=4663 (ObjectName=""C:\\ProgramData\\*.rar"" OR ObjectName=""C:\\ProgramData\\*.zip"" OR 
ObjectName=""C:\\ProgramData\\*.7z"")"
C3_TH-22 Search for Nishang PowerShell Framework (90d):,,always,24h,"index IN (prod_windows, prod_windows_ad, test_windows_iis) sourcetype=""WinEventLog"" EventCode=4104 
""*Invoke-PowerShellTCP*"""
C3_TH-22 Search to Detect Authentication Bypass (90d):,,always,24h,"index=test_windows_iis sourcetype=""ms:iis:auto"" http_method=POST 
uri_path=""/owa/auth/Current/themes/resources/*""

| stats count by src_ip, http_user_agent, uri_path, http_method, uri_query"
C3_TH-22 Search to detect Exchange Unified Messaging Service Creating Child Process (90d):,,always,24h,"index IN (prod_windows, prod_windows_ad, test_windows_iis) 
(ParentProcessName=""*umworkerprocess.exe*"" OR ParentProcessName=""*UMService.exe*"") NOT 
NewProcessName=""*UMWorkerProcess.exe*"""
C3_TH-22 Search to Detect Powercat (90d):,,always,24h,"index IN (prod_windows, prod_windows_ad, test_windows_iis) sourcetype=""WinEventLog"" EventCode=4104 
""*powercat*"""
C3_TH-22 Search to Detect WebShells (90d):,,always,24h,"index=test_windows_iis sourcetype=""ms:iis:auto"" http_method=POST status<=403 uri_query=*.php OR 
uri_query=*.jsp OR uri_query=*.cfm OR uri_query=*.asp OR uri_query=*.aspx

| stats count by src_ip, http_user_agent, uri_path, http_method, uri_query"
C3_TH-22 Search to identify Exchange Unified Messaging Service Creating Executable Content (90d):,,always,24h,"index IN (prod_windows, prod_windows_ad, test_windows_iis) sourcetype=""WinEventLog"" EventCode=4663 
ObjectType=""File"" (ObjectName=""*.php"" OR ObjectName=""*.jsp"" OR ObjectName=""*.js"" OR 
ObjectName=""*.aspx"" OR ObjectName=""*.asmx"" OR ObjectName=""*.cfm"" OR ObjectName=""*.shtml"") 
(ProcessName=""*umworkerprocess.exe*"" OR ProcessName=""*UMService.exe*"")"
C3_TH-22 Search to Identify Execution of 7z (90d):,,always,24h,"index IN (prod_windows, prod_windows_ad, test_windows_iis) sourcetype=""WinEventLog"" EventCode=4688 
process=""C:\\ProgramData\\7z*"""
C3_TH-22 Search to Identify Nishang Framework Utilising EventCode 4688 (90d):,,always,24h,"index IN (prod_windows, prod_windows_ad, test_windows_iis) sourcetype=""WinEventLog"" EventCode=4104 
""*powercat*"""
C3_TH-23 Checking for connections to the flagged domains over the last 30 days:,,always,24h,"| tstats min(_time) as Time values(Web.user) AS user, values(Web.dest) AS dest, 
values(Web.http_method) AS method, values(Web.url) AS url, values(Web.http_referrer) AS referrer, 
values(Web.http_user_agent) AS userAgent, values(Web.category) AS category, values(Web.action) AS 
action FROM datamodel=Web WHERE Web.dest IN (*) Web.url IN (""*burkecctv.swanndvr.net*""

""*sl-nbuapp02.coveinsurance.co.uk*""

""*wifi.vivo.com.cn.a.bdydns.com*""

""*opencdn.jomodns.com*""

""*opencdnvivodtml.jomodns.com*""

""*weu1-urlp.cloudapp.net*""

""*weu-azsc-urlp.cloudapp.net*""

""*urlp-asm-skype.trafficmanager.net*""

""*weu-azsc-urlp.cloudapp.net*""

""*apps.bdimg.jomodns.com*""

""*statres.quickapp.cn.a.bdydns.com*""

""*opencdnssl.jomodns.com*""

""*statres.quickapp.cn.a.bdydns.com*""

""*matrix.cdn.bcebos.com.a.bdydns.com*""

""*opencdn.jomodns.com*""

""*opencdnssl.jomodns.com*""

""*194-218-16-66.customer.telia.com*""

""*proxy.utcluj.ro*""

""*pc19f01fd.dip0.t-ipconnect.de*""

""*baikebcs.bdimg.com.a.bdydns.com*""

""*opencdnbd.jomodns.com*""

""*statres.quickapp.cn.a.bdydns.com*""

""*matrix.cdn.bcebos.com.a.bdydns.com*""

""*yd.edajin.com.a.bdydns.com*""

""*opencdn.jomodns.com*""

""*opencdnspy.jomodns.com*""

""*opencdnssl.jomodns.com*""

""*boscdn.djduoduo.com.a.bdydns.com*""

""*m.shezhan88.com.a.bdydns.com*""

""*opencdnspy.jomodns.com*""

""*poi-pic.cdn.bcebos.com.a.bdydns.com*""

""*opencdnv6test.jomodns.com*""

""*wifi.vivo.com.cn.a.bdydns.com*""

""*poi-pic.cdn.bcebos.com.a.bdydns.com*""

""*opencdn.jomodns.com*""

""*opencdnv6test.jomodns.com*""

""*opencdnvivodtml.jomodns.com*""

""*poi-pic.cdn.bcebos.com.a.bdydns.com*""

""*talos-bundle.cdn.bcebos.com.a.bdydns.com*""

""*opencdn.jomodns.com*""

""*opencdnv6test.jomodns.com*""

""*v5-cdn.1sapp.com*""

""*poi-pic.cdn.bcebos.com.a.bdydns.com*""

""*v5.qutoutiao.net.a.bdydns.com*""

""*opencdnspyv6.jomodns.com*""

""*opencdnssl.jomodns.com*""

""*opencdnv6test.jomodns.com*""

""*v5.qutoutiao.net.vdncache.com*""

""*opencdnzhihustatic.jomodns.com*""

""*node-kcx.pool-1-4.dynamic.totinternet.net"") Web.http_referrer IN (*) BY Web.url

| fields Time, user, dest, url, method, referrer, userAgent, category, action

| convert ctime(Time)"
C3_TH-23 Checking for connections to/from the flagged IP's over the last 30 days:,,always,24h,"| tstats earliest(_time) as ""Earliest"" latest(_time) as ""Latest"" values(All_Traffic.user) AS user, 
values(All_Traffic.src_ip) AS sourceIP, values(All_Traffic.src_port) AS sourcePort, 
values(All_Traffic.dest_ip) AS destinationIP, values(All_Traffic.dest_port) AS destinationPort, 
values(All_Traffic.direction) AS direction, values(All_Traffic.action) AS action FROM 
datamodel=Network_Traffic WHERE All_Traffic.src_ip IN 

(77.75.244.131

70.32.1.32

58.217.200.35

52.114.75.71

52.114.75.216

42.101.56.49

220.169.152.35

219.153.113.35

194.218.16.66

193.226.5.155

193.226.5.148

193.159.1.253

180.101.38.35

171.107.86.38

171.107.86.35

124.236.41.35

124.236.104.35

124.225.184.35

123.52.189.35

121.227.7.35

120.71.177.35

118.180.30.35

117.91.181.35

113.96.178.41

110.80.30.35

106.225.194.49

106.225.194.35

1.4.231.17) All_Traffic.dest_ip IN (*) All_Traffic.dest_port IN (*) BY All_Traffic.dest_ip, 
All_Traffic.action

| fields Earliest, Latest, user, sourceIP, sourcePort, destinationIP, destinationPort, direction, 
action

| convert ctime(""Earliest"") ctime(""Latest"") timeformat=""%d/%m/%y %H:%M:%S"""
C3_TH-23 Checking for malware events using flagged domains over the last 30 days:,,always,24h,"| tstats count summariesonly=t from datamodel=Malware WHERE Malware_Attacks.* IN 

(""*burkecctv.swanndvr.net*""

""*sl-nbuapp02.coveinsurance.co.uk*""

""*wifi.vivo.com.cn.a.bdydns.com*""

""*opencdn.jomodns.com*""

""*opencdnvivodtml.jomodns.com*""

""*weu1-urlp.cloudapp.net*""

""*weu-azsc-urlp.cloudapp.net*""

""*urlp-asm-skype.trafficmanager.net*""

""*weu-azsc-urlp.cloudapp.net*""

""*apps.bdimg.jomodns.com*""

""*statres.quickapp.cn.a.bdydns.com*""

""*opencdnssl.jomodns.com*""

""*statres.quickapp.cn.a.bdydns.com*""

""*matrix.cdn.bcebos.com.a.bdydns.com*""

""*opencdn.jomodns.com*""

""*opencdnssl.jomodns.com*""

""*194-218-16-66.customer.telia.com*""

""*proxy.utcluj.ro*""

""*pc19f01fd.dip0.t-ipconnect.de*""

""*baikebcs.bdimg.com.a.bdydns.com*""

""*opencdnbd.jomodns.com*""

""*statres.quickapp.cn.a.bdydns.com*""

""*matrix.cdn.bcebos.com.a.bdydns.com*""

""*yd.edajin.com.a.bdydns.com*""

""*opencdn.jomodns.com*""

""*opencdnspy.jomodns.com*""

""*opencdnssl.jomodns.com*""

""*boscdn.djduoduo.com.a.bdydns.com*""

""*m.shezhan88.com.a.bdydns.com*""

""*opencdnspy.jomodns.com*""

""*poi-pic.cdn.bcebos.com.a.bdydns.com*""

""*opencdnv6test.jomodns.com*""

""*wifi.vivo.com.cn.a.bdydns.com*""

""*poi-pic.cdn.bcebos.com.a.bdydns.com*""

""*opencdn.jomodns.com*""

""*opencdnv6test.jomodns.com*""

""*opencdnvivodtml.jomodns.com*""

""*poi-pic.cdn.bcebos.com.a.bdydns.com*""

""*talos-bundle.cdn.bcebos.com.a.bdydns.com*""

""*opencdn.jomodns.com*""

""*opencdnv6test.jomodns.com*""

""*v5-cdn.1sapp.com*""

""*poi-pic.cdn.bcebos.com.a.bdydns.com*""

""*v5.qutoutiao.net.a.bdydns.com*""

""*opencdnspyv6.jomodns.com*""

""*opencdnssl.jomodns.com*""

""*opencdnv6test.jomodns.com*""

""*v5.qutoutiao.net.vdncache.com*""

""*opencdnzhihustatic.jomodns.com*""

""*node-kcx.pool-1-4.dynamic.totinternet.net"")"
C3_TH-23 Checking for malware events using flagged IPs over the last 30 days:,,always,24h,"| tstats count summariesonly=t from datamodel=Malware WHERE Malware_Attacks.* IN 

(77.75.244.131

70.32.1.32

58.217.200.35

52.114.75.71

52.114.75.216

42.101.56.49

220.169.152.35

219.153.113.35

194.218.16.66

193.226.5.155

193.226.5.148

193.159.1.253

180.101.38.35

171.107.86.38

171.107.86.35

124.236.41.35

124.236.104.35

124.225.184.35

123.52.189.35

121.227.7.35

120.71.177.35

118.180.30.35

117.91.181.35

113.96.178.41

110.80.30.35

106.225.194.49

106.225.194.35

1.4.231.17)"
C3_TH-24 Search for malicious domain ( 7 days):,,always,24h,"index=prod_workday_live url IN(

""*albanallahacrab.club*""

""*dclogictrust.com *""

""*masskwearing.cyou*""

""*padishahmurrka.best*""

""*uragusexgre.club*""

)

| table category sourcetype index url user cs_host c_ip time date action"
C3_TH-24 Search for malicious files 7 days:,,always,24h,"index IN (prod_windows prod_sophos_onprem ) (

""*locker_64.dll*"" OR 

""*RecoveryManual.html*"" OR 

""*wininit64.dll*""

)

| table category sourcetype index url user cs_host c_ip time date action dest dvc site"
C3_TH-24 Search for malicious hashes (30 days):,,always,24h,"index IN (prod_windows prod_sophos_onprem ) sourcetype=WinEventLog 
(""0a671d9d7ca62274e5e210813d02d860846baf59188e2a07522cd3a1cc3f9cc0"" OR 
""2c44444d207a78da7477ae1af195d4265134e895bebb476f7b2c003f1467a033"" )"
C3_TH-25 Search to view uploads to known Paste Sites over the last 30 days:,,always,24h,"| tstats min(_time) as earliest max(_time) as latest values(Web.src) as src sum(Web.bytes) as bytes 
sum(Web.bytes_in) as bytes_in sum(Web.bytes_out) as bytes_out values(Web.http_user_agent) as 
http_user_agent values(Web.uri_path) as uri_path values(Web.url) as url values(Web.site) as dest

    FROM datamodel=Web WHERE (Web.url IN 
(""*paste.ee/r/*"",""*pastebin.com/raw/*"",""*hastebin.com/raw/*"",""*ghostbin.co/paste/*/raw/*"",""*controlc
.com*"",""*rentry.co/*"", ""*pastehouse.com*"", ""*pastebin.pl*"", ""*justpaste.it*"", ""*pastelink.net*"", 
""*anotepad.com*"", ""*pastequick.com*"", ""*penyacom.org*"", ""*pastebin.pt*"", ""*pastebin.es*"", 
""*pastebin.cz*"", ""*pastebin.in*"", ""*pastebin.ro*"", ""*pastebin.co.za*"", ""*xup.in./paste/*"", 
""*pastr.io*"", ""*0bin.net*"", ""*write.as*"", ""*privatebin.net*"", ""*ideone.com*"", ""*throwbin.io*"", 
""*anonpaste.org*"", ""*secretpm.co*"",""*tempmessage.xyc*"",""*notes.io*"",""*notexe.com*"", ""*zerobin.net*"", 
""*0bin.net*"", ""*privatebin.info*"", ""*pastefs.com*"", ""*pastie.org*"", 
""*dpaste.com*"",""*paste2.org*"",""*codepad.org*"") OR Web.uri_path IN 
(""*paste.ee/r/*"",""*pastebin.com/raw/*"",""*hastebin.com/raw/*"",""*ghostbin.co/paste/*/raw/*"",""*controlc
.com*"",""*rentry.co/*"", ""*pastehouse.com*"", ""*pastebin.pl*"", ""*justpaste.it*"", ""*pastelink.net*"", 
""*anotepad.com*"", ""*pastequick.com*"", ""*penyacom.org*"", ""*pastebin.pt*"", ""*pastebin.es*"", 
""*pastebin.cz*"", ""*pastebin.in*"", ""*pastebin.ro*"", ""*pastebin.co.za*"", ""*xup.in./paste/*"", 
""*pastr.io*"", ""*0bin.net*"", ""*write.as*"", ""*privatebin.net*"", ""*ideone.com*"", ""*throwbin.io*"", 
""*anonpaste.org*"", ""*secretpm.co*"",""*tempmessage.xyc*"",""*notes.io*"",""*notexe.com*"", ""*zerobin.net*"", 
""*0bin.net*"", ""*privatebin.info*"", ""*pastefs.com*"", ""*pastie.org*"", 
""*dpaste.com*"",""*paste2.org*"",""*codepad.org*"")) BY Web.app Web.action Web.user 

| rename Web.* as * 

| eval kbytes_out=(bytes_out/1024),kbytes_in=(bytes_in/1024),kbytes_total=(bytes/1024) 

| convert timeformat=""%d/%m/%Y %H:%M:%S"" ctime(earliest) ctime(latest)

| sort 0 - earliest 

| table earliest latest app action user src dest kbytes_total kbytes_in kbytes_out url uri_path 
http_user_agent"
C3_TH-26 File Hashes (90d):,,always,24h,"index IN (prod_windows prod_sophos_onprem ) sourcetype=WinEventLog

(""0c451e42735fa72cb36d1cc6911cd78ff5a6605bbf104c5f43b90342b1cc38db""

""11959868974ed014b69f572db4c68a1e7547121a759241e32856f208b64c88a8""

""1498e1536f2beb0d4e2ff9e1ace10e5c37fde536b3ed8d3ac2f6614ef37c9216""

""18712de3ff1e2af3255f76ccb40bf79e6f58599e15b7c148c87e8720438f56b6""

""1dc196190e82a017a81937d0b42f96ecd86673b7cc4d4a5fcebe0b4c63495879""

""1df87baeeac67f7eadf3875c0a12a610ec21b285e6b6be97bc0c6969b33277e7""

""1e7e024929426dc634eb67cdf25e1ea621bcaa437707f1956a96c62d66307c30""

""1ebcb62975ca935c0c538d1a421fe94c35c42ca42ebae3fdddce3b23240899b0""

""2047537c162e02f2135b3386f5cfec72c94a7dbe030c7ec12083a93e0a308d3b""

""4d11b045a577258f2ed62c1a56584c6ad8b0128398d19e2ad114c53dc091a734""

""62438d9ec56061fb81f514d6c8eff718f765d3101c16f70051c605deb3e4d788""

""74e23bf9c148dda32dd64e972a6eca790fef3e53008b80242b0732eefb283d51""

""78568ae742d82478786a06e8639fac6a2da6fa032a576ba89bc85261771abb18""

""7f6ebd301c47243a0c909c8f59f1600eacfe56dba2ccfb2639b24d9b16c9ec92""

""8176f5b87011d4d4db43e23663350820ef7a8f31ab452cf5ceae53b49d51b41e""

""823d10a3218a7fb185e70351870c21dcdbd175755a6da60c2cf5a5126904765d""

""83f1e0aceccf0ee054b7f0a933f3ccea3b2306d5b3bea741ea9206c08428a58f""

""91b5b42102b2a55ccf2cf8644e6c310c85b4061ec9ecdc228929769d51cf9ee3""

""a8546a9766dec41398b77083033656665b0b2b456bafeef6787284e224edde7d""

""a94f325d59619e015c362c480b953dedee41f90d10643c6ecc2b7405ce4d4d61""

""aec1921b68b08b6524304f0857bf328c7a404f25fdac2cd9ee88aaa822be6567""

""be801f78febf260293a7977dfd7f539f97faf3badbb8d21fe95ca894dd373e0e""

""c2bea2314e29228dc45397436380ce833cd456e95a36b04396da5bc512589a5b""

""c8d5bef4f8a9c5ca0ae5fbeed8494952a2eb2068e716b075682d056b496493c6""

""d43fc5bd5ab07811b01def3be2a57a4bf0126fd6ced7b73e55f1bf2fe80b95b1"")"
C3_TH-26 Malicious Domains (90d):,,always,24h,"| tstats min(_time) as Time values(Web.user) AS user, values(Web.dest) AS dest, 
values(Web.http_method) AS method, values(Web.url) AS url, values(Web.http_referrer) AS referrer, 
values(Web.http_user_agent) AS userAgent, values(Web.category) AS category, values(Web.action) AS 
action FROM datamodel=Web WHERE Web.dest IN (*) Web.url 

IN(

""*bunikabatedoba13.top*""

""*bvnotike.667.top*""

""*jokimutinke.net*""

""*opiutunuza11.net*""

""*ujnuyteeej.top*""

""*ff.dfbkmoeiruoiumoeio.pro*""

""*x.demolist.org*""

""*nerdasss33.top*""

""*fin.sleeptimellc.net*""

""*support.hebit.at*""

""*pp.ekrjhgkjjhvhkkdfgd.pro*""

""*prod-tp.sumo.mozit.cloud*""

""*makron.bit*""

""*a1815.dscr.akamai.net*""

""*filezilla-project.org*""

""*erwwbasmhtm.com*""

""*fbnurqhsbun.com*"") Web.http_referrer IN (*) BY Web.url

| fields Time, user, dest, url, method, referrer, userAgent, category, action

| convert ctime(Time)"
C3_TH-26 Malicious IP's (30d):,,always,24h,"| tstats earliest(_time) as ""Earliest"" latest(_time) as ""Latest"" values(All_Traffic.user) AS user, 
values(All_Traffic.src_ip) AS sourceIP, values(All_Traffic.src_port) AS sourcePort, 
values(All_Traffic.dest_ip) AS destinationIP, values(All_Traffic.dest_port) AS destinationPort, 
values(All_Traffic.direction) AS direction, values(All_Traffic.action) AS action FROM 
datamodel=Network_Traffic WHERE All_Traffic.src_ip IN 

(50.21.183.63 

50.3.75.246 

199.21.113.151 

203.150.19.63 

173.243.126.142 

104.107.28.123 

23.6.24.15 

23.209.185.159 

185.121.177.177 

13.107.21.200 

172.217.10.142 

130.255.78.223 

185.121.177.53 

144.76.133.38 

45.63.25.55 

27.100.36.191 

89.18.27.34 

178.63.145.230 

104.168.144.17 

62.113.203.55 

192.35.177.64 

23.6.65.194 

195.201.179.207 

104.20.21.251 

23.3.13.137)All_Traffic.dest_ip IN (*) All_Traffic.dest_port IN (*) BY All_Traffic.dest_ip, 
All_Traffic.action

| fields Earliest, Latest, user, sourceIP, sourcePort, destinationIP, destinationPort, direction, 
action

| convert ctime(""Earliest"") ctime(""Latest"") timeformat=""%d/%m/%y %H:%M:%S"""
C3_TH-27 Search for malicious domains:,,always,24h,"index IN (prod_censornet

prod_checkpoint

prod_mimecast

prod_rapid7

prod_squid_proxy

test_windows_iis) (""*dimentos.com*"" OR ""*vaclicinni.xyz*"" OR ""*thulleultinn.club*"" OR 
""*oxythuler.cyou*"" OR ""*dictorecovery.cyou*"" OR ""*expertulthima.club*"")"
C3_TH-27 Search for malicious files:,,always,24h,"index IN (prod_aws

prod_checkpoint

prod_cisco_asa

prod_f5

prod_kong

prod_mimecast

prod_netscaler

prod_o365

prod_rapid7

prod_servicenow

prod_slack

prod_squid_proxy

prod_windows

test_windows_iis) (CONTI_README.txt)

| table category sourcetype index url user cs_host c_ip time date action dest dvc site"
C3_TH-27 Search for malicious IP addresses:,,always,24h,"index IN (prod_checkpoint

prod_cisco_asa

prod_cisco_ise) (""*68.183.20.194*"" OR ""*159.89.140.116*"" OR ""*83.97.20.160*"" OR ""*192.99.178.145*"" 
OR ""*38.135.122.194*"")

| table category sourcetype index url user cs_host c_ip time date action dest dvc site"
C3_TH-28 Search to view activity to malicious domains:,,always,24h,"| tstats min(_time) as Time values(Web.user) AS user, values(Web.dest) AS dest, 
values(Web.http_method) AS method, values(Web.url) AS url, values(Web.http_referrer) AS referrer, 
values(Web.http_user_agent) AS userAgent, values(Web.category) AS category, values(Web.action) AS 
action FROM datamodel=Web WHERE Web.dest IN (*) Web.url 

IN(*australiatourism.bazar*

*bestsightsofwildaustralia.bazar*

*restinaustraliaplace.bazar*

*sightsofsydney21.bazar*

*sydneynewtours.bazar*

*vacationinsydney2021.bazar*) Web.http_referrer IN (*) BY Web.url

| fields Time, user, dest, url, method, referrer, userAgent, category, action

| convert ctime(Time)"
C3_TH-28 Search to view presence of malicious file hashes:,,always,24h,"index IN (prod_windows prod_sophos_onprem ) sourcetype=WinEventLog 
(""21807bf30699429100f07c674e9f52f0"" OR

""441a9b57a778665b0689986265a59caf"" OR

""494e8dc63210ed59ab012ebb5be1a283"" OR

""c941c4a83663fa976cf0367844900bc6"" OR

""c9ea53bdb7010f189f3c4566a854c543"")"
C3_TH-29 File Hash Search (30d):,,always,24h,"index IN (prod_windows prod_sophos_onprem ) sourcetype=WinEventLog

(3f8975af51c5028a28097bd0fecc58a92f083abaa347c1f3565fe0309f0286c3 OR

7c24d99685623b604aa4b2686e9c1b843a4243eb1b0b7b096d73bcae3d8d5a79 OR

0f0e25e859bc6f21447ed196d557eb6cdba9737dd3de22a5183a505da0126302 OR

ac92d4c6397eb4451095949ac485ef4ec38501d7bb6f475419529ae67e297753 OR

b76e2eea653b480c8a559215aa08806fad4c83c60f9a5996e89d51709212ee29 OR

e6b0a56662d1f0544257c63e63b2f85ad7215f0df3a7f5a689dee66f27e24db7 OR

c087de89a3e2c83eb0e5b4bf11de01082518d2099667a63fb49df23206b132e3 OR

714f3edd04dcce475992d4b173a99ed1a10783d6b5b22cb342884875226396ab OR

878c2d30ac544c9cb9353675313cfd0b9e2cd4f1952f451b44b9c68849a403e8 OR

f6ffead3b5f3db5a7a00d1fef874c3d3ed7ecf095da2d981ebd691fdfa685716 OR

91450c079b924cdbe85c774ac414ee8824cb4182764c51c11c7f0a6fcf11b800 OR

00ef6637bea63d139f497f9b19c72bc526b85ab40d4ed62a1558930c0ebaa6e5 OR

95363884cf0cfa8a086cd09714ec1825469f2bfae513e908ec2ea1ffb4215143 OR

afb49eb1848957358695dabc101257dc008b327aaa45d6651dbfeebca646622f OR

fcdb76dd9ed127aa0d67615e30a9fbe167e6d5470b943e3a2aa4c33039e21c38 OR

7dc6d17f523f0e5edf4299c719c6272afc9c53a57c4a9a8cbdc099d00eec1623 OR

7a248603f91082b2f7d34037ed9974a39716fe72483002616d43eca59fc1e6dd OR

6660186d53830ad8135e7cd6205f79da69319871e636fba913b3465913ecf2ce OR

eba8b7356da43b24b7e62f362ada126596043a38bc5d8d3a9138a9b484d36e3e OR

67ee96c3666d51f14442f898204efa03e54ec829c901d09534d46416b4e59400 OR

fcc120cbbbf66a71a9c0e82d20ecfc6c5721b8ccb806755126c321545fd98d38 OR

dfc703a9b8498aa24306908fce67cbf894c7861e07ff778e3fd62315684b579b OR

e6bc1311af74b649c4ee6e54de5eed79dee7ece5a62d4e20d28114330707b1d1 OR

1e04335478d3681820124d2fc090f03dafe4a25a8101eaf879752f80f54841e8 OR

89fccb259fa583055e8ebb83c1dda513ecd679920772a4e3007d40e386bb356d OR

3e038841353a959f9ba4b0c293d2940f4a1b2de691eea76d44d85722129191dc OR

4a4a333147eb03fa0bfb7d0f03b37585669e4d056d63d31beecbb56eafc80c91 OR

d2ff06963c3fb1aea1d455d6e4cbddbb634c20fafb6466e6c0bcea739123cf7  OR

34a1bbb30373e208bfcde2a02f61df5b3656116725e931c4d105f27f087aedab OR

7bd29b61cdc2bbcdb2ba87ed9f103bba116eda52a53030242bc74742429ab494 OR

3d04dfa5abeadcf03bd21c6913e69f030e6e5051a91973a5a0f50b2fd683fc78 OR

746a28d9e35ca198af34d2c8841d4bf60076032a5a83f1c1cc272bb85461e6a2 OR

71bbe0c0a5a97e1f96aca9a01ab82b6a326adae668567ff46f3edc4813fa96d4 OR

f637dfdfc08e7572ee4e385fa144612ec7bbb72643f0afb87afd8bc90f71e12b OR

b568fc8764e1e941b1c0d6657800619c12012f0fdae975d2147ad6ced4e0266f OR

034121fab09a580e13c6664b4f48c9ae83655f8207549f230be65673d7e3ab2b OR

ba458c505bc5c40e7bd37551b28c7a32a10afe99fe1b36dc9c06610d22a1f632 OR

bc8c022317b3d4f93b8fd148e008714551c0769ae79049cb00787e71ef822d34 OR

037f8275756462f617b51fb8c93b2363c1da3eea67cf9d84127c9a201d9120ab OR

eb8cef45544a8c411d83df1e82b09fa70d329f9551ba1119ab9c03725851002a OR

bcb9857db47e01bc9b351a08a0064c019efdd5502d67e5793b257c26985256b0 OR

1cfba0ba32dbe3bb0b14a95da032d6cda94eaa5c65135973eea16d12e07e5b58 OR

191cb21f2adbc9d0bf94c42cfafe4b4c1ba58755d60539ee8c8a6aa291e46bfa OR

794127b6920fe3138328b48123a4445dd661d270e174e9358096f3283e7cf3ad OR

f74493ad84a320460bb99d9914db037facbb506b6710365fed85b2cfdb6d0505 OR

15f73ca1a359afe474442df3e569934bc73aea7a8173d0384b4923b5d78356e8 OR

0bbb92a61b4f0773ccfea0dfe75ba26fddf5dcdfc6845e59debf6ca4f41c7ff1 OR

316d3100899028dfca3b76db82a4e5090496292a0fa467cd9827135deb721eb9 OR

c07a554690440bfed88e72059e348fdd234d02a4ad62854eb0b0d96054efa2f4)"
C3_TH-29 IPv4 Search(7d):,,always,24h,"index IN (prod_checkpoint

prod_cisco_asa

prod_cisco_ise) (134.19.177.46 OR

194.33.45.132 OR

103.133.104.124 OR

103.232.55.27 OR

194.5.98.38 OR

103.207.36.177 OR

185.222.58.147 OR

194.5.97.87 OR

5.206.224.194 OR

185.19.85.176 OR

104.171.113.195 OR

103.151.123.132 OR

31.210.21.99 OR

103.151.123.132 OR

31.210.20.96 OR

87.98.245.48 OR

185.38.142.241 OR

104.236.223.230 OR

185.38.142.241 OR

79.134.225.104 OR

185.203.119.28 OR

103.133.109.176 OR

64.188.13.141 OR

193.218.118.85 OR

74.125.193.102)

| table category sourcetype index url user cs_host c_ip time date action dest dvc site"
C3_TH-29 Malicious Domains (90d):,,always,24h,"| tstats min(_time) as Time values(Web.user) AS user, values(Web.dest) AS dest, 
values(Web.http_method) AS method, values(Web.url) AS url, values(Web.http_referrer) AS referrer, 
values(Web.http_user_agent) AS userAgent, values(Web.category) AS category, values(Web.action) AS 
action FROM datamodel=Web WHERE Web.dest IN (*) Web.url 

IN (""*new.www1.biz*""

""*smasters.otzo.com*""

""*sriggggs.dynamic-dns.net*""

""*punisher.shacknet.us*""

""*italidiegwu12.duckdns.org*""

""*jbfrost.live*""

""*nectarclampplaza.com*""

""*str-master.pw*"") Web.http_referrer IN (*) BY Web.url

| fields Time, user, dest, url, method, referrer, userAgent, category, action

| convert ctime(Time)"
C3_TH-30 Search for domains 30 days:,,always,24h,"| tstats min(_time) as Time values(Web.user) AS user, values(Web.dest) AS dest, 
values(Web.http_method) AS method, values(Web.url) AS url, values(Web.http_referrer) AS referrer, 
values(Web.http_user_agent) AS userAgent, values(Web.category) AS category, values(Web.action) AS 
action FROM datamodel=Web WHERE Web.dest IN (*) Web.url 

IN (""*temisleyes.com*"" ""*catsdegree.com*"" ""*www.privatlab.com*"" ""*darksidedxcftmqa.onion*"" 
""https://darksidedxcftmqa.onion*"" ""www.mega.nz*"" ""*athaliaoriginals.com*"" ""*darksidfqzcuhtk2.onion*"" 
""*koliz.xyz*"" ""*lagrom.com*"" ""*los-web.xyz*"" ""*sol-doc.xyz*"" ""http://sol-doc.xyz/sol/ID-482875588*"" 
""https://athaliaoriginals.com/*"" ""https://lagrom.com/find.html?key=id#-*"" 
""https://lagrom.com:443/font.html"" ""https://lagrom.com:443/night.html"" 
""https://lagrom.com:443/online.html"" ""https://lagrom.com:443/send.html"" ""baroquetees.com*"" 
""*securebestapp20.com*"" ""http://185.117.119.87/update.exe"") Web.http_referrer IN (*) BY Web.url

| fields Time, user, dest, url, method, referrer, userAgent, category, action

| convert ctime(Time)"
C3_TH-30 Search for IPs 30 days:,,always,24h,"index IN (prod_checkpoint

prod_cisco_asa

prod_cisco_ise) (198.54.117.200 OR

198.54.117.198 OR

198.54.117.199 OR

198.54.117.197 OR

104.193.252.197 OR

162.244.81.253 OR

185.180.197.86 OR

81.91.177.54 OR

185.117.119.87)

| table category sourcetype index url user cs_host c_ip time date action dest dvc site"
C3_TH-30 Search to find malicious hashes 30 days:,,always,24h,"index IN (prod_windows prod_sophos_onprem ) sourcetype=WinEventLog

(243dff06fc80a049f4fb37292f8b8def0fce29768f345c88ee10699e22b0ae60

12ee27f56ec8a2a3eb2fe69179be3f7a7193ce2b92963ad33356ed299f7ed975

9cee5522a7ca2bfca7cd3d9daba23e9a30deb6205f56c12045839075f7627297

5860f2415aa9a30c045099e3071f099313f653ae1806d6bcdb5f47d5da96c6d7

78782fd324bc98a57274bd3fff8f756217c011484ebf6b614060115a699ee134

dc4b8dfff72ff08ec4daa8db4c096a350a9a1bf5434ba7796ab10ec1322ac38c

8cfd28911878af048fb96b6cc0b9da770542576d5c2b20b193c3cfc4bde4d3bc

4edb883d1ac97824ee42d9f92917cc84b52995abcd17b2852a7e3d5bb567ffbe

e9417cb1baec2826e3f5a6f64ade26c1374d74d8aa41bfabd29ea20ea5894b14

fb76b4a667c6d790c39fcc93a3aac8cd2a224f0eb9ece4ecfd7825f606c2a8b6

4d9432e8a0ceb64c34b13d550251b8d9478ca784e50105dc0d729490fb861d1a

508dd6f7ed6c143cf5e1ed6a4051dd8ee7b5bf4b7f55e0704d21ba785f2d5add

cc54647e8c3fe7b701d78a6fa072c52641ac11d395a6d2ffaf05f38f53112556

68872cc22fbdf0c2f69c32ac878ba9a7b7cf61fe5dd0e3da200131b8b23438e7

1ef8db7e8bd3aaba8b1cef96cd52fde587871571b1719c5d40f9a9c98dd26f84

43e61519be440115eeaa3738a0e4aa4bb3c8ac5f9bdfce1a896db17a374eb8aa

ec153c3cb67f742b12a35a498d93cd80f47b19ea7b7eb0de217139f136ea0073

533672da9d276012ebab3ce9f4cd09a7f537f65c6e4b63d43f0c1697e2f5e48d

1cc7c198a8a2c935fd6f07970479e544f5b35a8eb3173de0305ebdf76a0988cb

151fbd6c299e734f7853497bd083abfa29f8c186a9db31dbe330ace2d35660d5

ac092962654b46a670b030026d07f5b8161cecd2abd6eece52b7892965aa521b

06cfe7f5d88e82f7adda6d8333ca8b302debb22904c68a942188be5730e9b3c8

afb22b1ff281c085b60052831ead0a0ed300fac0160f87851dacc67d4e158178

17139a10fd226d01738fe9323918614aa913b2a50e1a516e95cced93fa151c61

0839aabe5fd63b16844a27b3c586c02a044d119010a1a40ee4035501c34eae0d

f42bcc81c05e8944649958f8b9296c5523d1eb8ab00842d66530702e476561ef

adcb912694b1abcdf9c467b5d47abe7590b590777b88045d10992d34a27aa06e

6228f75f52fd69488419c0e0eb3617b5b894a566a93e52b99a9addced7364cff

bac2149254f5ce314bab830f574e16c9d67e81985329619841431034c31646e0

f764c49daffdacafa94aaece1d5094e0fac794639758e673440329b02c0fda39

691515a485b0b3989fb71c6807e640eeec1a0e30d90500db6414035d942f70a5

6d656f110246990d10fe0b0132704b1323859d4003f2b1d5d03f665c710b8fd3

e0c0cbc50a9ed4d01a176497c8dba913cbbba515ea701a67ef00dcb7c8a84368

48a848bc9e0f126b41e5ca196707412c7c40087404c0c8ed70e5cee4a418203a

6d134cdf470f03707ad481b617e67b9018f92f72a0e2fb3e6cc9f2ab17ac1439

1667e1635736f2b2ba9727457f995a67201ddcd818496c9296713ffa18e17a43

27214dcb04310040c38f8d6a65fe03c14b18d4171390da271855fdd02e06768f

3dabd40d564cf8a8163432abc38768b0a7d45f0fc1970d802dc33b9109feb6a6

516664139b0ddd044397a56482d7308d87c213c320a3151ccb9738e8f932654b

58d21840d915aaf4040ceb89522396124c82f325282f805d1085527e1e2ccfa1

6836ec8588b8049bcd57cd920b7a75f1e206e5e8bb316927784afadb634ea4d8

71692622b63ec19d2b266fb81a11f026f74041fcf5523daf16f14230caf43032

91ff9edf889befd0f4a6be50a1a074c7c1d2f26a694587ac87740d9a641cd5db

b6855793aebdd821a7f368585335cb132a043d30cb1f8dccceb5d2127ed4b9a4

bafa2efff234303166d663f967037dae43701e7d63d914efc8c894b3e5be9408

bfb31c96f9e6285f5bb60433f2e45898b8a7183a2591157dc1d766be16c29893

d43b271fb4931263f8fa54b297e3cf60762a0fe5c50ed76999f276dcc3c283be

da3bb9669fb983ad8d2ffc01aab9d56198bd9cedf2cc4387f19f4604a070a9b5

df869907fb32560472915b86b12e07b89cfa58bcd63c47fec54c5032626c5c63

e5c94b799ad91049f97305b4ccff6e92e66f4da4d302177a8b578c3bb3f7cb43

ec368752c2cf3b23efbfa5705f9e582fc9d6766435a7b8eea8ef045082c6fbce

029c5d48e425206e2ae84a63d62bdbc80362702913b38618a423c541c8a0ed40

05459376bbe170c277739cab4e425530aff0a15616297b63f0ad665c3ce0f18a

0a0c225f0e5ee941a79f2b7701f1285e4975a2859eb4d025d96d9e366e81abb9

124e83f0812629fbc7ee0330002d7e5026b0f79e29a7d42facd62dd67b83549a

17ee406d40737e0d9e7ccaf17416461ab68fc77ec77758b4bcb4f782ae45a1b4

204af8409799f7b334d23fb7b1581453447366e50d8ee574563f60670bc3733a

2d82be244e23001148ed5a6d83856b6f7cd20c3f7786481303d5d584c51ff5f0

32163991a522545523358d4255d95e45d10be3442db71994ca6ecb089df9f245

35bade966650a624c6cbd71aad2b444a8676e71b98c13874bcd33f25d9131d79

43ff2eb30e7b8eb2eb284d2dd42aded786356419c6a9eeda3b941470aed65d2f

46753892de2ae2a55d74b704813ba487af219a29f973c28aad7fda09ac6cfc2d

56e7b9c4b8962b6ff0d1e0162ca8515a07b576cd47ba90221354838733f8689a

57e3813447a34d75c82f1daf536d3ae05e85757eeec67448081a1e7d7a7158b1

6a89815f6278d0e7763a545b5ff623a9693029afa5c5f8ac15a22f94868288bf

90dfcd6b2350a35c06519b2d1bd55e7a571724cb36213ea499d2905215dd0a7f

976c584484439e923426502f11e0f4c22af249b7b2e889ec6432c4b4008d8abf

9ec775df6c32e3277363fbc01e949336a5452173b1a621d6aa81fb81563f84fb

a11cc5051e3a88428db495f6d8e4b6381a1cb3fa5946a525ef5c00bfcb44e210

a68c61b08d7b7eb7f13ada3e07b0df219cd3724fbd170e5dbee0c116fe7b0856

b5a94f998743a62d8e5f9c0857368dddd526d4b9dd7ddecc60f246207b5f6efd

b9fa10f068530007845b84d97d5cd1cba9e69e832a8afd7b49dfddc33def257c

bac7f1cb70a0fe909590f7b270248705d216b4abaf4e5dd4969fa4f1949badec

becce918e158a9ecdc81d49badfeb7c5c5098f607485700cc45cab3c2211068a

c281ed1b4f68416247907f0ac9f9c410d22db3e55def60ee1fe7093daabb7215

c718e6eaa1a446e0a3d72b533b3552c4419e9e2c646e48a5cbfeb6a7ee88c3dc

cbbc7052fed8d0002d07736a68219f01a5a4e1c19ee50310e2381e96fa8836ed

d0310c05af050555e9c7e4d005c28fc174cc288e41d44c3d919bfb1f5b88e486

d490cd8d7de06c53d634ea0e199fbb2976ff4b5458c856bbe144bf5d894091db

e0493b082077648eb33ca1294f2b26bc4c96d3820913c46330923e8bb3d73230

f73044fadb6ee95308c3de89692ac97f707f600e92cee6f217b2a9b657bdb64a)"
C3_TH-31 Search for Windows Pcap Drivers (30d):,,always,24h,"index IN (prod_checkpoint prod_cisco* prod_o365 prod_windows prod_sophos*)EventCode=4697 (""*pcap*"" 
OR ""*npcap*"" OR ""*npf*"" OR ""*nm3*"" OR ""*ndiscap*"" OR ""*nmnt*"" OR ""*windivert*"" OR ""*USBPcap*"" OR 
""*pktmon*"")"
C3_TH-32 Search for PSexec or WMI IoC (30d):,,always,24h,"index IN (prod_checkpoint prod_cisco* prod_o365 prod_windows prod_sophos*) EventCode=1121 AND 
(Process_Name IN (""*\\wmiprvse.exe"" ""*\\psexesvc.exe"") OR New_Process_Name IN (""*\\wmiprvse.exe"" 
""*\\psexesvc.exe"") OR process_name IN (""*\\wmiprvse.exe"" ""*\\psexesvc.exe"") OR new_process_name IN 
(""*\\wmiprvse.exe"" ""*\\psexesvc.exe""))

| convert ctime(_time) as Time timeformat=""%d/%m/%y %H:%M:%S""

| stats earliest(Time) as ""Earliest"" latest(Time) as ""Latest"" values(user) as User values(EventCode) 
as EventCode values(Message) as Message by host"
C3_TH-33 Check for evidence of mimikatz PrintNightmare module: (30 days),,always,24h,"index IN (test_windows

prod_windows) source=""WinEventLog*"" EventCode=4688 OR EventCode=592 AND (""*misc::printnightmare*"" OR 
(""*/server:*"" AND ""*/library:\\*"" AND ""*.dll""))"
C3_TH-33 Search for evidence of powershell PrintNightmare module: (30 days),,always,24h,"index IN (test_windows

prod_windows) source=""WinEventLog*"" EventCode=4688 OR EventCode=592 AND (""*Invoke-Nightmare*"" OR 
(""*-DLL*"" AND ""*.dll"") OR (""*-DriverName*"" AND ""*-NewUser*""))"
C3_TH-33 Search for evidence of Rundll32.exe PrintNightmare module: (30 days),,always,24h,"index IN (test_windows

prod_windows) (source=WinEventLog*) EventCode=4688 OR EventCode=592 New_Process_Name=*rundll32.exe 
Creator_Process_Name=*spoolsv.exe"
C3_TH-33 Search for relevant event codes for indication of exploitation:,,always,24h,"index IN (test_windows

prod_windows) source=""WinEventLog*"" AND (EventCode=4688 OR EventCode=592) AND (""*spoolsv.exe*"" OR 
""*\AppCrash_spoolsv.exe_*"")"
C3_TH-33 Search to view spoolsv.exe errors associated with PrintNightmare exploit: (30 Days),,always,24h,"index IN (test_windows

prod_windows) source=""WinEventLog*"" ((ErrorCode=""0x45A"" (EventCode=""808"" OR EventCode=""4909""))

OR (""The print spooler failed to load a plug-in module"" OR ""*\\drivers\\x64\\*"")) AND *mimispool*"
C3_TH-34 Check For Connections to Domains (30d):,,always,24h,"| tstats values(Web.user) AS user, values(Web.dest) AS dest, values(Web.http_method) AS method, 
values(Web.url) AS url, values(Web.http_referrer) AS referrer, values(Web.http_user_agent) AS 
userAgent, values(Web.category) AS category, values(Web.action) AS action FROM datamodel=Web WHERE 
Web.dest IN (*) Web.url IN (""*f0525443.xsph.ru*""

""*f0525538.xsph.ru*""

""*f0526889.xsph.ru*""

""*f0528108.xsph.ru*""

""*f0528018.xsph.ru*""

""*f0528103.xsph.ru*""

""*f0527632.xsph.ru*""

""*f0527590.xsph.ru*""

""*f0527586.xsph.ru*""

""*f0527577.xsph.ru*""

""*f0527472.xsph.ru*""

""*f0527475.xsph.ru*""

""*f0527235.xsph.ru*""

""*f0526632.xsph.ru*""

""*f0526333.xsph.ru*""

""*f0525244.xsph.ru*""

""*f0525767.xsph.ru*""

""*f0525168.xsph.ru*""

""*f0525255.xsph.ru*""

""*f0525053.xsph.ru*"") Web.http_referrer IN (*) BY Web.url

| fields user, dest, url, method, referrer, userAgent, category, action"
C3_TH-34 Search for activity to IPs (30d),,always,24h,"| tstats values(Web.user) AS user, values(Web.dest) AS dest, values(Web.http_method) AS method, 
values(Web.url) AS url, values(Web.http_referrer) AS referrer, values(Web.http_user_agent) AS 
userAgent, values(Web.category) AS category, values(Web.action) AS action FROM datamodel=Web WHERE 
Web.dest IN (*) Web.url IN (""*f0525443.xsph.ru*""

""*f0525538.xsph.ru*""

""*f0526889.xsph.ru*""

""*f0528108.xsph.ru*""

""*f0528018.xsph.ru*""

""*f0528103.xsph.ru*""

""*f0527632.xsph.ru*""

""*f0527590.xsph.ru*""

""*f0527586.xsph.ru*""

""*f0527577.xsph.ru*""

""*f0527472.xsph.ru*""

""*f0527475.xsph.ru*""

""*f0527235.xsph.ru*""

""*f0526632.xsph.ru*""

""*f0526333.xsph.ru*""

""*f0525244.xsph.ru*""

""*f0525767.xsph.ru*""

""*f0525168.xsph.ru*""

""*f0525255.xsph.ru*""

""*f0525053.xsph.ru*"") Web.http_referrer IN (*) BY Web.url

| fields user, dest, url, method, referrer, userAgent, category, action"
C3_TH-34 Search for presence of suspicious hashes in the estate (30 days):,,always,24h,"index IN (prod_windows prod_sophos_onprem ) sourcetype=WinEventLog

(B935689B73080CBB9E705E0E598554D1551803E405607CEEABAFE763AA6F9977 

73CF0383A1DC61D851478D5C12408F19A426DD6DA3B347135D0D02A30B4E7545

9EA73CAC6A19E97458C24AA41D11D0A259EC9E374F58C5861FCA83F2984EC9FA

80C6688BEE8ED522D3045F46729803A9925857C0AC6B0A4CC2EE552820014197

7376C43230CE320552C655C6A1CDAD03A4A65395F241A763758BF8F13375474B

99875E7786B803B50675D3FDE7B3B297EB0291582A71D07FDE68A6F4B1E66C4E

CD6D89DEB28453839DFFCBD5F95EA988DD1845F763FD6ABD33FC62189ECAB339

3279E4790191B9C9306B8C6870D6E6D4D1990F33B6B1B1E44876F32D9FAD83FA

453005576C7EDBFDFBD0E0B96D3ACABA53FCDAB6B0DDA0F18375EA898BDBBFD4

2F1AF29DF7E0104B363D1D5F905FD978ECA948151D55334753E1540F6217AC95

824D880A5331A14827C549B6277E57DBDF55CBBCF63EA6F9EE47C788258CD313

B6C563486ADE09FBE672D8ACB34736FEE2B36D217DF5EA1D4E3C6BF07DC375C4

DDB32192DB103ECF44FDBE3E0CF4DA8D61853BD90B46EC3721B6760EDEC8FBEB

3F9A83AFB95B22057FE64588AF8CC3A4F463615DEDFB56F4077FA8BBD7607A9F

FFB99BB263054241D6D3C9330EA911A3B596B3F0D1146CD5C09DF2652A3A8DA8

35296AA729A0A7FFB94E8141EF9DE20315F88412D1C68DBB81FBAE5FA871F914

515FEDD3B73D5E818BF55CB918C9788E1F89B4E8C185A90DCB5B66B38C87C17F

860388A45EED8C7BAEB4CF3B3AF742222E060DA5723A7E6724D5B6B22F43C697

C063D617F9DBBB3A9951BDCD24876DC72D912CF3E15BC7C6C7F24BB72EA42D62

EE36ED5F99897A9A56FEA264B68F89A3B08973717096A0476412A319CAEF1F80)"
C3_TH-35 Search for lateral movement Indicators with ConDrv (30d):,,always,24h,"| tstats summariesonly=t earliest(_time) as Earliest latest(_time) as Latest values(Web.user) as 
User values(Web.dest) as Destination values(Web.site) as Site values(Web.action) as Action 
values(Web.category) as Category values(Web.url) as URL values(Web.http_content_type) as ""HTTP 
Content Type"" values(Web.http_method) as ""HTTP Method"" values(Web.http_referrer) as ""HTTP Referrer"" 
values(Web.http_user_agent) as ""User Agent"" from datamodel=Web WHERE

(Web.dest=""95.179.242.6"" OR

Web.dest=""95.179.242.27"" OR

Web.dest=""199.247.25.102"" OR

Web.dest=""95.179.210.61"" OR

Web.dest=""95.179.156.97"") by Web.src

| `drop_dm_object_name(Web)` 

| convert ctime(Earliest) ctime(Latest) timeformat=""%d/%m/%Y %H:%M:%S""

| sort -Earliest"
C3_TH-36 Search to view evidence of executables over the last 30 days:,,always,24h,"index IN (prod_checkpoint prod_cisco* prod_o365 prod_windows prod_sophos*) EventCode=4688 
New_Process_Name IN (""*bash.exe""  ""*lxrun.exe""  ""*wsl.exe"")  

| fields src_user user category New_Process_Name app signature dest index

| stats earliest(_time) as earliest latest(_time) as latest count values(category) as category 
values(New_Process_Name) as New_Process_Name values(app) as app  values(signature) as signature 
values(index) as index by dest user src_user 

| eval earliest=strftime(earliest,""%Y-%m-%d %H:%M:%S.%Q"") 

| eval latest=strftime(latest,""%Y-%m-%d %H:%M:%S.%Q"") 

| table earliest latest count src_user user New_Process_Name dest signature category app index"
C3_TH-37 Search for suspicious domains:,,always,24h,"| tstats values(Web.user) AS user, values(Web.dest) AS dest, values(Web.http_method) AS method, 
values(Web.url) AS url, values(Web.http_referrer) AS referrer, values(Web.http_user_agent) AS 
userAgent, values(Web.category) AS category, values(Web.action) AS action FROM datamodel=Web WHERE 
Web.dest IN (*) Web.url IN (""*py2web.online*"" ""*py2web.store*"" ""*mr.f2pool.com*"" 
""*pool.minexmr.com*"" ""*xmr-eu1.nanopool.org*"" ""*xmr.f2pool.com*"" ""*xmr.pool.gntl.co.uk*"" 
""185.239.242.71*""

""194.145.227.21*"" 

""194.145.227.21/a.py*"" 

""194.145.227.21/ldr.ps1*"" 

""194.145.227.21/ldr.sh*"" 

""194.40.243.98/ldr.sh*"" 

""194.87.139.103/cleanfda/newinit.sh*"" 

""194.87.139.103/cleanfda/zzh*"" 

""195.58.39.46/asap*"" 

""195.58.39.46/cleanfda/init.sh*"" 

""195.58.39.46/cleanfda/newinit.sh*"" 

""195.58.39.46/cleanfda/zzh*"" 

""31.210.20.120/ldr.sh*"" 

""31.210.20.181/ldr.sh*"" 

""45.145.185.85*"" 

""py2web.store/cleanfda/newinit.sh*"" 

""py2web.store/cleanfda/zzh*"") Web.http_referrer IN (*) BY Web.url

| fields user, dest, url, method, referrer, userAgent, category, action"
C3_TH-37 Search for suspicious IP addresses:,,always,24h,"| tstats summariesonly=t count min(_time) as firstTime max(_time) as lastTime 
values(All_Traffic.src_ip) as ""src_ip""  values(All_Traffic.dvc) as dvc values(All_Traffic.protocol) 
as ""protocol"" values(All_Traffic.src_zone) as ""src_zone"" values(All_Traffic.user) as ""user"" from 
datamodel=Network_Traffic where All_Traffic.dest_ip IN (""139.99.102.72"" ""139.99.102.72"" 
""185.239.242.71"" ""194.145.227.21"" ""194.40.243.98"" ""194.87.139.103"" ""195.58.39.46"" ""31.210.20.120"" 
""31.210.20.181"" ""45.145.185.85"") by All_Traffic.dest_ip All_Traffic.action All_Traffic.app

| convert ctime(lastTime) ctime(firstTime) timeformat=""%Y/%m/%d %H:%M"""
C3_TH-38 Search for a process injection associated with Bazar malware (30 days):,,always,24h,"index IN (prod_checkpoint prod_cisco* prod_o365 prod_windows prod_sophos*) EventCode=4688 
New_Process_Name IN (""*bash.exe""  ""*lxrun.exe""  ""*wsl.exe"")  

| fields src_user user category New_Process_Name app signature dest index

| stats earliest(_time) as earliest latest(_time) as latest count values(category) as category 
values(New_Process_Name) as New_Process_Name values(app) as app  values(signature) as signature 
values(index) as index by dest user src_user 

| eval earliest=strftime(earliest,""%Y-%m-%d %H:%M:%S.%Q"") 

| eval latest=strftime(latest,""%Y-%m-%d %H:%M:%S.%Q"") 

| table earliest latest count src_user user New_Process_Name dest signature category app index"
C3_TH-39 IPv4 Search:,,always,24h,"| tstats summariesonly=t count min(_time) as firstTime max(_time) as lastTime 
values(All_Traffic.src_ip) as ""src_ip""  values(All_Traffic.dvc) as dvc values(All_Traffic.protocol) 
as ""protocol"" values(All_Traffic.src_zone) as ""src_zone"" values(All_Traffic.user) as ""user"" from 
datamodel=Network_Traffic where All_Traffic.dest_ip IN (*198.55.119.112* 

*45.58.112.77* 

*23.229.111.197* 

*23.229.111.197* 

*185.208.158.208*) by All_Traffic.dest_ip All_Traffic.action All_Traffic.app

| convert ctime(lastTime) ctime(firstTime) timeformat=""%Y/%m/%d %H:%M"""
C3_TH-39 Search for Domains:,,always,24h,"| tstats values(Web.user) AS user, values(Web.dest) AS dest, values(Web.http_method) AS method, 
values(Web.url) AS url, values(Web.http_referrer) AS referrer, values(Web.http_user_agent) AS 
userAgent, values(Web.category) AS category, values(Web.action) AS action FROM datamodel=Web WHERE 
Web.dest IN (*) Web.url IN (*ddjm.co.kr/bbs/icon/skin/skin.php*

*hivekorea.com/jdboard/member/list.php*

*mail.namusoft.kr/jsp/user/eam/board.jsp*

*mail.sisnet.co.kr/jsp/user/sms/sms_recv.jsp*

*snum.or.kr/skin_img/skin.php*

*allamwith.com/home/mobile/list.php*

*conkorea.com/cshop/banner/list.php*

*ddjm.co.kr/bbs/icon/skin/skin.php*

*jinjinpig.co.kr/Anyboard/skin/board.php*) Web.http_referrer IN (*) BY Web.url

| fields user, dest, url, method, referrer, userAgent, category, action"
C3_TH-39 Search for Hashes:,,always,24h,"index IN (prod_windows prod_sophos_onprem ) sourcetype=WinEventLog

(ed9aa858ba2c4671ca373496a4dd05d4 

71759cca8c700646b4976b19b9abd6fe

3ba4c71c6b087e6d06d668bb22a5b59a

d5e974a3386fc99d2932756ca165a451

f4d46629ca15313b94992f3798718df7

118cfa75e386ed45bec297f8865de671

53648bf8f0121130edb42c626d7c2fc4

1bb267c96ec2925f6ae3716d831671cf

0812ce08a75e5fc774a114436e88cd06

927f0a1090255bc724953e1f5a09a070

145735911e9c8bafa4c9c1d7397199fc

551c5b3595e9fc1081b5e1f10e3c1a59

f3fcb306cb93489f999e00a7ef63536b

0ecfa51cd4bf1a9841a07bdb5bfcd0ab

4d30612a928faf7643b14bd85d8433cc

df1e7a42c92ecb01290d896dca4e5faa

3b1b8702c4d3e2e194c4cc8f09a57d06

ef3a6978c7d454f9f6316f2d267f108d

33c2e887c3d337eeffbbd8745bfdfc8f

bf4a822f04193b953689e277a9e1f4f1

6e710f6f02fdde1e4adf06935a296fd8

38917e8aa02b58b09401383115ab549e

67220baf2a415876bee2d43c11f6e9ad

3bf9b83e00544ac383aaef795e3ded78

159ad2afcab80e83397388e495d215a5

21ec5f03aab696f0a239c6ea5e50c014

b5874eb1119327be51ae03adcbf4d3e0

8b378eabcec13c3c925cc7ca4d191f5f

5b387a9130e9b9782ca4c225c8e641b3

25c8e057864126e6648c34581e7b4f20

62eae43a36cbc4ed935d8df007f5650b

8d74112c97e98fef4c5d77200f34e4f2

b5648f5e115da778615dfd0dc772b647

eef723ff0b5c0b10d391955250f781b3

d1a99087fa3793fbc4d0adb26e87efce

d63bb2c5cd4cfbe8fabf1640b569db6a

fffad123bd6df76f94ffc9b384a067fc

abaeecd83a585ec0c5f1153199938e83

569246a3325effa11cb8ff362428ab2c

3b494133f1a673b2b04df4f4f996a25d

fc3c31bbdbeee99aba5f7a735fac7a7e

d96fcd2159643684f4573238f530d03b)"
"C3_TH-4 Search checking for connections to ad sites (Domain, over 30 days):",,always,24h,"index=prod_checkpoint

dest=""34.231.131.84"" OR

dest=""52.87.34.65"" OR

dest=""52.41.141.111"" OR

dest=""35.164.24.169"" OR

dest=""54.149.89.229"" OR

dest=""54.191.252.124"" OR

dest=""52.10.53.42"" OR

dest=""52.26.163.52"" OR

dest=""104.27.169.191"" OR

dest=""104.27.168.191"" OR

dest=""45.82.253.244"" OR

dest=""104.206.78.18""

| table _time host action conn_direction dest hostname service

| sort -_time"
"C3_TH-4 Search checking for connections to ad sites (IP, over 30 days):",,always,24h,"index=prod_checkpoint

dest=""34.231.131.84"" OR

dest=""52.87.34.65"" OR

dest=""52.41.141.111"" OR

dest=""35.164.24.169"" OR

dest=""54.149.89.229"" OR

dest=""54.191.252.124"" OR

dest=""52.10.53.42"" OR

dest=""52.26.163.52"" OR

dest=""104.27.169.191"" OR

dest=""104.27.168.191"" OR

dest=""45.82.253.244"" OR

dest=""104.206.78.18""

| table _time host action conn_direction dest hostname service

| sort -_time"
C3_TH-4 Search checking for signs of the malware (over 30 days):,,always,24h,"index=* ""33094acd614825a916b77df6c5141c088fc3768b"" OR

""0f4d63961b5f0f85bdf17d7858ab76f4b12173f8af25a3c1c8d84d75bb46d384"" OR

""1b2fe4717cab6010c54d1132c789ab092a0f159733367f57d47a8673090e13e3"" OR

""31f86819ef41477c18e700a75450fb5fc733636f83f92cbf06e6bcfcfd7e39c3"" OR

""4685d1ea51450e291b46a4fb64b549ac423a41bdfe03f1a536c031a90ef05499"" OR

""60f240809b1d3c205a585b2386dcc4a0c6ec63e6038ab122af905e3b9bd9637c"" OR

""63d49ee2a609deacf15d4c5dd3c39b8678b1ef7d64704e6eda648e28ae97cf05"" OR

""7d57f577f22e1b87a1f94876840c924f4335cfac06ccac2dff032db5db763798"" OR

""9d3aab6a662b6f245e46a0548a7b7526fb7921c38f8f2da9fafae8cdae87dde1"" OR

""a88b8339048897ad794f6ba051d714533eaf750ba45d93397e19280fb0187479"" OR

""b56a75e8a431c78253ffca8adf967a33335ffd3413987fc129fb17dc81c3c866"" OR

""b7305f7409d9518d57aad6c9baf04160566c1cc90a9c8284ab7f9fc1c2af116b"" OR

""cea3c5d2afb1417c2e1435fa3035777c992f167532f9a5bc1203468993f025ed"" OR

""d745e27c1892fda16bf37f0cfaeef9cd7e201754bc75abbbd5db534186ff1c57"" OR

""db677e6fcdc8f80720323edd2c7e082ff64f805ec4e545b35c0dfaac370a7f9b"" OR

""dd96cf4443ec8c0ddf8355f1845f5a8c3e252061041231e25bc6d829c3edd5b0"" OR

""deeaf7d761dbb3d7434d378065161122296c07dfda1ad7a72fe2f364d90425db"" OR

""def687be0a9af6454054f20bb0bcfb9d5c7361584a024584174b4776e051926f"" OR

""dfc56347494ca778defdf4b68a70e20f8ce6b994819a9b5923a60e648de97f09"" OR

""e9803666c3f04c9091c53cb3e2ecc05e2f86fe0f20ed2a33147e2122a0c0bf05"" OR

""f37a852d668dcedf3872d1b428f742d0fbee9c64063b77d05d498f1246f49e5a"" OR

""f98e4a8e0e46841709bec31e0927c502b87634356203da24d02b9a7d1201633f"" OR

""fc959e362bbf57651d06e628cab8d47bdaafa37cd30ebd9cc4ec4dfe0f750c79"" OR

""fd093779663716380b6be33c5e7ffc1da88243570a9cbf648dd9a3059f85867b"""
C3_TH-40 Search for WMI filter to consumer binding or WMI suspicious event consumers(30d):,,always,24h,"index IN (prod_checkpoint prod_cisco* prod_o365 prod_windows prod_sophos*) (EventCode=5861 AND 
Message IN (*ActiveScriptEventConsumer* *CommandLineEventConsumer* *CommandLineTemplate*)) OR 
EventCode=5859

| transaction user,dvc,service maxspan=-1 maxevents=-1

| convert ctime(_time) as Time timeformat=""%d/%m/%y %H:%M:%S"" 

| stats earliest(Time) as ""Earliest"" latest(Time) as ""Latest"" values(EventCode) as EventCode 
values(eventtype) as EventType values(service) as Service values(dvc) as Host values(status) as 
Status values(Service_Type) as Service_Type values(Message) as Message by user"
C3_TH-40 Search for WMI subscription(30d):,,always,24h,"index IN (prod_checkpoint prod_cisco* prod_o365 prod_windows prod_sophos*) EventCode=4662 
Object_Type=""WMI Namespace"" Object_Name=*subscription*

| transaction user,dvc maxspan=-1 maxevents=-1

| convert ctime(_time) as Time timeformat=""%d/%m/%y %H:%M:%S"" 

| stats earliest(Time) as ""Earliest"" latest(Time) as ""Latest"" values(EventCode) as EventCode 
values(eventtype) as EventType values(Object_Type) as Object_Type values(dvc) as Host 
values(Object_Name) as Object_Name values(Message) as Message by user"
C3_TH-41 Search to view activity to IOC domains:,,always,24h,"| tstats values(Web.user) AS user, values(Web.dest) AS dest, values(Web.http_method) AS method, 
values(Web.url) AS url, values(Web.http_referrer) AS referrer, values(Web.http_user_agent) AS 
userAgent, values(Web.category) AS category, values(Web.action) AS action FROM datamodel=Web WHERE 
Web.dest IN (*) Web.url IN (""*gdcb.bit*""

""*corp-servers.ru*""""*politiaromana.bit*"" ""*aurumwedding.ru*"" ""*krasnaypolyana123.ru*""

""*goodapd.website*"" ""*blokefeed.club*"" ""*cevent.net*"" ""*graftedinn.us*"" 

""*top-22.ru*"" ""*fabbfoundation.gm*"" ""*hoteltravel2018.com*"" ""*boatshowradio.com*"" 

""*corp-server.ru*"" ""*cloud-name.ru*"" ""*virmach.ru*"" ""*fullmanaged.ru*""

""*bellytobabyphotographyseattle.com*"" ""*pp-panda74.ru*"" ""*virmach.ru*"" ""*wowservers.ru*"" 

""*perfectfunnelblueprint.com*"" ""*poketeg.com*"" ""*fliptray.biz*"" ""*wowservers.ru*""

""*dsoprodns.ru*"" ""*bizaziniinfissi.com*""  ""*dsoprodns.ru*"" ""*aubergemontblanc.com*""

""*hotelweisshorn.com*"" ""*holzbock.biz*"" ""*morcote-residenza.com*"") Web.http_referrer IN (*) BY 
Web.url

| fields user, dest, url, method, referrer, userAgent, category, action"
C3_TH-44 File Search (90d):,,always,24h,"index=* (

""CORE-2019.4.5220.20574-SolarWinds-Core-v2019.4.5220-Hotfix5.msp"" OR

""Solarwinds Worldwide, LLC"" OR

""SolarWinds.Orion.Core.BusinessLayer.dll"" OR

""OrionImprovementBusinessLayer.2.cs"" OR

""app_web_logoimagehandler.ashx.b6031896.dll"")"
C3_TH-44 Look for connections towards malicious ips (90d):,,always,24h,"index IN (prod_windows prod_sophos_onprem) [| inputlookup sunburst-domains.csv |  rename ip as src | 
 fields src]

| stats VALUES(ip) AS ""Sunburst"" by host"
C3_TH-44 Search to identify hashes(90d):,,always,24h,"index IN (prod_windows prod_sophos_onprem ) (

    d0d626deb3f9484e649294a8dfa814c5568f846d5aa02d4cdad5d041a29d5600 OR

    53f8dfc65169ccda021b72a62e0c22a4db7c4077f002fa742717d41b3c40f2c7 OR

    32519b85c0b422e4656de6e6c41878e95fd95026267daab4215ee59c107d6c77 OR

    abe22cf0d78836c3ea072daeaf4c5eeaf9c29b6feb597741651979fc8fbd2417 OR

    019085a76ba7126fff22770d71bd901c325fc68ac55aa743327984e89f4b0134 OR

    ce77d116a074dab7a22a0fd4f2c1ab475f16eec42e1ded3c0b0aa8211fe858d6 OR

    439bcd0a17d53837bc29fb51c0abd9d52a747227f97133f8ad794d9cc0ef191e OR

    a25cadd48d70f6ea0c4a241d99c5241269e6faccb4054e62d16784640f8e53bc OR

    d3c6785e18fba3749fb785bc313cf8346182f532c59172b69adfb31b96a5d0af OR

    292327e5c94afa352cc5a02ca273df543f2020d0e76368ff96c84f4e90778712 OR

    c15abaf51e78ca56c0376522d699c978217bf041a3bd3c71d09193efa5717c71 OR

    1b476f58ca366b54f34d714ffce3fd73cc30db1a OR

    47d92d49e6f7f296260da1af355f941eb25360c4 OR

    76640508b1e7759e548771a5359eaed353bf1eec OR

    b485953ed77caefe81bff0d9b349a33c5cea4cde OR

    2f1a5a7411d015d01aaee4535835400191645023 OR

    d130bd75645c2433f88ac03e73395fba172ef676 OR

    cfc57d48effb5bbd4e0a6f80e6041d9faf7d7ab4 OR

    5e643654179e8b4cfe1d3c1906a90a4c8d611cea OR

    ebe711516d0f5cd8126f4d53e375c90b7b95e8f2 OR

    c2c30b3a287d82f88753c85cfb11ec9eb1466bad OR

    75af292f34789a1c782ea36c7127bf6106f595e8 OR

    02af7cec58b9a5da1c542b5a32151ba1 OR

    08e35543d6110ed11fdf558bb093d401 OR

    b91ce2fa41029f6955bff20079468448 OR

    d5aad0d248c237360cf39c054b654d69 OR

    2c4a910a1299cdae2a4e55988a2f102e OR

    846e27a652a5e1bfbd0ddd38a16dc865 OR

    baa3d3488db90289eb2889c1a2acbcde OR

    e18a6a21eb44e77ca8d739a72209c370 OR

    3e329a4c9030b26ba152fb602a1d5893 OR

    4f2eb62fa529c0283b28d05ddd311fae OR

    56ceb6d0011d87b6e4d7023d7ef85676 )"
C3_TH-6 Search for remote task creation:,,always,24h,"(index=prod_windows OR index=prod_windows_ad OR index=prod_aws)  ((EventCode=4624 AND EventType=3) 
OR EventCode=4698)

|sort -_time

|transaction Logon_ID startswith=(EventCode=4624) endswith=(EventCode=4698) maxspan=1m

| stats values(EventCode) values(Task_Name) values(Message) values(user) by ComputerName"
C3_TH-6 Search for tasks with short life time:,,always,24h,"(index=prod_windows OR index=prod_windows_ad OR index=prod_aws)  (EventCode=4698 OR EventCode=4699)

|sort -_time

|transaction Logon_ID Task_Name startswith=(EventCode=4698) endswith=(EventCode=4699) maxspan=1m

| stats values(EventCode) values(Task_Name) values(Message) values(user) by ComputerName"
C3_TH-6 Search to detect creation of ATSVC scheduled tasks:,,always,24h,"(index=prod_windows OR index=prod_windows_ad OR index=prod_aws) (EventCode=""5145"" ""*IPC$*"" ""*atsvc*"" 
Accesses=""*Write*"")"
C3_TH-6 Search to detect lateral movement using GPO scheduled tasks:,,always,24h,"(index=prod_windows OR index=prod_windows_ad OR index=prod_aws) (EventCode=""5145"" ""*SYSVOL*"" 
""*Scheduled*"" Accesses=""*Write*"")"
C3_TH-7 Search for created and deleted scheduled tasks 30 days,,always,24h,"index=prod_windows sourcetype=* (EventCode=4698 OR EventCode=4699) 

| sort -_time 

| transaction ComputerName startswith=(EventCode=4698) endswith=(EventCode=4699) maxspan=60m 

| stats values(EventCode) as EventCode values(EventType) as Event values(TaskCategory) as Task_Name 
by ComputerName"
C3_TH-8 Search for known malicious service installation:,,always,24h,"(index=prod_windows OR index=prod_windows_ad OR index=prod_aws) EventCode=7045 

| eventstats count as val by Service_File_Name| search val < 5

| convert ctime(_time) as Time timeformat=""%d/%m/%y %H:%M:%S""

| stats values(Time) values(EventCode) values(Sid) values(OpCode) values(Service_Name) 
values(Service_File_Name) values(Service_Start_Type) values(Service_Type) by ComputerName"
C3_TH-8 Search for rare service installation:,,always,24h,"(index=prod_windows OR index=prod_windows_ad OR index=prod_aws) EventCode=7045 

| eventstats count as val by Service_File_Name| search val < 5

| convert ctime(_time) as Time timeformat=""%d/%m/%y %H:%M:%S""

| stats values(Time) values(EventCode) values(Sid) values(OpCode) values(Service_Name) 
values(Service_File_Name) values(Service_Start_Type) values(Service_Type) by ComputerName"
C3_TH-8 Search for service creation using external resources/utilities (psexec family):,,always,24h,"(index=prod_windows OR index=prod_windows_ad OR index=prod_aws) EventCode=5145

| transaction Account_Name ComputerName startswith=(EventCode=5145 (""*\ADMIN$"" OR ""*\C$"") 
Accesses=""*WriteData*"") endswith=(EventCode=5145 ""*\IPC$"" ""*svcctl*"") maxspan=1m

| convert ctime(_time) as Time timeformat=""%d/%m/%y %H:%M:%S""

| stats values(Time) values(user) values(Source_Network_Address) values(EventCode) 
values(Share_Name) values(action) values(Accesses) values(Security_ID) values(Relative_Target_Name) 
by ComputerName"
C3_TH-8 Search for standard remote service creation (Windows Builtin):,,always,24h,"(index=prod_windows OR index=prod_windows_ad OR index=prod_aws) (EventCode=5156 ""*services.exe"") OR 
(EventCode=7045 OR EventCode=4697) 

|transaction ComputerName startswith=(EventCode=5156) endswith=(EventCode=7045 OR EventCode=4697) 
maxspan=1m

| convert ctime(_time) as Time timeformat=""%d/%m/%y %H:%M:%S""

| stats values(EventCode) values(ComputerName) values(TaskCategory) values(Service_File_Name) 
values(Service_Start_Type) values(Service_Type) by Service_Name Time"
C3_TH-9 Search for RDP connections over reverse SSH tunnel (using Event ID 4624):,,always,24h,"(index=prod_windows OR index=prod_windows_ad OR index=prod_aws) EventCode=4624 Logon_Type=10 
(Source_Network_Address=127.0.0.1/8 OR Source_Network_Address=::1)

| convert ctime(_time) as Time timeformat=""%d/%m/%y %H:%M:%S""

| stats values(src_port) values(Time) values(ComputerName) values(user)  values(Account_Name) 
values(action)  values(subject) by src_ip"
C3_TH-9 Search for RDP connections over reverse SSH tunnel (utilising Event ID 5156):,,always,24h,"(index=prod_windows OR index=prod_windows_ad OR index=prod_aws) EventCode=5156 (src_port=3389 OR 
Client_Port=3389 OR Port=3389 OR dest_port=3389) (src_ip=127.0.0.1/8 OR dest_ip=127.0.0.1/8)

| convert ctime(_time) as Time timeformat=""%d/%m/%y %H:%M:%S""

| stats values(src_port) values(Time) values(ComputerName) values(user)  values(Account_Name) 
values(action)  values(subject) by src_ip"
C3_TH-9 Search for RDP with local account (connections to loopback address):,,always,24h,"(index=prod_windows OR index=prod_windows_ad OR index=prod_aws) EventCode=4624 Logon_Type=10 
(Source_Network_Address=127.0.0.1 OR Source_Network_Address=::1)

| replace ""*$"" with ""*"" IN Account_Name

| where Account_Name=Workstation_Name

| convert ctime(_time) as Time timeformat=""%d/%m/%y %H:%M:%S""

| stats values(src_port) values(Time) values(ComputerName) values(user)  values(Account_Name) 
values(action) by src_ip"
C3_util_LookupUpdater-SPL01,This is used to update the lookup for MFA logins.,always,24h,"index=prod_aws eventName=""ConsoleLogin"" additionalEventData.MFAUsed=""No"" action=success 
earliest=-65m@m latest=-5m@m

| rename userIdentity.userName AS user

| stats min(_time) AS earliestLogin BY user

| table user, earliestLogin

| appendcols 

    [| inputlookup C3_BL_MFAUserLogins.csv

    | fields user earliestLogin]

| outputlookup C3_BL_MFAUserLogins.csv"
Check For App Updates,Search to be run to find any apps that require an update,always,24h,"| rest /services/apps/local 

| search disabled=0 details=""http*"" (version!=update.version AND update.version != """")

| table label details version update.version"
Checkpoint Firewall Changes Last 7 days,A report of all changes that have been made to the Checkpoint,always,24h,"index=prod_checkpoint sourcetype=""cp_SmartConsole"" eventtype=""cp_admin"" 

| transaction session_uid

| table _time, session_description, administrator,operation, 
objecttype,objectname,logic_changes,fieldschanges, *"
Checkpoint Throughput over Time,,always,24h,"index=prod_checkpoint  

| eval Mbytes_total = (bytes_in + bytes_out)/1048576

| timechart eval(sum(Mbytes_total) ) AS ""Total Throughput"", eval( sum(bytes_in)/1048576) as ""Bytes 
In"" , eval( sum(bytes_out)/1048576) as ""Bytes Out"""
CIM - Data Model Acceleration Details,,always,24h,"| `datamodel(""Splunk_Audit"", ""Datamodel_Acceleration"")` | 
`drop_dm_object_name(""Datamodel_Acceleration"")` | eval size(MB)=round(size/1048576,1) | eval 
retention(days)=retention/86400 | eval complete(%)=round(complete*100,1) | sort 100 + datamodel | 
fieldformat earliest=strftime(earliest, ""%m/%d/%Y %H:%M:%S"") | fieldformat latest=strftime(latest, 
""%m/%d/%Y %H:%M:%S"") | fields 
datamodel,app,cron,retention(days),earliest,latest,is_inprogress,complete(%),size(MB),last_error"
CIM - Top Data Model Accelerations,Maintains a data cube of DMA statistics for use in Datamodel Audit view,always,24h,"| `datamodel(""Splunk_Audit"", ""Datamodel_Acceleration"")` | 
`drop_dm_object_name(""Datamodel_Acceleration"")` | join type=outer last_sid [| rest 
splunk_server=local count=0 /services/search/jobs reportSearch=summarize* | rename sid as last_sid | 
fields last_sid,runDuration] | eval ""size(MB)""=round(size/1048576,1), 
""retention(days)""=if(retention==0,""unlimited"",round(retention/86400,1)), 
""complete(%)""=round(complete*100,1), ""runDuration(s)""=round(runDuration,1)"
CIM - Top Data Model Accelerations By Run Duration,,always,24h,"| `datamodel(""Splunk_Audit"", ""Datamodel_Acceleration"")` | 
`drop_dm_object_name(""Datamodel_Acceleration"")` | join type=outer last_sid [| rest 
splunk_server=local count=0 /services/search/jobs reportSearch=summarize* | rename sid as last_sid | 
fields last_sid,runDuration] | sort 100 - runDuration | table datamodel,runDuration"
CIM - Top Data Model Accelerations By Size,,always,24h,"| `datamodel(""Splunk_Audit"", ""Datamodel_Acceleration"")` | 
`drop_dm_object_name(""Datamodel_Acceleration"")` | eval size(MB)=size/1048576 | sort 100 - size | 
table datamodel,size(MB)"
CIM - Vendor Product Tracker - Lookup Gen,Maintains a list of vendor_product values and the first and list time they have been seen,always,24h,"| tstats prestats=true summariesonly=true min(_time),max(_time) from 
datamodel=Malware.Malware_Attacks by Malware_Attacks.vendor_product | 
`drop_dm_object_name(""Malware_Attacks"")` | eval model=""Malware"" | tstats prestats=true 
summariesonly=true append=true min(_time),max(_time) from datamodel=Network_Traffic.All_Traffic by 
All_Traffic.vendor_product | `drop_dm_object_name(""All_Traffic"")` | eval 
model=if(isnull(model),""Network_Traffic"",model) | tstats prestats=true summariesonly=true 
append=true min(_time),max(_time) from datamodel=Intrusion_Detection.IDS_Attacks by 
IDS_Attacks.vendor_product | `drop_dm_object_name(""IDS_Attacks"")` | eval 
model=if(isnull(model),""Intrusion_Detection"",model) | tstats prestats=true summariesonly=true 
append=true min(_time),max(_time) from datamodel=Vulnerabilities.Vulnerabilities by 
Vulnerabilities.vendor_product | `drop_dm_object_name(""Vulnerabilities"")` | eval 
model=if(isnull(model),""Vulnerabilities"",model) | stats min(_time) as firstTime,max(_time) as 
lastTime by vendor_product,model | inputlookup append=true cim_vendor_product_tracker | stats 
min(firstTime) as firstTime,max(lastTime) as lastTime by vendor_product,model | outputlookup 
override_if_empty=false cim_vendor_product_tracker | stats count"
Cisco Search for source or dest,,always,24h,"index=* 10.80.76.* dest_ip!=""172.25.96.30"" dest_ip!=""172.22.96.30"" dest_ip!=""10.10.110.3"" 
dest_ip!=""10.10.150.160"" | lookup C3Subnets subnet as src_ip OUTPUT location as src_location | 
lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location | search dest_ip!=""10.70.20.80""  
transport!=icmp  src_ip!=""10.10.110.3""  Cisco_ASA_vendor_action=deny | table  src_ip src_location 
dest_ip dest_location transport Cisco_ASA_vendor_action dest_port"
CloudTrail Base Search,,always,24h,"index=*aws sourcetype=aws:cloudtrail ((aws_account_id=""*""),  (region=""**"") )       | lookup 
unauthorized_errorCode errorCode OUTPUT Unauthorized              | stats count 
count(eval(errorCode!=""success"")) as errors count(Unauthorized) as Unauthorized by eventName region 
aws_account_id userName"
CloudTrail EventName Generator,,always,2h,"`aws-cloudtrail-sourcetype` | stats count by eventName | lookup all_eventName eventName OUTPUTNEW 
eventName as existing | fillnull | search existing=0 | fields eventName | outputlookup all_eventName 
append=true"
CloudTrail S3 Data Event Search,,always,24h,"`aws-cloudtrail-sourcetype`| lookup all_eventName eventName OUTPUTNEW function| search function=""S3 
Data Event"" | spath output=bucketName path=""requestParameters.bucketName"" | spath output=objectName 
path=requestParameters.key | spath output=userName path=userIdentity.userName | eval 
error=if(errorCode==""success"",0, 1) | lookup unauthorized_errorCode errorCode OUTPUT Unauthorized | 
eval Unauthorized=if(Unauthorized==""true"", 1, 0) | stats count by region, aws_account_id, 
bucketName, objectName, userName, eventName, userAgent, sourceIPAddress,Unauthorized, error, 
readOnly,_time"
CloudTrail Timechart Search,,always,24h,"`aws-cloudtrail((aws_account_id=""*""),  (region=""**"") )` | eval day=strftime(_time, ""%Y-%m-%d %z"") | 
stats count by eventName region aws_account_id day errorCode | eval _time=strptime(day, ""%Y-%m-%d 
%z"") | eval response=if(errorCode==""success"",""success"", ""error"") | lookup unauthorized_errorCode 
errorCode OUTPUT Unauthorized | eval response=if(Unauthorized==""true"", ""unauthorized"", response) | 
fields - day errorCode Unauthorized"
CloudWatch: Topology CPU Metric Generator,,always,24h,"`aws-cloudwatch-ec2(""*"", ""*"")` metric_dimensions=""*InstanceId=[*]*"" metric_name=""CPUUtilization"" 

         | stats avg(Average) as cpu by metric_dimensions | 
`aws-cloudwatch-dimension-rex(""InstanceId"", ""name"")` 

         | table cpu, name | outputlookup topology_cpu_metrics"
CloudWatch: Topology Disk IO Metric Generator,,always,24h,"`aws-cloudwatch-ec2(""*"", ""*"")` metric_dimensions=""*InstanceId=[*]*"" metric_name=""Disk*Ops"" 

         | stats sum(Sum) as io_count by metric_dimensions, metric_name | stats sum(io_count) as 
disk by metric_dimensions 

         | `aws-cloudwatch-dimension-rex(""InstanceId"", ""name"")` | table disk, name | outputlookup 
topology_diskio_metrics"
CloudWatch: Topology Network Traffic Metric Generator,,always,24h,"`aws-cloudwatch-ec2(""*"", ""*"")` metric_dimensions=""*InstanceId=[*]*"" metric_name=""Network*"" 

         | stats sum(Sum) as network by metric_dimensions, metric_name | stats sum(network) as 
network_traffic by metric_dimensions 

         | `aws-cloudwatch-dimension-rex(""InstanceId"", ""name"")` | table network_traffic, name | 
outputlookup topology_network_traffic_metrics"
CloudWatch: Topology Volume IO Metric Generator,,always,24h,"`aws-cloudwatch-ebs(""*"", ""*"")` metric_dimensions=""*VolumeId=[*]*"" (metric_name=""VolumeReadOps"" OR 
metric_name=""VolumeWriteOps"") 

         | stats sum(Sum) as io_count by metric_dimensions, metric_name | stats sum(io_count) as 
volume_io by metric_dimensions 

         | `aws-cloudwatch-dimension-rex(""VolumeId"", ""name"")` | table volume_io, name | outputlookup 
topology_volumeio_metrics"
CloudWatch: Topology Volume Traffic Metric Generator,,always,24h,"`aws-cloudwatch-ebs(""*"", ""*"")` metric_dimensions=""*VolumeId=[*]*"" metric_name=""Volume*Bytes"" 

         | stats sum(Sum) as network by metric_dimensions, metric_name | stats sum(network) as 
network_traffic by metric_dimensions 

         | `aws-cloudwatch-dimension-rex(""VolumeId"", ""name"")` | table network_traffic, name | 
outputlookup topology_volume_traffic_metrics"
Config Rules: Topology Config Rules Generator,,always,24h,"`aws-config-rule-sourcetype` source=""*:configRule:complianceDetail"" | rename 
EvaluationResultIdentifier.EvaluationResultQualifier.ResourceId as resource_id, 
EvaluationResultIdentifier.EvaluationResultQualifier.ConfigRuleName as rule_name | stats 
latest(ComplianceType) as compliance_type by resource_id, rule_name | table resource_id, rule_name, 
compliance_type | outputlookup topology_config_rules"
Config: Topology Daily Snapshot Generator,,always,24h,"`topology-history-index` [search `topology-daily-snapshot-index` earliest=-1d@d | stats count | eval 
earliest=if(count==0, 0, ""-1d@d"") | return earliest] latest=@d | append [search 
`topology-daily-snapshot-index` earliest=-1d@d] | dedup resourceId | search 
resourceStatus!=""ResourceDeleted"" | eval _time=relative_time(now(),""@d"") | table resourceArn, 
relationships, tags, resourceStatus, instanceStatus, instanceType, publicIp, privateIp, vpcId , 
resourceId, resourceName, awsAccountId, awsRegion, resourceType, attachedPolicies, userPolicies, 
groupPolicies, _time | collect index=aws_topology_daily_snapshot source=aws_topology_summary"
Config: Topology History Appender,,always,24h,"`aws-config-sourcetype` (resourceId=igw-* OR resourceId=vpc-* OR resourceId=i-* OR 
resourceId=subnet-* OR resourceId=vol-* OR resourceId=sg-* OR resourceId=eni-* OR resourceId=acl-* 
OR resourceId=rtb-* OR resourceType=AWS::ElasticLoadBalancingV2::LoadBalancer OR 
resourceType=AWS::IAM::*) [| inputlookup topology_history_checkpoint | rename earliestTimestamp as 
_index_earliest | return _index_earliest] | dedup resourceId | eval 
resourceName=if((isnull(resourceName) or resourceName==""""), 'tags.Name', resourceName), 
resourceName=if((isnull(resourceName) or resourceName==""""), 'configuration.groupName', 
resourceName), resourceName=if((isnull(resourceName) or resourceName==""""), resourceId, resourceName) 
| eval _time=_indextime, relationships=mvzip('relationships{}.resourceId', 'relationships{}.name'), 
tags=mvzip('configuration.tags{}.key', 'configuration.tags{}.value'), 
attachedPolicies=mvzip('configuration.attachedManagedPolicies{}.policyArn', 
'configuration.attachedManagedPolicies{}.policyName'), 
userPolicies=mvzip('configuration.userPolicyList{}.policyName', 
'configuration.userPolicyList{}.policyDocument'), 
groupPolicies=mvzip('configuration.groupPolicyList{}.policyName', 
'configuration.groupPolicyList{}.policyDocument') | eval relationships=mvfilter(match(relationships, 
"",Is*"") AND NOT match(relationships, "",Is attached to Volume""))  | rename configurationItemStatus as 
resourceStatus, configuration.state.name as instanceStatus, configuration.instanceType as 
instanceType, configuration.vpcId as vpcId, ARN as resourceArn, configuration.privateIpAddress as 
privateIp, configuration.publicIpAddress as publicIp | table resourceArn, relationships, tags, 
resourceStatus, instanceStatus, instanceType, publicIp, privateIp, vpcId , resourceId, resourceName, 
awsAccountId, awsRegion, resourceType, attachedPolicies, userPolicies, groupPolicies, 
configurationItemCaptureTime, _time | collect index=aws_topology_history source=aws_topology_summary 
| append [| makeresults count=1 | eval earliestTimestamp=floor(now()/3600)*3600 | table 
earliestTimestamp | outputlookup topology_history_checkpoint]"
Config: Topology History Generator,,always,24h,"`aws-config-sourcetype` (resourceId=igw-* OR resourceId=vpc-* OR resourceId=i-* OR 
resourceId=subnet-* OR resourceId=vol-* OR resourceId=sg-* OR resourceId=eni-* OR resourceId=acl-* 
OR resourceId=rtb-* OR resourceType=AWS::ElasticLoadBalancingV2::LoadBalancer OR 
resourceType=AWS::IAM::*) | dedup resourceId | search configurationItemStatus!=""ResourceDeleted"" | 
eval resourceName=if((isnull(resourceName) or resourceName==""""), 'tags.Name', resourceName), 
resourceName=if((isnull(resourceName) or resourceName==""""), 'configuration.groupName', 
resourceName), resourceName=if((isnull(resourceName) or resourceName==""""), resourceId, resourceName) 
| eval _time=_indextime, relationships=mvzip('relationships{}.resourceId', 'relationships{}.name'), 
tags=mvzip('configuration.tags{}.key', 'configuration.tags{}.value'), 
attachedPolicies=mvzip('configuration.attachedManagedPolicies{}.policyArn', 
'configuration.attachedManagedPolicies{}.policyName'), 
userPolicies=mvzip('configuration.userPolicyList{}.policyName', 
'configuration.userPolicyList{}.policyDocument'), 
groupPolicies=mvzip('configuration.groupPolicyList{}.policyName', 
'configuration.groupPolicyList{}.policyDocument') | eval relationships=mvfilter(match(relationships, 
"",Is*"") AND NOT match(relationships, "",Is attached to Volume""))  | rename configurationItemStatus as 
resourceStatus, configuration.state.name as instanceStatus, configuration.instanceType as 
instanceType, configuration.vpcId as vpcId, ARN as resourceArn, configuration.privateIpAddress as 
privateIp, configuration.publicIpAddress as publicIp | table resourceArn, relationships, tags, 
resourceStatus, instanceStatus, instanceType, publicIp, privateIp, vpcId , resourceId, resourceName, 
awsAccountId, awsRegion, resourceType, attachedPolicies, userPolicies, groupPolicies, 
configurationItemCaptureTime, _time | collect index=aws_topology_history source=aws_topology_summary 
| append [| makeresults count=1 | eval earliestTimestamp=floor(now()/3600)*3600 | table 
earliestTimestamp | outputlookup topology_history_checkpoint]"
Config: Topology Monthly Snapshot Generator,,always,24h,"`topology-daily-snapshot-index` earliest=-1d@d | table resourceArn, relationships, tags, 
resourceStatus, instanceStatus, instanceType, publicIp, privateIp, vpcId , resourceId, resourceName, 
awsAccountId, awsRegion, resourceType, attachedPolicies, userPolicies, groupPolicies, _time | 
collect index=aws_topology_monthly_snapshot source=aws_topology_summary"
Config: Topology Playback Appender,,always,24h,"`topology-history-index` configurationItemCaptureTime=* (resourceId=igw-* OR resourceId=vpc-* OR 
resourceId=i-* OR resourceId=subnet-* OR resourceId=vol-* OR resourceId=sg-* OR resourceId=eni-* OR 
resourceId=acl-* OR resourceId=rtb-*) [| inputlookup topology_playback_checkpoint | rename 
earliestTimestamp as earliest | return earliest]| eval indexTimestamp=floor(_time), 
_time=strptime(configurationItemCaptureTime, ""%Y-%m-%dT%H:%M:%S.%3NZ""), 
timestamp=floor(_time/60)*60, canMiss=if((indexTimestamp - timestamp) > 86400, 1, 0) | table 
relationships, resourceStatus, instanceStatus, vpcId , resourceId, resourceName, awsAccountId, 
awsRegion, resourceType, canMiss, timestamp, _time | collect index=aws_topology_playback 
source=aws_topology_summary | append [| makeresults count=1 | eval 
earliestTimestamp=floor(now()/3600)*3600 | table earliestTimestamp | outputlookup 
topology_playback_checkpoint]"
Count of total installs per Application each day for the last 7 days,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" SourceName=MsiInstaller EventCode=11707 

| rex field=Message ""(?s)Product: (?<product_name>.*) --"" 

| timechart span=1d count by product_name"
Count of total installs per user each day for the last 7 days,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" SourceName=MsiInstaller EventCode=11707 

| timechart count by User"
Count of total installs per user for the last 7 days,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" SourceName=MsiInstaller EventCode=11707 

| stats count by User 

| sort -count"
CP IPS Apache Attack,,always,24h,"index=prod_checkpoint sourcetype=cp_IPS attack_info=*Apache*

| stats count as Event by attack_info, attack, action

| sort -Event"
Dangerous file types report,All the DFT listed by mimecast to see how many have been reported,always,24h,"index=prod_mimecast splunkAccountCode=* mcType=ttp_ap result=* 

| eval temp=split(fileName, ""."") 

| eval Extension=mvindex(temp, -1) 

| search Extension IN ( 

""a6p"",

""ac"",

""acr"",

""action"",

""air"",

""apk"",

""app"",

""applescript"",

""awk"",

""bin"",

""cgi"",

""csh"",

""dek"",

""dld"",

""dll"",

""drv"",

""ds"",

""ebm"",

""elf"",

""emf"",

""esh"",

""ezs"",

""fky"",

""frs"",

""fxp"",

""gadget"",

""gpe"",

""gpu"",

""hms"",

""icd"",

""iim"",

""inx"",

""ipa"",

""ipf"",

""isu"",

""jar"",

""jsp"",

""jsx"",

""kix"",

""ksh"",

""lib"",

""mcr"",

""mel"",

""mem"",

""mpkg"",

""mpx"",

""mrc"",

""ms"",

""mxe"",

""obs"",

""ocx"",

""pas"",

""pcd"",

""pex"",

""pkg"",

""pl"",

""plsc"",

""pm"",

""prc"",

""prg"",

""pvd"",

""pwc"",

""py"",

""pyc"",

""pyo"",

""qpx"",

""rbx"",

""rgs"",

""rox"",

""rpj"",

""scar"",

""scpt"",

""script"",

""seed"",

""sh"",

""shb"",

""spr"",

""sys"",

""thm"",

""tlb"",

""tms"",

""u3p"",

""udf"",

""vbscript"",

""vdo"",

""vxd"",

""wcm"",

""widget"",

""workflow"",

""wpk"",

""ws"",

""xap"",

""xqt"",

""zlq""

)

| stats count(mcType) as Count by Extension 
"
Deep Security - All Security Events,All events from Deep Security's modules,always,24h,sourcetype=deepsecurity* sourcetype!=deepsecurity-system_events
Deep Security - Anti-Malware Events,Events generated by Deep Security's Anti-Malware module,always,24h,sourcetype=deepsecurity-antimalware
Deep Security - Application Control Events,Events generated by Deep Security's Application Control module,always,24h,sourcetype=deepsecurity-app_control
Deep Security - Firewall Events,Events generated by Deep Security's Firewall module,always,24h,sourcetype=deepsecurity-firewall
Deep Security - High Severity Events,All High and Critical severity events from Deep Security's modules,always,24h,sourcetype=deepsecurity* sourcetype!=deepsecurity-system_events cef_severity > 7
Deep Security - Integrity Monitoring Events,Events generated by Deep Security's Integrity Monitoring module,always,24h,sourcetype=deepsecurity-integrity_monitoring
Deep Security - Intrusion Prevention Events,Events generated by Deep Security's Intrusion Prevention module,always,24h,sourcetype=deepsecurity-intrusion_prevention
Deep Security - Log Inspection Events,Events generated by Deep Security's Log Inspection module,always,24h,sourcetype=deepsecurity-log_inspection
Deep Security - System Events,System events generated by Deep Security,always,24h,sourcetype=deepsecurity-system_events
Deep Security - Web Reputation Events,Events generated by Deep Security's Web Reputation module,always,24h,sourcetype=deepsecurity-web_reputation
DNS: Failing Domains,,always,24h,"`msad-index` eventtype=msad-dns-debuglog direction=""Snd"" response!=""NOERROR""|top 
questiontype,questionname,response|`fix-dnsname(questionname)`"
DNS: Top Failing Domains,,always,24h,"`msad-index` eventtype=msad-dns-debuglog direction=""Rcv"" response!=""NOERROR""|top 
questiontype,questionname|`fix-dnsname(questionname)`"
DNS: Top Hosts sending failing queries,,always,24h,"`msad-index` eventtype=msad-dns-debuglog direction=""Rcv"" response!=""NOERROR""|top src_ip"
DNS: Top Non-Authoritative Responses,,always,24h,"`msad-index` eventtype=msad-dns-debuglog direction=""Snd"" response!=""NOERROR"" flags!=""A*""|top 
questiontype,questionname|`fix-dnsname(questionname)`"
DNS: Top Querying Hosts,,always,24h,"`msad-index` eventtype=msad-dns-debuglog direction=""Rcv""|top src_ip"
DNS: Top Recursive Failure Domains,,always,24h,"`msad-index` eventtype=msad-dns-debuglog direction=""Rcv"" flags=""*DR"" response!=""NOERROR""|top 
questiontype,questionname|`fix-dnsname(questionname)`"
DNS: Top Requested Queries,,always,24h,"`msad-index` eventtype=msad-dns-debuglog direction=""Rcv""|top 
questiontype,questionname|`fix-dnsname(questionname)`"
DomainSelector_Lookup,,always,24h,"`msad-index` `domain-selector-search` 

| eval _key = host 

| outputlookup DomainSelector append=true"
DomainSelector_Lookup_Migrate,,always,24h,"| outputlookup DomainSelector 

| inputlookup append=true DomainSelector.csv 

| eval _key = host 

| outputlookup DomainSelector"
EntityNameLookupBuilder,,always,24h,"`dynatrace_index` sourcetype=dynatrace:entity | stats values(displayName) as displayName, 
values(discoveredName) as discoveredName by entityId | outputlookup entityNames"
Errors in the last 24 hours,,always,24h,error OR failed OR severe OR ( sourcetype=access_* ( 404 OR 500 OR 503 ) )
Errors in the last hour,,always,24h,error OR failed OR severe OR ( sourcetype=access_* ( 404 OR 500 OR 503 ) )
Event categories and counts by host for the last 30 days,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" 

| fields host, TaskCategory 

| stats count as EvtCounts by host, TaskCategory 

| sort -EvtCounts 

| eval EvtCatCnt = TaskCategory."" ("".EvtCounts."")"" 

| stats sum(EvtCounts) as Total_Events, values(EvtCatCnt) as Event_Category_Count by host 

| sort -Total_Events 

| eval Host_Count = host."" ("".Total_Events."")"" 

| table Host_Count, Event_Category_Count"
Event severity counts by host for the last 24 hours,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" (EventType=2 OR EventType=3 OR EventType=1) 

| eval EventSeverity=case(EventType == 2, ""Error"", EventType == 3,""Warning"", EventType == 1, 
""Critical"") 

| eval host=upper(host) 

| stats count by host EventSeverity 

| xyseries host EventSeverity count 

| eval t=1 

| addcoltotals 

| sort t desc 

| eval host = if(t>1,""Totals"",host) 

| fields - t 

| table host *"
Event severity counts by host for the last 30 days,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" (EventType=2 OR EventType=3 OR EventType=1) 

| eval EventSeverity=case(EventType == 2, ""Error"", EventType == 3,""Warning"", EventType == 1, 
""Critical"") 

| eval host=upper(host) 

| stats count by host EventSeverity 

| xyseries host EventSeverity count 

| eval t=1 

| addcoltotals 

| sort t desc 

| eval host = if(t>1,""Totals"",host) 

| fields - t 

| table host *"
Event severity counts by host for the last 7 days,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" (EventType=2 OR EventType=3 OR EventType=1) 

| eval EventSeverity=case(EventType == 2, ""Error"", EventType == 3,""Warning"", EventType == 1, 
""Critical"") 

| eval host=upper(host) 

| stats count by host EventSeverity 

| xyseries host EventSeverity count 

| eval t=1 

| addcoltotals 

| sort t desc 

| eval host = if(t>1,""Totals"",host) 

| fields - t 

| table host *"
External Users Added to Teams,,always,24h,"`m365_default_index` sourcetype=""o365:management:activity"" Workload=MicrosoftTeams 
Operation=MemberAdded Members{}.UPN=*\#ext\#*

| rename Members{}.UPN AS memberUpn

| eval UserId =lower(UserId)  | rex field=UserId ""@(?<src_domain>.*)""

| eval memberUpn =lower(memberUpn)  | rex field=memberUpn ""(?<email>.*)\#ext\#"" | rex mode=sed 
field=email ""s/_(?!.*_)/@/g"" | rex field=email ""@(?<target_domain>.*)"" 

| where target_domain != src_domain

| stats values(email), values(target_domain) by CreationTime, CommunicationType, ItemName, UserId, 
src_domain, 

| fields CreationTime, values(email) CommunicationType, ItemName, UserId  values(target_domain)

| rename values(memberUpn) AS ""Member Added"", CreationTime AS ""Timestamp"" ItemName AS ""Item Name"" 
UserId AS ""Added By"" values(email) AS ""External User "" CommunicationType AS ""Added To"" 
values(target_domain) AS ""External Domain"" 

| sort - Timestamp"
Generate Data Availability ML Model for Latency,,always,24h,"| tstats count values(source) as source avg(_indextime) as indextime where 

    [| inputlookup data_inventory_products_lookup 

    | eval category=case(isnotnull(daily_event_volume) AND daily_event_volume > 50000, 
""highvolumelowlatency"", stage!=""step-sourcetype"", ""normal"", 1=1,""unused"") 

    | lookup SSE-data-availability-products-categorization productId OUTPUT category as 
category_override 

    | eval category=coalesce(category_override, category) 

    | search category=""highvolumelowlatency"" OR category=""normal"" 

    | eval termsearch = if(len(termsearch)>0,""("" . termsearch . "")"",null()) 

    | stats values(termsearch) as search 

    | eval search=""("" . mvjoin(search, "" OR "") . "")"" ] earliest=-30d by index sourcetype _time 
span=5m 

| eval reduce_factor_to_limit_memory_explosion = 10

| where random()%reduce_factor_to_limit_memory_explosion = 1 

| eval lag = indextime - _time - 180 

| stats values(lag) as lag values(source) as source by index sourcetype _time 

| where lag > 0 

| eval productId=null, 

    [| inputlookup data_inventory_products_lookup 

    | eval category=case(isnotnull(daily_event_volume) AND daily_event_volume > 50000, 
""highvolumelowlatency"", stage!=""step-sourcetype"", ""normal"", 1=1,""unused"") 

    | lookup SSE-data-availability-products-categorization productId OUTPUT category as 
category_override 

    | eval category=coalesce(category_override, category) 

    | search category=""highvolumelowlatency"" OR category=""normal"" 

    | eval termsearch = if(len(termsearch)>0,""("" . termsearch . "")"",null()) 

    | rex field=termsearch mode=sed ""s/\""/\\\""/g"" 

    | eval search = ""productId=if(searchmatch(\"""" . termsearch . ""\""), mvappend(productId, \"""" . 
productId . ""\""), productId)"" 

    | stats values(search) as search 

    | eval search=mvjoin(search, "", "")]

| mvexpand productId

| fit DensityFunction lag  by productId upper_threshold=0.01 dist=norm into app:sse_event_lag_model

| stats count as baseline_num_data_samples avg(lag) as baseline_avg_lag min(_time) as 
baseline_earliest max(_time) as baseline_latest by productId | eval baseline_update_last_run = 
now(), baseline_lag_at_last_update = now() - baseline_latest  | outputlookup 
SSE-data_availability_latency_status.csv"
Generate MITRE Enterprise List,This search formats the MITRE ATT&CK framework table into a list format.,always,24h,"| mitremap output=""list"""
Generic event counts,Event search try,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" 

| stats count by LogName, EventCode, Keywords, TaskCategory, Type"
Get All Applications,,always,24h,"| rest /services/apps/local | search disabled=0 details=""http*""

| table label description details version update.version"
getIndexesList,"Get indexes information from the indexers, this search is needed to populate the cloud indexes manager page.",always,24h,"| rest splunk_server=idx* /services/data/indexes datatype=all search=""isInternal=0"" f=eai:acl* 
f=datatype f=storage_tier f=disabled f=frozenTimePeriodInSecs f=isVirtual f=max*SizeMB f=archiver* 
f=title f=metric.timestampResolution 

| stats values(eai:acl.app) as eai:acl.app 

        values(datatype) as datatype 

        values(storage_tier) as storage_tier 

        values(disabled) as disabled 

        values(frozenTimePeriodInSecs) as frozenTimePeriodInSecs 

        values(isVirtual) as isVirtual 

        values(maxTotalDataSizeMB) as maxTotalDataSizeMB 

        values(maxGlobalDataSizeMB) as maxGlobalDataSizeMB 

        values(maxGlobalRawDataSizeMB) as maxGlobalRawDataSizeMB 

        values(archiver.selfStorageProvider) as archiver.selfStorageProvider 

        values(archiver.selfStorageBucket) as archiver.selfStorageBucket 

        values(archiver.selfStorageBucketFolder) as archiver.selfStorageBucketFolder 

        values(archiver.coldStorageProvider) as archiver.coldStorageProvider 

        values(archiver.coldStorageRetentionPeriod) as archiver.coldStorageRetentionPeriod 

        values(archiver.enableDataArchive) as archiver.enableDataArchive 

        values(archiver.maxDataArchiveRetentionPeriod) as archiver.maxDataArchiveRetentionPeriod 

        values(metric.timestampResolution) as metric.timestampResolution 

        by title 

| join type=outer title [rest splunk_server=local count=0 /services/data/distributed-indexes 

                         | fields title rawSizeBytes eventCount startEpoch endEpoch 

                         | rename eventCount AS totalEventCount startEpoch AS minTime endEpoch AS 
maxTime] 

| eval totalRawSizeMB = if(isnotnull(rawSizeBytes), round(rawSizeBytes / 1024 / 1024, 2), 0) 

| eval totalEventCount = if(isnotnull(totalEventCount), totalEventCount, 0)"
getMetricTransformsList,Get the list of metric schema transforms for all the indexers,always,24h,|rest splunk_server=idx*  /services/data/transforms/metric-schema
Histogram of delay in seconds,,always,24h,"index=sample | fields + delay, count | convert dur2sec(delay) | sort - delay | top delay limit=10"
HostToDomain_Lookup_Migrate,,always,24h,"| outputlookup HostToDomain 

| inputlookup append=true DomainList.csv 

| eval _key = host 

| outputlookup HostToDomain"
HostToDomain_Lookup_Update,,always,24h,"`msad-index` `domain-list` 

| sort host 

| eval _key = host 

| outputlookup HostToDomain append=true"
Insights: EBS,,always,24h,"earliest=-1d `aws-description-resource((aws_account_id=""*""),  (region=""**"") , ""ec2_volumes"")` 

                         | where status!=""in-use""

                         | eval abnormaltype=""Unused"", Severity=1| append[search earliest=-1d 
`aws-description-resource((aws_account_id=""*""),  (region=""**"") , ""ec2_volumes"")` 

                         | where type=""io1""

                         | where status=""in-use""

                         | rename attach_data.instance_id as instanceId

                         | join instanceId type=""inner"" [search earliest=-1d 
`aws-description-resource((aws_account_id=""*""),  (region=""**"") , ""ec2_instances"")`

                         | where ebs_optimized=""false"" | rename id as instanceId ]

                         | eval abnormaltype=""Non-Optimized"", Severity=1]| append[search 
earliest=-1d `aws-description-resource((aws_account_id=""*""),  (region=""**"") , ""ec2_volumes"")` 

                             | join id type=""outer"" [search earliest=-1d 
`aws-description-resource((aws_account_id=""*""),  (region=""**"") , ""ebs_snapshots"")` 

                             | rename volume_id as id, id as snapshotId] 

                             | eval snapTime=strptime(start_time, ""%Y-%m-%dT%T"") 

                             | eval diff=round((now()-snapTime)/86400,0) 

                             | where NOT (diff>0 AND diff<30)

                             | eval abnormaltype=""No Recent Snapshot"", Severity=2]| append[search 
earliest=-7d@h `aws-cloudwatch-ebs(""*"", ""*"")` (metric_name=""VolumeWriteOps"" OR 
metric_name=""VolumeReadOps"")

                         | eval Average = Average / period

                         | stats avg(Average) as iops by metric_dimensions 

                         | eval iops = round(iops*2, 2)

                         | sort +iops

                         | `aws-cloudwatch-dimension-rex(""VolumeId"", ""id"")` 

                         | join type=inner id [search earliest=-1d 
`aws-description-resource((aws_account_id=""*""),  (region=""**"") , ""ec2_volumes"")` 

                         | rename iops as piops]

                         | where piops != ""null""

                         | where type=""io1""

                         | where iops/piops < 0.1

                         | eval abnormaltype=""Small IOPS"", Severity=3]| append[search earliest=-7d@h 
`aws-cloudwatch-ebs(""*"", ""*"")` (metric_name=""VolumeWriteOps"" OR metric_name=""VolumeReadOps"")

                         | eval Average = Average / period

                         | stats avg(Average) as iops by metric_dimensions 

                         | eval iops = round(iops*2, 2)

                         | sort -iops

                         | `aws-cloudwatch-dimension-rex(""VolumeId"", ""id"")` 

                         | join type=inner id [search earliest=-1d 
`aws-description-resource((aws_account_id=""*""),  (region=""**"") , ""ec2_volumes"")` 

                         | rename iops as piops]

                         | where piops != ""null""

                         | where iops/piops > 0.9

                         | eval abnormaltype=""Large IOPS"", Severity=3] | stats count by account_id 
region"
Insights: EIP,,always,24h,"`aws-unused-eip(""*"", ""*"")` | search insight=""*"" | stats count by account_id region"
Insights: ELB,,always,24h,"`aws-unused-elb((""*""), (""*""))` | append [search earliest=-1d `aws-not-autoscaling-elb((""*""), 
(""*""))`] | append [search earliest=-1d `aws-not-enough-request-elb((""*""), (""*""))`] | append [search 
earliest=-1d `aws-not-cross-zone-elb((""*""), (""*""))`] | append [search earliest=-1d 
`aws-insecure-listener-elb((""*""), (""*""))`] | stats count by account_id region"
Insights: IAM,,always,24h,"`aws-password-policy-iam((""*""))` | append [search earliest=-1d `aws-key-rotation-iam((""*""))`] | 
append [search earliest=-1d `aws-long-unused-iam((""*""))`] | stats count by account_id"
Insights: SG,,always,24h,"`aws-specific-ports-unrestricted-sg((""*""), (""*""))` | append [search earliest=-1d 
`aws-unrestricted-access-sg((""*""), (""*""))`] | append [search earliest=-1d `aws-unused-sg((""*""), 
(""*""))`] | append [search earliest=-1d `aws-redundant-sg((""*""), (""*""))`] | append [search 
earliest=-1d `aws-large-number-rules-sg((""*""), (""*""))`] | stats count by account_id region"
instrumentation.anonymized.eventsByTime,,always,24h,"(index=_introspection OR index=_telemetry) sourcetype=splunk_telemetry source=""http-stream"" 
visibility=*anonymous* | append [| savedsearch instrumentation.licenseUsage]"
instrumentation.anonymous.firstEvent,,always,24h,"(index=_introspection OR index=_telemetry) sourcetype=splunk_telemetry source=""http-stream"" 
visibility=*anonymous* | append [savedsearch instrumentation.licenseUsage] | where date >= 
""$beginDate$"" AND date <= ""$endDate$"" | head 1"
instrumentation.authentication.jwt,,always,24h,"| rest splunk_server=local /services/properties/authorize/tokens_auth/disabled | table value | 
rename value as disabled | appendcols [| search index=_audit action=create_token | stats count | 
rename count as created] | appendcols [| rest splunk_server=local 
/services/configs/conf-authentication |  eval test=if(isnull(scriptPath), 0, 1) | table test | stats 
sum | rename sum(test) as scriptedExtensionsEnabled] | appendcols [| search index = _internal 
source=*/splunkd.log jsonwebtoken validation failed | stats count | rename count as failures] | 
makejson output=data"
instrumentation.deployment.app,,always,24h,"| rest /services/apps/local | eval _time=now() | fields splunk_server title updated version disabled 
| eval 
data=""{\""host\"":\""""+splunk_server+""\"",\""name\"":\""""+title+""\"",\""version\"":\""""+coalesce(version, 
"""")+""\"",\""enabled\"":""+if(disabled=0, ""true"", ""false"")+""}"" | eval date=strftime(_time, ""%Y-%m-%d"") | 
fields data _time date"
instrumentation.deployment.clustering.indexer,,always,24h,"| makeresults annotate=true | append [localop | rest /services/cluster/config] | sort -mode | head 1 
| eval 
data=if(mode==""master"",""{\""host\"":\""""+splunk_server+""\"",\""timezone\"":\""""+strftime(now(),""%z"")+""\"",\""
multiSite\"":""+multisite+"",\""summaryReplication\"":""+if(summary_replication=1,""true"",""false"")+"",\""enab
led\"":true,\""replicationFactor\"":""+tostring(replication_factor)+"",\""siteReplicationFactor\"":""+coales
ce(replace(replace(site_replication_factor, ""origin"", ""\""origin\""""), ""total"", ""\""total\""""), 
""null"")+"",\""siteSearchFactor\"":""+coalesce(replace(replace(site_search_factor, ""origin"", 
""\""origin\""""), ""total"", 
""\""total\""""),""null"")+"",\""searchFactor\"":""+tostring(search_factor)+""}"",""{\""host\"":\""""+splunk_server+""
\"",\""timezone\"":\""""+strftime(now(),""%z"")+""\"",\""enabled\"":false}"") | eval _time=now() | eval 
date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.deployment.featureFlags,,always,24h,"| rest /services/properties splunk_server=local | rename title as conf |  map maxsearches=200 
search=""| rest /services/properties/$conf$ fillContents=1 | rename title as featureFlag  | search 
featureFlag=_feature-flag*"" | fields featureFlag, name, creationDate, disabled, description |  
makejson featureFlag, name, description, disabled, creationDate output=data | outputtelemetry 
input=data anonymous=true support=true component=""deployment.featureFlags"" optinrequired=3 
type=event"
instrumentation.deployment.forwarders,,always,24h,"index=_internal source=*metrics.log* TERM(group=tcpin_connections) (TERM(connectionType=cooked) OR 
TERM(connectionType=cookedSSL)) fwdType=* guid=* | rename sourceIp as forwarderHost | eval 
connectionType=case(fwdType==""uf"" or fwdType==""lwf"" or fwdType==""full"", fwdType, 1==1,""Splunk 
fwder"") | eval version=if(isnull(version),""pre 4.2"",version) | bin _time span=1d | stats sum(kb) as 
kb, latest(connectionType) as connectionType, latest(arch) as arch, latest(os) as os, 
latest(version) as version latest(forwarderHost) as forwarderHost by guid _time | stats 
estdc(forwarderHost) as numHosts estdc(guid) as numInstances 
`instrumentation_distribution_values(kb)` by connectionType arch os version _time | eval 
data=""{\""hosts\"":""+tostring(numHosts)+"",\""instances\"":""+tostring(numInstances)+"",\""architecture\"":\""
""+arch+""\"",\""os\"":\""""+os+""\"",\""splunkVersion\"":\""""+version+""\"",\""type\"":\""""+connectionType+""\"",\""byt
es\"":{"" + `instrumentation_distribution_strings(""kb"",1024,0)` + ""}}"" | eval date=strftime(_time, 
""%Y-%m-%d"") | fields _time date data"
instrumentation.deployment.index,,always,24h,"| rest /services/data/indexes | join type=outer splunk_server title [| rest 
/services/data/indexes-extended] 

| append [| rest /services/data/indexes datatype=metric | join type=outer splunk_server title [| 
rest /services/data/indexes-extended datatype=metric]] 

| eval warm_bucket_size = if(isnotnull('bucket_dirs.home.warm_bucket_size'), 
'bucket_dirs.home.warm_bucket_size', 'bucket_dirs.home.size') 

| eval cold_bucket_size_gb = tostring(round(coalesce('bucket_dirs.cold.bucket_size', 
'bucket_dirs.cold.size', 0) / 1024, 2)) 

| eval warm_bucket_size_gb = tostring(round(coalesce(warm_bucket_size,0) / 1024, 2)) 

| eval hot_bucket_size = tostring(round(coalesce(total_size / 1024 - cold_bucket_size_gb - 
warm_bucket_size_gb, 0),2)) 

| eval hot_bucket_size_gb = tostring(round(coalesce(hot_bucket_size,0) / 1024, 2)) 

| eval thawed_bucket_size_gb = tostring(round(coalesce('bucket_dirs.thawed.bucket_size', 
'bucket_dirs.thawed.size',0) / 1024, 2)) 

| eval warm_bucket_count = tostring(coalesce('bucket_dirs.home.warm_bucket_count', 0)) 

| eval hot_bucket_count = tostring(coalesce('bucket_dirs.home.hot_bucket_count',0)) 

| eval cold_bucket_count = tostring(coalesce('bucket_dirs.cold.bucket_count',0)) 

| eval thawed_bucket_count = tostring(coalesce('bucket_dirs.thawed.bucket_count',0)) 

| eval home_event_count = tostring(coalesce('bucket_dirs.home.event_count',0)) 

| eval cold_event_count = tostring(coalesce('bucket_dirs.cold.event_count',0)) 

| eval thawed_event_count = tostring(coalesce('bucket_dirs.thawed.event_count',0)) 

| eval home_bucket_capacity_gb = coalesce(if('homePath.maxDataSizeMB' == 0, ""\""unlimited\"""", 
round('homePath.maxDataSizeMB' / 1024, 2)), ""\""unlimited\"""") 

| eval cold_bucket_capacity_gb = coalesce(if('coldPath.maxDataSizeMB' == 0, ""\""unlimited\"""", 
round('coldPath.maxDataSizeMB' / 1024, 2)), ""\""unlimited\"""") 

| eval currentDBSizeGB = tostring(round(coalesce(currentDBSizeMB,0) / 1024, 2)) 

| eval maxTotalDataSizeGB = tostring(if(maxTotalDataSizeMB = 0, ""unlimited"", 
coalesce(round(maxTotalDataSizeMB / 1024, 2), ""null""))) 

| eval minTime = tostring(coalesce(strptime(minTime,""%Y-%m-%dT%H:%M:%S%z""),""null"")) 

| eval maxTime = tostring(coalesce(strptime(maxTime,""%Y-%m-%dT%H:%M:%S%z""),""null"")) 

| eval total_bucket_count = tostring(if(isnotnull(total_bucket_count), total_bucket_count, 0)) 

| eval totalEventCount = tostring(coalesce(totalEventCount, 0)) 

| eval total_raw_size_gb = tostring(coalesce(round(total_raw_size / 1024, 2), ""null"")) 

| eval timeResolution = IF('metric.timestampResolution'==""ms"",""millisec"",""sec"") 

| eval index_type = coalesce(datatype ,""event"") 

| rename eai:acl.app as App 

| eval _time=now() 

| fields splunk_server, title,index_type, timeResolution,

currentDBSizeGB, totalEventCount, total_bucket_count, 

total_raw_size_gb, minTime, maxTime, home_bucket_capacity_gb, cold_bucket_capacity_gb, 

hot_bucket_size_gb, warm_bucket_size_gb, cold_bucket_size_gb, thawed_bucket_size_gb, 

hot_bucket_count, warm_bucket_count, cold_bucket_count, thawed_bucket_count, 

home_event_count, cold_event_count, thawed_event_count, 

maxTotalDataSizeGB, maxHotBuckets, maxWarmDBCount App _time 

| eval 
data=""{\""host\"":\""""+splunk_server+""\"",\""name\"":\""""+title+""\"",\""type\"":\""""+index_type+""\"",\""timeResol
ution\"":\""""+timeResolution+""\"",\""app\"":\""""+App+""\"",\""total\"":{\""currentDBSizeGB\"":""+currentDBSizeGB+
"",\""maxDataSizeGB\"":""+maxTotalDataSizeGB+"",\""events\"":""+totalEventCount+"",\""buckets\"":""+total_bucket
_count+"",\""rawSizeGB\"":""+total_raw_size_gb+"",\""minTime\"":""+minTime+"",\""maxTime\"":""+maxTime+""},\""buck
ets\"":{\""homeCapacityGB\"":""+home_bucket_capacity_gb+"",\""homeEventCount\"":""+home_event_count+"",\""cold
CapacityGB\"":""+cold_bucket_capacity_gb+"",\""hot\"":{\""sizeGB\"":""+hot_bucket_size_gb+"",\""count\"":""+hot_
bucket_count+"",\""max\"":""+maxHotBuckets+""},\""warm\"":{\""sizeGB\"":""+warm_bucket_size_gb+"",\""count\"":""+w
arm_bucket_count+""},\""cold\"":{\""sizeGB\"":""+cold_bucket_size_gb+"",\""count\"":""+cold_bucket_count+"",\""e
vents\"":""+cold_event_count+""},\""thawed\"":{\""sizeGB\"":""+thawed_bucket_size_gb+"",\""count\"":""+thawed_bu
cket_count+"",\""events\"":""+thawed_event_count+""}}}"" 

| eval date=strftime(_time, ""%Y-%m-%d"") | fields data _time date"
instrumentation.deployment.node,,always,24h,"index=_introspection sourcetype=splunk_disk_objects component::Partitions | bin _time span=1d | 
stats latest(data.free) as partitionFree, latest(data.capacity) as partitionCapacity by host 
data.fs_type data.mount_point _time | eval 
partitionUtilized=round(1-partitionFree/partitionCapacity,2) | eval 
partitions=""{\""utilization\"":""+`instrumentation_number_format(partitionUtilized,1,2)`+"",\""capacity\""
:""+`instrumentation_number_format(partitionCapacity,1048576,0)`+"",\""fileSystem\"":\""""+'data.fs_type' 
+ ""\""}"" | stats delim="","" values(partitions) as partitions by host _time | rename _time as date | 
mvcombine partitions | rename date as _time | join type=left host _time [search index=_introspection 
sourcetype=splunk_resource_usage component::Hostwide | eval cpuUsage = 'data.cpu_system_pct' + 
'data.cpu_user_pct' | rename data.mem_used as memUsage | bin _time span=1d | stats 
latest(data.cpu_count) as coreCount, latest(data.virtual_cpu_count) as virtualCoreCount, 
latest(data.mem) as memAvailable, latest(data.splunk_version) as splunkVersion, 
latest(data.cpu_arch) as cpuArch, latest(data.os_name) as osName, latest(data.os_name_ext) as 
osNameExt, latest(data.os_version) as osVersion, `instrumentation_distribution_values(cpuUsage)`, 
`instrumentation_distribution_values(memUsage)`, latest(data.instance_guid) as guid by host _time] | 
fillnull value=""null"" coreCount virtualCoreCount memAvailable | eval 
splunkVersion=coalesce(""\""""+splunkVersion+""\"""", ""null""), cpuArch=coalesce(""\""""+cpuArch+""\"""", 
""null""), osName=coalesce(""\""""+osName + ""\"""", ""null""), osNameExt=coalesce(""\""""+osNameExt+""\"""", 
""null""), osVersion=coalesce(""\""""+osVersion+""\"""", ""null""), guid=coalesce(""\""""+guid+""\"""", ""null"") | 
eval data = ""{\""guid\"":""+guid+"",\""host\"":\""""+replace(host,""\"""", ""\\\"""")+""\"",\""partitions\"": "" + 
coalesce(""["" + partitions + ""]"", ""null"") + "",\""cpu\"":{\""architecture\"":""+cpuArch+"",\""coreCount\"":"" + 
tostring(coreCount)+ "",\""virtualCoreCount\"":""+tostring(virtualCoreCount)+"",\""utilization\"":{"" + 
`instrumentation_distribution_strings(""cpuUsage"",.01,2)` + ""}},\""memory\"":""+""{\""capacity\"":""+ 
`instrumentation_number_format(memAvailable,1048576,0)`+"",\""utilization\"":{"" + 
`instrumentation_distribution_strings(""memUsage"",1/memAvailable,2)` + 
""}},\""os\"":""+osName+"",\""osExt\"":""+osNameExt + 
"",\""osVersion\"":""+osVersion+"",\""splunkVersion\"":""+splunkVersion+""}"" | eval date=strftime(_time, 
""%Y-%m-%d"") | fields _time date data"
instrumentation.lastSent,,always,24h,"index=_telemetry source=telemetry sourcetype=splunk_telemetry_log status=success | fillnull 
value=anonymous visibility | eval anonymous_send_time = if(visibility LIKE ""%anonymous%"", _time, 
null) | eval license_send_time = if(visibility LIKE ""%license%"", _time, null) | eval 
support_send_time = if(visibility LIKE ""%support%"", _time, null) | stats latest(anonymous_send_time) 
as latest_anonymous_send_time latest(license_send_time) as latest_license_send_time 
latest(support_send_time) as latest_support_send_time"
instrumentation.license.firstEvent,,always,24h,"| savedsearch instrumentation.licenseUsage | where date >= ""$beginDate$"" AND date <= ""$endDate$"" | 
head 1"
instrumentation.licenseUsage,,always,24h,"NOT() | append [search index=_telemetry type=RolloverSummary | eval date=strftime(_time-43200, 
""%Y-%m-%d"") | eval 
licenseIDs=coalesce(replace(replace(replace(replace(licenseGuids,""\["",""[\""""),""\]"",""\""]""),"","",""\"",\""""
),"" "", """"),""null""), subgroup_id=coalesce(subgroupId, ""Production""), 
group_id=coalesce(""\""""+licenseGroup+""\"""", ""null""), lmGuid=coalesce(""\""""+guid+""\"""", ""null""), 
productType=coalesce(""\""""+productType+""\"""", ""null""), 
type_id=if(substr(stack,1,16)=""fixed-sourcetype"", ""fixed-sourcetype"",stack) | stats max(_time) as 
lastTime latest(stacksz) as stack_quota, latest(poolsz) as pool_quota, sum(b) as consumption by pool 
stack host lmGuid licenseIDs type_id group_id subgroup_id productType date | rename stack as 
stack_id | eval pool=""{\""quota\"":"" + pool_quota+"",\""consumption\"":""+consumption+""}"" | stats 
delim="","" values(pool) as pools, max(lastTime) as lastTime max(stack_quota) as stack_quota 
sum(consumption) as stack_consumption by stack_id group_id subgroup_id type_id lmGuid host 
licenseIDs productType date | mvcombine pools | eval 
_raw=""{\""component\"":\""licensing.stack\"",\""data\"":{\""host\"":\""""+host+""\"",\""guid\"":""+lmGuid+"",\""name\
"":\""""+replace(stack_id,""\"""", ""\\\"""")+""\"",\""type\"":\"""" + type_id + ""\"",\""subgroup\"":\"""" + subgroup_id 
+ ""\"",\""product\"":""+productType+"",\""quota\"":"" + 
stack_quota+"",\""consumption\"":""+stack_consumption+"",\""pools\"":[""+pools+""],\""licenseIDs\"":""+licenseID
s+""}, \""date\"":\""""+date+""\"",\""visibility\"":\""anonymous,license\""}"", _time=lastTime]"
instrumentation.licensing.stack,,always,24h,"index=_telemetry source=*license_usage_summary.log* sourcetype=splunkd TERM(type=RolloverSummary) | 
eval date=strftime(_time, ""%m-%d-%Y""), 
licenseIDs=coalesce(replace(replace(replace(replace(licenseGuids,""\["",""[\""""),""\]"",""\""]""),"","",""\"",\""""
),"" "", """"),""null""), subgroup_id=coalesce(subgroupId, ""Production""), 
group_id=coalesce(""\""""+licenseGroup+""\"""", ""null""), lmGuid=coalesce(""\""""+guid+""\"""", ""null""), 
productType=coalesce(""\""""+productType+""\"""", ""null""), 
type_id=if(substr(stack,1,16)=""fixed-sourcetype"", ""fixed-sourcetype"",stack) | stats latest(stacksz) 
as stack_quota, latest(poolsz) as pool_quota, sum(b) as consumption by pool stack host lmGuid 
licenseIDs type_id group_id subgroup_id productType date | rename stack as stack_id | eval 
pool=""{\""quota\"":"" + pool_quota+"",\""consumption\"":""+consumption+""}"" | stats delim="","" values(pool) 
as pools, max(stack_quota) as stack_quota sum(consumption) as stack_consumption by stack_id group_id 
subgroup_id type_id lmGuid host licenseIDs productType date | mvcombine pools | eval 
data=""{\""host\"":\""""+host+""\"",\""guid\"":""+lmGuid+"",\""name\"":\""""+replace(stack_id,""\"""", 
""\\\"""")+""\"",\""type\"":\"""" + type_id + ""\"",\""subgroup\"":\"""" + subgroup_id + 
""\"",\""product\"":""+productType+"",\""quota\"":"" + 
stack_quota+"",\""consumption\"":""+stack_consumption+"",\""pools\"":[""+pools+""],\""licenseIDs\"":""+licenseID
s+""}"" | eval _time=strptime(date, ""%m-%d-%Y"")-43200 | fields data _time"
instrumentation.performance.bundleReplication,,always,24h,"index=_internal source=*/metrics.log TERM(group=bundles_uploads) | bin _time span=1d | stats count 
as bundles_uploads_count avg(peer_count) as avg_peer_count avg(average_baseline_bundle_bytes) as 
avg_baseline_bundle_bytes max(average_baseline_bundle_bytes) as max_baseline_bundle_bytes 
avg(average_delta_bundle_bytes) as avg_delta_bundle_bytes max(average_delta_bundle_bytes) as 
max_delta_bundle_bytes sum(total_count) as total_count sum(delta_count) as total_delta_count 
sum(success_count) as total_success_count sum(baseline_count) as total_baseline_count 
sum(already_present_count) as total_already_present_count sum(total_msec_spent) as total_msec_spent 
sum(delta_msec_spent) as total_delta_msec_spent sum(total_bytes) as total_bytes sum(delta_bytes) as 
total_delta_bytes by host _time | makejson output=data | eval date=strftime(_time, ""%Y-%m-%d"") | 
fields _time date data"
instrumentation.performance.bundleReplicationCycle,,always,24h,"index=_internal source=*/metrics.log splunk_server=local TERM(group=bundle_replication) 
TERM(name=cycle_dispatch) 

| stats count(cycle_id) as cycleCount avg(peer_count) as avgPeerCount avg(peer_success_count) as 
avgPeerSuccessCount avg(replication_time_msec) as avgReplicationTimeMsec avg(bundle_bytes) as 
avgBundleBytes avg(delta_bundle_bytes) as avgDeltaBundleBytes 

| appendcols [| rest /services/search/distributed/bundle/replication/config splunk_server=local | 
fields replicationPolicy] 

| eval avgPeerCount=round(avgPeerCount,2) | eval avgPeerSuccessCount=round(avgPeerSuccessCount,2) 

| eval avgReplicationTimeMsec=round(avgReplicationTimeMsec,2) | eval 
avgBundleBytes=round(avgBundleBytes,2) | eval avgDeltaBundleBytes=round(avgDeltaBundleBytes,2) 

| makejson output=data | eval _time=now(), date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.performance.indexing,,always,24h,"index=_internal TERM(group=thruput) TERM(name=index_thruput) source=*metrics.log* | bin _time 
span=30s | stats sum(kb) as kb sum(instantaneous_kbps) as instantaneous_kbps by host _time | bin 
_time span=1d | stats sum(kb) as totalKB `instrumentation_distribution_values(instantaneous_kbps)` 
by host _time | eval data=""{\""host\"":\""""+host+""\"",\""thruput\"":{\""total\"":"" + 
tostring(round(totalKB*1024)) + "","" + 
`instrumentation_distribution_strings(""instantaneous_kbps"",1024,0)`+""}}"" | eval date=strftime(_time, 
""%Y-%m-%d"") | fields _time date data"
instrumentation.performance.search,,always,24h,"index=_audit sourcetype=audittrail TERM(action=search) TERM(info=completed) total_run_time=* | eval 
search_et=if(search_et=""N/A"", 0, search_et) | eval search_lt=if(search_lt=""N/A"", exec_time, 
min(exec_time,search_lt)) | eval timerange=search_lt-search_et | bin _time span=1d | stats 
latest(searched_buckets) as searched_buckets latest(total_slices) as total_slices latest(scan_count) 
as scan_count latest(timerange) as timerange latest(total_run_time) as runtime by search_id _time | 
stats `instrumentation_distribution_values(runtime)`, 
`instrumentation_distribution_values(searched_buckets)`, 
`instrumentation_distribution_values(total_slices)`, 
`instrumentation_distribution_values(scan_count)`, `instrumentation_distribution_values(timerange)` 
count as numSearches by _time | eval 
data=""{\""searches\"":""+tostring(numSearches)+"",\""latency\"":{""+`instrumentation_distribution_strings(""
runtime"",1,2)`+""},\""buckets\"":{""+`instrumentation_distribution_strings(""searched_buckets"",1,2)`+""},\
""slices\"":{""+`instrumentation_distribution_strings(""total_slices"",1,2)`+""},\""scanCount\"":{""+`instrum
entation_distribution_strings(""scan_count"",1,2)`+""},\""dayRange\"":{""+`instrumentation_distribution_st
rings(""timerange"",1/86400,2)`+""}}"" | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.reporting,,always,24h,"index=_telemetry source=telemetry sourcetype=splunk_telemetry_log | fields _raw | spath | eval 
time_formatted = strftime(_time, ""%Y-%m-%d %H:%M:%S"") | search (status=success OR status=failed)"
instrumentation.reporting.errors,,always,24h,"index=_telemetry source=telemetry sourcetype=splunk_telemetry_log status=failed 
visibility=*$visibility$*"
instrumentation.reportingErrorCount,,always,24h,"index=_telemetry source=telemetry sourcetype=splunk_telemetry_log status=failed | fillnull 
value=anonymous visibility | stats count(eval(visibility LIKE ""%anonymous%"")) as anonymous_errors 
count(eval(visibility LIKE ""%license%"")) as license_errors count(eval(visibility LIKE ""%support%"")) 
as support_errors"
instrumentation.support.eventsByTime,,always,24h,"(index=_introspection OR index=_telemetry) sourcetype=splunk_telemetry source=""http-stream"" 
visibility=*support* | append [| savedsearch instrumentation.licenseUsage]"
instrumentation.support.firstEvent,,always,24h,"(index=_introspection OR index=_telemetry) sourcetype=splunk_telemetry source=""http-stream"" 
visibility=*support* | append [savedsearch instrumentation.licenseUsage] | where date >= 
""$beginDate$"" AND date <= ""$endDate$"" | head 1"
instrumentation.topology.deployment.clustering.member,,always,24h,"| localop | rest /services/cluster/master/peers | eval 
data=""{\""master\"":\""""+splunk_server+""\"",\""member\"":{\""host\"":\""""+label+""\"",\""guid\"":\""""+title+""\"",\""
status\"":\""""+status+""\""},\""site\"":\""""+site+""\""}"" | where isnotnull(data) | eval _time=now() | eval 
date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.topology.deployment.clustering.searchhead,,always,24h,"| localop | rest /services/cluster/master/searchheads | where splunk_server!=label | eval 
data=""{\""master\"":\""""+splunk_server+""\"",\""searchhead\"":{\""host\"":\""""+label+""\"",\""guid\"":\""""+title+""\
"",\""status\"":\""""+status+""\""},\""site\"":\""""+site+""\""}"" | where isnotnull(data) | eval _time=now() | 
eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.topology.deployment.distsearch.peer,,always,24h,"| localop | rest /services/search/distributed/peers | eval 
data=""{\""host\"":\""""+splunk_server+""\"",\""peer\"":{\""host\"":\""""+peerName+""\"",\""guid\"":\""""+guid+""\"",\""st
atus\"":\""""+status+""\""}}"" | where isnotnull(data) | eval _time=now() | eval date=strftime(_time, 
""%Y-%m-%d"") | fields _time date data"
instrumentation.topology.deployment.licensing.slave,,always,24h,"| localop | rest /services/licenser/slaves | eval 
data=""{\""master\"":\""""+splunk_server+""\"",\""slave\"":{\""host\"":\""""+label+""\"",\""guid\"":\""""+title+""\"",\""p
ool\"":\""""+active_pool_ids+""\""}}"" | where isnotnull(data) | eval _time=now() | eval 
date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.topology.deployment.shclustering.member,,always,24h,"| localop | rest /services/shcluster/captain/members | eval 
data=""{\""site\"":\""""+site+""\"",\""captain\"":\""""+splunk_server+""\"",\""member\"":{\""host\"":\""""+label+""\"",\""
guid\"":\""""+title+""\"",\""status\"":\""""+status+""\""}}"" | where isnotnull(data) | eval _time=now() | eval 
date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.admissionRules.enabled,,always,24h,"NOT() | append [rest splunk_server=local /services/workloads/status/admission-control-status | 
fields enabled]"
instrumentation.usage.admissionRules.rules,,always,24h,"NOT() | append [rest splunk_server=local 
""/services/workloads/rules?workload_rule_type=search_filter"" | 
`hash_admission_rule_predicate(index)` | `hash_admission_rule_predicate(app)` | 
`hash_admission_rule_predicate(user)` | `hash_admission_rule_predicate(role)` | eval 
data=""\""""+sha1(title)+""\"":{\""predicate\"":\""""+predicate+""\""}"" | stats list(data) AS ruleList, count 
AS ruleTotal | eval ruleCombined=mvjoin(ruleList, "", "") | fields ruleTotal, ruleCombined]"
instrumentation.usage.admissionRules.rulesTriggered,,always,24h,"index=_internal sourcetype=wlm_monitor prefilter_action=filter | stats count by prefilter_rule | 
fields prefilter_rule, count | eval data=""{\""searchFilterRule\"":\""""+sha1(prefilter_rule)+""\"", 
\""filteredSearchesCount\"":\""""+count+""\""}"" | stats list(data) AS rulesTriggered, count AS 
rulesTriggeredTotal | eval rulesTriggeredCombined=mvjoin(rulesTriggered, "", "") | fields 
rulesTriggeredTotal, rulesTriggeredCombined"
instrumentation.usage.app.page,,always,24h,"index=_internal sourcetype=splunk_web_access uri_path=""/*/app/*/*"" NOT uri_path=""/*/static/*"" | eval 
uri_parts=split(uri_path, ""/""),locale=mvindex(uri_parts,1), app=mvindex(uri_parts,3), 
page=mvindex(uri_parts,4) | bin _time span=1d | eventstats estdc(user) as appUsers count as 
appOccurrences by app _time | bin _time span=1d | stats latest(locale) as locale count as 
occurrences estdc(user) as users by app page appUsers appOccurrences _time | sort app -occurrences | 
streamstats count as pageRank by app _time | where pageRank<=10 | eval 
data=""{\""app\"":\""""+app+""\"",\""page\"":\""""+page+""\"",\""locale\"":\""""+locale+""\"",\""occurrences\"":"" + 
tostring(occurrences) + "",\""users\"":"" + tostring(users) + ""}"" | eval 
data=if(pageRank==1,data+"";{\""app\"":\""""+app+""\"",\""locale\"":\""""+locale+""\"",\""occurrences\"":"" + 
tostring(appOccurrences) + "",\""users\"":"" + tostring(appUsers) + ""}"", data) | stats values(data) as 
data by app appOccurrences appUsers _time | sort _time -appOccurrences | streamstats count as 
appRank by _time | where appRank<=25 | mvexpand data | makemv delim="";"" data | mvexpand data | eval 
date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.bucketmerge.clustered,,always,24h,"index=_internal source=*mergebuckets.log* (""all peers"" action=merge OR action=dryrun) OR action=list 
| eval command=action | eval newBucketsCount=mergedBuckets | eval 
oldBucketsCount=totalBucketsToMerge | eval indexersCount=if(isnotnull(peers),peers,0) | eval 
bucketsFailedToMergeCount=if(isnotnull(bucketsUnableToMerge),bucketsUnableToMerge,0) |table command, 
newBucketsCount, oldBucketsCount, bucketsFailedToMergeCount, indexersCount | makejson command 
newBucketsCount oldBucketsCount bucketsFailedToMergeCount indexersCount output=""data"" | eval 
_time=now(), date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.bucketmerge.standalone,,always,24h,"index=_internal source=*splunkd-utility.log* component=BucketMergerCmd command=merge OR 
command=dryrun OR command=list | table command, newBucketsCount, oldBucketsCount, durationSec | 
makejson command newBucketsCount oldBucketsCount durationSec output=""data"" | eval _time=now(), 
date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.configaudit.info,,always,24h,"| rest splunk_server=local /services/config_audit/config | eval disabled='info.disabled', 
mode='info.mode', denylist='info.denylist', exclude_fields='info.exclude_fields', 
uses_inotify='info.uses_inotify' | makejson disabled, mode, denylist, exclude_fields, uses_inotify 
output=data | eval _time=now(), date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.configaudit.introspection,,always,24h,"index=_audit action=search info=granted (search=""*index=_c*"" OR search=""*index=*_configaudit*"") NOT 
(search=*""index=*_audit""*) | stats dc(user) AS ""user_count"" count AS ""total_search_count"" | eval 
_time=now() | eval date=strftime(_time, ""%Y-%m-%d"") | makejson user_count total_search_count 
output=data | fields data _time"
instrumentation.usage.configaudit.searches,,always,24h,"index=""_configaudit"" | top limit=500 data.action data.path data.changes{}.stanza 
data.changes{}.properties{}.name | rex field=data.path "".*\/etc\/*(?<path>.*)"" | eval path = 
""$SPLUNK_HOME/etc/"" + 'path' | eval stanza = 'data.changes{}.stanza' | eval prop = 
'data.changes{}.properties{}.name' | eval _time=now() | eval date=strftime(_time, ""%Y-%m-%d"") | 
makejson path stanza prop count output=data | fields data _time"
instrumentation.usage.durableSearch,,always,24h,"| rest servicesNS/-/-/admin/savedsearch | search NOT title=instrumentation.* AND NOT 
durable.track_time_type="""" | eval name=sha1(title), durableTrackTimeType='durable.track_time_type', 
durableLagTime='durable.lag_time', durableBackfillType='durable.backfill_type', 
durableMaxBackfillIntervals='durable.max_backfill_intervals', 
enableSummaryIndex=if('action.summary_index'==1, ""Yes"", ""No"")  | fields name, durableTrackTimeType, 
durableLagTime, durableBackfillType, durableMaxBackfillIntervals, enableSummaryIndex | makejson name 
durableTrackTimeType durableLagTime durableBackfillType durableMaxBackfillIntervals 
enableSummaryIndex output=""data"" | eval _time=now(), date=strftime(_time, ""%Y-%m-%d"") | fields _time 
date data"
instrumentation.usage.healthMonitor.currentState,,always,24h,"| rest /services/apps/local splunk_server=local | search title=search | rename version as 
splunk_version | fields splunk_version 

 | appendcols [| rest services/server/health-config/distributed_health_reporter splunk_server=local 
| eval dist_hr_enabled=if(isnull(disabled) or disabled=='' or disabled==0, 1, 0) | fields 
dist_hr_enabled] 

 | appendcols [| search index=_internal earliest=-1d source=*splunkd_ui_access.log 
(""server/health/splunkd/details"" OR ""server/health/deployment/details"") | stats count as 
click_count] 

 | appendcols [ 

    | rest services/server/health/splunkd/details splunk_server=local 

    | fields + features.* health | rename health as features.health 

    | fields - *.reasons.* *.messages.* 

    | foreach features.* [ eval newname=""splunkd.""+replace(lower(""<<MATCHSTR>>""), "" "", ""_"") | rex 
field=newname mode=sed ""s/features\.|\.health//g"" | eval {newname}='<<FIELD>>'] 

    | fields - features.*, newname 

    | transpose column_name=""features"" | rename ""row 1"" as current_color 

    | join type=outer features [ 

        | search index=_internal earliest=-1d source=*health.log component=PeriodicHealthReporter 

            | stats count as num,  values(color) as colors by node_path 

            | rename node_path as features 

            | eval colors = mvjoin(colors, "","") 

            | eval worst_color = if(match(colors, ""red""), ""red"", (if(match(colors, ""yellow""), 
""yellow"", ""green""))) 

            | fields features, num, colors, worst_color 

    ] 

    | sort by features 

    | eval nodes="""", combin_column=1 

    | foreach features* [eval nodes = ""{\""nodePath\"": \"""" + '<<FIELD>>' + ""\"", \""color\"": \"""" + 
current_color + ""\"", \""worstColorInLast24Hours\"": \"""" + worst_color + ""\""}""] 

    | stats count list(nodes) as node_list by combin_column 

    | eval node_status = mvjoin(node_list, "", "") 

 ] 

 | eval data = ""{\""splunkVersion\"": \"""" + splunk_version + ""\"", \""distribuedHealthReporter\"": 
{\""enabled\"": "" + dist_hr_enabled + ""}, \""healthReportClicks\"": "" + click_count + "", \""nodeStatus\"": 
["" + node_status + ""]}"", _time=now(), date=strftime(_time, ""%Y-%m-%d"") 

 | fields data _time date"
instrumentation.usage.indexing.sourcetype,,always,24h,"index=_internal source=*metrics.log* TERM(group=per_sourcetype_thruput) | bin _time span=1d | stats 
sum(ev) as events, sum(kb) as size, estdc(host) as hosts by series _time | eval 
data=""{\""name\"":\""""+replace(series,""\"""", ""\\\"""") + 
""\"",\""events\"":""+tostring(events)+"",\""bytes\"":""+tostring(round(size*1024))+"",\""hosts\"":""+tostring(ho
sts)+""}"" | eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.kvstore,,always,24h,"|rest splunk_server=local /services/kvstore/info | eval data = ""{"" | foreach usage.* [eval data = 
data + ""\""<<FIELD>>\"":\"""" + '<<FIELD>>' + ""\"", "" ] | eval data = rtrim(data, "", "") + ""}"", _time = 
now(), date=strftime(_time, ""%Y-%m-%d"") | fields data _time date"
instrumentation.usage.kvstorebackuprestore,,always,24h,"index=_internal sourcetype=splunkd source=*splunkd.log* component=KVStoreBackupRestore (started AND 
archiveName AND method) | eval usageMethod = if(method==2, ""pointInTime"", ""nonPointInTime"") | stats 
count by usageMethod, action | makejson usageMethod, action, count output=data | eval _time=now(), 
date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.lookups.lookupDefinitions,,always,24h,"|rest splunk_server=local /services/admin/transforms-lookup getsize=true | eval name = 'eai:acl.app' 
+ ""."" + title | rename ""eai:acl.sharing"" AS sharing | eval is_temporal = if(isnull(time_field),0,1) 
| table name type is_temporal size sharing | join type=left name [rest splunk_server=local 
/services/admin/kvstore-collectionstats | table data | mvexpand data | spath input=data | table ns 
size | rename ns as name] | eval name=sha1(name) | makejson output=lookups | stats list(lookups) as 
lookups | eval data = ""{ \""lookups\"" : ["" . mvjoin(lookups,"","") . ""]}"", _time = now(), 
date=strftime(_time, ""%Y-%m-%d"") | fields data _time date"
instrumentation.usage.metrics,,always,24h,"| mcatalog values(_dims) values(sourcetype) values(metric_type) where index=* earliest=-15m by 
metric_name, index | stats count(values(_dims)) AS dimension_count list(values(sourcetype)) AS 
sourcetype list(values(metric_type)) AS metrictype by metric_name, index | eval metrictype = 
if(isnull(metrictype), ""N/A"", metrictype) | fields metric_name, index,  dimension_count, sourcetype, 
metrictype | eval data=""{ \""metricName\"" : \""""+metric_name+""\"", \""indexName\"" : \""""+index+""\"", 
\""dimensionCount\"" : \""""+dimension_count+""\"", \""sourcetype\"" : \""""+sourcetype+""\"", \""metricType\"" : 
\""""+metrictype+""\""}"", _time = now(), date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.rest,,always,24h,"index=_internal useragent=splunk-sdk* | eval endpointuri = case(like(uri_path, 
""%/authorization/capabilities%""), ""authorization/capabilities"", like(uri_path, 
""%/authorization/roles%""), ""authorization/roles"", like(uri_path, ""%/configs/conf-%s%""), 
""configs/conf-%s"", like(uri_path, ""%/properties/%""), ""properties"", like(uri_path, 
""%/saved/eventtypes%""), ""saved/eventtypes"", like(uri_path, ""%/deployment/client%""), 
""deployment/client"", like(uri_path, ""%/deployment/tenants%""), ""deployment/tenants"", like(uri_path, 
""%/deployment/server%""), ""deployment/server"", like(uri_path, ""%/deployment/serverclass%""), 
""deployment/serverclass"", like(uri_path, ""%/storage/passwords%""), ""storage/passwords"", 
like(uri_path, ""%/services/receivers/stream%""), ""/services/receivers/stream"", like(uri_path, 
""%/services/receivers/simple%""), ""/services/receivers/simple"", like(uri_path, 
""%/authentication/users%""), ""authentication/users"", like(uri_path, ""%/saved/searches%""), 
""saved/searches"", like(uri_path, ""%/data/modular_inputs%""), ""data/modular_inputs"", like(uri_path, 
""%/data/input%""), ""data/input"", like(uri_path, ""%/data/indexes%""), ""data/indexes"", like(uri_path, 
""%/alerts/fired_alerts%""), ""/alerts/fired_alerts"", like(uri_path, ""%messages%""), ""messages"", 
like(uri_path, ""%/search/jobs%""), ""search/jobs"" ) | stats count by endpointuri, status, method, 
useragent | eval _time=now(), date=strftime(_time, ""%Y-%m-%d"") | eval data=""{ \""endpointUri\"" : 
\""""+endpointuri+""\"", \""status\"" : \""""+status+""\"", \""method\"" : \""""+method+""\"", \""useragent\"" : 
\""""+useragent+""\"", \""count\"" : \""""+count+""\"" }"" | fields _time date data"
instrumentation.usage.rollup,,always,24h,"| rest servicesNS/-/-/catalog/metricstore/rollup | eval summaryCount=0, target_index_list="""", 
metricOverrideCount=0, name=title, hasDimensionList=if(isnull(dimensionList), ""false"", ""true"") | 
foreach summaries*rollupIndex [| eval summaryCount=if(isnull('<<FIELD>>'), summaryCount, 
summaryCount+1)] | foreach aggregation* [| eval metricOverrideCount=if(isnull('<<FIELD>>'), 
metricOverrideCount, metricOverrideCount+1)] | foreach summaries*rollupIndex [eval 
target_index_list=if(isnotnull('<<FIELD>>'), target_index_list."","".'<<FIELD>>', target_index_list)] 
| eval targetIndex=split('target_index_list',"","")| mvexpand  targetIndex | search NOT targetIndex="""" 
| join type=left targetIndex [| rest /services/data/indexes datatype=metric | eval 
targetIndexDBSizeGB_temp=tostring(round(coalesce(currentDBSizeMB,0) / 1024, 2)) | stats 
sum(targetIndexDBSizeGB_temp) as targetIndexDBSizeGB by title | rename title as targetIndex | fields 
targetIndex, targetIndexDBSizeGB] | fields name, defaultAggregation, summaryCount, hasDimensionList, 
metricOverrideCount, targetIndex, targetIndexDBSizeGB | eval 
targetIndexDBSizeGB=if(targetIndexDBSizeGB==0, ""0 (Check Index to Verify)"", targetIndexDBSizeGB) | 
makejson name defaultAggregation targetIndex targetIndexDBSizeGB hasDimensionList summaryCount(int) 
metricOverrideCount(int) output=""data"" | eval _time=now(), date=strftime(_time, ""%Y-%m-%d"") | fields 
_time date data"
instrumentation.usage.savedSearches.alerts,,always,24h,"| rest servicesNS/-/-/admin/savedsearch | search NOT title=instrumentation.* | eval 
name=sha1(title), alertConditionType=alert_type, actionList=actions, 
triggerMode=if('alert.digest_mode'==1, ""Once"", ""For each result""), alertSeverity='alert.severity', 
alertSuppress=if('alert.suppress'==1, ""Yes"", ""No""), 
alertSuppressGroup=if('alert.suppress.group_name'=="""", ""N/A"", sha1('alert.suppress.group_name')), 
alertTrackable=if('alert.track'==1, ""Yes"", ""No""), cronSchedule=cron_schedule, 
dispatchAllowPartialResults=if('dispatch.allow_partial_results'==1, ""Yes"", ""No"") | fields name, 
alertConditionType, actionList, triggerMode, alertSeverity, alertTrackable, alertSuppress, 
alertSuppressGroup, cronSchedule, dispatchAllowPartialResults | makejson name alertConditionType 
actionList triggerMode alertSeverity alertTrackable alertSuppress cronSchedule alertSuppressGroup 
dispatchAllowPartialResults output=""data"" | eval _time=now(), date=strftime(_time, ""%Y-%m-%d"") | 
fields _time date data"
instrumentation.usage.search.concurrent,,always,24h,"index=_introspection sourcetype=splunk_resource_usage component::PerProcess data.search_props.sid::* 
| bin _time span=10s | stats estdc(data.search_props.sid) AS concurrent_searches by _time host | bin 
_time span=1d | stats `instrumentation_distribution_values(concurrent_searches)` by host _time | 
eval data=""{\""host\"":\""""+host+""\"",\""searches\"":{"" + 
`instrumentation_distribution_strings(""concurrent_searches"",1,0)` +""}}"" | eval date=strftime(_time, 
""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.search.report_acceleration,,always,24h,"| localop | rest /servicesNS/-/-/admin/summarization | stats count as existing_report_accelerations, 
sum(summary.access_count) as access_count_of_existing_report_accelerations | makejson 
access_count_of_existing_report_accelerations(int) existing_report_accelerations(int) output=""data"" 
| eval _time=now(), date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.search.searchTelemetry,,always,24h,"index=_introspection sourcetype=search_telemetry | rename search_commands{}.name as name, 
search_commands{}.duration as duration | stats perc50(duration), perc90(duration), perc95(duration), 
perc99(duration), sum(duration) as totalDuration, sum(bytes_read) as sumBytesRead, count(bytes_read) 
as countBytesRead max(bytes_read) as maxBytesRead by name, type | makejson 
output=searchTypeInformation | fields searchTypeInformation | mvcombine delim="","" 
searchTypeInformation | nomv searchTypeInformation | eval _time=now(), date=strftime(_time, 
""%Y-%m-%d"") | eval data=""{ \""searchTypeInformation\"" : ["".searchTypeInformation.""]}"" | fields _time 
date data"
instrumentation.usage.search.searchtelemetry.sourcetypeUsage,,always,24h,"index=_audit | stats count(sourcetype_count__*) as * | makejson output=sourcetypeUsage | fields 
sourcetypeUsage | mvcombine delim="","" sourcetypeUsage | nomv sourcetypeUsage | eval _time=now(), 
date=strftime(_time, ""%Y-%m-%d"") | eval data=""{ \""sourcetypeUsage\"" : ["".sourcetypeUsage.""]}"" | 
fields _time date data"
instrumentation.usage.search.type,,always,24h,"index=_introspection sourcetype=splunk_resource_usage component::PerProcess data.search_props.sid::* 
| rename data.search_props.type as searchType | bin _time span=1d | stats 
estdc(data.search_props.sid) AS search_count by searchType _time | eval 
data=""\""""+searchType+""\"":""+tostring(search_count) | stats delim="","" values(data) as data by _time | 
rename _time as date | mvcombine data | eval data=""{""+data+""}"" | rename date as _time | eval 
date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.smartStore.accountTypes,,always,24h,"|rest splunk_server=local /services/configs/conf-indexes | eval scheme=if(storageType == ""remote"", 
mvindex(split(path,"":""), 0), ""local"") | eval 
scheme=case(scheme==""gs"",""gcp"",scheme==""s3"",""aws"",scheme!=""local"",scheme) | stats list(scheme) as 
accountTypes delim="","" by splunk_server | nomv accountTypes | fillnull value="""" accountTypes | eval 
accountTypes=""\""accountTypes\"":\"""" + accountTypes + ""\"""" | fields accountTypes, splunk_server"
instrumentation.usage.smartStore.capacity,,always,24h,"|rest splunk_server=local /services/server/status/partitions-space | makejson available, capacity, 
free, fs_type, output=""cap"" | eval cap=""\""""+title+""\"": ""+cap+"""" | stats list(cap) AS capList BY 
splunk_server | eval capCombined=""\""total storage capacity\"":{"" + mvjoin(capList, "", "") + ""}"" | 
fields capCombined, splunk_server"
instrumentation.usage.smartStore.global,,always,24h,"|rest splunk_server=local /services/configs/conf-server | where title in 
(""cachemanager"",""diskUsage"", ""clustering"") | eval 
data=""\""""+title+""\"":"",hotlist_recency_secs=if(isnull(hotlist_recency_secs), ""none"", 
hotlist_recency_secs), 
hotlist_bloom_filter_recency_hours=if(isnull(hotlist_bloom_filter_recency_hours), ""none"", 
hotlist_bloom_filter_recency_hours) | eval data=if(title=""diskUsage"", 
data+""{\""minFreeSpace\"":\""""+minFreeSpace+""\""}"", data), data=if(title=""cachemanager"", 
data+""{\""eviction_padding\"":\""""+eviction_padding+""\"",\""max_cache_size\"":\""""+max_cache_size+""\"", 
\""hotlist_recency_secs\"":\""""+hotlist_recency_secs+""\"", 
\""hotlist_bloom_filter_recency_hours\"":\""""+hotlist_bloom_filter_recency_hours+""\""}"", data), 
data=if(title=""clustering"", data+""{\""mode\"":\""""+mode+""\""""+if(mode=""master"", 
"",\""search_factor\"":\""""+search_factor+""\"",\""multisite\"":\""""+multisite+""\"",\""site_replication_factor\
"":\""""+site_replication_factor+""\"",\""site_search_factor\"":\""""+site_search_factor+""\""}"", ""}""), data) | 
stats list(data) AS dataList BY splunk_server | eval globalConfig=""\""global config\"":{"" + 
mvjoin(dataList, "","") + ""}"" | fields globalConfig, splunk_server"
instrumentation.usage.smartStore.perIndex,,always,24h,"|rest splunk_server=local /services/configs/conf-indexes | appendcols [|rest splunk_server=local 
/servicesNS/nobody/splunk_instrumentation/telemetry | fields telemetrySalt]| eval 
title_dist=if(match(title, ""^([^_].*?)\s*""),""external"",""internal""), 
s2Enabled=if(isnotnull(remotePath),""SmartStore enabled"", ""non-SmartStore 
enabled""),hotlist_recency_secs=if(isnull(hotlist_recency_secs), ""none"", hotlist_recency_secs), 
hotlist_bloom_filter_recency_hours=if(isnull(hotlist_bloom_filter_recency_hours), ""none"", 
hotlist_bloom_filter_recency_hours) | makejson frozenTimePeriodInSecs, hotlist_recency_secs, 
hotlist_bloom_filter_recency_hours, maxHotSpanSecs, maxGlobalDataSizeMB, output=""indexConfig"" | eval 
telemetrySalt=if(isnull(telemetrySalt), """", telemetrySalt), hashTitle=sha1(telemetrySalt+title), 
title_combine=title_dist+""_""+hashTitle, indexConfig=""\""""+title_combine+""\"":"" + indexConfig | stats 
list(hashTitle) AS titleList,list(indexConfig) AS indexList BY s2Enabled, splunk_server | eval 
indexConfig=mvjoin(indexList, "",""), titleCombined=""\""""+s2Enabled+""\"":\"""" + mvjoin(titleList, "","") 
+""\"""" | stats list(titleCombined) AS s2List, list(indexConfig) AS indexList BY splunk_server| eval 
s2Enabled=""\""list of indexes\"":{"" + mvjoin(s2List, "","") + ""}"", indexConfig=""\""per index config\"":{"" 
+ mvjoin(indexList, "","") + ""}""  | fields s2Enabled, indexConfig, splunk_server"
instrumentation.usage.streamingMetricAlerts,,always,24h,"| rest servicesNS/-/-/alerts/metric_alerts | eval name=sha1(title), hasFilter=if(filter=="""", ""No"", 
""Yes""), hasGroupby=if(groupby=="""", ""No"", ""Yes""), 
triggerActionPerGroup=if('trigger.action_per_group'==1, ""Yes"", ""No""), 
triggerEvaluationPerGroup=if('trigger.evaluation_per_group'==1, ""Yes"", ""No""), 
triggerSuppress=if('trigger.suppress'==1, ""Yes"", ""No""), 
triggerPrepare=if(isnotnull('trigger.prepare'), ""Yes"", ""No""), 
alertTrackable=if('splunk_ui.track'==1, ""Yes"", ""No""), 
triggerThreshold=if(isnotnull('trigger.threshold'), 'trigger.threshold', ""N/A""), actionList="""", 
hasDescription=if(description=="""", ""No"", ""Yes""), alertSeverity=if(isnull('splunk_ui.severity'), 
""N/A"", 'splunk_ui.severity'), triggerExpires='trigger.expires', 
triggerMaxTracked='trigger.max_tracked' | eval actionList=if('action.email'==1, 
actionList."","".""email"", actionList), actionList=if('action.logevent'==1, actionList."","".""logevent"", 
actionList), actionList=if('action.rss'==1, actionList."","".""rss"", actionList), 
actionList=if('action.script'==1, actionList."","".""script"", actionList), 
actionList=if('action.webhook'==1, actionList."","".""webhook"", actionList) | eval 
actionList=if(actionList=="""", actionList, substr(actionList,2)) | eval hasLabels=""No"", 
hasComplexCondition=""No"" | foreach label* [| eval hasLabels=if(isnull('<<FIELD>>'), hasLabels, 
""Yes"")] | eval hasMultipleMetricIndexes=if(match(metric_indexes, "",""), ""Yes"", ""No""), 
hasComplexCondition=if(match(condition, ""OR"") OR match(condition, ""AND""), ""Yes"", 
hasComplexCondition) | fields name, hasFilter, hasGroupby, triggerActionPerGroup, 
triggerEvaluationPerGroup, triggerThreshold, triggerSuppress, triggerPrepare, alertTrackable, 
actionList, hasDescription, alertSeverity, triggerExpires, triggerMaxTracked, hasLabels, 
hasMultipleMetricIndexes, hasComplexCondition | makejson name hasFilter hasGroupby 
triggerActionPerGroup triggerEvaluationPerGroup triggerThreshold triggerSuppress triggerPrepare 
alertTrackable actionList hasDescription alertSeverity triggerExpires triggerMaxTracked hasLabels 
hasMultipleMetricIndexes hasComplexCondition output=""data"" | eval _time=now(), date=strftime(_time, 
""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.users.active,,always,24h,"index=_audit sourcetype=audittrail TERM(action=search) user!=""splunk-system-user"" user!=""n/a"" | bin 
_time span=1d | stats estdc(user) as active by _time | eval data=""{\""active\"":""+tostring(active)+""}"" 
| eval date=strftime(_time, ""%Y-%m-%d"") | fields _time date data"
instrumentation.usage.workloadManagement.category,,always,24h,"NOT() | append [rest splunk_server=local /services/workloads/categories | eval 
data=""\""""+title+""\"":{\""allocated cpu percent\"":\""""+cpu_allocated_percent+""\"", \""allocated mem 
limit\"":\""""+mem_allocated_percent+""\""}"" | stats list(data) AS categoryList | eval 
categoryCombined=mvjoin(categoryList, "", "") | fields categoryCombined]"
instrumentation.usage.workloadManagement.enabled,,always,24h,"NOT() | append [rest splunk_server=local /services/workloads/status | eval 
support='general.isSupported', enabled='general.enabled', os_name='general.os_name', 
os_version='general.os_version'| fields support, enabled, os_name, os_version]"
instrumentation.usage.workloadManagement.pools,,always,24h,"NOT() | append [rest splunk_server=local /services/workloads/pools | eval 
isDeafultPool=if(default_category_pool=1, ""True"", ""False""), poolList=""\""""+title+""\"":{\""allocated cpu 
percent\"":\""""+cpu_allocated_percent+""\"", \""allocated mem limit\"":\""""+mem_allocated_percent+""\"", 
\""default category pool\"":\""""+isDeafultPool+""\""}"" | stats list(poolList) AS poolList, count BY 
category | eval poolList=""\""""+category+""\"":{\""count\"":""+count+"",""+mvjoin(poolList, "", "")+""}"" | stats 
sum(count) AS poolTotal list(poolList) AS poolList| eval poolCombined=mvjoin(poolList, "", "") | 
fields poolCombined, poolTotal]"
instrumentation.usage.workloadManagement.rules,,always,24h,"NOT() | append [rest splunk_server=local /services/workloads/rules | eval 
data=""\""""+title+""\"":{\""order\"":\""""+order+""\"", \""predicate\"":\""""+predicate+""\"", \""workload 
pool\"":\""""+workload_pool+""\""}"" | stats list(data) AS ruleList, count AS ruleTotal by splunk_server | 
eval ruleCombined=mvjoin(ruleList, "", "") | fields ruleTotal, ruleCombined]"
Investigation into 45.32.2228.159,,always,24h,"| tstats summariesonly=t sum(All_Traffic.bytes) AS Bytes sum(All_Traffic.bytes_in) as Bytes_In  
sum(All_Traffic.bytes_out) as Bytes_Out FROM datamodel=Network_Traffic WHERE 

    sourcetype=""cp_Firewall"" 

    All_traffic.dest_ip = ""45.32.228.159""

    NOT All_Traffic.action IN ( ""Drop"" )

    BY 

    _time span=5m , All_Traffic.src_ip

| rename All_Traffic.* AS * 

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location 

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location 

| rename src_ip AS ""Source IP""

| eval GBytes_Out = round(Bytes_Out / 1024 /1024 /1024, 2) 

| eval GBytes_In = round(Bytes_In / 1024 /1024 /1024, 2) 

| fields _time, GBytes_In, GBytes_Out"
IPS tuning,,always,24h,"index=""prod_checkpoint"" sourcetype=""cp_IPS"" severity=Critical OR High

|  stats count by attack,attack_info,severity"
KVStore Synchronization,,always,24h,| synckvstore
License Usage Data Cube,,always,24h,"index=_internal source=*license_usage.log* type=""Usage"" | eval h=if(len(h)=0 OR 
isnull(h),""(SQUASHED)"",h) | eval s=if(len(s)=0 OR isnull(s),""(SQUASHED)"",s) | eval idx=if(len(idx)=0 
OR isnull(idx),""(UNKNOWN)"",idx) | bin _time span=1d | stats sum(b) as b by _time, pool, s, st, h, 
idx"
"List of Applications, Time of install, User and Host for the last 7 days",,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" SourceName=MsiInstaller EventCode=11707 

| rex field=Message ""(?s)Product: (?<product_name>.*) --"" 

| table _time host User product_name"
List of Failed KB installs in the last 7 days,,always,24h,"`windows-index` OR `wineventlog-index` NOT [ search eventtype=""Update_Successful"" | dedup package, 
host | fields + host, package ] 

eventtype=""Update_Failed"" package=* 

| dedup host package 

| stats count, max(_time) as latest_failure_time by host,package 

| sort - latest_failure_time | convert ctime(latest_failure_time) 

| eval kb_details=""KB"".package."" (Total Fails="".tostring(count)."") (Last Failure 
at:"".latest_failure_time."")"" 

| stats sum(count) as total_fails, values(kb_details) as latest_fail_details by host"
List of failed service starts for the last 30 days,,always,24h,"`wineventlog-index` source=wineventlog:system SourceName=""Microsoft-Windows-Service Control Manager"" 
""service failed to start"" 

| rex field=Message ""^The (?<Service_Name>.*) service failed"" 

| fields + _time,host,Service_Name"
List of KB successful and failed KB installation for the last 30 days,,always,24h,"`windows-index` OR `wineventlog-index` tag=Windows_Update package=* 

| dedup package, host 

| eval status=if(eventtype==""Update_Successful"", ""Success"", if(eventtype==""Update_Failed"", ""Failed"", 
""NA"")) 

| search NOT status=""NA""  

| stats latest(_time) as ltime, count by status, host, package 

| convert ctime(ltime) 

| eval lsuccess=""Succesful at ("".ltime."")"" 

| eval lfail=""Failed at ("".ltime."")"" 

| eval lstatus=if(status==""Success"",lsuccess,lfail) 

| stats values(lstatus) as Status_History by host, package 

| sort host,package 

| eval scount=mvcount(Status_History) 

| eval Last_Status=if(scount>1,""Success"",if(match(Status_History, ""Success*""),""Success"",""Failed"")) 

| table host, package, Last_Status, Status_History 

| sort host,package"
List of shutdowns for last 30 days,,always,24h,"`wineventlog-index` source=wineventlog:system ""EventCode=1076"" OR ""EventCode=6008"" 

| rex field=Message ""(?m)(?<cause>.*)$"" 

| fields + _time,host,cause"
List of Successful installations (non-KB) for the last 7 days,,always,24h,"`windows-index` OR `wineventlog-index` eventtype=""Update_Successful"" 

| dedup package, host 

| chart count,max(_time) as latest_install_time by package 

| sort - latest_install_time 

| convert ctime(latest_install_time)"
List of unexpected service terminations for the last 30 days,,always,24h,"`wineventlog-index` source=wineventlog:system terminated (""EventCode=7034"" OR ""EventCode=7031"") 

| rex field=Message ""(?i)^The (?<Service_Name>.*) service terminated unexpectedly.\s+It has done 
this (?<num_failures>\d+)"" 

| fields + _time,host,Service_Name"
List Pipeline Jobs,,always,24h,"`pipeline_stage_sourcetype` [| inputlookup jenkins_jobs | tail 1 | eval earliest=last_modified | 
return earliest]

| fields job_name, host 

| eval path=mvjoin(mvindex(split(job_name, ""/""), 0, -2), ""/"") 

| stats count by host, path 

| lookup jenkins_jobs host, path OUTPUTNEW path as existing 

| fillnull 

| search existing=0 

| eval last_modified=now() 

| table host, path, last_modified 

| outputlookup jenkins_jobs append=true"
Log4j search parameters,,always,24h,"index=prod_checkpoint sourcetype=cp_ips industry_reference IN (""CVE-2021-44228"", ""CVE-2021-45046"")"
Lookup - Locations,Updates the ISE_Locations.csv lookup file,always,24h,"eventtype=""cisco-ise"" Location=""*"" | stats count by Location | inputlookup append=T 
ISE_Locations.csv | stats count by Location | table Location | outputlookup ISE_Locations.csv"
Machine Learning: Recommendation,,always,24h,| recommend
Mail delivery time,,always,24h,index=sample | transaction fields=qid | timechart avg(duration)
Message size by relay,,always,24h,index=sample from | timechart avg(size) by relay
Messages by minute last 3 hours,,always,24h,"index=_internal source=""*metrics.log"" eps ""group=per_source_thruput"" NOT filetracker | eval 
events=eps*kb/kbps | timechart fixedrange=t span=1m limit=5 sum(events) by series"
MI License Usage,,always,24h,"index=_internal host=*.splunkcloud.com NOT host=sh*.splunkcloud.com source=*license_usage.log* 
type=""RolloverSummary""

| bin _time span=1d

| stats latest(b) AS b by slave, pool, _time

| eval b=b/1024/1024/1024, limit=300

| timechart span=1d values(limit) as limit sum(b) AS ""volume (GB)"" fixedrange=true

| rename _time as Date

| convert timeformat=""%b %e"" ctime(Date)"
Mimecast Block by IP report,,always,24h,"index=prod_mimecast IP=135.148.156.239 OR 107.174.142.73 OR 106.75.123.51 OR 104.223.22.122 OR 
103.11.188.82 OR 68.226.42.116 OR 64.188.9.97 OR 23.94.80.171 OR 212.34.142.72 OR 212.129.54.30"
Mimecast Domain Top Talkers,,always,24h,"index=prod_mimecast 

| eval temp=split(Sender,""@"") | eval senderDomain=mvindex(temp, 1) 

| eval temp=split(Rcpt,""@"") | eval rcptDomain=mvindex(temp, 1) 

| stats count by senderDomain, rcptDomain

| sort count desc"
Mimecast Inbound/Outbound Top talkers,,always,24h,"index=prod_mimecast Sender != ""<>"" AND Sender != ""smsstatus@textapp.net""  AND Sender != ""noreply*"" 
AND Sender != ""no-reply*"" AND Sender != ""bounce*""

|  stats count by Sender, Rcpt, Dir

| sort count desc"
Mimecast Top Talkers,,always,24h,"index=prod_mimecast Sender != ""<>"" AND Sender != ""smsstatus@textapp.net""  AND Sender != ""noreply*"" 
AND Sender != ""no-reply*"" AND Sender != ""bounce*"" AND Sender != ""donotreplycovea*"" AND Sender != 
""mail@*"" AND Sender != ""info@*""

|  eval temp=split(Sender,""@"") 

|  eval senderDomain=mvindex(temp, 1) 

|  stats count by Sender, Rcpt, Dir

| sort count desc"
ms_ad_obj_cfg_macro_chk,Scheduled Search for Checking the Health of the macro defined indexes.,always,24h,| `ms_obj_cfg_macro_chk`
ms_ad_obj_dev_user_delete_missing_fields,,always,24h,"| makeresults 

| eval 
field=""DomainDNSName,OU,accountExpires,adminCount,badPasswordTime,badPwdCount,c,cn,orig_cn,codePage,
countryCode,dSCorePropagationData,dcName,deletedDate,department,description,displayName,distinguishe
dName,dn,dn_path,domain,givenName,guid_lookup,initials,instanceType,isCriticalSystemObject,isDeleted
,isRecycled,l,lastKnownParent,lastLogon,lastLogonTimestamp,last_evt_flg,lockoutTime,logonCount,logon
Hours,managedBy,memberOf,msDS-SupportedEncryptionTypes,name,objectCategory,objectClass,objectGUID,ob
jectSid,physicalDeliveryOfficeName,postalCode,primaryGroupID,pwdLastSet,sAMAccountName,sAMAccountTyp
e,servicePrincipalName,showInAdvancedViewOnly,sid_lookup,sn,st,streetAddress,title,uSNChanged,uSNCre
ated,userAccountControl,userPrincipalName,userWorkstations,whenChanged,whenCreated"" 

| makemv delim="","" field 

| eval match=""true"" 

| mvexpand field 

| table field, match

| join field type=left 

    [search  eventtype=ms_ad_obj_msad_data (admonEventType=Deleted) 
objectClass=""top|person|organizationalPerson|user"" 

| fieldsummary 

    | table field, match, values] 

| table field, match, values 

| sort match, field

| search NOT values=""[{*""

| stats values(field) AS field

| eval field=mvjoin(field,"","")"
mscs virtual_machine ip,,always,24h,"index=* sourcetype=""mscs:resource:networkInterfaceCard"" ""properties.virtualMachine.id""=* | dedup 
""properties.virtualMachine.id"" | eval 
private_ip_public_ip_id=mvzip('properties.ipConfigurations{}.properties.privateIPAddress', 
'properties.ipConfigurations{}.properties.publicIPAddress.id', "", "") | mvexpand 
private_ip_public_ip_id | rex field=private_ip_public_ip_id 
""(?<private_ip>\S*),\s(?<public_ip_id>.*)"" | rename ""properties.virtualMachine.id"" AS vm_id | fields 
vm_id private_ip public_ip_id | join type=left public_ip_id [| search index=* 
sourcetype=""mscs:resource:publicIPAddress"" | rename id AS public_ip_id | rename 
""properties.ipAddress"" AS public_ip |fields public_ip_id public_ip] | table vm_id private_ip 
public_ip | outputlookup mscs_vm_ip_lookup"
"Number of ""from"" messages",,always,24h,index=sample |stats count(from)
"Number of ""to"" messages",,always,24h,index=sample |stats count(to)
Number of hosts with Average CPU utilization > 80% in the last 24 hours,,always,24h,"`perfmon-index` eventtype=perfmon_windows Host=* object=""processor"" counter=""% processor time""|stats 
avg(Value) as Threshold by Host 

| eval range=case(Threshold<10, ""OK (<50%)"", Threshold<50, ""Warn (80%-94%)"", Threshold>50, ""Critical 
(95%+)"") 

| chart values(Host), count by range"
Number of reject events by relay,,always,24h,index=sample reject |stats count by relay
Office 365 Operations,,always,24h,"index=* index=prod_o365 

| stats count by Operation"
Okta2 app detail,Saved search which populates the okta2_app_detail_lookup.csv lookup file.,always,24h,"source=okta:im2 AND sourcetype=oktaim2:app | dedup id | table id, name, label, created, lastUpdated, 
status, signOnMode  | outputlookup okta2_app_detail_lookup"
Okta2 app group,Saved search which populates the okta2_app_assigned_group_lookup.csv lookup file.,always,24h,"source=""okta:im2"" AND sourcetype=""oktaim2:app"" | dedup id | mvexpand assigned_groups{} | table id, 
assigned_groups{} | rename id as app_id | rename assigned_groups{} as group_id | outputlookup 
okta2_app_group_lookup"
Okta2 app user,Saved search which populates the okta2_app_assigned_user_lookup.csv lookup file.,always,24h,"source=""okta:im2"" sourcetype=""oktaim2:appUser"" | dedup appid, userid | rename appid as app_id | 
rename userid as user_id | table app_id, user_id | outputlookup okta2_app_user_lookup"
Okta2 group detail,Saved search which populates the okta2_group_detail_lookup.csv lookup file.,always,24h,"source=okta:im2 AND sourcetype=oktaim2:group | dedup id | rename embedded.stats.usersCount as 
usersCount | rename embedded.stats.appsCount as appsCount | rename 
embedded.stats.groupPushMappingsCount as groupPushMappingsCount | rename embedded.app.id as app_id | 
rename profile.name AS name | rename profile.description AS description| table id, type, name, 
description, usersCount, appsCount, groupPushMappingsCount, app_id | outputlookup 
okta2_group_detail_lookup"
Okta2 group member,Saved search which populates the okta2_group_member_lookup.csv lookup file.,always,24h,"source=""okta:im2"" sourcetype=""oktaim2:groupUser"" | dedup groupid, userid | rename groupid as 
group_id | rename userid as user_id | table group_id, user_id | outputlookup 
okta2_group_member_lookup"
Okta2 user detail,Saved search which populates the okta2_user_detail_lookup.csv lookup file.,always,24h,"source=okta:im2 AND sourcetype=oktaim2:user | dedup id | table id, profile.firstName, 
profile.lastName, 
profile.login,profile.email,profile.secondEmail,profile.primaryPhone,profile.mobilePhone,profile.sta
te,profile.city,profile.countryCode,profile.zipCode,profile.streetAddress,status,created,lastUpdated
,lastLogin,activated | rename id as user_id | rename profile.firstName as firstName | rename 
profile.lastName as lastName | rename profile.login as loginName | rename profile.email as email | 
rename profile.secondEmail as secondEmail | rename profile.primaryPhone as primaryPhone | rename 
profile.mobilePhone as mobilePhone | rename profile.state as state | rename profile.city as city | 
rename profile.countryCode as countryCode | rename profile.zipCode as zipCode | rename 
profile.streetAddress as streetAddress | rename created as created_time | rename lastUpdated as 
lastUpdated_time | rename lastLogin as lastLogin_time | rename activated as activated_time | 
outputlookup okta2_user_detail_lookup"
Orphaned scheduled searches,,always,24h,"| rest timeout=600 splunk_server=local /servicesNS/-/-/saved/searches add_orphan_field=yes count=0 

| search orphan=1 disabled=0 is_scheduled=1 

| eval status = if(disabled = 0, ""enabled"", ""disabled"") 

| fields title eai:acl.owner eai:acl.app eai:acl.sharing orphan status is_scheduled cron_schedule 
next_scheduled_time next_scheduled_time actions 

| rename title AS ""search name"" eai:acl.owner AS owner eai:acl.app AS app eai:acl.sharing AS sharing"
People with Remote Censornet Tag,,always,24h,"index=""prod_censornet""| spath tag | search tag=""remote""

| stats count by user"
Performance counter categories and counts by host for the last 7 days,,always,24h,"`perfmon-index` eventtype=""perfmon_windows"" 

| stats values(object) as Perfmon_counter_Category, dc(counter) as Perfmon_counter_Count by Host 

| table Host, Perfmon_counter_Category, Perfmon_counter_Count 

| sort Host"
Products and the Content Mapped to Them,"This expects that you have completed the Data Inventory configuration, and mapped your active content on the Manage Bookmarks page. You will then get a complete view from product to the content that it enables.",always,24h,"| inputlookup data_inventory_products_lookup 

| search stage!=step-sourcetype stage!=step-cim 

| rex field=basesearch ""^\s*(?<basesearch>.*?)\s*$""

| eval basesearch=if(like(basesearch, ""(%"") AND like(basesearch, ""%)""), basesearch, ""("" . basesearch 
. "")"") 

| makemv delim=""|"" eventtypeId 

| mvexpand eventtypeId 

| rename eventtypeId as data_source_categories 

| join data_source_categories 

    [| sseanalytics 

    | search search_title!="""" 

    | stats count count(eval(bookmark_status=""successfullyImplemented"")) as 
count_successfullyImplemented values(search_title) as search_title by data_source_categories 

    | eval search_title=mvjoin(search_title, ""|"")] 

| eval Product = vendorName . "" "" . productName

| makemv delim=""|"" data_source_categories | mvexpand data_source_categories

| rex field=data_source_categories ""^(?<ds>[^-]*)"" | sseidenrichment type=datasourceid field=ds | 
sseidenrichment type=dscid field=data_source_categories | eval data_source_categories = data_source 
. "" > "" . data_source_category| stats values(*) as * by Product | search Product!="" "" 

| table Product basesearch data_source_categories metadata_json search_title count 

| spath input=metadata_json | fields - metadata_json

| table Product basesearch data_source_categories search_title * count 

| rename count as ""Total Mapped Content for This Product"" basesearch as ""Dataset That Provides 
Visibility"" search_title as ""Saved Search Name"" data_source_categories as ""Data Source Category"" 
description as Description"
RapidDiag Telemetry: CLI access statistics,,always,24h,"index=_internal sourcetype=""splunk_rapid_diag"" splunk_server=""local"" component=cli_internal 
token_auth=False mode=* action=* result=* 

| table mode, action , result 

| stats count AS data.count by mode, action, result 

| rename mode as data.mode, action as data.action , result AS data.result 

| makejson data.* output=event"
RapidDiag Telemetry: Execution statistics,,always,24h,"index=_internal sourcetype=""splunk_rapid_diag"" splunk_server=""local"" (component=task OR 
(component=collector internal=False)) name=* status=* 

| table component, name, status 

| eval name=substr(sha256(name),0,12) 

| stats count AS data.count by component, name, status 

| rename status as data.status, name as data.metricName, component AS data.type 

| makejson data.* output=event"
RapidDiag Telemetry: UI access statistics,,always,24h,"index=_internal sourcetype=""splunkd_ui_access"" app/splunk_rapid_diag/task_manager OR 
app/splunk_rapid_diag/task_template_wizard OR app/splunk_rapid_diag/data_collection OR 
app/splunk_rapid_diag/reference_guide method=GET splunk_server=""local"" 

| table user, uri_path, status 

| stats count AS data.count by user, uri_path, status 

| eval [| rest splunk_server=local /servicesNS/nobody/splunk_instrumentation/telemetry 

| table telemetrySalt 

| format 

| rex field=search mode=sed ""s/[()]//g""] 

| eval data.user=substr(sha256(telemetrySalt + user),0,12) 

| rename uri_path as data.uri_path, status as data.status 

| makejson data.* output=event"
RF Firewall Zone to Zone Traffic,,always,24h,"index=prod_cisco_asa OR index=prod_checkpoint

| rename inzone AS ""Source Zone"", src_zone as ""Source Zone"", outzone as destination_zone, dest_zone 
as destination_zone



| stats count by index, ""Source Zone"", destination_zone"
s2modecheck,"check _internal index path to see if remotePath is configured. If yes, S2 is enabled, if not, it is Non-S2 stack.",always,24h,"| rest splunk_server=idx* /services/data/indexes/_internal datatype=all f=title f=remotePath 
f=disabled"
Saved Searches and the Data that Enables Them,"This expects that you have completed the Data Inventory configuration, and mapped your active content on the Manage Bookmarks page. You will then be get a list oriented to the saved searches, showing each saved search and the data set and products that enable it",always,24h,"| inputlookup data_inventory_products_lookup 

| search stage!=step-sourcetype stage!=step-cim 

| rex field=basesearch ""^\s*(?<basesearch>.*?)\s*$"" 

| eval basesearch=if(like(basesearch, ""(%"") AND like(basesearch, ""%)""), basesearch, ""("" . basesearch 
. "")"") 

| makemv delim=""|"" eventtypeId 

| mvexpand eventtypeId 

| rename eventtypeId as data_source_categories 

| join data_source_categories 

    [| sseanalytics 

    | search search_title!="""" 

    | stats count count(eval(bookmark_status=""successfullyImplemented"")) as 
count_successfullyImplemented values(search_title) as search_title by bookmark_status 
data_source_categories 

    | eval search_title=mvjoin(search_title, ""|"")] 

| eval Product = vendorName . "" "" . productName 

| makemv search_title delim=""|"" 

| mvexpand search_title

| stats values(basesearch) as basesearch values(Product) as Product by search_title

| eval basesearch = ""("" . mvjoin(basesearch, "" OR "") . "")"", ""Products That Provide 
Visibility""=mvjoin(mvfilter(Product!="" ""), "", "")

| rename basesearch as ""Dataset That Provides Visibility"" search_title as ""Saved Search Name""

| table ""Saved Search Name"" ""Dataset That Provides Visibility"" ""Products That Provide Visibility"""
Sendmail transactions,,always,24h,index=sample | transaction msgid pid maxpause=48h | search linecount > 1
ServiceNow CMDB CI App Servers,Saved search which populates the CMDB CI App Servers from ServiceNow,always,24h,"eventtype=snow_cmdb_ci_app_server | dedup sys_id | fields - _bkt, 
_cd,_indextime,_kv,_raw,_serial,_si,_sourcetype,_subsecond, punct, index, source, sourcetype  | 
inputlookup append=t snow_cmdb_ci_app_server_lookup | dedup sys_id | outputlookup 
snow_cmdb_ci_app_server_lookup"
ServiceNow CMDB CI Database Instances,Saved search which populates the CMDB CI Database Instances from ServiceNow,always,24h,"eventtype=snow_cmdb_ci_db_instance | dedup sys_id | fields - _bkt, 
_cd,_indextime,_kv,_raw,_serial,_si,_sourcetype,_subsecond, punct, index, source, sourcetype  | 
inputlookup append=t snow_cmdb_ci_db_instance_lookup | dedup sys_id | outputlookup 
snow_cmdb_ci_db_instance_lookup"
ServiceNow CMDB CI Infra Services,Saved search which populates the CMDB CI Infra Services from ServiceNow,always,24h,"eventtype=snow_cmdb_ci_infra_service | dedup sys_id | fields - _bkt, 
_cd,_indextime,_kv,_raw,_serial,_si,_sourcetype,_subsecond, punct, index, source, sourcetype  | 
inputlookup append=t snow_cmdb_ci_infra_service_lookup | dedup sys_id | outputlookup 
snow_cmdb_ci_infra_service_lookup"
ServiceNow CMDB CI List,Saved search which populates the CMDB CI of ServiceNow,always,24h,"eventtype=snow_cmdb_ci_list | dedup sys_id | fields - _bkt, 
_cd,_indextime,_kv,_raw,_serial,_si,_sourcetype,_subsecond, punct, index, source, sourcetype  | 
inputlookup append=t snow_cmdb_ci_list_lookup | dedup sys_id | outputlookup snow_cmdb_ci_list_lookup"
ServiceNow CMDB CI Relation,Saved search which populates the CMDB CI Relations from ServiceNow,always,24h,"eventtype=snow_cmdb_rel_ci | dedup sys_id | fields - _bkt, 
_cd,_indextime,_kv,_raw,_serial,_si,_sourcetype,_subsecond, punct, index, source, sourcetype  | 
inputlookup append=t snow_cmdb_rel_ci_lookup | dedup sys_id | outputlookup snow_cmdb_rel_ci_lookup"
ServiceNow CMDB CI Server,Saved search which populates the CMDB CI Servers from ServiceNow,always,24h,"eventtype=snow_cmdb_ci_server | dedup sys_id | fields - _bkt, 
_cd,_indextime,_kv,_raw,_serial,_si,_sourcetype,_subsecond, punct, index, source, sourcetype  | 
inputlookup append=t snow_cmdb_ci_server_lookup | dedup sys_id | outputlookup 
snow_cmdb_ci_server_lookup"
ServiceNow CMDB CI Services,Saved search which populates the CMDB CI Relations from ServiceNow,always,24h,"eventtype=snow_cmdb_ci_service | dedup sys_id | fields - _bkt, 
_cd,_indextime,_kv,_raw,_serial,_si,_sourcetype,_subsecond, punct, index, source, sourcetype  | 
inputlookup append=t snow_cmdb_ci_service_lookup | dedup sys_id | outputlookup 
snow_cmdb_ci_service_lookup"
ServiceNow CMDB CI VM,Saved search which populates the CMDB CI VMs from ServiceNow,always,24h,"eventtype=snow_cmdb_ci_vm | dedup sys_id | fields - _bkt, 
_cd,_indextime,_kv,_raw,_serial,_si,_sourcetype,_subsecond, punct, index, source, sourcetype  | 
inputlookup append=t snow_cmdb_ci_vm_lookup | dedup sys_id | outputlookup snow_cmdb_ci_vm_lookup"
ServiceNow CMN Location List,This savedsearch will populate the CMN location of ServiceNow from the events that are indexed in last 2 hours in snow_cmn_location_list_lookup lookup.,always,24h,"eventtype=snow_cmn_location_list _index_earliest=-2h@h _index_latest=now | dedup sys_id | fields - 
_bkt, _cd,_indextime,_kv,_raw,_serial,_si,_sourcetype,_subsecond, punct, index, source, sourcetype  
| inputlookup append=t snow_cmn_location_list_lookup | dedup sys_id | outputlookup 
snow_cmn_location_list_lookup"
ServiceNow CMN Location List - Last 30 days,This saved-search will execute at the start of Splunk or when saved search is enabled. It will populate last 30days CMN location data of ServiceNow in snow_cmn_location_list_lookup lookup.,always,24h,"eventtype=snow_cmn_location_list | dedup sys_id | fields - _bkt, 
_cd,_indextime,_kv,_raw,_serial,_si,_sourcetype,_subsecond, punct, index, source, sourcetype  | 
inputlookup append=t snow_cmn_location_list_lookup | dedup sys_id | outputlookup 
snow_cmn_location_list_lookup"
ServiceNow Incident State,Saved search which populates incident state from ServiceNow,always,24h,"eventtype=snow_sys_choice_list name=""incident"" element=""state"" | eval incident_state_name=label | 
eval state=value | eval incident_state=value| dedup state, incident_state, incident_state_name | 
table state, incident_state, incident_state_name| inputlookup append=t snow_incident_state_lookup | 
dedup state | sort + state | outputlookup snow_incident_state_lookup"
ServiceNow Sys Choice List,Saved search which populates the sys choice list from ServiceNow,always,24h,"eventtype=snow_sys_choice_list  | table name, element, value, sys_id | inputlookup append=t 
snow_sys_choice_list_lookup | dedup sys_id | sort + name, element | outputlookup 
snow_sys_choice_list_lookup"
ServiceNow Sys User Group List,Saved search which populates the sys user group of ServiceNow,always,24h,"eventtype=snow_sys_user_group_list | dedup sys_id | fields - _bkt, 
_cd,_indextime,_kv,_raw,_serial,_si,_sourcetype,_subsecond, punct, index, source, sourcetype  | 
inputlookup append=t snow_sys_user_group_list_lookup | dedup sys_id | outputlookup 
snow_sys_user_group_list_lookup"
ServiceNow Sys User List,This savedsearch will populate the sys users of ServiceNow from the events that are indexed in last 2 hours in snow_sys_user_list_lookup lookup.,always,24h,"eventtype=snow_sys_user_list _index_earliest=-2h@h _index_latest=now | dedup sys_id | fields - _bkt, 
_cd, _indextime, _kv, _raw, _serial, _si, _sourcetype, _subsecond, punct, index, source, sourcetype  
| inputlookup append=t snow_sys_user_list_lookup | dedup sys_id | outputlookup 
snow_sys_user_list_lookup"
ServiceNow Sys User List - Last 30 days,This saved-search will execute at the start of Splunk or when saved search is enabled. It will populate last 30days sys user data of ServiceNow in snow_sys_user_list_lookup lookup.,always,24h,"eventtype=snow_sys_user_list | dedup sys_id | fields - _bkt, _cd, _indextime, _kv, _raw, _serial, 
_si, _sourcetype, _subsecond, punct, index, source, sourcetype  | inputlookup append=t 
snow_sys_user_list_lookup | dedup sys_id | outputlookup snow_sys_user_list_lookup"
SIM - Total Searchable Index Data,,always,24h,"`sim_searchable_index_storage` 

| logresults tag=TotalSearchableStorage"
SIM Splunkd - Data Parsing Issues,,always,24h,`data_parsing_issues`
SIM Splunkd - Distinct Apps,,always,24h,`distinct_apps`
SIM Splunkd - Distinct Users,,always,24h,`distinct_users`
SIM Splunkd - Long Running Searches,,always,24h,`long_running_searches`
SIM Splunkd - Scheduled Search Skip Ratio,,always,24h,`scheduled_search_skip_ratio`
SIM Splunkd - Total Page Views,,always,24h,`total_page_views`
SIM SS - Forwarder Build Asset Table,,always,24h,"`sim_build_forwarder_assets(1m)` 

| inputlookup append=true sim_forwarder_assets 

| stats values(forwarder_type) as forwarder_type, max(version) as version, values(arch) as arch, 
values(os) as os, max(last_connected) as last_connected, values(new_sum_kb) as sum_kb, 
values(new_avg_tcp_kbps_sparkline) as avg_tcp_kbps_sparkline, values(new_avg_tcp_kbps) as 
avg_tcp_kbps, values(new_avg_tcp_eps) as avg_tcp_eps by guid, hostname 

| addinfo 

| eval status = if(isnull(sum_kb) or (sum_kb <= 0) or (last_connected < (info_max_time - 900)), 
""missing"", ""active"") 

| eval sum_kb = round(sum_kb, 2) 

| eval avg_tcp_kbps = round(avg_tcp_kbps, 2) 

| eval avg_tcp_eps = round(avg_tcp_eps, 2) 

| fields guid, hostname, forwarder_type, version, arch, os, status, last_connected, sum_kb, 
avg_tcp_kbps_sparkline, avg_tcp_kbps, avg_tcp_eps 

| outputlookup sim_forwarder_assets"
SIM SS - License Usage Data Cube,,always,24h,"`sim_set_index_internal` `sim_set_license_master` source=*license_usage.log* type=""Usage"" | eval 
h=if(len(h)=0 OR isnull(h),""(SQUASHED)"",h) | eval s=if(len(s)=0 OR isnull(s),""(SQUASHED)"",s) | bin 
_time span=1d | stats sum(b) as b by _time, s, st, h, idx"
SIM SS - SAML Algorithm Compatibility,,always,24h,"| rest /services/properties/authentication/authentication/authType | fields value

| eval saml_enabled=case(value=""SAML"",1)

| stats count by host,saml_enabled

| stats values(saml_enabled) AS saml_enabled values(name) AS name by host

| fillnull saml_enabled value=0

| eventstats sum(saml_enabled) AS sum_saml

| where sum_saml>0

| fields - sum_saml

| join host type=outer [search (index=splunkd OR index=auth) 
source=/opt/splunk/var/log/splunk/splunkd.log `sim_set_search_head` component=UiSAML log_level=DEBUG 
""IDP response"" ""SignatureMethod Algorithm"" earliest=-60m

  | rex ""<(ds:|)SignatureMethod Algorithm=.+?\#(?<saml_algorithm>.+?)\""( \/|\/)\>""

  | fillnull saml_algorithm value=""unknown""

  | stats count by host,saml_algorithm

  | fields - count]

| eval order=1

| appendpipe [| inputlookup splunk_72_upgrade_saml.csv | eval order=2]

| sort host order saml_algorithm

| stats first(saml_algorithm) AS saml_algorithm first(saml_enabled) AS saml_enabled by host name

| outputlookup splunk_72_upgrade_saml.csv"
SIM SS - SAML Authentication Check,,always,24h,"index=btool file=authentication.conf `sim_set_search_head` stanza=""saml"" OR stanza=""duo-mfa""

| stats latest(signatureAlgorithm) AS signatureAlgorithm by host,stanza

| eval saml=case(stanza=""saml"",""yes"")

| eval duo=case(stanza=""duo-mfa"",""yes"")

| eval sha_status=case(stanza=""saml"" AND signatureAlgorithm=""RSA-SHA1"",1,stanza=""saml"" AND 
signatureAlgorithm=""RSA-SHA256"",0)

| eventstats sum(sha_status) AS sha_status1

| eval sha_status=case(sha_status1=0,""pass"",sha_status1>0,""fail"",isnull(sha_status1) AND 
stanza=""saml"",""unknown"")

| stats values(saml) AS saml values(duo) AS duo values(sha_status) AS sha_status

| outputlookup saml.csv"
SIM SVC - Log Data,,always,24h,"index=""summary"" source=""splunk-virtual-core-usage"" 

| bin _time span=1h 

| rename _time as svc_time 

| convert ctime(svc_time) 

| stats 

  max(License) as License, 

  max(utilization) as Utilization, 

  max(total_util) as total_util, 

  max(Provisioned) as Provisioned, 

  max(total_prov) as total_prov 

  by svc_time, role 

| logresults tag=SVC"
SiteInfo_Lookup_Migrate,,always,24h,"| outputlookup SiteInfo 

| inputlookup append=true SiteInfo.csv 

| eval _key = host 

| outputlookup SiteInfo"
SiteInfo_Lookup_Update,,always,24h,"`msad-index` eventtype=msad-dc-health 

| table host,Site 

| dedup host, Site 

| eval _key = host 

| outputlookup SiteInfo append=true"
Splunk errors last 24 hours,,always,24h,"index=_internal "" error "" NOT debug source=*splunkd.log*"
Splunk License Usage,Displays the amount of data ingested in from each logsource,always,24h,"index=_internal source=*license_usage.log type=""Usage""  

| eval indexname = if(len(idx)=0 OR isnull(idx),""(UNKNOWN)"",idx)  

| eval sourcetypename = st  

| bin _time span=1d  

| stats sum(b) as b by _time, pool, indexname, sourcetypename  

| eval GB=round(b/1024/1024/1024, 3)  

| fields _time, indexname, sourcetypename, GB  

| join sourcetypename [  | rest /services/saved/sourcetypes 

    | fields title, ""eai:acl.app""  

    | rename title AS sourcetypename, ""eai:acl.app"" AS app_name]

| sort - GB"
StatsCount,,always,24h,index=* | stats count as events by sourcetype index
Subnet List,,always,24h,| inputlookup C3Subnets
System_App Installs - By Host - Timechart - 7days,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" SourceName=MsiInstaller EventCode=11707 

| dedup _raw 

| rex field=Message ""(?s)Product: (?<product_name>.*) --"" 

| timechart span=1d count by host"
TC-CSV-Address-Indicator,Generate CSV of indicators from KV Store (ES - Local Ip Intel),always,24h,"| inputlookup tci_iott | search type=Address | eval description=(""ThreatConnect indicator from owner 
"" + ownerName) | rename indicator as ip | table description, ip, rating | outputlookup 
threatconnect_ip_indicators.csv"
TC-CSV-EmailAddress-Indicator,Generate CSV of indicators from KV Store (ES - Local Email Intel),always,24h,"| inputlookup tci_iott | search type=EmailAddress | eval description=(""ThreatConnect indicator from 
owner "" + ownerName) | eval subject=""N/A"" | rename indicator as src_user | table description, 
src_user, subject, rating | outputlookup threatconnect_email_indicators.csv"
TC-CSV-File-Indicator,Generate CSV of indicators from KV Store (ES - Local File Intel),always,24h,"| inputlookup tci_iott | search type=File | eval description=(""ThreatConnect indicator from owner "" 
+ ownerName) | eval file_name=""N/A"" | eval indicator=split(indicator,"" : "") | mvexpand indicator | 
rename indicator as file_hash | table description, file_hash, file_name, rating | outputlookup 
threatconnect_file_indicators.csv"
TC-CSV-Host-Indicator,Generate CSV of indicators from KV Store (ES - Local Domain Intel),always,24h,"| inputlookup tci_iott | search type=Host | eval description=(""ThreatConnect indicator from owner "" 
+ ownerName) | rename indicator as domain | table description, domain, rating | outputlookup 
threatconnect_domain_indicators.csv"
TC-CSV-URL-Indicator,Generate CSV of indicators from KV Store (ES - Local HTTP Intel),always,24h,"| inputlookup tci_iott | search type=URL | eval description=(""ThreatConnect indicator from owner "" + 
ownerName) | eval http_referrer=""N/A"" | eval http_user_agent=""N/A"" | rename indicator as url | table 
description, http_referrer, http_user_agent, url, rating | outputlookup 
threatconnect_http_indicators.csv"
TC-DataModel-Data,Retrieve Datamodel Data and Store in KV Store for fast access,always,24h,| tcdmu
TC-DataModel-Search-61ba38b8acdc2708056486c0,"ThreatConnect Data Model Search for ""T1078-ValidAccounts-MTTILogonFromWatchlistedAddressCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba38b8acdc2708056486c0
TC-DataModel-Search-61ba38e8acdc2708056486c1,"ThreatConnect Data Model Search for ""T1566-Phishing-MTTIHighRiskInboundEmailCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba38e8acdc2708056486c1
TC-DataModel-Search-61ba391eacdc270805648c9e,"ThreatConnect Data Model Search for ""T1566.001-PhishingSpearphishingAttachment-MTTIHighRiskAttachmentCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba391eacdc270805648c9e
TC-DataModel-Search-61ba3981acdc270805649e30,"ThreatConnect Data Model Search for ""T1566.002-PhishingSpearphishingLink-MTTIHighRiskEmailLinkCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba3981acdc270805649e30
TC-DataModel-Search-61ba39c4acdc27080564a40c,"ThreatConnect Data Model Search for ""T1071-ApplicationLayerProtocol-MTTIHighRiskInboundSignatureIntrusionCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba39c4acdc27080564a40c
TC-DataModel-Search-61ba39feacdc27080564a9e8,"ThreatConnect Data Model Search for ""T1071-ApplicationLayerProtocol-MTTIHighRiskOutboundSignatureIntrusionCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba39feacdc27080564a9e8
TC-DataModel-Search-61ba3a36acdc27080564afc4,"ThreatConnect Data Model Search for ""T1204.002-UserExecutionMaliciousFile-MTTIHighRiskFileHashIntrusionCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba3a36acdc27080564afc4
TC-DataModel-Search-61ba3a68acdc27080564b5a0,"ThreatConnect Data Model Search for ""T1204.002-UserExecutionMaliciousFile-MTTIHighRiskFileHashMalwareCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba3a68acdc27080564b5a0
TC-DataModel-Search-61ba3aa1acdc27080564bb7c,"ThreatConnect Data Model Search for ""T1204.001-UserExecutionMaliciousLink-MTTIHighRiskFileHashMalwareCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba3aa1acdc27080564bb7c
TC-DataModel-Search-61ba3af5acdc27080564c158,"ThreatConnect Data Model Search for ""T1071.004-ApplicationLayerProtocolDNS-MTTIHighRiskOutboundQueryDNSCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba3af5acdc27080564c158
TC-DataModel-Search-61ba3b29acdc27080564c734,"ThreatConnect Data Model Search for ""T1095-NonApplicationLayerProtocol-MTTIHighRiskInboundConnectionNetworkCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba3b29acdc27080564c734
TC-DataModel-Search-61ba3b66acdc27080564cd10,"ThreatConnect Data Model Search for ""T1095-NonApplicationLayerProtocol-MTTIHighRiskOutboundConnectionNetworkCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba3b66acdc27080564cd10
TC-DataModel-Search-61ba3ba8acdc27080564d2ec,"ThreatConnect Data Model Search for "" T1071.001-ApplicationLayerProtocolWebProtocols-MTTIHighRiskWebAddressCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba3ba8acdc27080564d2ec
TC-DataModel-Search-61ba3bdeacdc27080564d8c8,"ThreatConnect Data Model Search for ""T1071.001-ApplicationLayerProtocolWebProtocols-MTTIHighRiskWebDomainCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba3bdeacdc27080564d8c8
TC-DataModel-Search-61ba3c19acdc27080564dea4,"ThreatConnect Data Model Search for ""T1071.001-ApplicationLayerProtocolWebProtocols-MTTIHighRiskWebLinkCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba3c19acdc27080564dea4
TC-DataModel-Search-61ba44e4acdc27080564ea5b,"ThreatConnect Data Model Search for "" T1078-ValidAccounts-MTTILogonFromWatchlistedAddressCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba44e4acdc27080564ea5b
TC-DataModel-Search-61ba451eacdc27080564f037,"ThreatConnect Data Model Search for ""T1566-Phishing-MTTIHighRiskInboundEmailCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba451eacdc27080564f037
TC-DataModel-Search-61ba4558acdc27080564f613,"ThreatConnect Data Model Search for ""T1566.001-PhishingSpearphishingAttachment-MTTIHighRiskAttachmentCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba4558acdc27080564f613
TC-DataModel-Search-61ba458bacdc27080564fbef,"ThreatConnect Data Model Search for ""T1566.002-PhishingSpearphishingLink-MTTIHighRiskEmailLinkCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba458bacdc27080564fbef
TC-DataModel-Search-61ba4603acdc2708056501cb,"ThreatConnect Data Model Search for ""T1071-ApplicationLayerProtocol-MTTIHighRiskInboundSignatureIntrusionCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba4603acdc2708056501cb
TC-DataModel-Search-61ba464aacdc2708056507a7,"ThreatConnect Data Model Search for ""T1071-ApplicationLayerProtocol-MTTIHighRiskOutboundSignatureIntrusionCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba464aacdc2708056507a7
TC-DataModel-Search-61ba4687acdc270805650d83,"ThreatConnect Data Model Search for ""T1204.002-UserExecutionMaliciousFile-MTTIHighRiskFileHashIntrusionCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba4687acdc270805650d83
TC-DataModel-Search-61ba46beacdc27080565135f,"ThreatConnect Data Model Search for ""T1204.002-UserExecutionMaliciousFile-MTTIHighRiskFileHashMalwareCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba46beacdc27080565135f
TC-DataModel-Search-61ba46f9acdc27080565193b,"ThreatConnect Data Model Search for ""T1204.001-UserExecutionMaliciousLink-MTTIHighRiskFileHashMalwareCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba46f9acdc27080565193b
TC-DataModel-Search-61ba472eacdc270805651f17,"ThreatConnect Data Model Search for ""T1071.004-ApplicationLayerProtocolDNS-MTTIHighRiskOutboundQueryDNSCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba472eacdc270805651f17
TC-DataModel-Search-61ba476cacdc2708056524f3,"ThreatConnect Data Model Search for ""T1095-NonApplicationLayerProtocol-MTTIHighRiskInboundConnectionNetworkCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba476cacdc2708056524f3
TC-DataModel-Search-61ba47a5acdc270805652acf,"ThreatConnect Data Model Search for ""T1095-NonApplicationLayerProtocol-MTTIHighRiskOutboundConnectionNetworkCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba47a5acdc270805652acf
TC-DataModel-Search-61ba47ddacdc2708056530ab,"ThreatConnect Data Model Search for ""T1071.001-ApplicationLayerProtocolWebProtocols-MTTIHighRiskWebAddressCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba47ddacdc2708056530ab
TC-DataModel-Search-61ba4821acdc2708056530ac,"ThreatConnect Data Model Search for ""T1071.001-ApplicationLayerProtocolWebProtocols-MTTIHighRiskWebDomainCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba4821acdc2708056530ac
TC-DataModel-Search-61ba4858acdc2708056530ad,"ThreatConnect Data Model Search for ""T1071.001-ApplicationLayerProtocolWebProtocols-MTTIHighRiskWebLinkCIM-SPL01"".",always,24h,| tcdmsearch _key=61ba4858acdc2708056530ad
TC-DB-Stats,Stats Generator,always,24h,| tcdbstats
TC-Group-Download-10,"ThreatConnect Group Download for ""Blocklist.de Bruteforce IPs"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f4d
TC-Group-Download-102,"ThreatConnect Group Download for ""Shodan.io"".",always,24h,| tcgroupdownload owner_key=61ba1690acdc270805646f03
TC-Group-Download-106,"ThreatConnect Group Download for ""Censys"".",always,24h,| tcgroupdownload owner_key=61ba1690acdc270805646f04
TC-Group-Download-11,"ThreatConnect Group Download for ""Blocklist.de FTP IPs"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f4c
TC-Group-Download-112,"ThreatConnect Group Download for ""Emmet Test"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f53
TC-Group-Download-12,"ThreatConnect Group Download for ""Blocklist.de IMAP IPs"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f4b
TC-Group-Download-13,"ThreatConnect Group Download for ""Blocklist.de Mail IPs"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f4a
TC-Group-Download-14,"ThreatConnect Group Download for ""Blocklist.de SIP IPs"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f49
TC-Group-Download-15,"ThreatConnect Group Download for ""Blocklist.de SSH IPs"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f48
TC-Group-Download-16,"ThreatConnect Group Download for ""Blocklist.de Strong IPs"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f47
TC-Group-Download-17,"ThreatConnect Group Download for ""BotScout Bot List"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f46
TC-Group-Download-18,"ThreatConnect Group Download for ""Botvrij Domains"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f45
TC-Group-Download-19,"ThreatConnect Group Download for ""Botvrij IPs"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f44
TC-Group-Download-20,"ThreatConnect Group Download for ""BruteForceBlocker Blocklist"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f43
TC-Group-Download-21,"ThreatConnect Group Download for ""CAL COVID19-themed Newly Registered Domains"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f42
TC-Group-Download-22,"ThreatConnect Group Download for ""CAL Communications-themed NRDs"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f41
TC-Group-Download-23,"ThreatConnect Group Download for ""CAL Energy-themed NRDs"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f40
TC-Group-Download-24,"ThreatConnect Group Download for ""CAL Finance-themed NRDs"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f3f
TC-Group-Download-25,"ThreatConnect Group Download for ""CAL Healthcare-themed NRDs"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f3e
TC-Group-Download-26,"ThreatConnect Group Download for ""CAL Manufacturing-themed NRDs"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f3d
TC-Group-Download-27,"ThreatConnect Group Download for ""CAL Retail-themed NRDs"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f3c
TC-Group-Download-28,"ThreatConnect Group Download for ""CAL Suspected DGA NRDs"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f3b
TC-Group-Download-29,"ThreatConnect Group Download for ""CAL Suspected Ranking Manipulators"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f3a
TC-Group-Download-30,"ThreatConnect Group Download for ""CAL Suspicious Nameservers"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f39
TC-Group-Download-31,"ThreatConnect Group Download for ""CAL Suspicious New Resolution IPs"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f38
TC-Group-Download-32,"ThreatConnect Group Download for ""CAL Suspicious Newly Registered Domains"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f37
TC-Group-Download-33,"ThreatConnect Group Download for ""CINS Army IP List"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f36
TC-Group-Download-34,"ThreatConnect Group Download for ""Cedia.org.ec Immortal Domains"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f35
TC-Group-Download-35,"ThreatConnect Group Download for ""Cert-pa.it Latest Malware Analysis"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f34
TC-Group-Download-36,"ThreatConnect Group Download for ""Cryptam"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f33
TC-Group-Download-37,"ThreatConnect Group Download for ""Cybercrime Tracker"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f32
TC-Group-Download-38,"ThreatConnect Group Download for ""DShield.org Recommended Blocklist CIDRs"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f31
TC-Group-Download-39,"ThreatConnect Group Download for ""Disconnect.me Malvertising"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f30
TC-Group-Download-4,"ThreatConnect Group Download for ""Adarma"".",always,24h,| tcgroupdownload owner_key=61ba1690acdc270805646f02
TC-Group-Download-40,"ThreatConnect Group Download for ""Firebog Airelle Hrsk Domains"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f2f
TC-Group-Download-41,"ThreatConnect Group Download for ""Firebog Prigent Malware Domains"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f2e
TC-Group-Download-42,"ThreatConnect Group Download for ""Firebog Prigent Phishing Domains"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f2d
TC-Group-Download-43,"ThreatConnect Group Download for ""Firebog Shalla Malware Domains"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f2c
TC-Group-Download-44,"ThreatConnect Group Download for ""GreenSnow Blocklist"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f2b
TC-Group-Download-45,"ThreatConnect Group Download for ""Haley SSH Bruteforce IPs"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f2a
TC-Group-Download-46,"ThreatConnect Group Download for ""Hybrid Analysis"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f29
TC-Group-Download-48,"ThreatConnect Group Download for ""MalShare Daily Malware List"".",always,24h,| tcgroupdownload owner_key=61ba1693acdc270805646f28
TC-Group-Download-49,"ThreatConnect Group Download for ""Maldun Malware Analysis"".",always,24h,| tcgroupdownload owner_key=61ba1692acdc270805646f27
TC-Group-Download-5,"ThreatConnect Group Download for ""Bambenek"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f52
TC-Group-Download-50,"ThreatConnect Group Download for ""Malware Domain Blocklist"".",always,24h,| tcgroupdownload owner_key=61ba1692acdc270805646f26
TC-Group-Download-51,"ThreatConnect Group Download for ""MalwareConfig"".",always,24h,| tcgroupdownload owner_key=61ba1692acdc270805646f25
TC-Group-Download-52,"ThreatConnect Group Download for ""Manwe Mac Malware"".",always,24h,| tcgroupdownload owner_key=61ba1692acdc270805646f24
TC-Group-Download-53,"ThreatConnect Group Download for ""Minotaur URLs"".",always,24h,| tcgroupdownload owner_key=61ba1692acdc270805646f23
TC-Group-Download-54,"ThreatConnect Group Download for ""OpenPhish"".",always,24h,| tcgroupdownload owner_key=61ba1692acdc270805646f22
TC-Group-Download-55,"ThreatConnect Group Download for ""PDFExaminer"".",always,24h,| tcgroupdownload owner_key=61ba1692acdc270805646f21
TC-Group-Download-56,"ThreatConnect Group Download for ""PhishTank"".",always,24h,| tcgroupdownload owner_key=61ba1692acdc270805646f20
TC-Group-Download-57,"ThreatConnect Group Download for ""Rutgers Attacker IPs"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f1f
TC-Group-Download-58,"ThreatConnect Group Download for ""SARVAM"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f1e
TC-Group-Download-59,"ThreatConnect Group Download for ""StopForumSpam Toxic CIDRs"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f1d
TC-Group-Download-6,"ThreatConnect Group Download for ""Blocklist.de Apache IPs"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f51
TC-Group-Download-60,"ThreatConnect Group Download for ""VXVault"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f1c
TC-Group-Download-61,"ThreatConnect Group Download for ""WSTNPHX Malware Email Addresses"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f1b
TC-Group-Download-62,"ThreatConnect Group Download for ""abuse.ch CryptoWall Ransomware C2 Domain Blocklist"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f1a
TC-Group-Download-63,"ThreatConnect Group Download for ""abuse.ch Feodo Tracker"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f19
TC-Group-Download-64,"ThreatConnect Group Download for ""abuse.ch Locky Ransomware C2 Domain Blocklist"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f18
TC-Group-Download-65,"ThreatConnect Group Download for ""abuse.ch Ransomware Domain Blocklist"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f17
TC-Group-Download-66,"ThreatConnect Group Download for ""abuse.ch Ransomware Tracker"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f16
TC-Group-Download-67,"ThreatConnect Group Download for ""abuse.ch TeslaCrypt Ransomware C2 Domain Blocklist"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f15
TC-Group-Download-68,"ThreatConnect Group Download for ""abuse.ch TorrentLocker Ransomware C2 Domain Blocklist"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f14
TC-Group-Download-69,"ThreatConnect Group Download for ""abuse.ch URLHaus"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f13
TC-Group-Download-7,"ThreatConnect Group Download for ""Technical Blogs and Reports"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f50
TC-Group-Download-70,"ThreatConnect Group Download for ""abuse.ch Zeus Tracker"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f12
TC-Group-Download-71,"ThreatConnect Group Download for ""dan.me Tor Exit Nodes"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f11
TC-Group-Download-72,"ThreatConnect Group Download for ""hpHosts Exploit Domains"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f10
TC-Group-Download-73,"ThreatConnect Group Download for ""hpHosts Malware Distribution Domains"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f0f
TC-Group-Download-74,"ThreatConnect Group Download for ""hpHosts Phishing Domains"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f0e
TC-Group-Download-78,"ThreatConnect Group Download for ""DigitalSide"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f0d
TC-Group-Download-79,"ThreatConnect Group Download for ""abuse.ch SSL IP Blocklist"".",always,24h,| tcgroupdownload owner_key=61ba1691acdc270805646f0c
TC-Group-Download-8,"ThreatConnect Group Download for ""ThreatConnect Intelligence"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f4f
TC-Group-Download-80,"ThreatConnect Group Download for ""dan.me Tor Full Nodes"".",always,24h,| tcgroupdownload owner_key=61ba1690acdc270805646f0b
TC-Group-Download-81,"ThreatConnect Group Download for ""DynamicDNS"".",always,24h,| tcgroupdownload owner_key=61ba1690acdc270805646f0a
TC-Group-Download-83,"ThreatConnect Group Download for ""Phishtank ATO"".",always,24h,| tcgroupdownload owner_key=61ba1690acdc270805646f09
TC-Group-Download-84,"ThreatConnect Group Download for ""FS-ISAC"".",always,24h,| tcgroupdownload owner_key=61ba1690acdc270805646f08
TC-Group-Download-85,"ThreatConnect Group Download for ""NCSC CiSP"".",always,24h,| tcgroupdownload owner_key=61ba1690acdc270805646f07
TC-Group-Download-86,"ThreatConnect Group Download for ""MITRE ATT&CK"".",always,24h,| tcgroupdownload owner_key=61ba1690acdc270805646f06
TC-Group-Download-9,"ThreatConnect Group Download for ""Blocklist.de Bot IPs"".",always,24h,| tcgroupdownload owner_key=61ba1694acdc270805646f4e
TC-Group-Download-90,"ThreatConnect Group Download for ""CIRCL"".",always,24h,| tcgroupdownload owner_key=61ba1690acdc270805646f05
TC-Indicator-Download-10,"ThreatConnect Indicator Download for ""Blocklist.de Bruteforce IPs"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f4d
TC-Indicator-Download-102,"ThreatConnect Indicator Download for ""Shodan.io"".",always,24h,| tciocdownload owner_key=61ba1690acdc270805646f03
TC-Indicator-Download-106,"ThreatConnect Indicator Download for ""Censys"".",always,24h,| tciocdownload owner_key=61ba1690acdc270805646f04
TC-Indicator-Download-11,"ThreatConnect Indicator Download for ""Blocklist.de FTP IPs"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f4c
TC-Indicator-Download-112,"ThreatConnect Indicator Download for ""Emmet Test"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f53
TC-Indicator-Download-12,"ThreatConnect Indicator Download for ""Blocklist.de IMAP IPs"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f4b
TC-Indicator-Download-13,"ThreatConnect Indicator Download for ""Blocklist.de Mail IPs"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f4a
TC-Indicator-Download-14,"ThreatConnect Indicator Download for ""Blocklist.de SIP IPs"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f49
TC-Indicator-Download-15,"ThreatConnect Indicator Download for ""Blocklist.de SSH IPs"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f48
TC-Indicator-Download-16,"ThreatConnect Indicator Download for ""Blocklist.de Strong IPs"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f47
TC-Indicator-Download-17,"ThreatConnect Indicator Download for ""BotScout Bot List"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f46
TC-Indicator-Download-18,"ThreatConnect Indicator Download for ""Botvrij Domains"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f45
TC-Indicator-Download-19,"ThreatConnect Indicator Download for ""Botvrij IPs"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f44
TC-Indicator-Download-20,"ThreatConnect Indicator Download for ""BruteForceBlocker Blocklist"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f43
TC-Indicator-Download-21,"ThreatConnect Indicator Download for ""CAL COVID19-themed Newly Registered Domains"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f42
TC-Indicator-Download-22,"ThreatConnect Indicator Download for ""CAL Communications-themed NRDs"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f41
TC-Indicator-Download-23,"ThreatConnect Indicator Download for ""CAL Energy-themed NRDs"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f40
TC-Indicator-Download-24,"ThreatConnect Indicator Download for ""CAL Finance-themed NRDs"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f3f
TC-Indicator-Download-25,"ThreatConnect Indicator Download for ""CAL Healthcare-themed NRDs"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f3e
TC-Indicator-Download-26,"ThreatConnect Indicator Download for ""CAL Manufacturing-themed NRDs"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f3d
TC-Indicator-Download-27,"ThreatConnect Indicator Download for ""CAL Retail-themed NRDs"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f3c
TC-Indicator-Download-28,"ThreatConnect Indicator Download for ""CAL Suspected DGA NRDs"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f3b
TC-Indicator-Download-29,"ThreatConnect Indicator Download for ""CAL Suspected Ranking Manipulators"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f3a
TC-Indicator-Download-30,"ThreatConnect Indicator Download for ""CAL Suspicious Nameservers"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f39
TC-Indicator-Download-31,"ThreatConnect Indicator Download for ""CAL Suspicious New Resolution IPs"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f38
TC-Indicator-Download-32,"ThreatConnect Indicator Download for ""CAL Suspicious Newly Registered Domains"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f37
TC-Indicator-Download-33,"ThreatConnect Indicator Download for ""CINS Army IP List"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f36
TC-Indicator-Download-34,"ThreatConnect Indicator Download for ""Cedia.org.ec Immortal Domains"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f35
TC-Indicator-Download-35,"ThreatConnect Indicator Download for ""Cert-pa.it Latest Malware Analysis"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f34
TC-Indicator-Download-36,"ThreatConnect Indicator Download for ""Cryptam"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f33
TC-Indicator-Download-37,"ThreatConnect Indicator Download for ""Cybercrime Tracker"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f32
TC-Indicator-Download-38,"ThreatConnect Indicator Download for ""DShield.org Recommended Blocklist CIDRs"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f31
TC-Indicator-Download-39,"ThreatConnect Indicator Download for ""Disconnect.me Malvertising"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f30
TC-Indicator-Download-4,"ThreatConnect Indicator Download for ""Adarma"".",always,24h,| tciocdownload owner_key=61ba1690acdc270805646f02
TC-Indicator-Download-40,"ThreatConnect Indicator Download for ""Firebog Airelle Hrsk Domains"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f2f
TC-Indicator-Download-41,"ThreatConnect Indicator Download for ""Firebog Prigent Malware Domains"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f2e
TC-Indicator-Download-42,"ThreatConnect Indicator Download for ""Firebog Prigent Phishing Domains"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f2d
TC-Indicator-Download-43,"ThreatConnect Indicator Download for ""Firebog Shalla Malware Domains"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f2c
TC-Indicator-Download-44,"ThreatConnect Indicator Download for ""GreenSnow Blocklist"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f2b
TC-Indicator-Download-45,"ThreatConnect Indicator Download for ""Haley SSH Bruteforce IPs"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f2a
TC-Indicator-Download-46,"ThreatConnect Indicator Download for ""Hybrid Analysis"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f29
TC-Indicator-Download-48,"ThreatConnect Indicator Download for ""MalShare Daily Malware List"".",always,24h,| tciocdownload owner_key=61ba1693acdc270805646f28
TC-Indicator-Download-49,"ThreatConnect Indicator Download for ""Maldun Malware Analysis"".",always,24h,| tciocdownload owner_key=61ba1692acdc270805646f27
TC-Indicator-Download-5,"ThreatConnect Indicator Download for ""Bambenek"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f52
TC-Indicator-Download-50,"ThreatConnect Indicator Download for ""Malware Domain Blocklist"".",always,24h,| tciocdownload owner_key=61ba1692acdc270805646f26
TC-Indicator-Download-51,"ThreatConnect Indicator Download for ""MalwareConfig"".",always,24h,| tciocdownload owner_key=61ba1692acdc270805646f25
TC-Indicator-Download-52,"ThreatConnect Indicator Download for ""Manwe Mac Malware"".",always,24h,| tciocdownload owner_key=61ba1692acdc270805646f24
TC-Indicator-Download-53,"ThreatConnect Indicator Download for ""Minotaur URLs"".",always,24h,| tciocdownload owner_key=61ba1692acdc270805646f23
TC-Indicator-Download-54,"ThreatConnect Indicator Download for ""OpenPhish"".",always,24h,| tciocdownload owner_key=61ba1692acdc270805646f22
TC-Indicator-Download-55,"ThreatConnect Indicator Download for ""PDFExaminer"".",always,24h,| tciocdownload owner_key=61ba1692acdc270805646f21
TC-Indicator-Download-56,"ThreatConnect Indicator Download for ""PhishTank"".",always,24h,| tciocdownload owner_key=61ba1692acdc270805646f20
TC-Indicator-Download-57,"ThreatConnect Indicator Download for ""Rutgers Attacker IPs"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f1f
TC-Indicator-Download-58,"ThreatConnect Indicator Download for ""SARVAM"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f1e
TC-Indicator-Download-59,"ThreatConnect Indicator Download for ""StopForumSpam Toxic CIDRs"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f1d
TC-Indicator-Download-6,"ThreatConnect Indicator Download for ""Blocklist.de Apache IPs"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f51
TC-Indicator-Download-60,"ThreatConnect Indicator Download for ""VXVault"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f1c
TC-Indicator-Download-61,"ThreatConnect Indicator Download for ""WSTNPHX Malware Email Addresses"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f1b
TC-Indicator-Download-62,"ThreatConnect Indicator Download for ""abuse.ch CryptoWall Ransomware C2 Domain Blocklist"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f1a
TC-Indicator-Download-63,"ThreatConnect Indicator Download for ""abuse.ch Feodo Tracker"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f19
TC-Indicator-Download-64,"ThreatConnect Indicator Download for ""abuse.ch Locky Ransomware C2 Domain Blocklist"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f18
TC-Indicator-Download-65,"ThreatConnect Indicator Download for ""abuse.ch Ransomware Domain Blocklist"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f17
TC-Indicator-Download-66,"ThreatConnect Indicator Download for ""abuse.ch Ransomware Tracker"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f16
TC-Indicator-Download-67,"ThreatConnect Indicator Download for ""abuse.ch TeslaCrypt Ransomware C2 Domain Blocklist"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f15
TC-Indicator-Download-68,"ThreatConnect Indicator Download for ""abuse.ch TorrentLocker Ransomware C2 Domain Blocklist"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f14
TC-Indicator-Download-69,"ThreatConnect Indicator Download for ""abuse.ch URLHaus"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f13
TC-Indicator-Download-7,"ThreatConnect Indicator Download for ""Technical Blogs and Reports"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f50
TC-Indicator-Download-70,"ThreatConnect Indicator Download for ""abuse.ch Zeus Tracker"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f12
TC-Indicator-Download-71,"ThreatConnect Indicator Download for ""dan.me Tor Exit Nodes"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f11
TC-Indicator-Download-72,"ThreatConnect Indicator Download for ""hpHosts Exploit Domains"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f10
TC-Indicator-Download-73,"ThreatConnect Indicator Download for ""hpHosts Malware Distribution Domains"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f0f
TC-Indicator-Download-74,"ThreatConnect Indicator Download for ""hpHosts Phishing Domains"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f0e
TC-Indicator-Download-78,"ThreatConnect Indicator Download for ""DigitalSide"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f0d
TC-Indicator-Download-79,"ThreatConnect Indicator Download for ""abuse.ch SSL IP Blocklist"".",always,24h,| tciocdownload owner_key=61ba1691acdc270805646f0c
TC-Indicator-Download-8,"ThreatConnect Indicator Download for ""ThreatConnect Intelligence"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f4f
TC-Indicator-Download-80,"ThreatConnect Indicator Download for ""dan.me Tor Full Nodes"".",always,24h,| tciocdownload owner_key=61ba1690acdc270805646f0b
TC-Indicator-Download-81,"ThreatConnect Indicator Download for ""DynamicDNS"".",always,24h,| tciocdownload owner_key=61ba1690acdc270805646f0a
TC-Indicator-Download-83,"ThreatConnect Indicator Download for ""Phishtank ATO"".",always,24h,| tciocdownload owner_key=61ba1690acdc270805646f09
TC-Indicator-Download-84,"ThreatConnect Indicator Download for ""FS-ISAC"".",always,24h,| tciocdownload owner_key=61ba1690acdc270805646f08
TC-Indicator-Download-85,"ThreatConnect Indicator Download for ""NCSC CiSP"".",always,24h,| tciocdownload owner_key=61ba1690acdc270805646f07
TC-Indicator-Download-86,"ThreatConnect Indicator Download for ""MITRE ATT&CK"".",always,24h,| tciocdownload owner_key=61ba1690acdc270805646f06
TC-Indicator-Download-9,"ThreatConnect Indicator Download for ""Blocklist.de Bot IPs"".",always,24h,| tciocdownload owner_key=61ba1694acdc270805646f4e
TC-Indicator-Download-90,"ThreatConnect Indicator Download for ""CIRCL"".",always,24h,| tciocdownload owner_key=61ba1690acdc270805646f05
TC-Label-Data,Retrieve Label Data and Store in KV Store for fast access,always,24h,"| tclabelmanager action=""refresh_labels"""
TC-Observations,Post Indicator Observations to ThreatConnect,always,24h,| tcobservations
Teams Externals Added and Removed,,always,24h,"`m365_default_index` sourcetype=""o365:management:activity"" Workload=MicrosoftTeams 
Members{}.UPN=*\#ext\#* (Operation=MemberAdded OR Operation=MemberRemoved)

| dedup _raw

| rename Members{}.UPN AS memberUpn

| eval UserId =lower(UserId)  | rex field=UserId ""@(?<src_domain>.*)""

| eval memberUpn =lower(memberUpn)  | rex field=memberUpn ""(?<email>.*)\#ext\#"" | rex mode=sed 
field=email ""s/_(?!.*_)/@/g"" | rex field=email ""@(?<target_domain>.*)"" 

|transaction email maxspan=86400s startswith=Operation=""MemberAdded"" 
endswith=Operation=""MemberRemoved""

| where eventcount > 1

| eval starttime=_time | eval endtime=_time+duration

| stats count by email, CommunicationType, ItemName, UserId, starttime, endtime, duration

| convert ctime(starttime) ctime(endtime)

| eval duration = round(duration / 60,1)

| sort + duration

| rename UserId AS ""Internal User""  email AS ""External Account"" CommunicationType AS ""Team/Channel"" 
ItemName AS ""Added & Removed From""  duration AS ""Mins between Add/Remove"" starttime AS Added endtime 
AS Removed

| fields - count

| table  ""Internal User""  ""Added & Removed From"" ""External Account"" ""Team/Channel""  Added Removed 
""Mins between Add/Remove"""
Telemetry - AWS Security and CWL Input Snapshot,,always,24h,|dmtelemetryinputslookup |makejson output=data
Telemetry - Data Manager Global Configuration Information,,always,24h,|dmtelemetryglobalconfiglookup |makejson output=data
temp_build_inputs_lookup,,always,24h,"index=temp | rex ""(?msi)(?:\[)(?<input_stanza>[^\]]+)\](\r|\n)(?<input_setting_ex>.*)(\r|\n|$)""

| rex ""(?msi)(?:##Header##) (?<input_type>[^(\r|\n|#)]+)""

| rex ""(?msi)(?:##SubHeader(##\s|\s+))(?<input_sub_type>[^(\r|\n|#)]+)""

| eval input_setting=replace(input_setting_ex,""(\r|\n)"",""#DIV#"")

| makemv delim=""#DIV#"" input_setting_ex

| rex field=input_stanza ""^(?<input_stanza_type>[^(\:|\/)]+)""

| eval input_type=if(input_type==""Splunk 5.0+ Performance Counters "",""Performance 
Counters"",if(input_stanza==""script://.\bin\win_timesync_status.bat"",""TimeSync Status 
Script"",input_type))

| eval input_description=if(isnull(input_sub_type),input_stanza_type."" - 
"".input_type,input_stanza_type."" - "".input_type."" - "".input_sub_type)

| mvexpand input_setting_ex

| search input_setting_ex!=""##*""

| rex field=input_setting_ex ""^(?<input_key>[^\=]+)\=(?<input_value>[^$]+)""

| eval input_key=trim(input_key),input_value=trim(input_value)

| eval recommended_value=input_value,can_edit=""false"",win_vers_filt="""",target_group=""AD/DNS or Base 
Windows"",special_config_notes=""""

| table 
input_stanza_type,input_stanza,input_description,input_key,input_value,input_setting_ex,recommended_
value,can_edit,win_vers_filt,target_group,special_config_notes

| outputlookup ms_ad_obj_inputs_vals.csv"
tHostInfo_Lookup_Migrate,,always,24h,| inputlookup tHostInfo.csv | outputlookup tHostInfo
tHostInfo_Lookup_Update,,always,24h,"`wineventlog-index` `thostinfo`|inputlookup append=T tHostInfo|where _time > relative_time(now(), 
""-30d@d"")|sort 0 src_ip,src_hostdomain,_time|dedup consecutive=T src_ip,src_hostdomain|sort 0 
-_time|outputlookup tHostInfo"
Top 10 Blocked hosts by protocol,,always,24h,"| tstats count FROM datamodel=Network_Traffic WHERE index=prod_checkpoint All_Traffic.action=Drop BY 
All_Traffic.src All_Traffic.dest, All_Traffic.dest_port

| lookup C3Subnets subnet as All_Traffic.src OUTPUT location as src_location

| lookup C3Subnets subnet as All_Traffic.dest OUTPUT location as dest_location

| lookup C3_WellKnownPorts port as All_Traffic.dest_port OUTPUT description AS ""Well Known Port""

| sort -count

| head 10

| table All_Traffic.src, src_location , All_Traffic.dest , All_Traffic.dest_port, ""Well Known Port"", 
dest_location, count"
Top recipients,,always,24h,index=sample | top to
Top recipients - pie chart,,always,24h,index=sample | top to limit=10
Top recipients by mailer,,always,24h,index=sample | timechart count(to) by mailer
Top recipients by mailer - area chart,,always,24h,index=sample | timechart count(to) by mailer
Top Talkers by Protocol,,always,24h,"index=*  

| eval bytes_total = bytes_in + bytes_out

| stats sum(bytes_total) as Total_Bytes sum(bytes_out) as Total_Bytes_out sum(bytes_in) as 
Total_Bytes_in by host, src_ip ,  dest_ip, hostname, app

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location

| eval KB_out = Total_Bytes_out /1024

| eval MB_out = KB_out /1024

| eval GB_out = round(MB_out / 1024,2)

| eval KB_in = Total_Bytes_in /1024

| eval MB_in = KB_in /1024

| eval GB_in = round(MB_in / 1024,2)

| eval KB_Total = Total_Bytes /1024

| eval MB_Total = KB_Total /1024

| eval GB_Total = round(MB_Total / 1024, 2)

| table host,src_ip, src_location, dest_ip, dest_location, hostname, app, GB_Total,Total_Bytes, 
GB_out, Total_Bytes_out, GB_in, Total_Bytes_in

| sort - Total_Bytes"
Top Talkers to/From Unknown Subnets,,always,24h,"index=*  

| eval bytes_total = bytes_in + bytes_out

| stats sum(bytes_total) as Total_Bytes sum(bytes_out) as Total_Bytes_out sum(bytes_in) as 
Total_bytes_in values(appi_name) as APPI_Name by host, src_ip ,  dest_ip, hostname 

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location

| eval KB_out = Total_Bytes_out /1024

| eval MB_out = KB_out /1024

| eval GB_out = round(MB_out / 1024,2)

| eval KB_in = Total_Bytes_in /1024

| eval MB_in = KB_in /1024

| eval GB_in = round(MB_in / 1024,2)

| eval KB_Total = Total_Bytes /1024

| eval MB_Total = KB_Total /1024

| eval GB_Total = round(MB_Total / 1024, 2)

| table host,src_ip, src_location, dest_ip, dest_location, hostname, APPI_name, 
GB_Total,Total_Bytes, GB_Out, Total_Bytes_out, GB_In, Total_bytes_in

| sort - Total_Bytes 

|  search src_location = unknown OR dest_location = unknown"
Top Talkers V2,,always,24h,"index=*  

| eval bytes_total = bytes_in + bytes_out

| stats sum(bytes_total) as Total_Bytes sum(bytes_out) as Total_Bytes_out sum(bytes_in) as 
Total_Bytes_in values(appi_name) as APPI_Name by host, src_ip ,  dest_ip, hostname 

| lookup C3Subnets subnet as src_ip OUTPUT location as src_location

| lookup C3Subnets subnet as dest_ip OUTPUT location as dest_location

| eval KB_out = Total_Bytes_out /1024

| eval MB_out = KB_out /1024

| eval GB_out = round(MB_out / 1024,2)

| eval KB_in = Total_Bytes_in /1024

| eval MB_in = KB_in /1024

| eval GB_in = round(MB_in / 1024,2)

| eval KB_Total = Total_Bytes /1024

| eval MB_Total = KB_Total /1024

| eval GB_Total = round(MB_Total / 1024, 2)

| table host,src_ip, src_location, dest_ip, dest_location, hostname, APPI_name, 
GB_Total,Total_Bytes, GB_out, Total_Bytes_out, GB_in, Total_Bytes_in

| sort - Total_Bytes"
tSessions_Lookup_Migrate,,always,24h,| inputlookup tSessions.csv | outputlookup tSessions
tSessions_Lookup_Update,,always,24h,"`wineventlog-index` `tsessions`|eval _key = session_id |sort 0 _time|outputlookup tSessions  
append=true"
tSessions_Lookup_Update_For_Lost_Data,,always,24h,"`wineventlog-index` `tsessions`|eval _key = session_id |sort 0 _time|outputlookup tSessions  
append=true"
tSessions_Lookup_Update_One_Time,,always,24h,"`wineventlog-index` eventtype=wineventlog_security session_id=""*x*"" session_id!=""0x3e7"" 
earliest=-7d@d latest=now() 

| eval login_username = if(eventtype==""msad-successful-user-logons"",user,NULL) 

    | eval login_domain=if(eventtype==""msad-successful-user-logons"",dest_nt_domain,NULL) 

    | stats earliest(_time) as _time values(eventtype) as eventtype count as eventcount 
values(src_ip) as src_ip values(user) as user values(host) as host values(login_username) as 
login_username values(login_domain) as login_domain by session_id 

    | where eventtype==""msad-successful-user-logons"" AND eventcount>=1 AND isnotnull(src_ip) AND 
isnotnull(user) 

    | eval login_host=if(src_ip==""127.0.0.1"" OR src_ip==""::1"" OR src_ip==""-"",upper(host),src_ip) 

    | table _time,session_id,login_username,login_domain,login_host |eval _key = session_id |sort 0 
_time|outputlookup tSessions  append=true"
tSessions_Lookup_Update_Per_Day,,always,24h,"| inputlookup tSessions | where _time > relative_time(now(), ""-7d@d"") | outputlookup tSessions"
Users Logging into Servers,,always,24h,"index=prod_windows (category=""Credential Validation"") 

``` Defined list of service accounts ```

(NOT user IN ( svct-*, SVREplication, SVC_*, ""SVL-*"", ""DDSERVICE"" , ""svcl-*"", ""svc-*"" , ""SV-*"" 
,""SYSTEM"", ""*$"")) 

AND 

``` Defined list of client device types ```

( NOT src_nt_host IN (""V-P*"", ""L-*"", ""P-*"", ""RDG-P*"", ""WS-*"", ""S-*"", ""SLT-INF-DCC*"" ""S02DC*"", 
S02CXA* , V-BORDEREAUX*, S02TS* , HFX-L-TERMAPP* ) )

AND 

``` Set of Exchange hosts that the set of Users are approved to access them ```

NOT (src_nt_host IN (""SLT-INF-EXC*"") AND user IN (

""docsupdatetest"" , 

""tccdev"" , 

""tcctest"" , 

""HealthMailbox*"", 

""docsupdate"",

""CommercialInSource"", 

""*claims"" , 

""businessinsurance"", 

""commercial.post"" ,

""hcvt"", 

""hfxmt"" ) )

AND 

``` Jump boxes and authorised users ```

NOT (src_nt_host IN (""SLT-INF-JBD*"") AND user IN (

Matthew.Tyers, 

""Muhammad.Abdullah"",

""umar.chishti""

) )

AND

``` SAS Application servers and users ```

NOT (src_nt_host IN (""SLT-INF-SAS*"") AND user IN (

cameron.wells,



) )

| stats count by user, src_nt_host 

| sort by -count"
VPC Flow Logs Summary Generator - Dest IP,,always,24h,"`aws-vpc-flow-sourcetype` bytes!=""-"" | fields bytes packets aws_account_id dest_ip interface_id 
protocol vpcflow_action | stats sum(bytes) as bytes sum(packets) as packets by aws_account_id 
dest_ip interface_id protocol vpcflow_action | sort 10000 -packets | collect 
`aws-vpc-flow-log-index` source=""dest_ip"""
VPC Flow Logs Summary Generator - Dest Port,,always,24h,"`aws-vpc-flow-sourcetype` bytes!=""-"" | fields bytes packets aws_account_id dest_port interface_id 
protocol vpcflow_action | lookup well_known_ports port as dest_port protocol OUTPUT port as port | 
eval port=if(dest_port<=1024,dest_port,port) | rename port as dest_port | fillnull value=""Others"" 
dest_port | stats sum(bytes) as bytes sum(packets) as packets by aws_account_id dest_port 
interface_id protocol vpcflow_action | eventstats sum(packets) as total_packets sum(bytes) as 
total_bytes by interface_id aws_account_id protocol vpcflow_action | sort 10000 -packets | collect 
`aws-vpc-flow-log-index` source=""dest_port"""
VPC Flow Logs Summary Generator - Src IP,,always,24h,"`aws-vpc-flow-sourcetype` bytes!=""-"" | fields bytes packets aws_account_id src_ip interface_id 
protocol vpcflow_action | stats sum(bytes) as bytes sum(packets) as packets by aws_account_id src_ip 
interface_id protocol vpcflow_action | sort 10000 -packets | iplocation src_ip | collect 
`aws-vpc-flow-log-index` source=""src_ip"""
WinApp_Event_details - Migrate - Detail,,always,24h,"| inputlookup windows_event_details | 

 eval _key=sha256(LogName . ""___"" . EventCode . ""___"" . SourceName . ""___"" . TaskCategory . ""___"" . 
Type . ""___"" . EventCodeDescription) 

 | outputlookup windows_event_details"
WinApp_Lookup_Build_Event - CreateNew - Detail,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" 

| dedup EventCode 

| fields + LogName, EventCode, SourceName, TaskCategory, Type, EventCodeDescription 

| dedup EventCode, Type 

| table LogName, EventCode, SourceName, TaskCategory, Type, EventCodeDescription 

| sort  LogName, EventCode, SourceName, TaskCategory, Type, EventCodeDescription 

| outputlookup windows_event_details"
WinApp_Lookup_Build_Event - CreateNew - Server,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" 

| eval Host=if(isnull(Host), upper(host), upper(Host)) 

| fields Host 

| dedup Host 

| table Host 

| sort Host 

| outputlookup windows_event_system"
WinApp_Lookup_Build_Event - Migrate - Detail,,always,24h,"| outputlookup windows_event_details 

| inputlookup append=true windows_event_details.csv 

| eval _key = sha256(LogName . ""___"" . EventCode . ""___"" . SourceName . ""___"" . TaskCategory . ""___"" 
. Type . ""___"" . EventCodeDescription) 

| outputlookup windows_event_details"
WinApp_Lookup_Build_Event - Migrate - Server,,always,24h,"| outputlookup windows_event_system 

| inputlookup append=true windows_event_system.csv 

| eval _key = Host 

| outputlookup windows_event_system"
WinApp_Lookup_Build_Event - Update - Detail,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" 

| dedup EventCode, LogName 

| fields + LogName, EventCode, SourceName, TaskCategory, Type, EventCodeDescription, Message 

| eval EventCodeDescription=if(isnull(EventCodeDescription) OR len(trim(EventCodeDescription))==0 OR 
EventCode==""No Description Available-Update windows_eventcode_definitions"", mvindex(split(Message, 
"".""), 0), EventCodeDescription) 

| table LogName, EventCode, SourceName, TaskCategory, Type, EventCodeDescription 

| eval _key = sha256(LogName . ""___"" . EventCode . ""___"" . SourceName . ""___"" . TaskCategory . ""___"" 
. Type . ""___"" . EventCodeDescription) 

| outputlookup windows_event_details append=true"
WinApp_Lookup_Build_Event - Update - Server,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" 

| eval Host=if(isnull(Host), upper(host), upper(Host)) 

| stats count by Host 

| eval _key = Host 

| outputlookup windows_event_system append=true"
WinApp_Lookup_Build_Hostmon - CreateNew - Server,,always,24h,"`windows-index` eventtype=""hostmon_windows""

| eval Host=if(isnull(Host), upper(host), upper(Host)) 

| fields Host 

| dedup Host 

| table Host 

| sort Host 

| outputlookup windows_hostmon_system"
WinApp_Lookup_Build_Hostmon - Migrate - Server,,always,24h,"| outputlookup windows_hostmon_system 

| inputlookup append=true windows_hostmon_system.csv 

| eval _key = Host 

| outputlookup windows_hostmon_system key_field=Host"
WinApp_Lookup_Build_Hostmon - Update - Server,,always,24h,"`windows-index` eventtype=""hostmon_windows"" 

| eval Host=if(isnull(Host), upper(host), upper(Host)) 

| stats count by Host 

| eval _key = Host 

| outputlookup windows_hostmon_system append=true"
WinApp_Lookup_Build_Hostmon_FS - CreateNew - Detail,,always,24h,"`windows-index` eventtype=hostmon_windows Type=Disk 

| eval FreeSpacePct=round(FreeSpaceKB/TotalSpaceKB*100) 

| eval TotalSpaceGB=round(TotalSpaceKB/1024/1024) 

| dedup FileSystem, DriveType, FreeSpacePct, TotalSpaceGB 

| table FileSystem, DriveType, FreeSpacePct, TotalSpaceGB 

| outputlookup windows_hostmon_fs_details"
WinApp_Lookup_Build_Hostmon_FS - Migrate - Detail,,always,24h,"| outputlookup windows_hostmon_fs_details 

| inputlookup append=true windows_hostmon_fs_details.csv 

| eval _key = FileSystem . ""___"" . DriveType . ""___"" . FreeSpacePct . ""___"" . TotalSpaceGB 

| outputlookup windows_hostmon_fs_details"
WinApp_Lookup_Build_Hostmon_FS - Update - Detail,,always,24h,"`windows-index` eventtype=hostmon_windows Type=Disk 

| eval FreeSpacePct=round(FreeSpaceKB/TotalSpaceKB*100) 

| eval TotalSpaceGB=round(TotalSpaceKB/1024/1024) 

| stats count by FileSystem, DriveType, FreeSpacePct, TotalSpaceGB 

| eval _key = FileSystem . ""___"" . DriveType . ""___"" . FreeSpacePct . ""___"" . TotalSpaceGB 

| outputlookup windows_hostmon_fs_details append=true"
WinApp_Lookup_Build_Hostmon_Machine - CreateNew - Detail,,always,24h,"`windows-index` eventtype=""hostmon_windows"" Type=OperatingSystem 

| join host [search `windows-index` eventtype=hostmon_windows Type=Computer] 

| dedup OS, Domain, Architecture, Manufacturer 

| table OS, Domain, Architecture, Manufacturer 

| outputlookup windows_hostmon_machine_details"
WinApp_Lookup_Build_Hostmon_Machine - Migrate - Detail,,always,24h,"| outputlookup windows_hostmon_machine_details 

| inputlookup append=true windows_hostmon_machine_details.csv 

| eval _key = OS . ""___"" . Domain . ""___"" . Architecture . ""___"" . Manufacturer 

| outputlookup windows_hostmon_machine_details"
WinApp_Lookup_Build_Hostmon_Machine - Update - Detail,,always,24h,"`windows-index` eventtype=""hostmon_windows"" Type=OperatingSystem 

| join host [search `windows-index` eventtype=hostmon_windows Type=Computer earliest=-80m] 

| stats count by OS, Domain, Architecture, Manufacturer 

| eval _key = OS . ""___"" . Domain . ""___"" . Architecture . ""___"" . Manufacturer 

| outputlookup windows_hostmon_machine_details append=true"
WinApp_Lookup_Build_Hostmon_Process - CreateNew - Detail,,always,24h,"`windows-index` eventtype=hostmon_windows Type=Process 

| dedup Name 

| table Name 

| outputlookup windows_hostmon_process_details"
WinApp_Lookup_Build_Hostmon_Process - Migrate - Detail,,always,24h,"| outputlookup windows_hostmon_process_details 

| inputlookup append=true windows_hostmon_process_details.csv 

| eval _key = Name 

| outputlookup windows_hostmon_process_details"
WinApp_Lookup_Build_Hostmon_Process - Update - Detail,,always,24h,"`windows-index` eventtype=hostmon_windows Type=Process 

| stats count by Name 

| eval _key = Name 

| outputlookup windows_hostmon_process_details append=true"
WinApp_Lookup_Build_Hostmon_Services - CreateNew - Detail,,always,24h,"`windows-index` eventtype=hostmon_windows Type=Service 

| dedup Name, StartMode, State 

| table Name, StartMode, State 

| outputlookup windows_hostmon_services_details"
WinApp_Lookup_Build_Hostmon_Services - Migrate - Detail,,always,24h,"| outputlookup windows_hostmon_services_details 

| inputlookup append=true windows_hostmon_services_details.csv 

| eval _key = Name . ""___"" . StartMode . ""___"" . State 

| outputlookup windows_hostmon_services_details"
WinApp_Lookup_Build_Hostmon_Services - Update - Detail,,always,24h,"`windows-index` eventtype=hostmon_windows Type=Service 

| stats count by Name, StartMode, State 

| eval _key = Name . ""___"" . StartMode . ""___"" . State 

| outputlookup windows_hostmon_services_details append=true"
WinApp_Lookup_Build_Netmon - CreateNew - Detail,,always,24h,"`windows-index` eventtype=""netmon_windows"" 

| fields Direction Protocol PacketType RemoteHostName RemotePort LocalPort ProcessName UserName 

| dedup Direction Protocol PacketType RemoteHostName RemotePort LocalPort ProcessName UserName 

| table Direction Protocol PacketType RemoteHostName RemotePort LocalPort ProcessName UserName 

| sort Direction Protocol PacketType RemoteHostName RemotePort LocalPort ProcessName UserName 

| outputlookup windows_netmon_details"
WinApp_Lookup_Build_Netmon - CreateNew - Server,,always,24h,"`windows-index` eventtype=""netmon_windows"" 

| eval Host=if(isnull(Host), upper(host), upper(Host)) 

| stats count by Host 

| outputlookup windows_netmon_system"
WinApp_Lookup_Build_Netmon - Migrate - Detail,,always,24h,"| outputlookup windows_netmon_details 

| inputlookup append=true windows_netmon_details.csv 

| eval _key = sha256(Direction . ""___"" . Protocol . ""___"" . PacketType . ""___"" . RemoteHostName . 
""___"" . RemotePort . ""___"" . LocalPort . ""___"" . ProcessName . ""___"" . UserName) 

| outputlookup windows_netmon_details"
WinApp_Lookup_Build_Netmon - Migrate - Server,,always,24h,"| outputlookup windows_netmon_system 

| inputlookup append=true windows_netmon_system.csv 

| eval _key = Host 

| outputlookup windows_netmon_system key_field=Host"
WinApp_Lookup_Build_Netmon - Update - Detail,,always,24h,"`windows-index` eventtype=""netmon_windows"" 

| stats count by Direction Protocol PacketType RemoteHostName RemotePort LocalPort ProcessName 
UserName 

| sort Direction Protocol PacketType RemoteHostName RemotePort LocalPort ProcessName UserName 

| eval _key = sha256(Direction . ""___"" . Protocol . ""___"" . PacketType . ""___"" . RemoteHostName . 
""___"" . RemotePort . ""___"" . LocalPort . ""___"" . ProcessName . ""___"" . UserName) 

| outputlookup windows_netmon_details append=true"
WinApp_Lookup_Build_Netmon - Update - Server,,always,24h,"`windows-index` eventtype=""netmon_windows"" 

| eval Host=if(isnull(Host), upper(host), upper(Host)) 

| stats count by Host 

| eval _key = Host 

| outputlookup windows_netmon_system append=true"
WinApp_Lookup_Build_Perfmon - CreateNew - Detail,,always,24h,"`perfmon-index` eventtype=""perfmon_windows"" object=* 

| fillnull value=NA instance 

| dedup collection, object, counter, instance 

| table collection, object, counter, instance 

| outputlookup windows_perfmon_details"
WinApp_Lookup_Build_Perfmon - CreateNew - Server,,always,24h,"`perfmon-index` eventtype=""perfmon_windows"" object=* earliest=-60m 

| eval Host=if(isNull(Host),host,Host) 

| stats count by Host 

| outputlookup windows_perfmon_system"
WinApp_Lookup_Build_Perfmon - Migrate - Detail,,always,24h,"| outputlookup windows_perfmon_details 

| inputlookup append=true windows_perfmon_details.csv 

| eval _key = collection . ""___"" . object . ""___"" . counter . ""___"" . instance 

| outputlookup windows_perfmon_details"
WinApp_Lookup_Build_Perfmon - Migrate - Server,,always,24h,"| outputlookup windows_perfmon_system 

| inputlookup append=true windows_perfmon_system.csv 

| eval _key = Host 

| outputlookup windows_perfmon_system key_field=Host"
WinApp_Lookup_Build_Perfmon - Update - Detail,,always,24h,"`perfmon-index` eventtype=""perfmon_windows"" object=* 

| eval instance = if(isnull(instance), ""NA"", instance) 

| stats count by collection, object, counter, instance 

| sort collection, object, counter, instance 

| eval _key = collection . ""___"" . object . ""___"" . counter . ""___"" . instance 

| outputlookup windows_perfmon_details append=true"
WinApp_Lookup_Build_Perfmon - Update - Server,,always,24h,"`perfmon-index` eventtype=""perfmon_windows"" object=* 

| eval Host=if(isNull(Host),host,Host) 

| stats count by Host 

| eval _key = Host 

| outputlookup windows_perfmon_system append=true"
WinApp_Lookup_Build_Printmon - CreateNew,,always,24h,"`windows-index` sourcetype=WinPrintMon 

| eval Host=if(isnull(Host), upper(host), upper(Host)) 

| fields Host printer operation user 

| dedup Host printer operation user 

| table Host printer operation user 

| sort Host printer operation user 

| outputlookup windows_printmon"
WinApp_Lookup_Build_Printmon - Migrate,,always,24h,"| outputlookup windows_printmon 

| inputlookup append=true windows_printmon.csv 

| eval _key = Host . ""___"" . printer . ""___"" . operation . ""___"" . user 

| outputlookup windows_printmon"
WinApp_Lookup_Build_Printmon - Update,,always,24h,"`windows-index` sourcetype=WinPrintMon 

| eval Host=if(isnull(Host), upper(host), upper(Host)) 

| stats count by Host printer operation user 

| sort Host printer operation user 

| eval _key = Host . ""___"" . printer . ""___"" . operation . ""___"" . user 

| outputlookup windows_printmon append=true"
WinApp_Lookup_Event - Event Details,,always,24h,"| inputlookup windows_event_details

| table LogName, EventCode, SourceName, TaskCategory, Type, EventCodeDescription

| sort  LogName, EventCode, SourceName, TaskCategory, Type, EventCodeDescription"
WinApp_Lookup_Event - EventCode,,always,24h,"| inputlookup windows_event_details

| dedup EventCode

| table EventCode

| sort EventCode"
WinApp_Lookup_Event - EventCode Description,,always,24h,"| inputlookup windows_event_details

| dedup EventCode

| eval Event=EventCode."":"".EventCodeDescription

| table EventCode, EventCodeDescription, Event

| sort EventCode"
WinApp_Lookup_Event - Host,,always,24h,"| inputlookup windows_event_system

| dedup Host

| table Host

| sort Host"
WinApp_Lookup_Event - LogName,,always,24h,"| inputlookup windows_event_details

| dedup LogName

| table LogName

| sort LogName"
WinApp_Lookup_Event - TaskCategory,,always,24h,"| inputlookup windows_event_details

| dedup TaskCategory

| table TaskCategory

| sort TaskCategory"
"WinApp_Lookup_Perfmon - Collections, Object, and counters",,always,24h,"| inputlookup windows_perfmon_details

| stats values(counter) as Perfmon_counters by object

| sort object"
WinApp_Lookup_Perfmon - Combined,,always,24h,"| inputlookup windows_perfmon_details | dedup instance | table object, counter , instance | sort 
object, counter, instance"
WinApp_Lookup_Perfmon - counters and instances,,always,24h,"| inputlookup windows_perfmon_details

| eval Perfmon_counters=object."": "".counter

| stats values(instance) as Perfmon_instances by Perfmon_counters

| sort Perfmon_counters"
WinApp_Lookup_Perfmon - Host,,always,24h,"| inputlookup windows_perfmon_system

| dedup Host

| table Host

| sort Host"
WinApp_Lookup_Perfmon - Object,,always,24h,"| inputlookup windows_perfmon_details

| dedup object

| table object

| sort object"
WinApp_Netmon_Details - Migrate - Detail,,always,24h,"| inputlookup windows_netmon_details | 

 eval _key = sha256(Direction . ""___"" . Protocol . ""___"" . PacketType . ""___"" . RemoteHostName . 
""___"" . RemotePort . ""___"" . LocalPort . ""___"" . ProcessName . ""___"" . UserName) 

 | outputlookup windows_netmon_details"
Windows Failed Logins,,always,24h,"index=prod_windows EventCode=4776   action != ""success""  Logon_Account != ""*$""

| stats count by dest , Logon_Account, Source_Workstation

| search count > 5

| sort -count"
Windows Log Ons - on network,,always,24h,"| tstats summariesonly=t count FROM datamodel=Authentication WHERE

sourcetype=""WinEventLog""

Authentication.src_user IN (""james.prior"", ""jprior"")

BY

_time, Authentication.src_user span=1m

| rename Authentication.* AS *

| search count > 3"
WinMgmt_Security_Logon_Success Overall by Host,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common""(""EventCode=4776"" AND Keywords=""Audit Success"") OR 
(""EventCode=680"" AND ""Success Audit"") NOT (Logon_Account=""*$"" OR Logon_account=""*$"") 

| eval ""User_Account"" = coalesce(Logon_Account,Logon_account) 

| transaction ""User_Account"",Source_Workstation maxpause=5s 

| stats count by host 

| sort 10 -count"
WinMgmt_Security_Logon_Success Overtime,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" (""EventCode=4776"" AND Keywords=""Audit Success"") 
OR (""EventCode=680"" AND ""Success Audit"") NOT (Logon_Account=""*$"" OR Logon_account=""*$"") 

| eval ""User_Account"" = coalesce(Logon_Account,Logon_account) 

| transaction ""User_Account"",Source_Workstation maxpause=5s 

| timechart bins=1000 count"
WinMgmt_Security_Logon_Unsuccessful,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" (""EventCode=4776"" AND Keywords=""Audit Success"") 
OR (""EventCode=680"" AND ""Success Audit"") NOT (Logon_Account=""*$"" OR Logon_account=""*$"") 

| eval ""User_Account"" = coalesce(Logon_Account,Logon_account) 

| transaction ""User_Account"",Source_Workstation maxpause=5s  

| stats latest(_time) as ltime, count by User_Account, Source_Workstation, dest_nt_host, 
field_match_sum, duration 

| convert ctime(ltime)"
WinMgmt_System_Reboot Overtime,,always,24h,"`wineventlog-index` eventtype=""wineventlog_common"" EventCode=1074 SourceName=""USER32"" 

| rex field=_raw ""Comment:.(?<comment>.*)"" 

| rex field=Message ""The process.(?<process>[^ ]+)"" 

| transaction host maxspan=5m 

| eval user_count=mvcount(User) 

| eval final_user=case(user_count == 1, User, user_count > 1, mvindex(User, user_count-1))

| eval process_count=mvcount(process) 

| eval final_process=case(process_count == 1, process, process_count > 1, mvindex(process, 
process_count-1)) 

| search host=""*"" final_user=""*"" 

| table _time host final_user final_process comment 

| rename _time AS Time 

| convert ctime(Time) 

| rename final_user AS Username 

| rename final_process AS ""Process name"" 

| rename comment AS ""Comment"""
